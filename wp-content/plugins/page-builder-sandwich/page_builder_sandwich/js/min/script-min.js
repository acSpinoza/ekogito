function isBlankPage(){var editor=ContentTools.EditorApp.get();return editor.regions()["main-content"].html().match(/^\s*<p>\s*<\/p>\s*$/)}function openPageTemplates(ev){ev.preventDefault(),PBSEditor.pageTemplateFrame.open({title:pbsParams.labels.page_templates,button:isBlankPage()?pbsParams.labels.use_page_template:pbsParams.labels.replace_contents_with_template,successCallback:function(view){}.bind(this)})}!function(view){if(window.MSInputMethodContext&&document.documentMode||navigator.appVersion.indexOf("MSIE 10")!==-1){var constructors=["SVGSVGElement","SVGGElement"],dummy=document.createElement("dummy");if(!constructors[0]in view)return!1;if(Object.defineProperty){var innerHTMLPropDesc={get:function(){return dummy.innerHTML="",Array.prototype.slice.call(this.childNodes).forEach(function(node,index){dummy.appendChild(node.cloneNode(!0))}),dummy.innerHTML},set:function(content){var self=this,allNodes=Array.prototype.slice.call(self.childNodes),fn=function(to,node){if(1!==node.nodeType)return!1;var newNode=document.createElementNS("http://www.w3.org/2000/svg",node.nodeName);Array.prototype.slice.call(node.attributes).forEach(function(attribute){newNode.setAttribute(attribute.name,attribute.value)}),"TEXT"===node.nodeName&&(newNode.textContent=node.innerHTML),to.appendChild(newNode),node.childNodes.length&&Array.prototype.slice.call(node.childNodes).forEach(function(node,index){fn(newNode,node)})};content=content.replace(/<(\w+)([^<]+?)\/>/,"<$1$2></$1>"),allNodes.forEach(function(node,index){node.parentNode.removeChild(node)}),dummy.innerHTML=content,Array.prototype.slice.call(dummy.childNodes).forEach(function(node){fn(self,node)})},enumerable:!0,configurable:!0};try{constructors.forEach(function(constructor,index){Object.defineProperty(window[constructor].prototype,"innerHTML",innerHTMLPropDesc)})}catch(ex){}}else Object.prototype.__defineGetter__&&constructors.forEach(function(constructor,index){window[constructor].prototype.__defineSetter__("innerHTML",innerHTMLPropDesc.set),window[constructor].prototype.__defineGetter__("innerHTML",innerHTMLPropDesc.get)})}}(window),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var funcNameRegex=/function\s([^(]{1,})\(/,results=funcNameRegex.exec(this.toString());return results&&results.length>1?results[1].trim():""},set:function(){}}),function(){function CustomEvent(event,params){params=params||{bubbles:!1,cancelable:!1,detail:void 0};var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt}(window.MSInputMethodContext&&document.documentMode||navigator.appVersion.indexOf("MSIE 10")!==-1)&&(CustomEvent.prototype=window.Event.prototype,window.CustomEvent=CustomEvent)}(),!function(win){"use strict";function FastDom(){var self=this;self.reads=[],self.writes=[],self.raf=raf.bind(win),debug("initialized",self)}function scheduleFlush(fastdom){fastdom.scheduled||(fastdom.scheduled=!0,fastdom.raf(flush.bind(null,fastdom)),debug("flush scheduled"))}function flush(fastdom){debug("flush");var error,writes=fastdom.writes,reads=fastdom.reads;try{debug("flushing reads",reads.length),runTasks(reads),debug("flushing writes",writes.length),runTasks(writes)}catch(e){error=e}if(fastdom.scheduled=!1,(reads.length||writes.length)&&scheduleFlush(fastdom),error){if(debug("task errored",error.message),!fastdom["catch"])throw error;fastdom["catch"](error)}}function runTasks(tasks){debug("run tasks");for(var task;task=tasks.shift();)task()}function remove(array,item){var index=array.indexOf(item);return!!~index&&!!array.splice(index,1)}function mixin(target,source){for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}var debug=function(){},raf=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.msRequestAnimationFrame||function(cb){return setTimeout(cb,16)};FastDom.prototype={constructor:FastDom,measure:function(fn,ctx){debug("measure");var task=ctx?fn.bind(ctx):fn;return this.reads.push(task),scheduleFlush(this),task},mutate:function(fn,ctx){debug("mutate");var task=ctx?fn.bind(ctx):fn;return this.writes.push(task),scheduleFlush(this),task},clear:function(task){return debug("clear",task),remove(this.reads,task)||remove(this.writes,task)},extend:function(props){if(debug("extend",props),"object"!=typeof props)throw new Error("expected object");var child=Object.create(this);return mixin(child,props),child.fastdom=this,child.initialize&&child.initialize(),child},"catch":null};var exports=win.fastdom=win.fastdom||new FastDom;"f"==(typeof define)[0]?define(function(){return exports}):"o"==(typeof module)[0]&&(module.exports=exports)}("undefined"!=typeof window?window:this),ContentEdit.INDENT="",ContentEdit.DEFAULT_MAX_ELEMENT_WIDTH=2e3,ContentTools.HIGHLIGHT_HOLD_DURATION=999999,ContentEdit.RESIZE_CORNER_SIZE=0;var PBS={};window.addEventListener("DOMContentLoaded",function(){var editor,extraWrapper;if(document.querySelector('[data-name="main-content"]')){for(;document.querySelectorAll('.pbs-main-wrapper[data-name="main-content"]').length>1;)extraWrapper=document.querySelectorAll('.pbs-main-wrapper[data-name="main-content"]')[1],extraWrapper.removeAttribute("data-name"),null!==extraWrapper.getAttribute("data-editable")&&extraWrapper.removeAttribute("data-editable");var starterInterval;localStorage&&localStorage.getItem("pbs-open-"+pbsParams.post_id)&&(localStorage.removeItem("pbs-open-"+pbsParams.post_id),starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(document.querySelector(".ct-ignition__button--edit").dispatchEvent(new CustomEvent("click")),clearInterval(starterInterval))},200)),window.location.hash&&0===window.location.hash.indexOf("#pbs-edit")&&(starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(document.querySelector(".ct-ignition__button--edit").dispatchEvent(new CustomEvent("click")),clearInterval(starterInterval))},200)),editor=ContentTools.EditorApp.get(),window._contentToolsShim(editor),editor.init("*[data-editable]","data-name"),editor.bind("start",function(){clearInterval(editor._toolbox._updateToolsTimeout),editor._toolbox._updateToolsTimeout=setInterval(editor._toolbox._updateTools,300)}),document.addEventListener("click",function(ev){"pbs-help-docs"===ev.target.getAttribute("id")&&"undefined"!=typeof HS&&"undefined"!=typeof HS.beacon&&"undefined"!==HS.beacon.open?HS.beacon.open?HS.beacon.open():window.open("http://docs.pagebuildersandwich.com/","_blank"):"pbs-help-docs"===ev.target.getAttribute("id")&&window.open("http://docs.pagebuildersandwich.com/","_blank")}),document.querySelector("#wp-admin-bar-pbs_help_docs").addEventListener("click",function(ev){return"undefined"!=typeof HS&&"undefined"!=typeof HS.beacon&&"undefined"!==HS.beacon.open&&HS.beacon.open?HS.beacon.open():window.open("http://docs.pagebuildersandwich.com/","_blank"),ev.preventDefault(),!1}),editor.bind("start",function(){editor._toolboxScrollCheckInterval=setInterval(function(){var elements=document.querySelectorAll(".media-modal-backdrop"),hasModal=!1;elements&&Array.prototype.forEach.call(elements,function(el){0===el.offsetWidth&&0===el.offsetHeight||(hasModal=!0)});var toolbox=document.querySelector(".ct-toolbox");toolbox&&toolbox.style["overflow-y"]!==(hasModal?"hidden":"")&&(toolbox.style["overflow-y"]=hasModal?"hidden":"")},300)}),editor.bind("stop",function(){clearInterval(editor._toolboxScrollCheckInterval)}),editor.bind("start",function(){var adminBar=document.querySelector("#wpadminbar");adminBar&&(adminBar.style["pointer-events"]="none",setTimeout(function(){adminBar.style["pointer-events"]=""},100))}),editor.bind("stop",function(){var adminBar=document.querySelector("#wpadminbar");adminBar&&(adminBar.style["pointer-events"]="")}),editor.bind("save",function(regions){var name,payload,xhr;this.busy(!0),payload=new FormData;for(name in regions)if(regions.hasOwnProperty(name)){var html=regions[name];html=wp.hooks.applyFilters("pbs.save",html).replace(/\\/g,"\\\\"),payload.append(name,html)}payload.append("action","gambit_builder_save_content"),payload.append("save_nonce",pbsParams.nonce),payload.append("post_id",pbsParams.post_id),pbsParams.new_post_status&&(payload.append("post_status",pbsParams.new_post_status),pbsParams.new_post_status=void 0);var styles="";document.querySelector("style#pbs-style")&&(styles=document.querySelector("style#pbs-style").innerHTML),payload.append("style",styles),wp.hooks.doAction("pbs.save.payload",payload),xhr=new XMLHttpRequest,xhr.onload=function(){if(editor.busy(!1),xhr.status>=200&&xhr.status<400){if(xhr.responseText.match(/(http|https):\/\//)){var currentHref=window.location.href.replace(/#\.*$/,"");xhr.responseText!==currentHref&&(window.location.href=xhr.responseText)}new ContentTools.FlashUI("ok")}else new ContentTools.FlashUI("no")},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload),wp.hooks.doAction("pbs.save.payload.post",payload)});var _isShiftDown=!1,_showColumnOutlines=_.debounce(function(){_isShiftDown&&document.querySelector("html").classList.add("pbs-show-outlines")},800),showColumnOutlines=function(e){e.shiftKey&&(_isShiftDown=!0,_showColumnOutlines())},hideColumnOutlines=function(e){16===e.which&&(_isShiftDown=!1,document.querySelector("html").classList.remove("pbs-show-outlines"))};editor.bind("start",function(){document.querySelector("html").classList.add("pbs-editing"),document.querySelector("html").classList.add("theme-"+pbsParams.theme_name);try{this.regions()["main-content"].children[0].focus()}catch(e){}this.domRegions()[0].classList.add("pbs-editing"),this._handleHighlightOn=function(){},this._handleHighlightOff=function(){},document.addEventListener("keydown",showColumnOutlines),document.addEventListener("keyup",hideColumnOutlines)}),editor.bind("stop",function(){this.domRegions()[0].classList.remove("pbs-editing"),document.querySelector("html").classList.remove("pbs-editing"),document.querySelector("html").classList.remove("theme-"+pbsParams.theme_name),window._pbsBodyTransitionIntervalNum=0,clearInterval(window._pbsBodyTransitionInterval),window._pbsBodyTransitionInterval=setInterval(function(){window._pbsBodyTransitionIntervalNum++,window.dispatchEvent(new CustomEvent("resize")),window._pbsBodyTransitionIntervalNum>=30&&clearInterval(window._pbsBodyTransitionInterval)},16),document.removeEventListener("keydown",showColumnOutlines),document.removeEventListener("keyup",hideColumnOutlines)}),ContentEdit.Root.get().bind("focus",function(element){document.body.setAttribute("data-pbs-focused",element.constructor.name)}),ContentEdit.Root.get().bind("blur",function(){document.body.removeAttribute("data-pbs-focused")}),editor.bind("start",function(){for(var element=document.querySelector(".pbs-main-wrapper");element&&"body"!==element.tagName;){for(var curElement=element;curElement.previousSibling;)1===curElement.previousSibling.nodeType?curElement.previousSibling.querySelector(".pbs-title-editor")?curElement=curElement.previousSibling:(curElement.previousSibling.classList&&curElement.previousSibling.classList.add("pbs-ignore-while-editing"),curElement=curElement.previousSibling):curElement=curElement.previousSibling;element=element.parentNode}}),editor.bind("stop",function(){var elements=document.querySelectorAll(".pbs-ignore-while-editing");elements&&Array.prototype.forEach.call(elements,function(el){el.classList.remove("pbs-ignore-while-editing")})}),document.body.addEventListener("mousedown",function(e){(e.target.classList.contains("ct-ignition__button--confirm")||e.target.parentNode&&e.target.parentNode.classList.contains("ct-ignition__button--confirm"))&&window.PBSEditor.updateModifiedContent()}),document.body.addEventListener("mousedown",function(e){for(var editorArea=document.querySelector('[data-name="main-content"]'),isInEditorArea=editorArea.contains(e.target),isEditorArea=editorArea===e.target,editorSemiRoot=editorArea;"body"!==editorSemiRoot.parentNode.tagName.toLowerCase();)editorSemiRoot=editorSemiRoot.parentNode;var isInEditorSemiRoot=editorSemiRoot.contains(e.target);if(!window.pbsSelectorMatches(e.target,".wp-core-ui *")){var isInTitle=window.pbsSelectorMatches(e.target,".pbs-title-editor, .pbs-title-editor *");if(editorArea.classList.contains("pbs-editing")&&isInEditorSemiRoot&&!isEditorArea&&!isInEditorArea&&!isInTitle){var elem,rect=editorArea.getBoundingClientRect(),mainRegion=ContentTools.EditorApp.get().regions()["main-content"],isTop=!0,scrollY=window.scrollY||window.pageYOffset;if(e.pageY>scrollY+rect.top+rect.height/2?(isTop=!1,elem=mainRegion.children[mainRegion.children.length-1]):elem=mainRegion.children[0],"Text"!==elem.constructor.name){var p=new ContentEdit.Text("p",{},"");isTop?elem.parent().attach(p,0):elem.parent().attach(p,elem.parent().children.indexOf(elem)+1),elem=p}var index=0;isTop||elem.content&&(index=elem.content.length()),e.preventDefault(),elem.focus();var selection=new ContentSelect.Range(index,index);return void selection.select(elem._domElement)}}}),wp.hooks.doAction("pbs.init")}}),ContentEdit.DRAG_HOLD_DURATION=400,ContentEdit.Root.get().bind("drag",function(){document.querySelector('[data-name="main-content"]').classList.add("dragging")}),ContentEdit.Root.get().bind("drop",function(){document.querySelector('[data-name="main-content"]').classList.remove("dragging"),window.pbsFixRowWidths&&window.pbsFixRowWidths()}),window.pbsSelectorMatches=function(el,selector){var p=Element.prototype,f=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.msMatchesSelector||function(s){return[].indexOf.call(document.querySelectorAll(s),this)!==-1};return 1!==el.nodeType&&el.parentNode&&(el=el.parentNode),1===el.nodeType&&f.call(el,selector)},window.cssToStyleObject=function(cssString){for(var match,regex=/([\w-]*)\s*:\s*([^;]*)/g,properties={};match=regex.exec(cssString);)properties[match[1]]=match[2];return properties},window.cssToStyleString=function(cssObject){var s="";for(var i in cssObject)cssObject.hasOwnProperty(i)&&(s+=i+":"+cssObject[i]+";");return s},ContentEdit.Element.prototype._onMouseMove=function(){};var __slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.PBSEditor={},window.PBSEditor.getToolUI=function(name){return ContentTools.EditorApp.get()._toolboxBar._toolUIs[name]?ContentTools.EditorApp.get()._toolboxBar._toolUIs[name]:ContentTools.EditorApp.get()._toolboxElements._toolUIs[name]?ContentTools.EditorApp.get()._toolboxElements._toolUIs[name]:ContentTools.EditorApp.get()._toolbox._toolUIs[name]},ContentEdit.Root.get().bind("mount",function(element){element.domElement()._ceElement=element}),ContentTools.EditorApp.get().highlightRegions=function(){},window.PBSEditor.updateModifiedContent=function(){var i,regions=ContentTools.EditorApp.get().regions();for(i in regions)regions.hasOwnProperty(i)&&window.PBSEditor.updateModifiedContentRecursive(regions[i])},window.PBSEditor.updateModifiedContentRecursive=function(element){var ctElement,k,children=element.children;if(children)for(k=0;k<children.length;k++)ctElement=children[k],"undefined"!=typeof ctElement.content&&ctElement.content.html()!==ctElement._domElement.innerHTML&&window.PBSEditor.updateElementContent(ctElement,ctElement._domElement.innerHTML),window.PBSEditor.updateModifiedContentRecursive(ctElement)},window.PBSEditor.updateElementContent=function(element,newContent){"Shortcode"!==element.constructor.name&&(element.content=new HTMLString.String(newContent,element.content.preserveWhitespace()).trim(),element.updateInnerHTML(),element.taint())},window.PBSEditor.isEditing=function(){var editorArea=document.querySelector('[data-name="main-content"]');return!!editorArea&&editorArea.classList.contains("pbs-editing")},window.PBSEditor.getUniqueClassName=function(domElement){var classes,matches;return domElement.getAttribute("class")&&(classes=domElement.getAttribute("class"),matches=classes.match(/pbsguid-\w+/))?matches[0]:null},window.PBSEditor.removeUniqueClassName=function(domElement){var classes,matches;return!!(domElement.getAttribute("class")&&(classes=domElement.getAttribute("class"),matches=classes.match(/pbsguid-\w+/)))&&(domElement.classList.remove(matches[0]),!0)},window.PBSEditor.generateUniqueClassName=function(){var name;do name="pbsguid-"+window.PBSEditor.generateHash();while(document.querySelector("."+name));return name},window.PBSEditor.generateHash=function(){return Math.floor(4294967296*(1+Math.random())).toString(36).substring(1)},window.PBSEditor.addPseudoElementStylesRaw=function(styles){var currentStyles,mainRegion,styleTag=document.querySelector("style#pbs-style");return styleTag||(styleTag=document.createElement("style"),styleTag.setAttribute("id","pbs-style"),document.body.appendChild(styleTag)),currentStyles=styleTag.innerHTML+styles,mainRegion=ContentTools.EditorApp.get().regions()["main-content"],"undefined"==typeof mainRegion._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styles},window.PBSEditor.addPseudoElementStyles=function(selector,styles){var selectorStillExists=window.PBSEditor.removePseudoElementStyles(selector,Object.keys(styles)),styleTag=document.querySelector("style#pbs-style");styleTag||(styleTag=document.createElement("style"),styleTag.setAttribute("id","pbs-style"),document.body.appendChild(styleTag));var currentStyles=styleTag.innerHTML,styleString="";for(var styleName in styles)if(styles.hasOwnProperty(styleName)){var value=styles[styleName];value.trim&&(value=value.trim()),value&&(styleString+=styleName+": "+value+";")}var escapedSelector=selector.replace(/\./g,"\\.");if(selectorStillExists){var re=new RegExp("("+escapedSelector+"\\s*\\{)","gm");currentStyles=currentStyles.replace(re,"$1"+styleString)}else currentStyles+=selector+" {"+styleString+"}";var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];return"undefined"==typeof mainRegion._debouncedTaint&&(mainRegion._debouncedTaint=_.debounce(function(){this.taint()}.bind(mainRegion),400)),mainRegion._debouncedTaint(),styleTag.innerHTML=currentStyles,styleString},window.PBSEditor.getPseudoElementStyles=function(selector,style){var styleTag=document.querySelector("style#pbs-style");if(!styleTag)return null;var currentStyles=styleTag.innerHTML,selectorPattern=selector.replace(/\./g,"\\."),re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m"),matches=currentStyles.match(re);if(!matches)return null;for(var stylesMatch=matches[1].replace(/;$/,"").split(";"),k=0;k<stylesMatch.length;k++){var styleMatch=stylesMatch[k].match(new RegExp("^"+style+"\\s*:([\\s\\S]*$)"));if(styleMatch){var value=styleMatch[1].trim();return value&&(value=value.replace(/\s*!important/,"")),value}}return null},window.PBSEditor.removePseudoElementStyles=function(selector,styles){"string"==typeof styles&&(styles=[styles]);var styleTag=document.querySelector("style#pbs-style");if(!styleTag)return!1;for(var re,stylesMatch,selectorPattern=selector.replace(/\./g,"\\."),currentStyles=styleTag.innerHTML,i=0;i<styles.length;i++){var styleName=styles[i];re=new RegExp(selectorPattern+"\\s*\\{([\\s\\S]*?)\\}","m");var matches=currentStyles.match(re);if(matches){stylesMatch=matches[1].replace(/;$/,"").split(";");for(var k=0;k<stylesMatch.length;k++)if(stylesMatch[k].match(new RegExp("^"+styleName+"\\s*:"))){stylesMatch.splice(k,1);break}stylesMatch=stylesMatch.join(";"),currentStyles=currentStyles.replace(matches[0],""),currentStyles+=selector+" {"+stylesMatch+"}"}}return(currentStyles=currentStyles.replace(/(^|[^\}])+\{[\s]*\}/gm,"").trim())?(styleTag.innerHTML=currentStyles,re=new RegExp(selectorPattern+"\\s*\\{","gm"),!!styleTag.innerHTML.match(re)):(styleTag.parentNode.removeChild(styleTag),!1)},window.PBSEditor.convertSVGToBackgroundImage=function(svgElement){svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg");var svgString=svgElement.outerHTML;return svgString=svgString.replace(/"/g,"'"),svgString=svgString.replace(/</g,"%3C"),svgString=svgString.replace(/>/g,"%3E"),svgString=svgString.replace(/&/g,"%26"),svgString=svgString.replace(/#/g,"%23"),svgString=svgString.replace(/\n/g,""),svgString='url("data:image/svg+xml,'+svgString+'")'},window.PBSEditor.isCtrlDown=!1,window.PBSEditor.isShiftDown=!1,window.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(ev){(ev.ctrlKey||ev.metaKey)&&(window.PBSEditor.isCtrlDown=!0),ev.shiftKey&&(window.PBSEditor.isShiftDown=!0)}),document.addEventListener("keyup",function(ev){ev.ctrlKey||ev.metaKey||(window.PBSEditor.isCtrlDown=!1),ev.shiftKey||(window.PBSEditor.isShiftDown=!1)})}),function(){var _Root=ContentEdit.Root.get(),proxied=_Root._getDropPlacement;_Root._getDropPlacement=function(x,y){if(!this._dropTarget)return null;var placements=this._dropTarget.constructor.placements;if(placements.indexOf("center")===-1&&placements.indexOf("left")!==-1&&placements.indexOf("right")!==-1){var _ref,vert,horz,rect=this._dropTarget.domElement().getBoundingClientRect();return _ref=[x-rect.left,y-rect.top],x=_ref[0],y=_ref[1],horz="center",horz=x<rect.width/2?"left":"right",vert="above",y>rect.height/2&&(vert="below"),[vert,horz]}return proxied.call(this,x,y)}}(),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){var element,selection,tail,tip;return ev.preventDefault(),this.content.isWhitespace()?proxied.call(this,ev):(ContentSelect.Range.query(this._domElement),selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),tail=this.content.substring(selection.get()[1]),ev.shiftKey||tip.length()?proxied.call(this,ev):(element=new ContentEdit.Text("p",{},""),this.parent().attach(element,this.parent().children.indexOf(this)),void element.focus()))}}(),window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",function(ev){window.PBSEditor.isEditing()&&"A"===ev.target.tagName&&window.pbsSelectorMatches(ev.target,".pbs-main-wrapper *")&&ev.preventDefault()})}),ContentEdit.Element.prototype.style=function(name,value){var style;if("undefined"==typeof value)return this._domElement?(style=this._domElement.style[name],style?style:(style=window.getComputedStyle(this._domElement),style[name])):null;if(!this._domElement)return value;if(this._domElement.style[name]===value)return value;if(this._domElement.style[name]=value,style=this._domElement.getAttribute("style"),null===style)return this._attributes.style="",this.isMounted()&&this._domElement.removeAttribute("style"),"undefined"==typeof this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),this.debouncedTaint();for(;style.match(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i);)style=style.replace(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i,"$1");return this.attr("style",style)},ContentEdit.Element.prototype.defaultStyle=function(name){if(!this._domElement)return"";var origStyleAttribute=this._domElement.getAttribute("style");this._domElement.style[name]="";var defaultStyle=window.getComputedStyle(this._domElement);return defaultStyle="undefined"!=typeof defaultStyle[name]?defaultStyle[name]:0,origStyleAttribute?this._domElement.setAttribute("style",origStyleAttribute):this._domElement.removeAttribute("style"),defaultStyle},function(){var proxy=ContentEdit.Element.prototype.removeAttr;ContentEdit.Element.prototype.removeAttr=function(name){return name=name.toLowerCase(),!this._attributes[name]&&this._attributes.hasOwnProperty(name)?(delete this._attributes[name],this.isMounted()&&"class"!==name.toLowerCase()&&this._domElement.removeAttribute(name),this.taint()):proxy.call(this,name)}}(),ContentEdit.Element.prototype.attr=function(name,value,forceSet){return name=name.toLowerCase(),void 0===value?this._attributes[name]:this._attributes[name]!==value?(this._attributes[name]=value,this.isMounted()&&"class"!==name.toLowerCase()&&(""!==value||forceSet?this._domElement.setAttribute(name,value):this._domElement.removeAttribute(name)),"undefined"==typeof this.debouncedTaint&&(this.debouncedTaint=_.debounce(function(){this.taint()}.bind(this),400)),ContentEdit.Root.get().trigger("debounced_taint",this),this.debouncedTaint()):void 0},ContentEdit.Element.prototype.removeAllCSSClasses=function(){if(this._domElement&&this._domElement.classList)for(var i=this._domElement.classList.length-1;i>=0;i--)this.removeCSSClass(this._domElement.classList.item(i))},window._contentToolsShim=function(editor){editor.start=function(){ContentTools.EditorApp.getCls().prototype.start.call(this),editor.trigger("start")},editor.stop=function(){ContentTools.EditorApp.getCls().prototype.stop.call(this),editor.trigger("stop")}},function(){var proxied=ContentEdit.Element.prototype._addCSSClass;ContentEdit.Element.prototype._addCSSClass=function(className){return"ce-element--over"===className&&ContentEdit.Root.get().trigger("over",this),proxied.call(this,className)}}(),function(){var proxied=ContentEdit.Element.prototype._removeCSSClass;ContentEdit.Element.prototype._removeCSSClass=function(className){return"ce-element--over"===className&&ContentEdit.Root.get().trigger("out",this),proxied.call(this,className)}}(),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]'))var starterInterval=setInterval(function(){document.querySelector(".ct-widget--active")&&(wp.hooks.doAction("pbs.ct.ready"),clearInterval(starterInterval))},200)}),ContentTools.IgnitionUI.prototype.mount=function(){var ret;return this._domElement=document.querySelector("#wpadminbar"),this._domEdit=document.querySelector("#wp-admin-bar-gambit_builder_edit"),this._domEdit.classList.add("ct-ignition__button--edit"),this._domConfirm=document.querySelector("#wp-admin-bar-gambit_builder_save"),this._domConfirm.classList.add("ct-ignition__button--confirm"),this._domCancel=document.querySelector("#wp-admin-bar-gambit_builder_cancel"),this._domCancel.classList.add("ct-ignition__button--cancel"),this._domBusy=document.querySelector("#wp-admin-bar-gambit_builder_busy"),this._domBusy.classList.add("ct-ignition__button--busy"),ret=this._addDOMEventListeners(),this._domEdit.addEventListener("mousedown",function(){this.prevScrollY=window.pbsScrollY()}),this._domEdit.addEventListener("click",function(){window.scrollTo(0,this.prevScrollY)}),document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-publish").addEventListener("click",function(ev){ev.preventDefault(),pbsParams.new_post_status="publish",this._domConfirm.click(),document.querySelector("#pbs-save-button").setAttribute("data-current-post-type","publish"),this._domConfirm.querySelector(".ab-item").childNodes[0].nodeValue=pbsParams.labels.save_and_update}.bind(this)),document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-draft").addEventListener("click",function(ev){ev.preventDefault(),pbsParams.new_post_status="draft",this._domConfirm.click(),document.querySelector("#pbs-save-button").setAttribute("data-current-post-type","draft"),this._domConfirm.querySelector(".ab-item").childNodes[0].nodeValue=pbsParams.labels.save_as_draft}.bind(this)),document.querySelector("#wp-admin-bar-gambit_builder_save_options #pbs-save-pending").addEventListener("click",function(ev){ev.preventDefault(),pbsParams.new_post_status="pending",this._domConfirm.click(),document.querySelector("#pbs-save-button").setAttribute("data-current-post-type","pending"),this._domConfirm.querySelector(".ab-item").childNodes[0].nodeValue=pbsParams.labels.save_as_pending}.bind(this)),wp.hooks.doAction("pbs.ct.mounted"),ret},function(){var proxied=ContentTools.History.prototype.undo;ContentTools.History.prototype.undo=function(){var ret=proxied.call(this);return wp.hooks.doAction("pbs.undo"),ret}}(),function(){var proxied=ContentTools.History.prototype.redo;ContentTools.History.prototype.redo=function(){var ret=proxied.call(this);return wp.hooks.doAction("pbs.redo"),ret}}(),function(){var proxied=ContentEdit.ResizableElement.prototype.size;ContentEdit.ResizableElement.prototype.size=function(newSize){var height,width,rect;return!newSize&&this._domElement?(rect=this._domElement.getBoundingClientRect(),width=parseInt(rect.width||1,10),height=parseInt(rect.height||1,10),[width,height]):proxied.call(this,newSize)}}(),function(){var proxied=ContentEdit.ResizableElement.prototype.size;ContentEdit.ResizableElement.prototype.size=function(newSize){var ratio,parentWidth,ret=proxied.call(this,newSize);return newSize&&2===newSize.length&&this.parent()&&this.parent()._domElement&&(parentWidth=window.pbsGetBoundingClientRect(this.parent()._domElement).width,newSize[0]>parentWidth&&(ratio=newSize[1]/newSize[0],newSize[0]=parentWidth,newSize[1]=newSize[0]*ratio),this._domElement.style.width=newSize[0]+"px",this._domElement.style.height=newSize[1]+"px"),ret}}(),function(){var proxied=ContentEdit.ResizableElement.prototype._onMouseDown;ContentEdit.ResizableElement.prototype._onMouseDown=function(ev){var corner=this._getResizeCorner(ev.clientX,ev.clientY);corner&&window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown&&(this.style("width","auto"),this.style("height","auto"),this.attr("height",""),this.attr("width","")),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype.drop;ContentEdit.Element.prototype.drop=function(element,placement){var root=ContentEdit.Root.get();return element&&"undefined"!=typeof element.type&&!this.constructor.droppers[element.type()]&&!element.constructor.droppers[this.type()]&&element.constructor.droppers["*"]?(element._removeCSSClass("ce-element--drop"),element._removeCSSClass("ce-element--drop-"+placement[0]),element._removeCSSClass("ce-element--drop-"+placement[1]),element.constructor.droppers["*"](this,element,placement),void root.trigger("drop",this,element,placement)):proxied.call(this,element,placement)}}(),function(){var proxied=ContentEdit.Element.prototype._onOver;ContentEdit.Element.prototype._onOver=function(ev){var ret=proxied.call(this,ev);if(!ret){var root=ContentEdit.Root.get(),dragging=root.dragging();if(!dragging)return;if(dragging===this)return;if(root._dropTarget)return;if(this.constructor.droppers["*"])return this._addCSSClass("ce-element--drop"),root._dropTarget=this}return ret}}(),function(){ContentEdit.ResizableElement.prototype._getResizeCorner=function(){return null}}(),function(){ContentTools.WidgetUI.prototype.hide=function(){this.removeCSSClass("ct-widget--active")}}(),PBSEditor.Frame=wp.media.view.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},initialize:function(){wp.media.view.Frame.prototype.initialize.apply(this,arguments),_.defaults(this.options,{title:"My Modal",button:"My Button",modal:!0}),this.options.modal&&(this.modal=new wp.media.view.Modal({controller:this}),this.modal.content(this),this.modal.on("open",_.bind(function(){this._onOpen()},this)),this.modal.on("close",_.bind(function(){this._onClose()},this)))},open:function(args){args||(args={}),this.options=_.defaults(args,this.options),args.content&&this.modal.content(args.content(this)),this.modal.open(),this.modal.el.children[0].classList.add("pbs-modal-frame"),this.className&&this.modal.el.children[0].classList.add(this.className),this.modal.el.querySelector(".media-frame-title h1")&&(this.modal.el.querySelector(".media-frame-title h1").textContent=this.options.title),
this.modal.el.querySelector(".media-toolbar-primary button")&&(this.modal.el.querySelector(".media-toolbar-primary button").textContent=this.options.button),this.modal.el.children[0].classList.add("pbs-frame-hide"),setTimeout(function(){this.modal.el.children[0].classList.remove("pbs-frame-hide")}.bind(this),50)},close:function(){this.modal.close()},_primaryClicked:function(){this.modal.close(),this.options.successCallback&&this.options.successCallback(this)},_onOpen:function(){this.options.openCallback&&this.options.openCallback(this)},_onClose:function(){this.options.closeCallback&&this.options.closeCallback(this)}}),PBSEditor.SearchFrame=PBSEditor.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled"),this.modal.el.querySelector(".pbs-no-results").style.display=""},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){this.selected=null,this.model.el.querySelector(".pbs-no-results").style.display="",this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var keyword=ev.target.value.trim().toLowerCase(),shortcodes=this.modal.el.querySelectorAll(".pbs-search-list > *"),hasResult=!1;Array.prototype.forEach.call(shortcodes,function(el){""===keyword||el.textContent.trim().toLowerCase().indexOf(keyword)!==-1?(el.style.display="",hasResult=!0):el.style.display="none"}),this.modal.el.querySelector(".pbs-no-results").style.display=hasResult?"":"flex"},select:function(ev){for(var target=ev.target;!target.parentNode.classList.contains("pbs-search-list");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".pbs-selected")&&this.modal.el.querySelector(".pbs-selected").classList.remove("pbs-selected"),target.classList.add("pbs-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),PBSEditor._IconFrame=PBSEditor.Frame.extend({className:"pbs-icon-modal",template:wp.template("pbs-icon-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click .pbs-icon-display [data-name]":"selectIcon"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var searchInput=this.modal.el.querySelector('input[type="search"]');""===searchInput.value&&(searchInput.value="dashicons",this.searchKeyup({target:searchInput})),searchInput.focus(),searchInput.select()}.bind(this),1),this.selected||this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},_onClose:function(){this.modal.el.querySelector('input[type="search"]').focus()},searchKeyup:function(ev){clearTimeout(this._searchTimeout),this._searchTimeout=setTimeout(function(){this.doSearch(ev)}.bind(this),400)},reset:function(){for(this._searchResults=[],this.modal.el.querySelector(".pbs-no-results").style.display="";this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)");){var item=this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)");item.parentNode.removeChild(item)}this._prevKeyword="",this.selected=null,this._currentGroup=null,this.modal.el.querySelector(".media-toolbar-primary button").setAttribute("disabled","disabled")},doSearch:function(ev){var keyword=ev.target.value.trim();if(keyword&&this._prevKeyword!==keyword){this.reset(),this._prevKeyword=keyword,"undefined"==typeof pbsParams.icon_searches&&(pbsParams.icon_searches=[]),"undefined"!=typeof ev.keyCode&&pbsParams.icon_searches.push(keyword);var request=new XMLHttpRequest;request.open("POST",pbsParams.ajax_url,!0),request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),request.onload=function(){if(request.status>=200&&request.status<400){if(request.responseText){var response=JSON.parse(request.responseText);return"undefined"!=typeof response.length||0===response.length?void this.displayNoResults():(this._searchResults=response,void this.displayResults())}this.displayNoResults()}}.bind(this),request.send("action=pbs_icon_search&nonce="+pbsParams.nonce+"&s="+keyword)}},displayNoResults:function(){this.modal.el.querySelector(".pbs-no-results").style.display="flex"},displayResults:function(){var groupLabel,keys=Object.keys(this._searchResults);if(keys.length){var key=keys[0],result=this._searchResults[Object.keys(this._searchResults)[0]];if(delete this._searchResults[key],"undefined"==typeof this.groups){this.groups={};for(groupLabel in pbsParams.icon_groups)pbsParams.icon_groups.hasOwnProperty(groupLabel)&&(this.groups[groupLabel]=new RegExp(pbsParams.icon_groups[groupLabel],"i"))}var currGroup="";for(groupLabel in this.groups)if(this.groups.hasOwnProperty(groupLabel)){var groupRegex=this.groups[groupLabel];if(key.match(groupRegex)){currGroup=groupLabel;break}}if(this._currentGroup!==currGroup){var item=document.createElement("h4");item.innerHTML=groupLabel,item.classList.add("pbs-icon-group-title"),this.modal.el.querySelector(".pbs-icon-display").appendChild(item),this._currentGroup=currGroup}var icon=document.createElement("div");icon.innerHTML=result,icon.setAttribute("data-name",key),this.modal.el.querySelector(".pbs-icon-display").appendChild(icon),keys.length>1&&setTimeout(function(){this.displayResults()}.bind(this),5),this.modal.el.querySelector(".pbs-no-results").style.display=""}},selectIcon:function(ev){for(var target=ev.target;!target.getAttribute("data-name");)target=target.parentNode;this.selected=target,this.modal.el.querySelector(".pbs-icon-display .pbs-selected")&&this.modal.el.querySelector(".pbs-icon-display .pbs-selected").classList.remove("pbs-selected"),target.classList.add("pbs-selected"),this.modal.el.querySelector(".media-toolbar-primary button").removeAttribute("disabled"),this._justClicked===target&&this._primaryClicked(),this._justClicked=target,clearTimeout(this._justClickedTimeout),this._justClickedTimeout=setTimeout(function(){this._justClicked=!1}.bind(this),300)}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.iconFrame=new PBSEditor._IconFrame}),wp.hooks.addAction("pbs.save.payload",function(payload){"undefined"!=typeof pbsParams.icon_searches&&payload.append("icon_searches",pbsParams.icon_searches)}),PBSEditor._WidgetFrame=PBSEditor.SearchFrame.extend({className:"pbs-widget-modal",template:wp.template("pbs-widget-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-widget-slug]":"select"}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.widgetFrame=new PBSEditor._WidgetFrame}),PBSEditor._ShortcodeFrame=PBSEditor.SearchFrame.extend({className:"pbs-shortcode-modal",template:wp.template("pbs-shortcode-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-shortcode-tag]":"select","click .pbs-refresh-mappings":"refreshShortcodeMappings"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initShortcodeList()},initShortcodeList:function(){var map,shortcodeArea=this.modal.el.querySelector(".pbs-search-list");if(!shortcodeArea.querySelector("*:not(.pbs-no-results)")){for(var sc,tag,allShortcodes=[],i=0;i<pbsParams.shortcodes.length;i++)if(tag=pbsParams.shortcodes[i],"undefined"==typeof pbsParams.shortcodes_to_hide||-1===pbsParams.shortcodes_to_hide.indexOf(tag)){if(sc={tag:tag,name:tag.replace(/[\-_]/g," "),desc:"",owner:"",ownerslug:"",image:"",isMapped:!1},pbsParams.shortcode_mappings[tag]){if(map=pbsParams.shortcode_mappings[tag],"1"===map.is_hidden)continue;sc.desc=map.description,sc.owner=map.owner,sc.ownerslug=map["owner-slug"],sc.image="http://ps.w.org/"+sc.ownerslug+"/assets/icon-128x128.png), url(http://ps.w.org/"+sc.ownerslug+"/assets/icon.svg), url("+pbsParams.plugin_url+"page_builder_sandwich/assets/element-icons/shortcode_single.svg",map.owner===pbsParams.theme&&(sc.image=pbsParams.stylesheet_directory_uri+"screenshot.png"),sc.isMapped=!0,map.name&&(sc.name=map.name)}if(PBSInspectorOptions.Shortcode[pbsParams.shortcodes[i]]){if(map=PBSInspectorOptions.Shortcode[pbsParams.shortcodes[i]],"1"===map.is_hidden)continue;map.label&&(sc.name=map.label),map.name&&(sc.name=map.name),map.desc&&(sc.desc=map.desc),map.owner&&(sc.owner=map.owner),map.image&&(sc.image=map.image),sc.isMapped=!0}allShortcodes.push(sc)}allShortcodes.sort(function(a,b){var x=a.name.toLowerCase(),y=b.name.toLowerCase(),ret=x<y?-1:x>y?1:0,xMap=a.isMapped,yMap=b.isMapped;return xMap===yMap?ret:xMap?-1:1});for(tag in allShortcodes)if(allShortcodes.hasOwnProperty(tag)){sc=allShortcodes[tag];var div=document.createElement("DIV");div.setAttribute("data-shortcode-tag",sc.tag);var title=document.createElement("H4");if(title.innerHTML=sc.name,div.appendChild(title),sc.desc){var desc=document.createElement("P");desc.innerHTML=sc.desc,div.appendChild(desc)}var owner=document.createElement("P");if(owner.classList.add("pbs-shortcode-owner"),owner.innerHTML=sc.owner+" ["+sc.tag+"]",div.appendChild(owner),sc.isMapped){var preview=document.createElement("DIV");preview.classList.add("pbs-shortcode-owner-image"),sc.image&&preview.setAttribute("style","background-image: url("+sc.image+")"),div.appendChild(preview),div.classList.add("pbs-has-owner-image")}shortcodeArea.appendChild(div)}}},refreshShortcodeMappings:function(ev){if(ev.preventDefault(),!this._isUpdatingShortcodes){this._isUpdatingShortcodes=!0,this.modal.$el.addClass("pbs-busy");var payload=new FormData;payload.append("action","pbs_update_shortcode_mappings"),payload.append("nonce",pbsParams.nonce);var xhr=new XMLHttpRequest;return xhr.onload=function(){if(this.modal.$el.removeClass("pbs-busy"),xhr.status>=200&&xhr.status<400){this._isUpdatingShortcodes=null;var response=JSON.parse(xhr.responseText);if(response){for(var shortcode in pbsParams.shortcode_mappings)pbsParams.shortcode_mappings.hasOwnProperty(shortcode)&&window.pbsRemoveInspector(shortcode);pbsParams.shortcode_mappings=response;var shortcodeArea=this.modal.el.querySelector(".pbs-search-list"),noResults=shortcodeArea.querySelector(".pbs-no-results");for(noResults.parentNode.removeChild(noResults);shortcodeArea.firstChild;)shortcodeArea.removeChild(shortcodeArea.firstChild);shortcodeArea.appendChild(noResults),this.initShortcodeList()}}}.bind(this),xhr.onerror=function(){this.modal.$el.removeClass("pbs-busy"),this._isUpdatingShortcodes=null},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload),!1}}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.shortcodeFrame=new PBSEditor._ShortcodeFrame}),PBSEditor._PredesignedFrame=PBSEditor.SearchFrame.extend({className:"pbs-predesigned-modal",template:wp.template("pbs-predesigned-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-template]":"select"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initList()},initList:function(){if(!this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)")){var container=this.modal.el.querySelector(".pbs-search-list"),designElements=document.querySelectorAll("[data-design-element-template]");Array.prototype.forEach.call(designElements,function(el){var elem,templateID=el.getAttribute("id"),name=el.getAttribute("data-name"),description=el.getAttribute("data-description"),image=el.getAttribute("data-image"),button=document.createElement("DIV");button.setAttribute("data-template",templateID),button.setAttribute("data-root-only",el.getAttribute("data-root-only")),image&&(elem=document.createElement("img"),elem.setAttribute("src",image),elem.setAttribute("alt",name?name:templateID),button.appendChild(elem)),name&&(elem=document.createElement("h4"),elem.innerHTML=name,button.appendChild(elem)),description&&(elem=document.createElement("p"),elem.classList.add("description"),elem.innerHTML=description,button.appendChild(elem)),container.appendChild(button)})}}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.predesignedFrame=new PBSEditor._PredesignedFrame}),PBSEditor._PageTemplateFrame=PBSEditor.SearchFrame.extend({className:"pbs-page-template-modal",template:wp.template("pbs-page-template-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked",'keyup [type="search"]':"searchKeyup","click [data-template]":"select"},_onOpen:function(){PBSEditor.SearchFrame.prototype._onOpen.apply(this),this.initList()},initList:function(){if(!this.modal.el.querySelector(".pbs-search-list > *:not(.pbs-no-results)")){var container=this.modal.el.querySelector(".pbs-search-list"),designElements=document.querySelectorAll("[data-page-template-template]");Array.prototype.forEach.call(designElements,function(el){var elem,templateID=el.getAttribute("id"),name=el.getAttribute("data-name"),description=el.getAttribute("data-description"),image=el.getAttribute("data-image"),button=document.createElement("DIV");button.setAttribute("data-template",templateID),button.setAttribute("data-root-only",el.getAttribute("data-root-only")||!1),pbsParams.is_lite&&(button.classList.add("pbs-lite-template"),button.setAttribute("data-preview",el.getAttribute("data-preview")),button.addEventListener("click",function(){window.open(this.getAttribute("data-preview"),"pbs-preview")})),image&&(elem=document.createElement("img"),elem.setAttribute("src",image),elem.setAttribute("alt",name?name:templateID),button.appendChild(elem)),pbsParams.is_lite&&(elem=document.createElement("button"),elem.classList.add("preview"),elem.innerHTML=pbsParams.labels.view_template,button.appendChild(elem)),name&&(elem=document.createElement("h4"),elem.innerHTML=name,pbsParams.is_lite&&(elem.innerHTML+=" <span>("+pbsParams.labels.premium+")</span>"),button.appendChild(elem)),description&&(elem=document.createElement("p"),elem.classList.add("description"),elem.innerHTML=description,button.appendChild(elem)),container.appendChild(button)})}}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.pageTemplateFrame=new PBSEditor._PageTemplateFrame}),PBSEditor._HtmlFrame=PBSEditor.Frame.extend({className:"pbs-html-modal",template:wp.template("pbs-html-frame"),events:{"click .media-toolbar-primary button":"_primaryClicked","keydown textarea":"tabHandler"},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),setTimeout(function(){var input=this.modal.el.querySelector("textarea");input.focus(),""===input.value&&(input.value="<div>\n\t<p>Sample HTML</p>\n</div>",input.select())}.bind(this),1)},_onClose:function(){this.modal.el.querySelector("textarea").focus()},tabHandler:function(e){if(9===e.keyCode){var val=e.target.value,start=e.target.selectionStart,end=e.target.selectionEnd;return e.target.value=val.substring(0,start)+"\t"+val.substring(end),e.target.selectionStart=e.target.selectionEnd=start+1,e.preventDefault(),!1}},getHtml:function(){var html=this.modal.el.querySelector("textarea").value.trim(),dummy=document.createElement("div");return dummy.innerHTML=html,dummy.innerHTML.replace(/\s{2,}/g," ")},setHtml:function(html){html=html.trim(),html=this.formatXml(html).trim(),this.modal.el.querySelector("textarea").value=html},formatXml:function(xml){var formatted="",reg=/(>)(<)(\/*)/g;xml=xml.toString().replace(reg,"$1\r\n$2$3");var pad=0,nodes=xml.split("\r\n");for(var n in nodes){var node=nodes[n],indent=0;node.match(/.+<\/\w[^>]*>$/)?indent=0:node.match(/^<\/\w/)?0!==pad&&(pad-=1):indent=node.match(/^<\w[^>]*[^\/]>.*$/)?1:0;for(var padding="",i=0;i<pad;i++)padding+="  ";formatted+=padding+node+"\r\n",pad+=indent}return formatted}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.htmlFrame=new PBSEditor._HtmlFrame}),PBSEditor._AdminFrame=PBSEditor.Frame.extend({className:"pbs-admin-modal",template:wp.template("pbs-admin-frame"),events:{},_onOpen:function(){PBSEditor.Frame.prototype._onOpen.apply(this),sessionStorage.setItem("pbs_in_admin_iframe",1),setTimeout(function(){this.modal.el.classList.add("pbs-busy");var iframe=this.modal.el.querySelector("iframe");iframe.onload=function(){this.modal.el.classList.remove("pbs-busy")}.bind(this),iframe.setAttribute("src",this.options.url)}.bind(this),1)},_onClose:function(){sessionStorage.removeItem("pbs_in_admin_iframe"),this.modal.el.querySelector("iframe").setAttribute("src",""),PBSEditor.Frame.prototype._onClose.apply(this)}}),window.addEventListener("DOMContentLoaded",function(){PBSEditor.adminFrame=new PBSEditor._AdminFrame}),PBSEditor.Overlays=[],PBSEditor.Overlay=function(){function Overlay(){var editor=ContentTools.EditorApp.get();this.showOnTaint=!0,this._domElement=null,this._active=!1,this._shown=!1,this._isMounted=!1,this._classname="",PBSEditor.Overlays.push(this),wp.hooks.addAction("pbs.element.out",function(element){this.element&&element&&element._domElement&&(this.element._domElement===element._domElement||element._domElement.contains(this.element._domElement))&&0===this.constructor.name.toLowerCase().indexOf("toolbar")&&this._hide()}.bind(this)),wp.hooks.addAction("pbs.element.over",function(element){var applyToElem;if(!Overlay.active&&!ContentEdit.Root.get().dragging()&&element._domElement)return this.element&&!this.element._domElement&&(this.element=null),this.canApplyTo?(applyToElem=this.canApplyTo(element),void(applyToElem?(this._show(applyToElem),this.element=applyToElem):this._shown&&this._hide())):void 0}.bind(this)),ContentEdit.Root.get().bind("unmount",function(element){element===this.element&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("drag",function(){this._hide()}.bind(this)),ContentEdit.Root.get().bind("drop",function(){this._hide()}.bind(this)),document.addEventListener("mouseover",function(ev){if(this._isMounted&&!Overlay.active){if(window.pbsSelectorMatches(ev.target,'[data-name="main-content"], [data-name="main-content"] *, .pbs-quick-action-overlay, .pbs-quick-action-overlay *, .pbs-toolbar, .pbs-toolbar *'))return;this._hide()}}.bind(this)),ContentEdit.Root.get().bind("taint",function(element){this.showOnTaint&&this.element===element&&this._show(element)}.bind(this)),ContentEdit.Root.get().bind("debounced_taint",function(element){this.showOnTaint&&this.element===element&&this._show(element)}.bind(this)),editor.bind("start",function(){this._domElement=this.createElement(),this.mount()}.bind(this)),editor.bind("stop",function(){this.unmount()}.bind(this))}return Overlay.prototype.mount=function(){this._domElement.classList.add("pbs-quick-action-overlay"),this._domElement.classList.add("pbs-overlay-"+this.constructor.name.toLowerCase()),this._classname&&this._domElement.classList.add(this._classname),document.body.appendChild(this._domElement),this.addEventHandlers(),this._isMounted=!0},Overlay.prototype.unmount=function(){this.element=null,this.removeEventHandlers(),document.body.removeChild(this._domElement),this._isMounted=!1},Overlay.prototype.addEventHandlers=function(){this._mousedownBound=this._mousedown.bind(this),this._mousemoveBound=this._mousemove.bind(this),this._mouseupBound=this._mouseup.bind(this),this._mouseenterBound=this._mouseenter.bind(this),this._mouseleaveBound=this._mouseleave.bind(this),this._domElement.addEventListener("mousedown",this._mousedownBound),this._domElement.addEventListener("mouseenter",this._mouseenterBound),this._domElement.addEventListener("mouseleave",this._mouseleaveBound),document.addEventListener("mousemove",this._mousemoveBound),document.addEventListener("mouseup",this._mouseupBound)},Overlay.prototype.removeEventHandlers=function(){this._domElement.removeEventListener("mousedown",this._mousedownBound),this._domElement.removeEventListener("mouseenter",this._mouseenterBound),this._domElement.removeEventListener("mouseleave",this._mouseleaveBound),document.removeEventListener("mousemove",this._mousemoveBound),document.removeEventListener("mouseup",this._mouseupBound)},Overlay.prototype._mousedown=function(ev){return this.canApply()?(this._active=!0,this.startX=parseInt(ev.screenX,10),this.startY=parseInt(ev.screenY,10),this.deltaX=0,this.deltaY=0,Overlay.active=!0,this._domElement.classList.add("pbs-active"),document.body.classList.add("pbs-overlay-is-active"),document.body.classList.add("pbs-overlay-"+this.constructor.name.toLowerCase()),this.onClick(ev),void this.onMoveStart(ev)):void(this._active=!1)},Overlay.prototype._mousemove=function(ev){this._active&&(this.deltaX=parseInt(ev.screenX,10)-this.startX,this.deltaY=parseInt(ev.screenY,10)-this.startY,ev.preventDefault(),ev.stopPropagation(),wp.hooks.doAction("pbs.overlay.drag"),this.onMove(ev),clearTimeout(Overlay._hideOverlayTimeout),Overlay._hideOverlayTimeout=setTimeout(function(){Overlay.hideOtherOverlays(this)}.bind(this),10))},Overlay.hideOtherOverlays=function(callingOverlay){Array.prototype.forEach.call(PBSEditor.Overlays,function(overlay){overlay!==callingOverlay&&overlay._hide()})},Overlay.prototype._mouseup=function(){this._active=!1,Overlay.active=!1,this._domElement.classList.remove("pbs-active"),document.body.classList.remove("pbs-overlay-is-active"),document.body.classList.remove("pbs-overlay-active-"+this.constructor.name.toLowerCase())},Overlay.prototype._mouseenter=function(ev){this._domElement.classList.add("pbs-over"),document.body.classList.add("pbs-overlay-hovered"),document.body.classList.add("pbs-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onEnter(ev)},Overlay.prototype._mouseleave=function(){this._domElement.classList.remove("pbs-over"),document.body.classList.remove("pbs-overlay-hovered"),document.body.classList.remove("pbs-overlay-hovered-"+this.constructor.name.toLowerCase()),this.onLeave()},Overlay.prototype._show=function(element){var root=ContentEdit.Root.get();if(!root.dragging()&&element){if(this._domElement.style.display="block",this.shown&&this.element===element)return;this.show(element),this._shown=!0}},Overlay.prototype._hide=function(){this._domElement&&(this._domElement.style.display="none"),this.hide(),this._shown=!1},Overlay.active=!1,Overlay.prevOverElement=null,Overlay.prototype.canApply=function(){return!Overlay.active},Overlay.prototype.createElement=function(){},Overlay.prototype.onMoveStart=function(){},Overlay.prototype.onMove=function(){},Overlay.prototype.onClick=function(){},Overlay.prototype.show=function(element){},Overlay.prototype.hide=function(){},Overlay.prototype.onEnter=function(){},Overlay.prototype.onLeave=function(){},Overlay.prototype.canApplyTo=function(element){return!1},Overlay}(),function(){var proxied=ContentEdit.Element.prototype._onMouseDown;ContentEdit.Element.prototype._onMouseDown=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseMove;ContentEdit.Element.prototype._onMouseMove=function(ev){if(!PBSEditor.Overlay.active)return ContentEdit.Root.get().trigger("mousemove",this),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOver;ContentEdit.Element.prototype._onMouseOver=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseOut;ContentEdit.Element.prototype._onMouseOut=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Element.prototype._onMouseUp;ContentEdit.Element.prototype._onMouseUp=function(ev){if(!PBSEditor.Overlay.active)return proxied.call(this,ev)}}(),function(){var currentOverElement=null,currentTarget=null,pbsOverElement=_.throttle(function(target){if(currentTarget===target)return void wp.hooks.doAction("pbs.element.over",currentOverElement);if(!target._ceElement){for(wp.hooks.doAction("pbs.nonelement.over",target);!target._ceElement;)if(target=target.parentNode,!target||"BODY"===target.tagName)return;if("Region"===target._ceElement.constructor.name)return}null!==currentOverElement&&target._ceElement&&wp.hooks.doAction("pbs.element.out",currentOverElement),PBSEditor.Overlay.active||(currentTarget=target,currentOverElement=target._ceElement,wp.hooks.doAction("pbs.element.over",target._ceElement))},50),mouseListener=function(ev){pbsOverElement(ev.target)};ContentTools.EditorApp.get().bind("start",function(){window.addEventListener("mousemove",mouseListener),window.addEventListener("mouseover",mouseListener),window.addEventListener("mouseleave",mouseListener)}),ContentTools.EditorApp.get().bind("stop",function(){window.removeEventListener("mousemove",mouseListener),window.removeEventListener("mouseover",mouseListener),window.removeEventListener("mouseleave",mouseListener)})}(),PBSEditor.OverlayControls=function(_super){function OverlayControls(controls){OverlayControls.__super__.constructor.call(this),this.showOnTaint=!1,this.shown=!1,"undefined"==typeof controls&&(controls=[]),this.controls=controls,ContentEdit.Root.get().bind("taint",function(){this.updatePosition(this.element)}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("mousedown",function(ev){var focused=ContentEdit.Root.get().focused();focused&&focused._domElement===ev.target&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("keydown",function(ev){[40,37,39,38,9,8,46,13,16,91,18].indexOf(ev.keyCode)===-1&&this._hide()}.bind(this)),window.addEventListener("resize",function(){this._hide()}.bind(this))}return __extends(OverlayControls,_super),OverlayControls.prototype.createElement=function(){var element=document.createElement("DIV");if(!this.controls.length)return element;var wrapper=document.createElement("DIV");wrapper.classList.add("pbs-overlay-wrapper"),element.appendChild(wrapper);for(var i=0;i<this.controls.length;i++){var control=document.createElement("DIV");control.classList.add("pbs-overlay-"+this.controls[i].name),control.control=this.controls[i],this.controls[i]._domElement=control,control.addEventListener("mouseenter",function(overlay){overlay._domElement.classList.add("pbs-over-"+this.control.name),this.control._domElement.classList.add("pbs-control-over")}.bind(control,this)),control.addEventListener("mouseleave",function(overlay){overlay._domElement.classList.add("pbs-over-"+this.control.name),this.control._domElement.classList.remove("pbs-control-over")}.bind(control,this)),wrapper.appendChild(control)}return this._locationDragging=null,element},OverlayControls.prototype.updatePosition=function(element){element&&element._domElement&&fastdom.measure(function(){var styles,rect,top,height,left,width;element&&element._domElement&&(styles=this._cachedStyles,rect=this._cachedRect,styles=window.pbsGetComputedStyle(element._domElement),rect=window.pbsGetBoundingClientRect(element._domElement),this._cachedStyles===styles&&this._cachedRect===rect||(top=rect.top,height=rect.height,left=rect.left,width=rect.width,fastdom.mutate(function(){var i,hide;for(this._domElement.style.top=top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._domElement.style.height=height+"px",this._domElement.style.left=left+"px",this._domElement.style.width=width+"px",i=0;i<this.controls.length;i++)hide=!1,"function"==typeof this.controls[i].display&&(this.controls[i].display(element)||(hide=!0)),this.controls[i]._domElement.style.display=hide?"none":"",hide||"function"!=typeof this.controls[i].refresh||this.controls[i].refresh(this,element,styles,rect);this._cachedStyles=styles,this._cachedRect=rect}.bind(this))))}.bind(this))},OverlayControls.prototype._hide=function(){if(!this._domElement||this._domElement.getAttribute("class").indexOf("pbs-active-")===-1)return this.shown=!1,OverlayControls.__super__._hide.call(this)},OverlayControls.prototype.hide=function(){return void!this._domElement},OverlayControls.prototype.show=function(element){return this.shown=!0,void this.updatePosition(element)},OverlayControls.prototype.onMoveStart=function(ev){var i,styles=getComputedStyle(this.element._domElement),rect=this.element._domElement.getBoundingClientRect();for(i=0;i<this.controls.length;i++)this._locationDragging===this.controls[i].name&&this.controls[i].onMoveStart&&this.controls[i].onMoveStart(this,this.element,styles,rect,ev)},OverlayControls.prototype.onMove=function(ev){var i;for(i=0;i<this.controls.length;i++)if(this._locationDragging===this.controls[i].name){this.controls[i].onMove&&this.controls[i].onMove(this,this.element,this.deltaX,this.deltaY,ev);break}this.updatePosition(this.element)},OverlayControls.prototype.onClick=function(ev){var i;for(this._locationDragging=null,i=0;i<this.controls.length;i++)this._domElement.classList.remove("pbs-active-"+this.controls[i].name),this.controls[i].onClick&&this.controls[i].onClick(this,this.element);for(i=0;i<this.controls.length;i++)if(ev.target===this.controls[i]._domElement){this._locationDragging=this.controls[i].name,this._domElement.classList.add("pbs-active-"+this.controls[i].name),this._domElement.classList.add("pbs-active"),this.controls[i]._domElement.classList.add("pbs-control-active");break}this.updatePosition(this.element)},OverlayControls.prototype._mouseup=function(ev){var i,ret=OverlayControls.__super__._mouseup.call(this,ev);for(i=0;i<this.controls.length;i++)this._domElement.classList.remove("pbs-active-"+this.controls[i].name),this.controls[i]._domElement.classList.remove("pbs-control-active"),this._locationDragging===this.controls[i].name&&this.controls[i].onMoveStop&&this.controls[i].onMoveStop(this,this.element,ev);return this._locationDragging=null,ret},OverlayControls}(PBSEditor.Overlay),PBSEditor.OverlayElement=function(_super){function OverlayElement(){var controls=[{name:"resize-bottom-left",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var height,remainder,width=-deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(remainder=width%10,width-=remainder),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10)));var rect=element._domElement.getBoundingClientRect(),rectWidth=rect.width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px";
"Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-top-left",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var height,remainder,width=-deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(remainder=width%10,width-=remainder),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10)));var rect=element._domElement.getBoundingClientRect(),rectWidth=rect.width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px";"Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-top-right",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var remainder,height,width=deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(remainder=width%10,width-=remainder),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10)));var rect=element._domElement.getBoundingClientRect(),rectWidth=rect.width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px";"Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-bottom-right",display:function(element){return"Image"===element.constructor.name||"Icon"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){var label;this._initWidth=rect.width,this._initHeight=rect.height,this._aspectRatio=rect.width/rect.height,label=rect.width+" &times; "+parseInt(rect.height,10)+" px","Image"===element.constructor.name&&("100%"===element.attr("width")&&(label="100%"),wp.hooks.doAction("pbs.element.out",element)),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=label,this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX){var remainder,height,width=deltaX+this._initWidth;window.PBSEditor.isShiftDown&&(remainder=width%10,width-=remainder),width=parseInt(width,10),height=1/this._aspectRatio*width,fastdom.mutate(function(){element.style("height",height+"px"),element.style("width",width+"px"),"Image"===element.constructor.name&&(element.attr("width",width),element.attr("height",parseInt(height,10)));var rect=element._domElement.getBoundingClientRect(),rectWidth=rect.width,rectTop=rect.top,rectRight=rect.right,label=width+" &times; "+parseInt(height,10)+" px";"Image"===element.constructor.name&&width>rectWidth&&(element.style("width","100%"),element.style("height","auto"),label="100%"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=label}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&(element.style("height","auto"),wp.hooks.doAction("pbs.element.over",element))}},{name:"resize-bottom",display:function(element){return"Map"===element.constructor.name||"Spacer"===element.constructor.name},refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var height=rect.height,width=rect.width;fastdom.mutate(function(){var side;height<150||width<150?(side=height,height>width&&(side=width),side=.3*side,this._domElement.style.width=side+"px",this._domElement.style.height=side+"px"):(this._domElement.style.width="",this._domElement.style.height="")}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles,rect){this._initWidth=rect.width,this._initHeight=rect.height,this._domElement.style.top=this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),this._overlaySize.innerHTML=rect.height+" px",this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize)},onMove:function(overlay,element,deltaX,deltaY){var remainder,height=deltaY+this._initHeight;window.PBSEditor.isShiftDown&&(remainder=height%10,height-=remainder),height=parseInt(height,10),fastdom.measure(function(){var rect=element._domElement.getBoundingClientRect(),rectTop=rect.top,rectRight=rect.right,rectHeight=rect.height;fastdom.mutate(function(){element.style("height",height+"px"),this._overlaySize.style.top=rectTop+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rectRight+"px",this._overlaySize.innerHTML=rectHeight+" px"}.bind(this))}.bind(this))},onMoveStop:function(overlay,element){document.body.removeChild(this._overlaySize),"Image"===element.constructor.name&&fastdom.mutate(function(){element.style("height","auto")})}},{name:"margin-top",display:function(element){return"Shortcode"!==element.constructor.name&&("Title"!==element.constructor.name&&("Spacer"!==element.constructor.name&&("Text"!==element.constructor.name||!element.content.isWhitespace())))},refresh:function(overlay,element,styles,rect){var marginTop=element._domElement.style.marginTop;marginTop||(marginTop=styles.marginTop),this._domElement.getAttribute("data-value")!=="margin-"+marginTop&&(rect.width>100?this._domElement.setAttribute("data-label",pbsParams.labels.margin+": "+marginTop):this._domElement.setAttribute("data-label",marginTop),parseInt(marginTop,10)<0?this._domElement.style.height="0px":this._domElement.style.height=marginTop,this._domElement.setAttribute("data-value","margin-"+marginTop))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.marginTop,10)},onMove:function(overlay,element,deltaX,deltaY){var remainder,margin=deltaY+this._initValue;window.PBSEditor.isShiftDown&&(remainder=margin%10,margin-=remainder),element.style("margin-top",margin+"px")}},{name:"margin-bottom",display:function(element){return"Shortcode"!==element.constructor.name&&("Title"!==element.constructor.name&&("Spacer"!==element.constructor.name&&("Text"!==element.constructor.name||!element.content.isWhitespace())))},refresh:function(overlay,element,styles,rect){var marginBottom=element._domElement.style.marginBottom;marginBottom||(marginBottom=styles.marginBottom),this._domElement.getAttribute("data-value")!=="margin-"+marginBottom&&(rect.width>100?this._domElement.setAttribute("data-label",pbsParams.labels.margin+": "+marginBottom):this._domElement.setAttribute("data-label",marginBottom),parseInt(marginBottom,10)<0?this._domElement.style.height="0px":this._domElement.style.height=marginBottom,this._domElement.setAttribute("data-value","margin-"+marginBottom))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.marginBottom,10)},onMove:function(overlay,element,deltaX,deltaY){var remainder,margin=deltaY+this._initValue;window.PBSEditor.isShiftDown&&(remainder=margin%10,margin-=remainder),fastdom.mutate(function(){element.style("margin-bottom",margin+"px")})}}];OverlayElement.__super__.constructor.call(this,controls),this.showOnTaint=!1}return __extends(OverlayElement,_super),OverlayElement.prototype.canApplyTo=function(element){return this.element===element?element:"Static"!==element.constructor.name&&(["ListItem","ListItemText"].indexOf(element.constructor.name)===-1&&(["Tab","TabPanelContainer"].indexOf(element.constructor.name)!==-1?"TabContainer"===element.parent().constructor.name?element.parent():"TabContainer"===element.parent().parent().constructor.name&&element.parent():["TableRow","TableSection"].indexOf(element.constructor.name)===-1&&(["Carousel"].indexOf(element.constructor.name)===-1&&(["Div","DivRow","DivCol","Region"].indexOf(element.constructor.name)===-1&&element))))},OverlayElement}(PBSEditor.OverlayControls),PBSEditor.OverlayColumn=function(_super){function OverlayColumn(){var controls=[{name:"padding-top",refresh:function(overlay,element,styles){fastdom.measure(function(){var paddingTop=element._domElement.style.paddingTop;paddingTop||(paddingTop=styles.paddingTop),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingTop&&(this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingTop),this._domElement.setAttribute("data-value","padding-"+paddingTop),this._domElement.style.height=paddingTop)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingTop,10)},onMove:function(overlay,element,deltaX,deltaY){var remainder,padding=deltaY+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(remainder=padding%10,padding-=remainder),element.style("padding-top",padding+"px")}},{name:"padding-bottom",refresh:function(overlay,element,styles){fastdom.measure(function(){var paddingBottom=element._domElement.style.paddingBottom;paddingBottom||(paddingBottom=styles.paddingBottom),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingBottom&&(this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingBottom),this._domElement.setAttribute("data-value","padding-"+paddingBottom),this._domElement.style.height=paddingBottom)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingBottom,10)},onMove:function(overlay,element,deltaX,deltaY){var remainder,padding=deltaY+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(remainder=padding%10,padding-=remainder),element.style("padding-bottom",padding+"px")}},{name:"padding-left",refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var paddingLeft=element._domElement.style.paddingLeft;paddingLeft||(paddingLeft=styles.paddingLeft),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingLeft&&(parseInt(rect.height,10)>100?this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingLeft):this._domElement.setAttribute("data-label",paddingLeft),this._domElement.setAttribute("data-value","padding-"+paddingLeft),this._domElement.style.width=paddingLeft)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingLeft,10)},onMove:function(overlay,element,deltaX){var remainder,padding=deltaX+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(remainder=padding%10,padding-=remainder),element.style("padding-left",padding+"px")}},{name:"padding-right",refresh:function(overlay,element,styles,rect){fastdom.measure(function(){var paddingRight=element._domElement.style.paddingRight;paddingRight||(paddingRight=styles.paddingRight),fastdom.mutate(function(){this._domElement.getAttribute("data-value")!=="padding-"+paddingRight&&(parseInt(rect.height,10)>100?this._domElement.setAttribute("data-label",pbsParams.labels.padding+": "+paddingRight):this._domElement.setAttribute("data-label",paddingRight),this._domElement.setAttribute("data-value","padding-"+paddingRight),this._domElement.style.width=paddingRight)}.bind(this))}.bind(this))},onMoveStart:function(overlay,element,styles){this._initValue=parseInt(styles.paddingRight,10)},onMove:function(overlay,element,deltaX){var remainder,padding=-deltaX+this._initValue;padding<0&&(padding=0),window.PBSEditor.isShiftDown&&(remainder=padding%10,padding-=remainder),element.style("padding-right",padding+"px")}}];OverlayColumn.__super__.constructor.call(this,controls),this.showOnTaint=!1}return __extends(OverlayColumn,_super),OverlayColumn.prototype.canApplyTo=function(element){if(this.element===element)return element;if(this.element!==element&&this.element&&this.element._domElement.parentNode.classList.contains(".pbs-col")&&this.element._domElement.parentNode.contains(element._domElement))return element;if("DivCol"===element.constructor.name)return element;if("DivCol"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivCol"===element.constructor.name)return element;element=element.parent()}return!1},OverlayColumn}(PBSEditor.OverlayControls),PBSEditor.OverlayRow=function(_super){function OverlayRow(){OverlayRow.__super__.constructor.call(this),this.showOnTaint=!1,this.shown=!1,ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("mousedown",function(ev){var focused=ContentEdit.Root.get().focused();focused&&focused._domElement===ev.target&&this._hide()}.bind(this)),ContentEdit.Root.get().bind("focus",function(){this._hide()}.bind(this)),document.addEventListener("keydown",function(ev){[40,37,39,38,9,8,46,13,16,91,18].indexOf(ev.keyCode)===-1&&this._hide()}.bind(this)),window.addEventListener("resize",function(){this._hide()}.bind(this))}return __extends(OverlayRow,_super),OverlayRow.showOnTaint=!1,OverlayRow.prototype.createElement=function(){var element=document.createElement("DIV");return this._topMargin=document.createElement("DIV"),this._topMargin.classList.add("pbs-overlay-margin-top"),this._topMargin.addEventListener("mouseenter",function(){this._domElement.classList.add("pbs-over-margin-top")}.bind(this)),this._topMargin.addEventListener("mouseleave",function(){this._domElement.classList.remove("pbs-over-margin-top")}.bind(this)),element.appendChild(this._topMargin),this._bottomMargin=document.createElement("DIV"),this._bottomMargin.classList.add("pbs-overlay-margin-bottom"),this._bottomMargin.addEventListener("mouseenter",function(){this._domElement.classList.add("pbs-over-margin-bottom")}.bind(this)),this._bottomMargin.addEventListener("mouseleave",function(){this._domElement.classList.remove("pbs-over-margin-bottom")}.bind(this)),element.appendChild(this._bottomMargin),this._bottomResize=document.createElement("DIV"),this._bottomResize.classList.add("pbs-overlay-resize-bottom"),this._bottomResize.addEventListener("mouseenter",function(){this._domElement.classList.add("pbs-over-resize-bottom")}.bind(this)),this._bottomResize.addEventListener("mouseleave",function(){this._domElement.classList.remove("pbs-over-resize-bottom")}.bind(this)),element.appendChild(this._bottomResize),this._columnControls=[],this._columnLabels=[],element},OverlayRow.prototype.updatePosition=function(element){fastdom.measure(function(){var rect=window.pbsGetBoundingClientRect(element._domElement);fastdom.mutate(function(){this._domElement.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px"}.bind(this))}.bind(this))},OverlayRow.prototype.hide=function(){OverlayRow.__super__.hide.call(this),this.shown=!1,document.body.classList.remove("pbs-overlay-is-nested-row")},OverlayRow.prototype.show=function(element){var styles,rect,label,o,i,margin,columnRect,marginTop,marginBottom,topMarginDataValue,bottomMarginDataValue,rowLeftPadding,height,elementName=element.parent().constructor.name,totalWidth=0,totalWidthNoMargin=0;for(this.shown=!0,fastdom.mutate(function(){this._topMargin.style.display="",this._bottomMargin.style.display="",this._bottomResize.style.display="","Div"===elementName?(this._topMargin.style.display="none",this._bottomMargin.style.display="none",this._bottomResize.style.display="none"):"TabPanelContainer"===elementName&&(this._topMargin.style.display="none",this._bottomMargin.style.display="none",this._bottomResize.style.display="none"),this._domElement.classList.remove("pbs-active-margin-top"),this._domElement.classList.remove("pbs-active-margin-bottom"),this._domElement.classList.remove("pbs-active-resize-bottom")}.bind(this)),this.updatePosition(element),fastdom.measure(function(){styles=window.pbsGetComputedStyle(element._domElement),marginTop=element._domElement.style.marginTop,marginTop||(marginTop=styles.marginTop),marginBottom=element._domElement.style.marginBottom,marginBottom||(marginBottom=styles.marginBottom),topMarginDataValue=this._topMargin.getAttribute("data-value"),bottomMarginDataValue=this._bottomMargin.getAttribute("data-value"),fastdom.mutate(function(){topMarginDataValue!=="margin-"+marginTop&&(this._topMargin.setAttribute("data-label",pbsParams.labels.margin+": "+marginTop),this._topMargin.setAttribute("data-value","margin-"+marginTop),this._topMargin.style.height=marginTop),bottomMarginDataValue!=="margin-"+marginBottom&&(this._bottomMargin.setAttribute("data-label",pbsParams.labels.margin+": "+marginBottom),this._bottomMargin.style.height=marginBottom,this._bottomMargin.setAttribute("data-value","margin-"+marginBottom))}.bind(this))}.bind(this)),i=this._columnControls.length-1;i>=0;i--)this._columnControls[i].parentNode.removeChild(this._columnControls[i]);for(i=this._columnLabels.length-1;i>=0;i--)this._columnLabels[i].parentNode.removeChild(this._columnLabels[i]);this._columnControls=[],this._columnLabels=[],this._columnWidths=[],this._columnMarginRight=[],fastdom.measure(function(){for(rect=window.pbsGetBoundingClientRect(element._domElement),height=rect.height,rowLeftPadding=parseInt(element.style("padding-left"),10),i=0;i<element.children.length;i++)columnRect=window.pbsGetBoundingClientRect(element.children[i]._domElement),this._columnWidths.push(columnRect.width),this._columnMarginRight.push(element.children[i]._domElement.style.marginRight);fastdom.mutate(function(){for(i=0;i<element.children.length-1;i++)o=document.createElement("DIV"),o.classList.add("pbs-overlay-column-width-"+i),o.classList.add("pbs-overlay-column-width"),o._index=i,o._this=this,height>100?o.setAttribute("data-label",pbsParams.labels.column_width):o.setAttribute("data-label",pbsParams.labels.width),o.addEventListener("mouseenter",function(){this._this._domElement.classList.add("pbs-over-column-width-"+this._index),this._this._domElement.classList.add("pbs-overlay-column-width")}),o.addEventListener("mouseleave",function(){this._this._domElement.classList.remove("pbs-over-column-width-"+this._index),this._this._domElement.classList.remove("pbs-overlay-column-width")}),totalWidth+=this._columnWidths[i],totalWidthNoMargin+=this._columnWidths[i],o.style.left=rowLeftPadding+totalWidth+"px",this._columnMarginRight[i]&&(margin=parseInt(this._columnMarginRight[i],10),totalWidth+=margin,o.style.width=margin+"px",o.style.marginLeft="0px"),this._domElement.appendChild(o),this._columnControls.push(o);for(element.children.length&&(totalWidthNoMargin+=this._columnWidths[element.children.length-1]),totalWidth=0,i=0;i<element.children.length;i++)label=document.createElement("DIV"),label.classList.add("pbs-overlay-column-label"),label.innerHTML=(this._columnWidths[i]/totalWidthNoMargin*100).toFixed(1)+"%",i?label.style.left=rowLeftPadding+totalWidth+"px":label.style.left=totalWidth+"px",totalWidth+=this._columnWidths[i],this._columnMarginRight[i]&&(totalWidth+=parseInt(this._columnMarginRight[i],10)),this._domElement.appendChild(label),this._columnLabels.push(label)}.bind(this))}.bind(this)),fastdom.mutate(function(){"DivCol"===element.parent().constructor.name?document.body.classList.add("pbs-overlay-is-nested-row"):document.body.classList.remove("pbs-overlay-is-nested-row")})},OverlayRow.prototype.onMoveStart=function(){var i,styles=getComputedStyle(this.element._domElement),rect=this.element._domElement.getBoundingClientRect(),rectHeight=rect.height;for(this.marginTopInitialValue=parseInt(styles.marginTop,10),this.marginBottomInitialValue=parseInt(styles.marginBottom,10),this.resizeBottomInitialValue=parseInt(styles.minHeight,10),parseInt(rectHeight,10)>this.resizeBottomInitialValue&&(this.resizeBottomInitialValue=parseInt(rectHeight,10)),this.columnWidthInitialValues=[],i=0;i<this.element.children.length;i++)rect=this.element.children[i]._domElement.getBoundingClientRect(),this.columnWidthInitialValues.push(rect.width)},OverlayRow.prototype.onMove=function(){var label,width,margin,remainder,height,rect,totalWidth,totalWidthNoMargin,i,change,colRect,columnRect,rowLeftPadding;if(rect=this.element._domElement.getBoundingClientRect(),"margin-top"===this._locationDragging)margin=this.deltaY+this.marginTopInitialValue,window.PBSEditor.isShiftDown&&(remainder=margin%10,margin-=remainder),this.element.style("margin-top",margin+"px"),this._topMargin.setAttribute("data-label",pbsParams.labels.margin+": "+margin+"px"),this._topMargin.style.height=margin+"px",this._topMargin.setAttribute("data-value","margin-"+margin+"px");else if("margin-bottom"===this._locationDragging)margin=this.deltaY+this.marginBottomInitialValue,window.PBSEditor.isShiftDown&&(remainder=margin%10,margin-=remainder),this.element.style("margin-bottom",margin+"px"),rect.width>100?this._bottomMargin.setAttribute("data-label",pbsParams.labels.margin+": "+margin+"px"):this._bottomMargin.setAttribute("data-label",margin+"px"),this._bottomMargin.style.height=margin+"px",this._bottomMargin.setAttribute("data-value","margin-"+margin+"px");else if("resize-bottom"===this._locationDragging)height=this.deltaY+this.resizeBottomInitialValue,window.PBSEditor.isShiftDown&&(remainder=height%10,height-=remainder),this.element.style("min-height",height+"px"),label=parseInt(height,10),parseInt(rect.height,10)>label&&(label=parseInt(rect.height,10)),this._overlaySize.innerHTML=parseInt(label,10)+"px";else if(0===this._locationDragging.indexOf("column-")){for(width=this.deltaX+this.columnWidthInitialValues[this._columnDragging],window.PBSEditor.isShiftDown&&(remainder=width%10,width-=remainder),change=this.columnWidthInitialValues[this._columnDragging]-width,totalWidth=0,totalWidthNoMargin=0,i=0;i<this.element.children.length;i++)colRect=this.element.children[i]._domElement.getBoundingClientRect(),totalWidth+=colRect.width,totalWidthNoMargin+=colRect.width,i<this.element.children.length-1&&(this._columnControls[i].style.left=totalWidth+"px",this.element.children[i]._domElement.style.marginRight&&(totalWidth+=parseInt(this.element.children[i]._domElement.style.marginRight,10)));for(this.element._domElement.classList.add("pbs-overlay-changing-cols"),i=0;i<this.element.children.length;i++)this.element.children[i].style("flex-grow",""),i===this._columnDragging?this.element.children[i].style("flex-basis",width/totalWidthNoMargin*100+"%"):i===this._columnDragging+1?this.element.children[i].style("flex-basis",(this.columnWidthInitialValues[i]+change)/totalWidthNoMargin*100+"%"):this.element.children[i].style("flex-basis",this.columnWidthInitialValues[i]/totalWidthNoMargin*100+"%")}for(rect=window.pbsGetBoundingClientRect(this.element._domElement),this._domElement.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._domElement.style.height=rect.height+"px",this._domElement.style.left=rect.left+"px",this._domElement.style.width=rect.width+"px",rowLeftPadding=parseInt(this.element.style("padding-left"),10),totalWidthNoMargin=0,totalWidth=0,i=0;i<this.element.children.length;i++)columnRect=this.element.children[i]._domElement.getBoundingClientRect(),totalWidthNoMargin+=columnRect.width;for(i=0;i<this.element.children.length;i++)columnRect=this.element.children[i]._domElement.getBoundingClientRect(),this._columnLabels[i].classList.add("pbs-overlay-column-label"),this._columnLabels[i].innerHTML=(columnRect.width/totalWidthNoMargin*100).toFixed(1)+"%",i?this._columnLabels[i].style.left=rowLeftPadding+totalWidth+"px":this._columnLabels[i].style.left=totalWidth+"px",totalWidth+=columnRect.width,this.element.children[i]._domElement.style.marginRight&&(totalWidth+=parseInt(this.element.children[i]._domElement.style.marginRight,10));wp.hooks.doAction("pbs.overlay.row.move",this,this._locationDragging)},OverlayRow.prototype.canApplyTo=function(element){if(this.element===element)return element;if(this.element!==element&&this.element){if(this.element._domElement.parentNode.classList.contains(".pbs-row")&&this.element._domElement.parentNode.contains(element._domElement))return element;if(this.element._domElement.parentNode.classList.contains(".pbs-col")&&this.element._domElement.parentNode.parentNode.contains(element._domElement))return element}if("DivRow"===element.constructor.name)return element;if("DivRow"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivRow"===element.constructor.name)return element;element=element.parent()}return!1},OverlayRow.prototype._mouseup=function(){var i;for(OverlayRow.__super__._mouseup.call(this),this._domElement.classList.remove("pbs-active-margin-top"),this._domElement.classList.remove("pbs-active-margin-bottom"),this._domElement.classList.remove("pbs-active-resize-bottom"),this.element&&this.element._domElement&&this.element._domElement.classList.remove("pbs-overlay-changing-cols"),this._domElement.classList.remove("pbs-active-overlay-column"),i=0;i<10;i++)this._domElement.classList.remove("pbs-active-column-"+i);this._overlaySize&&(this._overlaySize.parentNode.removeChild(this._overlaySize),this._overlaySize=null)},OverlayRow.prototype.onClick=function(ev){var i,styles,rect,label;if(this._locationDragging=null,this._domElement.classList.remove("pbs-active-overlay-column"),ev.target===this._topMargin)this._locationDragging="margin-top";else if(ev.target===this._bottomMargin)this._locationDragging="margin-bottom";else if(ev.target===this._bottomResize)this._locationDragging="resize-bottom";else for(i=0;i<this._columnControls.length;i++)if(ev.target===this._columnControls[i]){this._locationDragging="column-"+this._columnControls[i]._index,this._columnDragging=this._columnControls[i]._index,this._domElement.classList.add("pbs-active-overlay-column");break}for(this._domElement.classList.remove("pbs-active-margin-top"),this._domElement.classList.remove("pbs-active-margin-bottom"),this._domElement.classList.remove("pbs-active-bottom-resize"),i=0;i<10;i++)this._domElement.classList.remove("pbs-active-column-"+i);this._locationDragging&&this._domElement.classList.add("pbs-active-"+this._locationDragging),"resize-bottom"===this._locationDragging&&(styles=getComputedStyle(this.element._domElement),rect=this.element._domElement.getBoundingClientRect(),this._overlaySize=document.createElement("DIV"),this._overlaySize.classList.add("pbs-size-indicator"),label=parseInt(styles.minHeight,10),parseInt(rect.height,10)>label&&(label=parseInt(rect.height,10)),this._overlaySize.innerHTML=label+"px",this._overlaySize.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",this._overlaySize.style.left=rect.right+"px",document.body.appendChild(this._overlaySize))},OverlayRow}(PBSEditor.Overlay),function(){var _Root=ContentEdit.Root.get(),proxiedGetDropPlacement=_Root._getDropPlacement;_Root._getDropPlacement=function(x,y){var placement=proxiedGetDropPlacement.call(this,x,y);return placement&&(placement[1]="center",showDropIndicator(placement)),placement};var proxiedCancelDragging=_Root.cancelDragging;_Root.cancelDragging=function(){return this._dragging&&hideDropIndicator(),proxiedCancelDragging.call(this)};var proxiedOnStopDragging=_Root._onStopDragging;_Root._onStopDragging=function(ev){return proxiedOnStopDragging.call(this,ev)};var proxiedOnMouseOut=ContentEdit.Element.prototype._onMouseOut;ContentEdit.Element.prototype._onMouseOut=function(ev){var ret=proxiedOnMouseOut.call(this,ev),root=ContentEdit.Root.get();return root.dragging()&&hideDropIndicator(),ret};var proxiedOnMouseOver=ContentEdit.Element.prototype._onMouseOver;ContentEdit.Element.prototype._onMouseOver=function(ev){var ret=proxiedOnMouseOver.call(this,ev),root=ContentEdit.Root.get();return root.dragging()===this&&(hideDropIndicator(),ev.stopPropagation(),ev.preventDefault()),ret};var proxiedDrop=ContentEdit.Element.prototype.drop;
ContentEdit.Element.prototype.drop=function(element,placement){var ret=proxiedDrop.call(this,element,placement);return element&&hideDropIndicator(),ret};var indicatorTimeout=null,dropIndicator=null,prevDropTarget=null,prevDropPlacement=null,showDropIndicator=function(placement){var root=ContentEdit.Root.get();dropIndicator||(dropIndicator=document.createElement("DIV"),dropIndicator.classList.add("pbs-drop-indicator"),dropIndicator.appendChild(document.createElement("SPAN")),dropIndicator.appendChild(document.createElement("SPAN")));var dropTargetDom=root._dropTarget._domElement;if(prevDropTarget!==dropTargetDom||prevDropPlacement!==placement[0]){prevDropTarget=dropTargetDom,prevDropPlacement=placement[0],clearTimeout(indicatorTimeout),dropIndicator.firstChild.innerHTML=pbsParams.labels.move_above_s.replace(/%s/,root._dropTarget.typeName()),dropIndicator.firstChild.nextSibling.innerHTML=pbsParams.labels.move_below_s.replace(/%s/,root._dropTarget.typeName());var styles=window.pbsGetComputedStyle(root._dropTarget._domElement),rect=window.pbsGetBoundingClientRect(root._dropTarget._domElement),toolbarHeight=window.formattingToolbarHeight(),scrollY=window.pbsScrollY();dropIndicator.classList.remove("pbs-drop-indicator-small"),rect.height+parseInt(styles.marginTop,10)+parseInt(styles.marginBottom,10)<60&&dropIndicator.classList.add("pbs-drop-indicator-small"),dropIndicator.classList.remove("pbs-drop-indicator-above"),dropIndicator.classList.remove("pbs-drop-indicator-below"),dropIndicator.classList.add("pbs-drop-indicator-"+placement[0]),"P"===dropTargetDom.tagName&&"DIV"===dropTargetDom.parentNode.tagName&&dropTargetDom.parentNode.classList&&dropTargetDom.classList&&dropTargetDom.parentNode.classList.contains("pbs-col")&&dropTargetDom.classList.contains("ce-element--empty")&&(dropIndicator.firstChild.innerHTML=pbsParams.labels.move_inside_column,dropIndicator.firstChild.nextSibling.innerHTML=pbsParams.labels.move_inside_column,dropIndicator.classList.remove("pbs-drop-indicator-above"),dropIndicator.classList.add("pbs-drop-indicator-below"));var marginTop=0;parseInt(styles.marginTop,10)>0&&(marginTop=parseInt(styles.marginTop,10)),dropIndicator.style.top=rect.top+scrollY-toolbarHeight-32-marginTop+"px",dropIndicator.style.left=rect.left+"px",dropIndicator.style.width=rect.width+"px",dropIndicator.style.height=rect.height+marginTop+parseInt(styles.marginBottom,10)+"px",setTimeout(function(){dropIndicator&&dropIndicator.classList.add("pbs-drop-indicator-show")},10),document.body.appendChild(dropIndicator)}},hideDropIndicator=function(){prevDropTarget=null,prevDropPlacement=null,clearTimeout(indicatorTimeout),indicatorTimeout=setTimeout(function(){dropIndicator&&(document.body.removeChild(dropIndicator),dropIndicator=null)},10)},proxiedStartDragging=_Root.startDragging;_Root.startDragging=function(element,x,y){var ret=proxiedStartDragging.call(this,element,x,y);if(this._dragging)return setTimeout(function(){this._draggingDOMElement&&this._draggingDOMElement.classList.add("pbs-drag-helper-show")}.bind(this),10),ret};var pbsOverElement=_.throttle(function(ev){var root=ContentEdit.Root.get();if(root.dragging()){if(window.pbsSelectorMatches(ev.target,".ct-widget, .ct-widget *"))return hideDropIndicator(),void(root._dropTarget=null);var elements=document.querySelectorAll(".pbs-main-wrapper > .ce-element, .pbs-main-wrapper > [data-ce-tag]"),pointerY=ev.pageY,closestDistance=999999999,closestElement=null,placement=["above","center"],doExit=!1;Array.prototype.forEach.call(elements,function(el){if(el._ceElement&&el._ceElement!==root.dragging()){if(window.pbsSelectorMatches(el,".ce-element *, [data-ce-tag] *"))return void(doExit=!0);var elemY,rect=el.getBoundingClientRect(),scrollY=window.pbsScrollY(),top=rect.top+scrollY,bottom=top+rect.height;elemY=pointerY<=top?top:pointerY>=bottom?bottom:pointerY;var dist=Math.abs(pointerY-elemY);return 0===dist?void(doExit=!0):void(dist<closestDistance&&(closestDistance=dist,closestElement=el._ceElement,placement[0]=pointerY<=top+rect.height/2?"above":"below"))}}),doExit||closestElement&&(root._dropTarget=closestElement,showDropIndicator(placement))}},30),mouseListener=function(ev){pbsOverElement(ev)};ContentTools.EditorApp.get().bind("start",function(){window.addEventListener("mousemove",mouseListener),window.addEventListener("mouseover",mouseListener)}),ContentTools.EditorApp.get().bind("stop",function(){window.removeEventListener("mousemove",mouseListener),window.removeEventListener("mouseover",mouseListener)})}(),window.addEventListener("DOMContentLoaded",function(){for(var origTitles=[],findInThese=["h1","h2","h3","h4",""],titleMarkers=null,i=0;i<findInThese.length;i++)document.querySelectorAll(findInThese[i]+" [data-pbs-title-marker-post-id]").length&&(titleMarkers=document.querySelectorAll(findInThese[i]+" [data-pbs-title-marker-post-id]"));titleMarkers||(titleMarkers=document.querySelectorAll("[data-pbs-title-marker-post-id]"));var titles=[];if(Array.prototype.forEach.call(titleMarkers,function(marker){var titleElement=marker.parentNode,postID=marker.getAttribute("data-pbs-title-marker-post-id");titleElement.classList.add("pbs-title-editor"),titleElement.getAttribute("pbs-post-id",postID),titles.push(titleElement)}),titleMarkers=document.querySelectorAll("[data-pbs-title-marker-post-id]"),Array.prototype.forEach.call(titleMarkers,function(marker){marker.parentNode.removeChild(marker)}),titles.length){var editor=ContentTools.EditorApp.get();for(PBSEditor.Title=function(){function Title(domElement){this._domElement=domElement}return Title.prototype.mount=function(){this._domElement.setAttribute("contenteditable","true"),this._onPasteBound=Title.prototype._onPaste.bind(this),this._domElement.addEventListener("paste",this._onPasteBound),this._onKeyDownBound=Title.prototype._onKeyDown.bind(this),this._domElement.addEventListener("keydown",this._onKeyDownBound),this._onFocusBound=Title.prototype._onFocus.bind(this),this._domElement.addEventListener("focus",this._onFocusBound),this._onBlurBound=Title.prototype._onBlur.bind(this),this._domElement.addEventListener("blur",this._onBlurBound),this._onMouseEnterBound=Title.prototype._onMouseEnter.bind(this),this._domElement.addEventListener("mouseenter",this._onMouseEnterBound),this._onMouseLeaveBound=Title.prototype._onMouseLeave.bind(this),this._domElement.addEventListener("mouseleave",this._onMouseLeaveBound)},Title.prototype.unmount=function(){this._domElement.removeEventListener("paste",this._onKeyDownBound),this._domElement.removeEventListener("keydown",this._onKeyDownBound),this._domElement.removeEventListener("focus",this._onFocusBound),this._domElement.removeEventListener("blur",this._onBlurBound),this._domElement.removeEventListener("mouseenter",this._onMouseEnterBound),this._domElement.removeEventListener("mouseleave",this._onMouseLeaveBound),this._domElement.removeAttribute("contenteditable"),this._domElement.classList.remove("ce-element--focused")},Title.prototype._onKeyDown=function(ev){(ev.ctrlKey||ev.metaKey)&&([82,73,66].indexOf(ev.keyCode)!==-1&&ev.preventDefault(),[90].indexOf(ev.keyCode)!==-1&&ev.stopPropagation())},Title.prototype._onPaste=function(ev){ev.preventDefault();var text="";ev.clipboardData||ev.originalEvent.clipboardData?text=(ev.originalEvent||ev).clipboardData.getData("text/plain"):window.clipboardData&&(text=window.clipboardData.getData("Text")),document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,text):document.execCommand("paste",!1,text)},Title.prototype._onFocus=function(){var root=ContentEdit.Root.get();root.focused()&&root.focused().blur(),this._domElement.classList.add("ce-element--focused"),PBSEditor.Overlay.hideOtherOverlays(null)},Title.prototype._onBlur=function(){this._domElement.classList.remove("ce-element--focused")},Title.prototype._onMouseEnter=function(){wp.hooks.doAction("pbs.element.over",this)},Title.prototype._onMouseLeave=function(){},Title.prototype.parent=function(){return null},Title}(),i=0;i<titles.length;i++)titles[i]=new PBSEditor.Title(titles[i]);editor.bind("start",function(){origTitles=[];for(var i=0;i<titles.length;i++)titles[i].mount(),origTitles.push(titles[i]._domElement.textContent)}),editor.bind("stop",function(){for(var i=0;i<titles.length;i++)titles[i].unmount()}),wp.hooks.addAction("pbs.save.payload",function(payload){for(var i=titles.length-1;i>=0;i--)if(origTitles[i]!==titles[i]._domElement.textContent){payload.append("title",titles[i]._domElement.textContent);break}})}}),PBSEditor.Toolbar=function(_super){function Toolbar(elementName,tools){Toolbar.__super__.constructor.call(this),this.tools=tools,this.elementName=elementName}return __extends(Toolbar,_super),Toolbar.prototype.createElement=function(){var element=document.createElement("DIV");element.classList.add("pbs-overlay-toolbar"),element.classList.add("pbs-toolbar-"+this.elementName.toLowerCase().replace(/[^\w\d]/,"-"));var buttonContainer=document.createElement("DIV");buttonContainer.classList.add("pbs-toolbar-wrapper"),element.appendChild(buttonContainer),this._buttonContainer=buttonContainer;for(var tool,i=0;i<this.tools.length;i++)tool=document.createElement("DIV"),tool.classList.add("pbs-toolbar-tool"),this.tools[i].label?(tool.classList.add("pbs-toolbar-label"),tool.innerHTML=this.tools[i].label,buttonContainer.appendChild(tool)):(tool.classList.add("pbs-toolbar-tool-"+this.tools[i].id),this.tools[i].tooltip&&tool.setAttribute("data-tooltip",this.tools[i].tooltip),tool.toolbar=this,tool.tool=this.tools[i],tool.addEventListener("click",function(ev){this.tool.onClick&&(this.tool.onClick(tool.toolbar.element,this,ev),tool.toolbar.updatePosition(tool.toolbar.element))}.bind(tool)),tool.addEventListener("mousedown",function(ev){this.tool.onMouseDown&&(this.tool.onMouseDown(tool.toolbar.element,this,ev),tool.toolbar.updatePosition(tool.toolbar.element))}.bind(tool)),tool.addEventListener("mouseenter",function(ev){this.tool.onEnter&&(this.tool.onEnter(tool.toolbar.element,tool.toolbar,ev),tool.toolbar.updatePosition(tool.toolbar.element))}.bind(tool)),buttonContainer.appendChild(tool));return element},Toolbar.prototype.canApplyTo=function(element){return this.element===element?element:!(!element.constructor||element.constructor.name!==this.elementName)&&element},Toolbar.prototype._updateFirstLastButtons=function(){return},Toolbar.prototype.checkIfTooSmall=function(element){fastdom.measure(function(){var rect=window.pbsGetBoundingClientRect(element._domElement),width=rect.width;fastdom.mutate(function(){width<=100?this._domElement.classList.add("pbs-toolbar-top"):this._domElement.classList.remove("pbs-toolbar-top")}.bind(this))}.bind(this))},Toolbar.prototype.updateTools=function(element){var i;for(i=0;i<this.tools.length;i++)this.tools[i]["class"]&&this._domElement.children[0].children[i].classList.add(this.tools[i]["class"]),"function"==typeof this.tools[i].tooltip&&this._domElement.children[0].children[i].setAttribute("data-tooltip",this.tools[i].tooltip(element)),"function"==typeof this.tools[i].label&&(this._domElement.children[0].children[i].innerHTML=this.tools[i].label(element)),this._domElement.children[0].children[i].classList.remove("pbs-toolbar-tool-hide"),"function"==typeof this.tools[i].display&&(this.tools[i].display(element,this._domElement.children[0].children[i])||this._domElement.children[0].children[i].classList.add("pbs-toolbar-tool-hide"))},Toolbar.prototype.show=function(element){Toolbar.__super__.show.call(this,element),this._updateFirstLastButtons(),this.checkIfTooSmall(element),this.updateTools(element)},Toolbar.prototype._mouseenter=function(ev){Toolbar.__super__._mouseenter.call(this,ev),this._updateFirstLastButtons()},Toolbar}(PBSEditor.OverlayControls),PBSEditor.ToolbarElement=function(_super){function ToolbarElement(){ToolbarElement.__super__.constructor.call(this,"Text",toolbars),ToolbarElement.prototype.canApplyTo=function(element){var ret=ToolbarElement.__super__.canApplyTo.call(this,element);return(!ret||"Text"!==element.constructor.name||!element.content.isWhitespace())&&ret}}__extends(ToolbarElement,_super);var toolbars=[];return toolbars.push({id:"move",tooltip:pbsParams.labels.move,display:function(element){return"IconLabel"!==element.parent().constructor.name&&!element.content.isWhitespace()},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){"IconLabel"===element.parent().constructor.name&&element.parent().parent().detach(element.parent()),element.parent().detach(element)}}),ToolbarElement}(PBSEditor.Toolbar),PBSEditor.ToolbarImage=function(_super){function ToolbarImage(){ToolbarImage.__super__.constructor.call(this,"Image",toolbars)}__extends(ToolbarImage,_super);var toolbars=[];return toolbars.push({id:"link",tooltip:pbsParams.labels.edit_link,onClick:function(element){window.PBSEditor.getToolUI("link").apply(element,null,function(){})}},{id:"unlink",tooltip:pbsParams.labels.unlink,display:function(element){return!!element.a},onClick:function(element,view){element.a=void 0,view.toolbar.canApply(element)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"align-left",tooltip:pbsParams.labels.align_left,onClick:function(element){element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("alignleft")}},{id:"align-center",tooltip:pbsParams.labels.align_center,onClick:function(element){element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("aligncenter")}},{id:"align-right",tooltip:pbsParams.labels.align_right,onClick:function(element){element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),element.addCSSClass("alignright")}},{id:"edit",tooltip:pbsParams.labels.edit,onClick:function(element){element.openMediaManager()}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}),ToolbarImage}(PBSEditor.Toolbar),PBSEditor.ToolbarNewsletter=function(_super){function ToolbarNewsletter(){ToolbarNewsletter.__super__.constructor.call(this,"Newsletter",[{label:pbsParams.labels.newsletter},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarNewsletter,_super),ToolbarNewsletter}(PBSEditor.Toolbar),PBSEditor.ToolbarHtml=function(_super){function ToolbarHtml(){ToolbarHtml.__super__.constructor.call(this,"Html",[{label:pbsParams.labels.html},{id:"edit",tooltip:pbsParams.labels.edit,onClick:function(element){element.openEditor()}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarHtml,_super),ToolbarHtml}(PBSEditor.Toolbar),PBSEditor.ToolbarIframe=function(_super){function ToolbarIframe(){ToolbarIframe.__super__.constructor.call(this,"IFrame",[{label:pbsParams.labels.iframe},{id:"edit",tooltip:pbsParams.labels.edit,onClick:function(element){element._onDoubleClick()}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarIframe,_super),ToolbarIframe}(PBSEditor.Toolbar),PBSEditor.ToolbarEmbed=function(_super){function ToolbarEmbed(){ToolbarEmbed.__super__.constructor.call(this,"Embed",[{label:pbsParams.labels.embedded_url},{id:"edit",tooltip:pbsParams.labels.edit,onClick:function(element){element._onDoubleClick()}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarEmbed,_super),ToolbarEmbed}(PBSEditor.Toolbar),PBSEditor.ToolbarMap=function(_super){function ToolbarMap(){ToolbarMap.__super__.constructor.call(this,"Map",[{label:pbsParams.labels.map},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarMap,_super),ToolbarMap}(PBSEditor.Toolbar),PBSEditor.ToolbarIcon=function(_super){function ToolbarIcon(){ToolbarIcon.__super__.constructor.call(this,"Icon",[{label:pbsParams.labels.icon},{display:function(element){return!!element.getLink()},label:function(element){return element.getLink()?element.getLink():""}},{id:"unlink",tooltip:pbsParams.labels.unlink,display:function(element){return!!element.getLink()},onClick:function(element,view){element.removeLink(),view.toolbar.canApply(element)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"edit",tooltip:"Edit",onClick:function(element){element._onDoubleClick()}},{id:"clone",tooltip:pbsParams.labels.clone,display:function(element){return"IconLabel"!==element.parent().constructor.name},onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels["delete"],display:function(element){return"IconLabel"!==element.parent().constructor.name},onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarIcon,_super),ToolbarIcon}(PBSEditor.Toolbar),PBSEditor.ToolbarShortcode=function(_super){function ToolbarShortcode(){ToolbarShortcode.__super__.constructor.call(this,"Shortcode",[{label:function(element){var label=wp.hooks.applyFilters("pbs.toolbar.shortcode.label",element.sc_base);return PBSInspectorOptions.Shortcode[element.sc_base]&&PBSInspectorOptions.Shortcode[element.sc_base].label&&(label=wp.hooks.applyFilters("pbs.toolbar.shortcode.label",PBSInspectorOptions.Shortcode[element.sc_base].label)),label}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"edit",tooltip:pbsParams.labels.edit,onClick:function(element){element.convertToText()}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element.clone()}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarShortcode,_super),ToolbarShortcode}(PBSEditor.Toolbar),PBSEditor.ToolbarList=function(_super){function ToolbarList(){ToolbarList.__super__.constructor.call(this,"List",[{label:pbsParams.labels.list},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarList,_super),ToolbarList}(PBSEditor.Toolbar),PBSEditor.ToolbarRow=function(_super){function ToolbarRow(){ToolbarRow.__super__.constructor.call(this,"DivRow",[{"class":"pbs-toolbar-yellow",display:function(element){if(element.parent())return element.parent()._domElement.classList.contains("glide__slide")},label:function(){return pbsParams.labels.carousel}},{id:"move",tooltip:pbsParams.labels.move_carousel,"class":"pbs-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onMouseDown:function(element,toolbar,ev){ev.stopPropagation();var o=element.parent().parent().parent().parent();o.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,"class":"pbs-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();ContentTools.EditorApp.get()._toolboxProperties.inspect(o)}},{id:"minus",tooltip:pbsParams.labels.remove_slide,"class":"pbs-toolbar-yellow",display:function(element){if(element.parent()._domElement.classList.contains("glide__slide")){var o=element.parent().parent().parent().parent();return o.numSlides()>1}return!1},onClick:function(element){var o=element.parent().parent().parent().parent();o.removeSlide(o.activeSlide())}},{id:"add",tooltip:pbsParams.labels.add_slide,"class":"pbs-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();o.addSlide()}},{id:"clone",tooltip:pbsParams.labels.clone_slide,"class":"pbs-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();o.cloneSlide(o.activeSlide())}},{id:"remove",tooltip:pbsParams.labels.delete_carousel,"class":"pbs-toolbar-yellow",display:function(element){return element.parent()._domElement.classList.contains("glide__slide")},onClick:function(element){var o=element.parent().parent().parent().parent();o.parent().detach(o)}},{label:pbsParams.labels.row},{id:"move",tooltip:pbsParams.labels.move,display:function(element){return!element.parent()._domElement.classList.contains("glide__slide")&&("TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name)},onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"add",tooltip:pbsParams.labels.add_column,onClick:function(element){var root,index,col,overElement=element._domElement.querySelector(".ce-element--over");if(overElement&&overElement.classList.remove("ce-element--over"),root=ContentEdit.Root.get(),index=element.children.length+1,root.focused())for(col=root.focused();"Region"!==col.constructor.name&&"DivRow"!==col.constructor.name;){if("DivCol"===col.constructor.name){index=element.children.indexOf(col)+1;break}col=col.parent()}col=element.addNewColumn(index)}},{id:"clone",tooltip:pbsParams.labels.clone_row,display:function(element){return!element.parent()._domElement.classList.contains("glide__slide")&&("TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name)},onClick:function(element){var newRow=element.clone();window._pbsFixRowWidth(newRow._domElement)}},{id:"responsive_hide",tooltip:function(){return window.innerWidth<=400?pbsParams.labels.hide_in_phones:pbsParams.labels.hide_in_tablets},display:function(element,button){return!element.parent()._domElement.classList.contains("glide__slide")&&("TabPanelContainer"!==element.parent().constructor.name&&("Toggle"!==element.parent().constructor.name&&(!(window.innerWidth>800)&&(window.innerWidth>400?element.attr("data-pbs-hide-tablet")?button.classList.add("pbs-responsive-hidden"):button.classList.remove("pbs-responsive-hidden"):"1"===element.attr("data-pbs-hide-phone")||"2"===element.attr("data-pbs-hide-phone")?button.classList.add("pbs-responsive-hidden"):button.classList.remove("pbs-responsive-hidden"),!0))))},onClick:function(element,button){window.innerWidth>400?element.attr("data-pbs-hide-tablet")?(element.removeAttr("data-pbs-hide-tablet"),"2"===element.attr("data-pbs-hide-phone")&&element.removeAttr("data-pbs-hide-phone"),button.classList.remove("pbs-responsive-hidden")):(element.attr("data-pbs-hide-tablet","1"),"0"!==element.attr("data-pbs-hide-phone")&&"1"!==element.attr("data-pbs-hide-phone")&&element.attr("data-pbs-hide-phone","2"),button.classList.add("pbs-responsive-hidden")):"0"!==element.attr("data-pbs-hide-phone")?(element.attr("data-pbs-hide-phone","0"),button.classList.remove("pbs-responsive-hidden")):(element.attr("data-pbs-hide-phone","1"),button.classList.add("pbs-responsive-hidden"))}},{id:"remove",tooltip:pbsParams.labels["delete"],display:function(element){return!element.parent()._domElement.classList.contains("glide__slide")&&("TabPanelContainer"!==element.parent().constructor.name&&"Toggle"!==element.parent().constructor.name)},onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarRow,_super),ToolbarRow.prototype.canApplyTo=function(element){if("DivRow"===element.constructor.name)return element;if("DivRow"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivRow"===element.constructor.name)return element;element=element.parent()}return!1},ToolbarRow.prototype.show=function(element){ToolbarRow.__super__.show.call(this,element),this._domElement.classList.add("pbs-smaller-toolbar")},ToolbarRow}(PBSEditor.Toolbar),PBSEditor.ToolbarColumn=function(_super){function ToolbarColumn(){ToolbarColumn.__super__.constructor.call(this,"DivCol",[{label:pbsParams.labels.column},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"clone",tooltip:pbsParams.labels.clone,onClick:function(element){element._domElement.classList.remove("ce-element--over");var col=element.clone();col.focus(),col._domElement.classList.add("ce-element--over")}},{id:"remove",tooltip:pbsParams.labels["delete"],display:function(element){if(element.parent()&&element.parent().parent()){if(element.parent().parent()._domElement.classList.contains("glide__slide"))return element.parent().children.length>1;if("TabPanelContainer"===element.parent().parent().constructor.name)return element.parent().children.length>1;if("Toggle"===element.parent().parent().constructor.name)return element.parent().children.length>1}return!0},onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarColumn,_super),ToolbarColumn.prototype.canApplyTo=function(element){if("DivCol"===element.constructor.name)return element;if("DivCol"!==element.constructor.name)for(element=element.parent();element&&"Region"!==element.constructor.name;){if("DivCol"===element.constructor.name)return element;element=element.parent()}return!1},ToolbarColumn.prototype.show=function(element){ToolbarColumn.__super__.show.call(this,element),this._domElement.classList.add("pbs-smaller-toolbar")},ToolbarColumn}(PBSEditor.Toolbar),PBSEditor.ToolbarTabContainer=function(_super){function ToolbarTabContainer(){ToolbarTabContainer.__super__.constructor.call(this,"TabContainer",toolbar)}__extends(ToolbarTabContainer,_super);var toolbar=[];return toolbar.push({label:pbsParams.labels.tabs},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.parent().drag(ev.pageX,ev.pageY)}},{id:"add",tooltip:pbsParams.labels.add_tab,onClick:function(element){element.parent().addTab()}},{id:"settings",tooltip:pbsParams.labels.properties,onClick:function(element){ContentTools.EditorApp.get()._toolboxProperties.inspect(element)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().parent().detach(element.parent())}}),ToolbarTabContainer.prototype.canApplyTo=function(element){return"Tab"===element.constructor.name?element.parent():ToolbarTabContainer.__super__.canApplyTo.call(this,element)},ToolbarTabContainer}(PBSEditor.Toolbar),PBSEditor.ToolbarTable=function(_super){function ToolbarTable(){ToolbarTable.__super__.constructor.call(this,"Table",[{label:pbsParams.labels.table},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarTable,_super),ToolbarTable}(PBSEditor.Toolbar),PBSEditor.ToolbarTitle=function(_super){function ToolbarTitle(){ToolbarTitle.__super__.constructor.call(this,"Title",[{label:"Post Title"}])}return __extends(ToolbarTitle,_super),ToolbarTitle}(PBSEditor.Toolbar),PBSEditor.ToolbarSpacer=function(_super){function ToolbarSpacer(){ToolbarSpacer.__super__.constructor.call(this,"Spacer",[{label:pbsParams.labels.spacer},{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarSpacer,_super),ToolbarSpacer}(PBSEditor.Toolbar),PBSEditor.ToolbarHr=function(_super){function ToolbarHr(){ToolbarHr.__super__.constructor.call(this,"Hr",[{id:"move",tooltip:pbsParams.labels.move,onMouseDown:function(element,toolbar,ev){ev.stopPropagation(),element.drag(ev.pageX,ev.pageY)}},{id:"remove",tooltip:pbsParams.labels["delete"],onClick:function(element){element.parent().detach(element)}}])}return __extends(ToolbarHr,_super),ToolbarHr}(PBSEditor.Toolbar),PBSEditor.Tooltip=function(){function Tooltip(name,selector,labelFunction,tools){this._domElement=null,this.name=name||this.constructor.name.toLowerCase(),this.labelFunction=labelFunction||function(){},this.selector=selector||"",this.tools=tools||[],this.init()}return Tooltip.prototype.init=function(){this._onMouseOverBound=this._onMouseOver.bind(this),this._onMouseOutBound=this._onMouseOut.bind(this),ContentTools.EditorApp.get().bind("start",function(){this._domElement=document.createElement("DIV"),this._domElement.classList.add("pbs-tooltip--"+this.name),this._domElement.classList.add("pbs-tooltip");var label=document.createElement("DIV");this._domElement.appendChild(label);for(var i=0;i<this.tools.length;i++){var tool=document.createElement("DIV");tool.classList.add("pbs-tooltip-button"),tool.classList.add("pbs-tooltip-button-"+this.tools[i].name),tool.addEventListener("click",this.tools[i].onClick.bind(this)),this._domElement.appendChild(tool)}document.body.appendChild(this._domElement),document.addEventListener("mouseover",this._onMouseOverBound),document.addEventListener("mouseout",this._onMouseOutBound)}.bind(this)),ContentTools.EditorApp.get().bind("stop",function(){this.hide(),document.removeEventListener("mouseover",this._onMouseOverBound),document.removeEventListener("mouseout",this._onMouseOutBound),this._domElement.parentNode.removeChild(this._domElement),this._domElement=null}.bind(this))},Tooltip.prototype._onMouseOver=function(ev){if(pbsSelectorMatches(ev.target,".pbs-main-wrapper "+this.selector+", .pbs-main-wrapper "+this.selector+" *")){for(var target=ev.target;!pbsSelectorMatches(target,".pbs-main-wrapper "+this.selector);)target=target.parentNode;this.show(target)}},Tooltip.prototype._onMouseOut=function(ev){return ev.relatedTarget?void((!pbsSelectorMatches(ev.target,".pbs-main-wrapper "+this.selector)&&!pbsSelectorMatches(ev.target,".pbs-main-wrapper "+this.selector+" *")||ev.relatedTarget!==this._domElement&&!this._domElement.contains(ev.relatedTarget))&&(this._domElement!==ev.target&&!this._domElement.contains(ev.target)||!pbsSelectorMatches(ev.relatedTarget,".pbs-main-wrapper "+this.selector)&&!pbsSelectorMatches(ev.relatedTarget,".pbs-main-wrapper "+this.selector+" *"))&&(this._domElement!==ev.target&&!this._domElement.contains(ev.target)||this._domElement!==ev.relative&&!this._domElement.contains(ev.relatedTarget))&&this.hide()):void this.hide()},Tooltip.prototype.show=function(domElementTarget){var rect=window.pbsGetBoundingClientRect(domElementTarget);this._domElement.style.top=rect.top+window.pbsScrollY()-window.formattingToolbarHeight()+"px",
this._domElement.style.left=rect.left+rect.width/2+"px","function"==typeof this.labelFunction?this._domElement.firstChild.innerHTML=this.labelFunction(domElementTarget):this._domElement.firstChild.innerHTML=this.labelFunction,this._domElement.classList.add("pbs-tooltip-show"),this.element=domElementTarget},Tooltip.prototype.hide=function(){this._domElement.classList.remove("pbs-tooltip-show")},Tooltip}(),PBSEditor.TooltipLink=function(_super){function TooltipLink(){TooltipLink.__super__.constructor.call(this,"link",".ce-element--type-text a:not(.pbs-button)",function(element){var link=element.getAttribute("href");return link.length>70&&(link=link.substr(0,70)+"..."),link},[{name:"visit",onClick:function(){window.open(this.element.getAttribute("href"),"_linktool"),this.hide()}},{name:"edit",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selection=new ContentSelect.Range(index,index);selection.select(domElement),window.PBSEditor.getToolUI("link").apply(domElement._ceElement,selection,function(){}),this.hide()}},{name:"unlink",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selected=ContentTools.Tools.Link.getSelectedLink(domElement._ceElement,index,index),from=selected.from,to=selected.to;domElement._ceElement.content=domElement._ceElement.content.unformat(from,to,"a"),domElement._ceElement.updateInnerHTML(),domElement._ceElement.taint(),this.hide()}}])}return __extends(TooltipLink,_super),TooltipLink}(PBSEditor.Tooltip),PBSEditor.TooltipButton=function(_super){function TooltipButton(){TooltipButton.__super__.constructor.call(this,"button","a.pbs-button",function(element){var link=element.getAttribute("href");return link.length>70&&(link=link.substr(0,70)+"..."),link},[{name:"settings",onClick:function(){ContentTools.EditorApp.get()._toolboxProperties.inspect(this.element)}},{name:"visit",onClick:function(){window.open(this.element.getAttribute("href"),"_linktool"),this.hide()}},{name:"edit",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selection=new ContentSelect.Range(index,index);selection.select(domElement),window.PBSEditor.getToolUI("link").apply(domElement._ceElement,selection,function(){}),this.hide()}},{name:"unlink",onClick:function(){for(var domElement=this.element;!domElement._ceElement;)domElement=domElement.parentNode;var index=domElement._ceElement.content.indexOf(this.element.innerHTML),selected=ContentTools.Tools.Link.getSelectedLink(domElement._ceElement,index,index),from=selected.from,to=selected.to;domElement._ceElement.content=domElement._ceElement.content.unformat(from,to,"a"),domElement._ceElement.updateInnerHTML(),domElement._ceElement.taint(),this.hide()}}])}return __extends(TooltipButton,_super),TooltipButton}(PBSEditor.Tooltip),PBSEditor.TooltipInput=function(_super){function TooltipInput(){TooltipInput.__super__.constructor.call(this,"input",'p[class*="ce-element--"] input[type="text"]',pbsParams.labels.input_field,[{name:"settings",onClick:function(){ContentTools.EditorApp.get()._toolboxProperties.inspect(this.element)}}])}return __extends(TooltipInput,_super),TooltipInput}(PBSEditor.Tooltip),PBSEditor.TooltipTab=function(_super){function TooltipTab(){TooltipTab.__super__.constructor.call(this,"button",'[data-ce-tag="tab"]',pbsParams.labels.tab,[{name:"remove",onClick:function(){this.element._ceElement.parent().parent().removeTab(this.element._ceElement),this.hide()}}])}return __extends(TooltipTab,_super),TooltipTab}(PBSEditor.Tooltip),document.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("detach",function(){"undefined"!=typeof AOS&&AOS.refresh()})});var elemsWithBoundingRects=[],elemsWithComputedStyles=[],showActualRect=!1;window.pbsGetBoundingClientRect=function(element){return!showActualRect&&element._boundingClientRect||(element._boundingClientRect=element.getBoundingClientRect(),elemsWithBoundingRects.push(element)),element._boundingClientRect},window.pbsGetComputedStyle=function(element){return element._computedStyle||(element._computedStyle=getComputedStyle(element),elemsWithComputedStyles.push(element)),element._computedStyle},window.pbsScrollY=function(){return window._prevScrollY||(window._prevScrollY=window.scrollY||window.pageYOffset),window._prevScrollY},window.addEventListener("scroll",function(){window._prevScrollY=null}),window.formattingToolbarHeight=function(){var toolbar;return this._formattingToolbarHeight?this._formattingToolbarHeight:(toolbar=window.pbsGetBoundingClientRect(document.querySelector(".pbs-toolbox-bar")),this._formattingToolbarHeight=toolbar.height,this._formattingToolbarHeight)},function(){var clearClientRects=function(){var i;for(i=0;i<elemsWithBoundingRects.length;i++)elemsWithBoundingRects[i]&&(elemsWithBoundingRects[i]._boundingClientRect=null);for(elemsWithBoundingRects=[],i=0;i<elemsWithComputedStyles.length;i++)elemsWithComputedStyles[i]&&(elemsWithComputedStyles[i]._computedStyle=null);elemsWithComputedStyles=[]},mousedown=!1,mouseDownListener=function(){mousedown=!0,clearClientRects()},mouseUpListener=function(){mousedown=!1,showActualRect=!1,clearClientRects()},mouseMoveListener=function(){mousedown&&clearClientRects()},overlayDragListener=function(){showActualRect=!0,clearClientRects()},clearRectsAndOverlays=function(){PBSEditor.Overlay.hideOtherOverlays(),clearClientRects()};ContentTools.EditorApp.get().bind("start",function(){window.addEventListener("mouseup",mouseUpListener),window.addEventListener("mousedown",mouseDownListener),window.addEventListener("mousemove",mouseMoveListener),window.addEventListener("keydown",clearClientRects),window.addEventListener("keyup",clearClientRects),window.addEventListener("resize",clearClientRects),window.addEventListener("scroll",clearClientRects),wp.hooks.addAction("pbs.overlay.drag",overlayDragListener),wp.hooks.addAction("pbs.image.mounted",clearRectsAndOverlays),ContentEdit.Root.get().bind("unmount",clearRectsAndOverlays),ContentEdit.Root.get().bind("mount",clearRectsAndOverlays)}),ContentTools.EditorApp.get().bind("stop",function(){window.removeEventListener("mouseup",mouseUpListener),window.removeEventListener("mousedown",mouseDownListener),window.removeEventListener("mousemove",mouseMoveListener),window.removeEventListener("keydown",clearClientRects),window.removeEventListener("keyup",clearClientRects),window.removeEventListener("resize",clearClientRects),window.removeEventListener("scroll",clearClientRects),wp.hooks.removeAction("pbs.overlay.drag",overlayDragListener),wp.hooks.removeAction("pbs.image.mounted",clearRectsAndOverlays),ContentEdit.Root.get().unbind("unmount",clearRectsAndOverlays),ContentEdit.Root.get().unbind("mount",clearRectsAndOverlays)})}(),PBSEditor.allDroppers={Carousel:ContentEdit.Element._dropVert,DivRow:ContentEdit.Element._dropVert,Div:ContentEdit.Element._dropVert,Embed:ContentEdit.Element._dropVert,Hr:ContentEdit.Element._dropVert,IFrame:ContentEdit.Element._dropVert,Shortcode:ContentEdit.Element._dropVert,Static:ContentEdit.Element._dropVert,Text:ContentEdit.Element._dropVert,Image:ContentEdit.Element._dropVert,List:ContentEdit.Element._dropVert,PreText:ContentEdit.Element._dropVert,Table:ContentEdit.Element._dropVert,Video:ContentEdit.Element._dropVert,Tabs:ContentEdit.Element._dropVert,Toggle:ContentEdit.Element._dropVert},PBSEditor.isNewStaticLikeElement=function(element){return"Static"!==element.constructor.name&&("Icon"!==element.constructor.name&&"undefined"!=typeof element._content)},ContentEdit.Text.prototype._elementOverrideKeyLeft=ContentEdit.Text.prototype._keyLeft,ContentEdit.Text.prototype._keyLeft=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(0===selection.get()[0]){var elem=this.previousContent();if(elem&&elem.focus&&PBSEditor.isNewStaticLikeElement(elem))return ev.preventDefault(),ev.stopPropagation(),void elem.focus()}return this._elementOverrideKeyLeft(ev)},ContentEdit.Text.prototype._elementOverrideKeyRight=ContentEdit.Text.prototype._keyRight,ContentEdit.Text.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(this._atEnd(selection)){var elem=this.nextContent();if(elem&&elem.focus&&PBSEditor.isNewStaticLikeElement(elem))return ev.preventDefault(),ev.stopPropagation(),void elem.focus()}return this._elementOverrideKeyRight(ev)},window.addEventListener("DOMContentLoaded",function(){var editor=ContentEdit.Root.get();document.addEventListener("keydown",function(ev){if(editor.focused()&&(!ev.target||["INPUT","TEXTAREA"].indexOf(ev.target.tagName)===-1)&&PBSEditor.isNewStaticLikeElement(editor.focused())&&["body","html"].indexOf(ev.target.tagName.toLowerCase())!==-1&&[16,17,18,91,92].indexOf(ev.which)===-1){var p,elem,parent,selection,sc=editor.focused(),index=sc.parent().children.indexOf(sc);if([13,8,46].indexOf(ev.which)!==-1&&ev.preventDefault(),8===ev.which?(sc.blur(),sc.parent().children[index-1]?(elem=sc.parent().children[index-1],elem.focus(),elem.content&&(selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem._domElement))):sc.parent().children[index+1]?(elem=sc.parent().children[index+1],elem.focus(),elem.content&&(selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem._domElement))):(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},10))):46===ev.which&&(sc.blur(),sc.parent().children[index+1]?sc.parent().children[index+1].focus():sc.parent().children[index-1]?sc.parent().children[index-1].focus():(parent=sc.parent(),setTimeout(function(){parent.children[0].focus()},10))),8===ev.which||46===ev.which)return void sc.parent().detach(sc);if((40===ev.which||39===ev.which)&&sc.nextContent()&&sc.parent().children.indexOf(sc)!==sc.parent().children.length-1)return ev.preventDefault(),void sc.nextContent().focus();if((38===ev.which||37===ev.which)&&sc.previousContent()&&0!==sc.parent().children.indexOf(sc))return ev.preventDefault(),void sc.previousContent().focus();38!==ev.which&&37!==ev.which&&index++,p=new ContentEdit.Text("p"),sc.parent().attach(p,index),sc.blur(),p.focus()}})}),ContentEdit.Node.prototype._overridePreviousContent=ContentEdit.Node.prototype.previousContent,ContentEdit.Node.prototype.previousContent=function(){var node=this.previousWithTest(function(node){return void 0!==node.content||PBSEditor.isNewStaticLikeElement(node)});return node},ContentEdit.Node.prototype._overrideNextContent=ContentEdit.Node.prototype.nextContent,ContentEdit.Node.prototype.nextContent=function(){return this.nextWithTest(function(node){return void 0!==node.content||PBSEditor.isNewStaticLikeElement(node)})},function(){var proxied=ContentEdit.Element.prototype._addDOMEventListeners;ContentEdit.Element.prototype._addDOMEventListeners=function(){return this._syncContent&&(this._domElement.oninput=function(){if(this._syncContent)return this._syncContent()}.bind(this)),proxied.call(this)}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseUp;ContentEdit.Static.prototype._onMouseUp=function(ev){proxied.call(this,ev),clearTimeout(this._dragTimeout),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseOut;ContentEdit.Static.prototype._onMouseOut=function(ev){proxied.call(this,ev),this._doubleClickCount=0,clearTimeout(this._dragTimeout)}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseMove;ContentEdit.Static.prototype._onMouseMove=function(ev){proxied.call(this,ev),this._doubleClickCount=0}}(),function(){var proxied=ContentEdit.Static.prototype._onMouseDown;ContentEdit.Static.prototype._onMouseDown=function(ev){ev.preventDefault(),ev.stopPropagation(),proxied.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target&&(this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION/2),clearTimeout(this._doubleClickTimeout),this._doubleClickTimeout=setTimeout(function(_this){return function(){_this._doubleClickCount=0}}(this),500),this._doubleClickCount++,3===this._doubleClickCount&&(clearTimeout(this._dragTimeout),this._doubleClickCount=0,"function"==typeof this._onDoubleClick&&this._onDoubleClick(ev)))}}(),ContentEdit.Static.prototype.convertToText=function(text,keepSize){"undefined"==typeof keepSize&&(keepSize=!1);var elem=document.createElement("P");elem.innerHTML=text,elem=ContentEdit.Text.fromDOMElement(elem),this.blur();var index=this.parent().children.indexOf(this),rect=this._domElement.getBoundingClientRect(),marginBottom=0;if(this._domElement.nextElementSibling){var nextRect=this._domElement.nextElementSibling.getBoundingClientRect();marginBottom=nextRect.top-rect.bottom}return this.parent().attach(elem,index),this.parent().detach(this),keepSize&&(elem._domElement.style.minHeight=rect.height+"px",elem._domElement.style.marginBottom=marginBottom+"px"),elem.focus(),function(elem){setTimeout(function(){var selection=new ContentSelect.Range(elem.content.length(),elem.content.length());elem._domElement&&selection.select(elem._domElement)},1)}(elem),elem},ContentEdit.StaticEditable=function(_super){function StaticEditable(tagName,attributes,content){this._doubleClickCount=0,StaticEditable.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(StaticEditable,_super),StaticEditable.droppers=PBSEditor.allDroppers,StaticEditable.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},StaticEditable.prototype._onMouseOver=function(ev){return StaticEditable.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},StaticEditable.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},StaticEditable.prototype.cssTypeName=function(){return"staticeditable"},StaticEditable.prototype.typeName=function(){return"StaticEditable"},StaticEditable}(ContentEdit.Static),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){if(ev.preventDefault(),this.content.isWhitespace())return proxied.call(this,ev);if(ev.shiftKey||ev.metaKey||ev.ctrlKey){ContentSelect.Range.query(this._domElement);var selection=ContentSelect.Range.query(this._domElement),tip=this.content.substring(0,selection.get()[0]),tail=this.content.substring(selection.get()[1]),cursor=selection.get()[0]+1,br=new HTMLString.String("<br><br>",(!0));return 0!==tail.length()&&(br=new HTMLString.String("<br>",(!0))),this.content=tip.concat(br,tail),this.updateInnerHTML(),selection.set(cursor,cursor),this.selection(selection),this.taint()}return proxied.call(this,ev)}}(),function(){ContentEdit.Text.prototype._onMouseDown=function(ev){return this.isFocused()&&this.content.isWhitespace()?void ev.preventDefault():(ContentEdit.Text.__super__._onMouseDown.call(this),this.content.isWhitespace()?void setTimeout(function(){var selection=new ContentSelect.Range(0,0);selection.select(this.domElement())}.bind(this),10):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)))};var proxied=ContentEdit.Text.prototype._onMouseUp;ContentEdit.Text.prototype._onMouseUp=function(ev){proxied.call(this,ev),this.content.isWhitespace()&&ev.preventDefault()}}(),function(){var bringBackState=!1,mouseDownHandler=function(ev){if(!ev.target._ceElement&&window.pbsSelectorMatches(ev.target,"[data-editable]")){var root=ContentEdit.Root.get(),element=root.focused();if(!element)return;element.storeState(),bringBackState=!0}},mouseUpHandler=function(){if(bringBackState){bringBackState=!1;var root=ContentEdit.Root.get(),element=root.focused();if(!element)return;element.restoreState()}},proxiedFocus=ContentEdit.Text.prototype.focus;ContentEdit.Text.prototype.focus=function(supressDOMFocus){var ret=proxiedFocus.call(this,supressDOMFocus);return document.addEventListener("mousedown",mouseDownHandler),document.addEventListener("mouseup",mouseUpHandler),ret};var proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(){var ret=proxiedBlur.call(this);return document.removeEventListener("mousedown",mouseDownHandler),document.removeEventListener("mouseup",mouseUpHandler),ret}}(),function(){var proxied=ContentEdit.Text.prototype._onKeyDown;ContentEdit.Text.prototype._onKeyDown=function(ev){var docRange,n,range,sel;if([40,37,39,38,9,8,46,13,32].indexOf(ev.keyCode)===-1&&window.getSelection().rangeCount){try{docRange=window.getSelection().getRangeAt(0)}catch(_error){return proxied.call(this,ev)}docRange.startContainer.parentNode&&(docRange.startContainer.nextSibling&&"A"!==docRange.startContainer.parentNode.tagName&&"A"===docRange.startContainer.nextSibling.tagName?docRange.startOffset===docRange.startContainer.length&&(docRange.startContainer.nextSibling.innerHTML.match(/^&nbsp;/)||(n=document.createTextNode(""),docRange.startContainer.nextSibling.insertBefore(n,docRange.startContainer.nextSibling.firstChild),range=document.createRange(),sel=window.getSelection(),range.setStart(docRange.startContainer.nextSibling,1),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))):"A"===docRange.startContainer.parentNode.tagName&&docRange.startOffset===docRange.startContainer.length&&(docRange.startContainer.parentNode.innerHTML.match(/&nbsp;$/)||(n=document.createTextNode(""),docRange.startContainer.parentNode.appendChild(n)),range=document.createRange(),sel=window.getSelection(),range.setStart(docRange.startContainer,docRange.startContainer.length),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range)))}proxied.call(this,ev)}}(),function(){var proxiedBlur=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(){if(this._domElement){var innerHTML=this._domElement.innerHTML;innerHTML=innerHTML.replace(/(\s|&nbsp;)+(<\/a>)/,"$2"),innerHTML=innerHTML.replace(/(<a\s[^>]+>)(&nbsp;|\s)+/,"$1"),this._domElement.innerHTML!==innerHTML&&(this._domElement.innerHTML=innerHTML,this._syncContent())}return proxiedBlur.call(this)}}(),function(){var proxy=ContentEdit.Text.prototype._syncContent;ContentEdit.Text.prototype._syncContent=function(){return this._domElement.innerHTML.match(/<font(>|\s)/)&&(this.storeState(),this._domElement.innerHTML=this._domElement.innerHTML.replace(/<font(>|\s)/,"<span$1"),this._domElement.innerHTML.match(/<\/font>/)&&(this._domElement.innerHTML=this._domElement.innerHTML.replace(/<\/font>/,"</span>")),this._domElement.innerHTML.match(/color=['"][^'"]+['"]/)&&(this._domElement.innerHTML=this._domElement.innerHTML.replace(/color=['"]([^'"]+)['"]/,'style="color: $1"')),this.restoreState()),proxy.call(this)}}(),function(){var proxied=ContentEdit.Text.prototype._syncContent;ContentEdit.Text.prototype._syncContent=function(ev){return this._domElement&&"undefined"!=typeof this._domElement.innerHTML?proxied.call(this,ev):this._flagIfEmpty()}}(),function(){var proxied=ContentEdit.Text.prototype._addCSSClass;ContentEdit.Text.prototype._addCSSClass=function(className){return"ce-element--empty"===className&&this.attr("data-placeholder",pbsParams.labels.click_to_add_text),proxied.call(this,className)}}(),function(){var proxied=ContentEdit.Text.prototype._removeCSSClass;ContentEdit.Text.prototype._removeCSSClass=function(className){return"ce-element--empty"===className&&this.removeAttr("data-placeholder"),proxied.call(this,className)}}(),function(){var proxied=ContentEdit.Text.prototype._onKeyUp;ContentEdit.Text.prototype._onKeyUp=function(ev){var ret=proxied.call(this,ev);if(9===ev.keyCode&&"lorem"===this.content.text().toLowerCase()){this.content=new HTMLString.String("Lorem ipsum dolor sit amet, consectetur adipisicing elit. At dolor sed numquam? Sapiente autem adipisci, minus expedita enim, suscipit laboriosam deleniti possimus sequi pariatur explicabo numquam alias atque officia sit."),this.updateInnerHTML(),this.taint();var selection=new ContentSelect.Range(this.content.length(),this.content.length());selection.select(this._domElement)}return ret}}(),function(){var proxied=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(ev){if("lorem"===this.content.text().toLowerCase()){this.content=new HTMLString.String("Lorem ipsum dolor sit amet, consectetur adipisicing elit. At dolor sed numquam? Sapiente autem adipisci, minus expedita enim, suscipit laboriosam deleniti possimus sequi pariatur explicabo numquam alias atque officia sit."),this.updateInnerHTML(),this.taint();var selection=new ContentSelect.Range(this.content.length(),this.content.length());selection.select(this._domElement)}return proxied.call(this,ev)}}(),ContentEdit.Shortcode=function(_super){function Shortcode(tagName,attributes,content){this.sc_hash=attributes["data-shortcode"],this.sc_base=attributes["data-base"],this.sc_raw=Shortcode.atob(this.sc_hash),this.sc_prev_raw=this.sc_raw,this.model=new Backbone.Model({}),this.parseShortcode(),this.model.element=this,this.model.listenTo(this.model,"change",this.modelChanged.bind(this)),this._doubleClickCount=0,Shortcode.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Shortcode,_super),Shortcode.sc_raw="",Shortcode.sc_hash="",Shortcode.sc_base="",Shortcode.sc_prev_raw="",Shortcode.btoa=function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},Shortcode.atob=function(str){return decodeURIComponent(Array.prototype.map.call(window.atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))},Shortcode.prototype.mount=function(){var ret=Shortcode.__super__.mount.call(this),scStyles=getComputedStyle(this._domElement);return"0px"===scStyles.height?this._domElement.classList.add("pbs--blank"):this._domElement.classList.remove("pbs--blank"),setTimeout(function(){if(this._domElement){var scStyles=getComputedStyle(this._domElement);"0px"===scStyles.height?this._domElement.classList.add("pbs--blank"):this._domElement.classList.remove("pbs--blank")}}.bind(this),1),ret},Shortcode.createShortcode=function(shortcode){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","shortcode"),o.setAttribute("data-base",shortcode.shortcode.tag),o.setAttribute("data-shortcode",Shortcode.btoa(shortcode.shortcode.string())),ContentEdit.Shortcode.fromDOMElement(o)},Shortcode.fromDOMElement=function(domElement){var newElement=new this(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML);return PBSEditor._justAddedDesignElement&&newElement.ajaxUpdate(!0),newElement},Shortcode.prototype.convertToText=function(){var innerHTML=this._domElement.innerHTML,elem=Shortcode.__super__.convertToText.call(this,this.sc_raw);return elem.origShortcode=this.sc_raw,elem.origInnerHTML=innerHTML,elem.isShortcodeEditing=!0,elem},Shortcode.prototype.parseShortcode=function(){var sc=wp.shortcode.next(this.sc_base,this.sc_raw,0);for(var attributeName in sc.shortcode.attrs.named)sc.shortcode.attrs.named.hasOwnProperty(attributeName)&&this.model.set(attributeName,sc.shortcode.attrs.named[attributeName],{silent:!0});for(var i=0;i<sc.shortcode.attrs.numeric.length;i++)this.model.set(i,sc.shortcode.attrs.numeric[i],{silent:!0});this.model.set("content",sc.shortcode.content,{silent:!0})},Shortcode.prototype._onDoubleClick=function(){wp.hooks.applyFilters("pbs.shortcode.allow_raw_edit",!0,this.sc_base,this)&&this.convertToText()},Shortcode.prototype.cssTypeName=function(){return"shortcode"},Shortcode.prototype.typeName=function(){return"Shortcode"},Shortcode.prototype.clone=function(){var root=ContentEdit.Root.get();root.focused()===this&&root.focused().blur();var clone=document.createElement("div");clone.innerHTML=this.html();var newElement=Shortcode.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);this.parent().attach(newElement,index+1),newElement.focus()},Shortcode.prototype.modelChanged=function(){this.updateSCRaw(),this.updateSCHash(),clearTimeout(this._scRefreshTrigger);var _this=this;this._scRefreshTrigger=setTimeout(function(){_this.ajaxUpdate()},500)},Shortcode.prototype.setSCAttr=function(name,value){this.model.set(name,value)},Shortcode.prototype.setSCContent=function(value){this.model.set("content",value)},Shortcode.prototype.updateSCRaw=function(){var sc="";sc+="["+this.sc_base;for(var keys=this.model.keys(),i=0;i<keys.length;i++){var attrName=keys[i];if("content"!==attrName){var value=this.model.get(attrName)||"";value=value.replace(/\n/g,"<br>"),sc+=" "+attrName+'="'+value+'"'}}sc+="]",this.model.get("content")&&(sc+=this.model.get("content")),sc+="[/"+this.sc_base+"]",this.sc_raw=sc},Shortcode.prototype.updateSCHash=function(){this.sc_hash=Shortcode.btoa(this.sc_raw),this.attr("data-shortcode",this.sc_hash)},Shortcode.prototype.unmount=function(){Shortcode.__super__.unmount.call(this),setTimeout(function(){this.runInitScripts()}.bind(this),100)},Shortcode.prototype.runInitScripts=function(){var ranInitCode=!1;if(this._scriptsToRun)for(var i=0;i<this._scriptsToRun.length;i++)try{new Function(this._scriptsToRun[i])(),ranInitCode=!0}catch(err){console.log("PBS:",this.sc_base,"init code errored out.")}if("undefined"!=typeof pbsParams.shortcode_mappings[this.sc_base]){var map=pbsParams.shortcode_mappings[this.sc_base];if("undefined"!=typeof map.init_code)try{this._domElement?new Function(map.init_code).bind(this._domElement.firstChild)():new Function(map.init_code)(),ranInitCode=!0}catch(err){console.log("PBS:",this.sc_base,"init code errored out.")}}ranInitCode?setTimeout(function(){this._domElement&&(this._content=this._domElement.innerHTML)}.bind(this),10):this._domElement&&(this._content=this._domElement.innerHTML)},Shortcode.prototype.ajaxUpdate=function(forceUpdate){clearTimeout(this._ajaxUpdateTimeout),this._ajaxUpdateTimeout=setTimeout(function(){this._ajaxUpdate(forceUpdate)}.bind(this),500)},Shortcode.prototype._ajaxUpdate=function(forceUpdate){if(this.sc_prev_raw!==this.sc_raw||forceUpdate){var payload=new FormData;payload.append("action","pbs_shortcode_render"),payload.append("shortcode",this.sc_hash),payload.append("nonce",pbsParams.nonce),this._domElement.classList.add("pbs--rendering");var _this=this,request=new XMLHttpRequest;request.open("POST",window.location.href),request.onload=function(){if(request.status>=200&&request.status<400){var i,node,response;try{response=JSON.parse(request.responseText)}catch(err){return console.log("PBS: Error getting rendered shortcode"),_this._domElement.classList.remove("pbs--rendering"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",void(_this.sc_prev_raw=_this.sc_raw)}var enqueued=response.scripts+response.styles,dummyContainer=document.createElement("div");dummyContainer.innerHTML=enqueued.trim();var currentHead=document.querySelector("html").innerHTML,enqueuedScriptsPending=0,scriptsToRun=[];if(enqueued.trim().length)for(i=dummyContainer.childNodes.length-1;i>=0;i--)if(dummyContainer.childNodes[i].getAttribute){if(node=dummyContainer.childNodes[i],"SCRIPT"===node.tagName){if(node.getAttribute("src")){var scriptURL=node.getAttribute("src");document.querySelector('script[src="'+scriptURL+'"]')||(enqueuedScriptsPending++,jQuery.getScript(node.getAttribute("src")).done(function(){enqueuedScriptsPending--}).fail(function(){enqueuedScriptsPending--}));continue}scriptsToRun.unshift(node.innerHTML);continue}if("LINK"===node.tagName&&"stylesheet"===node.getAttribute("rel")&&node.getAttribute("href")){var styleURL=node.getAttribute("href");if(document.querySelector('link[href="'+styleURL+'"]'))continue}currentHead.indexOf(node.outerHTML)===-1&&document.body.appendChild(node)}if(dummyContainer=document.createElement("div"),dummyContainer.innerHTML=response.output.trim(),_this._domElement.innerHTML="",dummyContainer.innerHTML.length)for(i=dummyContainer.childNodes.length-1;i>=0;i--)if(node=dummyContainer.childNodes[i],3===dummyContainer.childNodes[i].nodeType)_this._domElement.insertBefore(node,_this._domElement.firstChild);else{if("SCRIPT"===node.tagName){scriptsToRun.unshift(node.innerHTML);continue}_this._domElement.insertBefore(node,_this._domElement.firstChild)}if(_this._content=dummyContainer.innerHTML,scriptsToRun&&(_this._scriptsToRun=scriptsToRun,_this._scriptRunInterval=setInterval(function(){enqueuedScriptsPending||(this.runInitScripts(),clearInterval(this._scriptRunInterval))}.bind(_this),100)),_this.style("float",""),1===_this._domElement.children.length)try{var style=getComputedStyle(_this._domElement.firstChild);"left"!==style["float"]&&"right"!==style["float"]||_this.style("float",style["float"])}catch(err){}document.dispatchEvent(new CustomEvent("pbs:shortcode-render",{detail:document.querySelector(".pbs--rendering")}))}_this._domElement.classList.remove("pbs--rendering"),_this._domElement.classList.remove("pbs--blank"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw;var scStyles=getComputedStyle(_this._domElement);"0px"===scStyles.height?_this._domElement.classList.add("pbs--blank"):_this._domElement.classList.remove("pbs--blank")},request.onerror=function(){_this._domElement.classList.remove("pbs--rendering"),_this._domElement.style.minHeight="",_this._domElement.style.marginBottom="",_this.sc_prev_raw=_this.sc_raw},request.send(payload)}},Shortcode}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Shortcode,"shortcode"),ContentEdit.Text.prototype.convertShortcodes=function(){var html=this.content.html(),textParts=[],shortcodes=[];if(""!==html.trim()){var shortcodeRegex=/\[([^\/][^\s\]\[]+)[^\]]*\]/g,shortcodeMatch=shortcodeRegex.exec(html);if(shortcodeMatch){for(var prevIndex=0;shortcodeMatch;)if(pbsParams.shortcodes.indexOf(shortcodeMatch[1])!==-1)if(shortcodeMatch.index<prevIndex)shortcodeMatch=shortcodeRegex.exec(html);else{var base=shortcodeMatch[1],sc=wp.shortcode.next(base,html,shortcodeMatch.index);textParts.push(html.substr(prevIndex,shortcodeMatch.index-prevIndex)),shortcodes.push(sc),prevIndex=shortcodeMatch.index+sc.content.length,shortcodeMatch=shortcodeRegex.exec(html)}else shortcodeMatch=shortcodeRegex.exec(html);if(0!==shortcodes.length){textParts.push(html.substr(prevIndex));var elem,minHeight,bottomMargin,insertAt=this.parent().children.indexOf(this),parent=this.parent(),dom=this._domElement;dom&&dom.style.minHeight&&(minHeight=dom.style.minHeight,bottomMargin=dom.style.bottomMargin);for(var i=0;i<textParts.length+shortcodes.length;i++){var isShortcode=i%2===1;if(elem=null,0!==i){if(isShortcode?elem=ContentEdit.Shortcode.createShortcode(shortcodes[Math.floor(i/2)]):textParts[i/2].trim()&&(elem=document.createElement("P"),elem.innerHTML=textParts[i/2],elem=ContentEdit.Text.fromDOMElement(elem)),elem&&(insertAt++,parent.attach(elem,insertAt),1===i&&dom&&minHeight&&(elem._domElement.style.minHeight=minHeight,elem._domElement.style.bottomMargin=bottomMargin),"Shortcode"===elem.constructor.name)){var doAjax=!0;if(1===i&&elem.sc_raw===this.origShortcode){elem._domElement.innerHTML=this.origInnerHTML,elem._content=this.origInnerHTML;var scStyles=getComputedStyle(elem._domElement);"0px"===scStyles.height?elem._domElement.classList.add("pbs--blank"):elem._domElement.classList.remove("pbs--blank"),
doAjax=!1}doAjax&&elem.ajaxUpdate(!0)}}else this.content=new HTMLString.String(textParts[i],(!0)),this.updateInnerHTML(),this.taint()}this.parent()&&this.content.isWhitespace()&&this.parent().detach(this)}}}},function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){if(this.isShortcodeEditing)return this.blur(),this.convertShortcodes();var ret=proxied.call(this,ev);return this.convertShortcodes(),ret}}(),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertShortcodes()}),document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var root=ContentEdit.Root.get(),focused=root.focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.html().match(/\[\w+[^\]]+\]/)&&focused.blur()})}),window.addEventListener("DOMContentLoaded",function(){var shortcodes=document.querySelectorAll('[data-name="main-content"] [data-shortcode]');Array.prototype.forEach.call(shortcodes,function(el){if(1===el.children.length)try{var style=getComputedStyle(el.firstChild);"left"!==style["float"]&&"right"!==style["float"]||(el.style["float"]=style["float"])}catch(err){}})}),ContentEdit.Hr=function(_super){function Hr(tagName,attributes){this.model=new Backbone.Model({}),Hr.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Hr,_super),Hr.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Hr.droppers=PBSEditor.allDroppers,Hr.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Hr.prototype.cssTypeName=function(){return"hr"},Hr.prototype.typeName=function(){return"Horizontal Rule"},Hr}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Hr,"hr"),ContentEdit.Embed=function(_super){function Embed(tagName,attributes,content){this.url=attributes["data-url"],this.model=new Backbone.Model({}),this._doubleClickCount=0,Embed.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Embed,_super),Embed.create=function(url){var o=document.createElement("DIV");return o.setAttribute("data-ce-moveable",""),o.setAttribute("data-ce-tag","embed"),o.setAttribute("data-url",url),ContentEdit.Embed.fromDOMElement(o)},Embed.prototype.mount=function(){var ret=Embed.__super__.mount.call(this);return this._domElement.innerHTML="",jQuery(this._domElement).html(this._content),wp.hooks.doAction("pbs.embed.mount",this),ret},Embed.prototype._onDoubleClick=function(){this.convertToText(this.url,!1)},Embed.prototype.cssTypeName=function(){return"embed"},Embed.prototype.typeName=function(){return"Embed"},Embed.updateEmbedContent=function(url,textElement){var payload=new FormData;payload.append("post_ID",pbsParams.post_id),payload.append("type","embed"),payload.append("action","parse-embed"),payload.append("shortcode","[embed]"+url+"[/embed]");var request=new XMLHttpRequest;request.open("POST",pbsParams.ajax_url),request.onload=function(){if(request.status>=200&&request.status<400){var response=JSON.parse(request.responseText);if(!response.success)return;if(!textElement.parent())return;var elem=ContentEdit.Embed.create(url),insertAt=textElement.parent().children.indexOf(textElement),parent=textElement.parent();parent.attach(elem,insertAt),parent.detach(textElement),jQuery(elem._domElement).html("<p>"+response.data.body+"</p>"),elem._content="<p>"+response.data.body+"</p>",elem._domElement.classList.remove("pbs--rendering"),wp.hooks.doAction("pbs.embed.update_embed_content",elem)}},request.onerror=function(){},request.send(payload)},Embed}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Embed,"embed"),ContentEdit.Text.prototype.convertOEmbedURLs=function(){if(!this.content.isWhitespace()){var text=this.content.text();text&&(this.content.html().match(/<a[^>]+/g)||(text=text.trim(),text&&text.match(/^https?:\/\/[^\s\/$.?#].[^\s]*$/)&&ContentEdit.Embed.updateEmbedContent(text,this)))}},window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertOEmbedURLs()})}),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll('[data-ce-tag="embed"]');Array.prototype.forEach.call(shortcodes,function(el){var html=el.innerHTML;el.innerHTML="",jQuery(el).html(html)})})}),function(){ContentEdit.PreText.prototype.unhighlight=function(){this.updateInnerHTML()},ContentEdit.PreText.prototype.rehighlight=function(){this._domElement&&"undefined"!=typeof hljs&&(this.storeState(),this.removeAllCSSClasses(),hljs.highlightBlock(this._domElement),this.restoreState())}}(),function(){var proxied=ContentEdit.PreText.prototype.html;ContentEdit.PreText.prototype.html=function(indent){return proxied.call(this,indent),this._cached=this._cached.replace(/<\/?\w+[^>]*>/g,""),""+indent+"<"+this._tagName+this._attributesToString()+">"+(""+this._cached.replace(/\n/g,"\r\n")+"</"+this._tagName+">")}}(),function(){var proxied=ContentEdit.PreText.prototype.focus;ContentEdit.PreText.prototype.focus=function(){var ret=proxied.call(this);return this.unhighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.mount;ContentEdit.PreText.prototype.mount=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.prototype.blur;ContentEdit.PreText.prototype.blur=function(){var ret=proxied.call(this);return this.rehighlight(),ret}}(),function(){var proxied=ContentEdit.PreText.fromDOMElement;ContentEdit.PreText.fromDOMElement=function(domElement){return domElement.innerHTML=domElement.innerHTML.replace(/<\/?\w+[^>]*>/g,""),proxied.call(this,domElement)}}(),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){window.pbsInitAllPretext&&window.pbsInitAllPretext()})}),function(){var proxied=ContentEdit.PreText.prototype._onKeyDown;ContentEdit.PreText.prototype._onKeyDown=function(ev){if(9===ev.keyCode){ev.preventDefault(),ContentSelect.Range.query(this._domElement);var insertAt,selection=ContentSelect.Range.query(this._domElement),preserveWhitespace=this.content.preserveWhitespace();insertAt=selection.get()[1],this.content=this.content.insert(insertAt,new HTMLString.String("\t",preserveWhitespace),preserveWhitespace),this.updateInnerHTML(),insertAt+=1,selection=new ContentSelect.Range(insertAt,insertAt),selection.select(this.domElement())}return proxied.call(this,ev)}}(),function(){wp.hooks.addAction("pbs.embed.mount",fluidvids.render),wp.hooks.addAction("pbs.embed.update_embed_content",fluidvids.render);var editor=ContentTools.EditorApp.get();editor.bind("stop",fluidvids.render),editor.bind("start",fluidvids.render)}(),function(){var proxy=ContentEdit.Element.prototype.mount;ContentEdit.Element.prototype.mount=function(){var ret=proxy.call(this);return fluidvids&&fluidvids.render(),ret}}();var pbsTwitterMount=function(element){var domElement=element._domElement||element;if(domElement.querySelector("[data-tweet-id]")){var tweetID=domElement.querySelector("[data-tweet-id]").getAttribute("data-tweet-id");domElement.innerHTML="",twttr.widgets.createTweet(tweetID,domElement)}};wp.hooks.addAction("pbs.embed.mount",pbsTwitterMount),window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){var shortcodes=document.querySelectorAll("[data-tweet-id]");Array.prototype.forEach.call(shortcodes,function(el){pbsTwitterMount(el.parentNode)})})}),ContentEdit.IFrame=function(_super){function IFrame(tagName,attributes,content){this.model=new Backbone.Model({}),IFrame.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(IFrame,_super),IFrame.prototype.html=function(){return"<p>"+this._content+"</p>"},IFrame.prototype._onDoubleClick=function(){var html=this._domElement.innerHTML.replace(/</g,"&lt;").replace(/<p>|<\/p>/g,"").replace(/data-ce-tag=['"]iframe['"]/,""),textElement=this.convertToText(html,!1);textElement.isIframeEditing=!0},IFrame.prototype.cssTypeName=function(){return"iframe"},IFrame.prototype.typeName=function(){return"IFrame"},IFrame.convertTextToIFrame=function(html,textElement){var elem=new ContentEdit.IFrame("P",[],html),insertAt=textElement.parent().children.indexOf(textElement),parent=textElement.parent();parent.attach(elem,insertAt),parent.detach(textElement)},IFrame}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.IFrame,"iframe"),function(){var proxied=ContentEdit.Text.fromDOMElement;ContentEdit.Text.fromDOMElement=function(domElement){return domElement&&domElement.children&&1===domElement.children.length&&"IFRAME"===domElement.firstChild.tagName?new ContentEdit.IFrame(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML):proxied.call(this,domElement)}}(),ContentEdit.Text.prototype.convertIFrameTags=function(){if(!this.content.isWhitespace()){var text=this.content.text();text&&(text=text.trim(),text&&text.match(/^\s*<iframe.*/)&&ContentEdit.IFrame.convertTextToIFrame(text,this))}},window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){"Text"===element.constructor.name&&element.convertIFrameTags()})}),window.addEventListener("DOMContentLoaded",function(){document.querySelector("#wpadminbar").addEventListener("mouseover",function(){var root=ContentEdit.Root.get(),focused=root.focused();focused&&"Text"===focused.constructor.name&&focused.content&&focused.content.text().match(/^\s*<iframe.*/)&&focused.blur()})}),function(){var proxied=ContentEdit.Text.prototype._keyReturn;ContentEdit.Text.prototype._keyReturn=function(ev){return this.isIframeEditing?void this.blur():proxied.call(this,ev)}}(),ContentEdit.Div=function(_super){function Div(tagName,attributes){Div.__super__.constructor.call(this,tagName,attributes)}return __extends(Div,_super),Div.prototype.cssTypeName=function(){return"div"},Div.prototype.type=function(){return"Div"},Div.prototype.typeName=function(){return"Div"},Div.prototype._onMouseUp=function(ev){ev.target===this._domElement&&(Div.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout))},Div.prototype._onMouseOut=function(ev){Div.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},Div.prototype._onMouseDown=function(ev){if(ev.target===this._domElement&&(Div.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target))return ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)},Div.prototype._onMouseOver=function(ev){ev.target===this._domElement&&Div.__super__._onMouseOver.call(this,ev)},Div.prototype._onMouseMove=function(ev){Div.__super__._onMouseMove.call(this,ev)},Div.prototype.attach=function(component,index){2===this.children.length&&"undefined"!=typeof this.children[0].content&&this.children[0].content.isWhitespace()&&this.detach(this.children[0]),2===this.children.length&&"undefined"!=typeof this.children[1].content&&this.children[1].content.isWhitespace()&&this.detach(this.children[1]),Div.__super__.attach.call(this,component,index)},Div.prototype.detach=function(element){ContentEdit.NodeCollection.prototype.detach.call(this,element),setTimeout(function(){0===this.children.length&&this.attach(new ContentEdit.Text("p"),0)}.bind(this),1)},Div.prototype.focus=function(){for(var root=ContentEdit.Root.get(),i=this.children.length-1;i>=0;i--)if(this.children[i].constructor&&"DivRow"!==this.children[i].constructor.name){if(this.children[i].isFocused())return;return root.focused()&&root.focused().blur(),void(this.children[i].focus&&this.children[i].focus())}0===this.children.length&&this.attach(new ContentEdit.Text("p"),0),this.children[0].isFocused()||(root.focused()&&root.focused().blur(),this.children[0].focus())},Div.prototype.blur=function(){var root;if(root=ContentEdit.Root.get(),this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Div._dropInside=function(element,target,placement){var insertIndex=0;return"below"===placement[0]&&(insertIndex=target.children.length),target.attach(element,insertIndex)},Div.droppers=PBSEditor.allDroppers,Div._fromDOMElement=function(domElement){var cls,tagNames=ContentEdit.TagNames.get();if(domElement.getAttribute("data-ce-tag"))cls=tagNames.match(domElement.getAttribute("data-ce-tag"));else if(domElement.classList.contains("pbs-row"))cls=tagNames.match("row");else if(domElement.classList.contains("pbs-col"))cls=tagNames.match("column");else if(domElement.getAttribute("data-shortcode"))cls=tagNames.match("shortcode");else{if("DIV"===domElement.tagName)return null;cls=tagNames.match(domElement.tagName)}return cls.fromDOMElement(domElement)},Div.fromDOMElement=function(domElement){var element=this._fromDOMElement(domElement);if(element)return element;var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_i<_len;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName),element=cls.fromDOMElement(childNode),element&&list.attach(element)}return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},Div}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.Div,"div"),ContentEdit.DivRow=function(_super){function DivRow(tagName,attributes){DivRow.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(DivRow,_super),DivRow.prototype.cssTypeName=function(){return"row"},DivRow.prototype.type=function(){return"DivRow"},DivRow.prototype.typeName=function(){return"Row"},DivRow.prototype.showOutline=function(){for(var currElem=this;currElem;)"DivRow"===currElem.constructor.name&&currElem._addCSSClass("pbs-new-column"),currElem=currElem.parent()},DivRow.prototype.hideOutline=function(){for(var currElem=this;currElem;)"DivRow"===currElem.constructor.name&&currElem._removeCSSClass("pbs-new-column"),currElem=currElem.parent()},DivRow.prototype._onMouseOver=function(ev){this._removeCSSClass("pbs-new-column");var root=ContentEdit.Root.get(),dragging=root.dragging();return null!==root._dropTarget&&dragging&&pbsSelectorMatches(root._dropTarget.domElement(),".ce-element--dragging *")?(root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null)):(DivRow.__super__._onMouseOver.call(this,ev),void(ev.target.classList.contains("pbs-row")||this._removeCSSClass("ce-element--over")))},DivRow.prototype._onMouseUp=function(ev){DivRow.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick&&this.testClickBetweenRows(ev),clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseOut=function(ev){DivRow.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout)},DivRow.prototype._onMouseMove=function(ev){this._checkForBetweenRowClick=!1,clearTimeout(this._betweenRowSelectorTimeout);var root=ContentEdit.Root.get();if(null!==root._dropTarget){if("DivCol"===root._dropTarget.constructor.name&&"DivRow"===root.dragging().constructor.name){var row=root._dropTarget.parent();return root._dropTarget._onMouseOut(ev),void row._onOver(ev)}if(ev.target===root.dragging()._domElement)return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null);if(pbsSelectorMatches(root._dropTarget._domElement,".ce-element--dragging *"))return root._dropTarget._removeCSSClass("ce-element--drop"),root._dropTarget._removeCSSClass("ce-element--drop-above"),root._dropTarget._removeCSSClass("ce-element--drop-below"),root._dropTarget._removeCSSClass("ce-element--drop-center"),root._dropTarget._removeCSSClass("ce-element--drop-left"),root._dropTarget._removeCSSClass("ce-element--drop-right"),void(root._dropTarget=null)}DivRow.__super__._onMouseMove.call(this,ev),clearTimeout(this._dragTimeout)},DivRow.prototype._onMouseDown=function(ev){if(DivRow.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this._checkForBetweenRowClick=!0,clearTimeout(this._betweenRowSelectorTimeout),this._betweenRowSelectorTimeout=setTimeout(function(){this._checkForBetweenRowClick=!1}.bind(this),300),this.domElement()===ev.target)return ev.preventDefault(),this._dragTimeout=setTimeout(function(_this){return function(){return _this.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)},DivRow.droppers=PBSEditor.allDroppers,DivRow.prototype.mount=function(){DivRow.__super__.mount.call(this),this.addCSSClass("pbs-row"),window._pbsFixRowWidth&&window._pbsFixRowWidth(this._domElement)},DivRow.fromDOMElement=function(domElement){var childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=domElement.children;var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_i<_len;_i++)if(childNode=childNodes[_i],1===childNode.nodeType&&("div"===childNode.tagName.toLowerCase()||childNode.classList.contains("pbs-col"))){var element=tagNames.match("column").fromDOMElement(childNode);element&&list.attach(element)}return list},DivRow.prototype.focus=function(){var overElem=document.querySelector(".ce-element--over");if(null===overElem){if(this.children[0].isFocused())return;this.children[0].focus()}if(document.querySelector(".ce-element--over")===this._domElement){if(this.children[this.children.length-1].isFocused())return;this.children[this.children.length-1].focus()}},DivRow.prototype.addNewColumn=function(index){"undefined"==typeof index&&(index=this.children.length);for(var existingGap=this.hasColumnGap(),i=0;i<this.children.length;i++){var currFlexBasis=this.children[i].style("flex-basis");currFlexBasis&&"0px"!==currFlexBasis||this.children[i].style("flex-basis",100/(this.children.length+1)+"%")}var col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");return col.attach(p),this.attach(col,index),col.style("flex-grow","1"),col.style("flex-basis",100/this.children.length+"%"),existingGap&&index!==this.children.length-1?col.style("margin-right",existingGap):existingGap&&this.children[index-1].style("margin-right",existingGap),col},DivRow.prototype.adjustColumnNumber=function(numColumns){if(this.children.length<numColumns)for(;this.children.length<numColumns;)this.addNewColumn();else if(this.children.length>numColumns)for(;this.children.length>numColumns;)this.children[numColumns].blurIfFocused(),this.children[numColumns-1].merge(this.children[numColumns])},DivRow.prototype.adjustColumns=function(columnEquation){var arrWidths=columnEquation.replace(/(\s*\+\s*|\s+)/g," ").split(" ");this.adjustColumnNumber(arrWidths.length);for(var highestDenom=1,i=0;i<arrWidths.length;i++)if(arrWidths[i].indexOf("/")!==-1){var denom=parseInt(arrWidths[i].split("/")[1],10);denom>highestDenom&&(highestDenom=denom)}for(i=0;i<arrWidths.length;i++){var grow=1;if(arrWidths[i].indexOf("/")!==-1){var nums=arrWidths[i].split("/");grow=nums[0]/nums[1]*highestDenom}else grow=parseInt(arrWidths[i],10);this.children[i].style("flex-grow",grow)}},DivRow.prototype.clone=function(){this.blurIfFocused();var clone=document.createElement("div");clone.innerHTML=this.html();var newRow=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newRow,index+1),newRow.focus(),newRow},DivRow.prototype.getColumnEquation=function(){var col,colStyle,i,totalGrow=0;for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),totalGrow+=parseFloat(colStyle["flex-grow"]);var equation="";for(i=0;i<this.children.length;i++)col=this.children[i],colStyle=window.getComputedStyle(col._domElement),equation+=equation?" + ":"",equation+=parseFloat(colStyle["flex-grow"])+"/"+totalGrow;return equation},DivRow.prototype.blurIfFocused=function(){var root=ContentEdit.Root.get();if(root.focused())for(var currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivRow.prototype.hasColumnGap=function(){for(var existingMargin="",currMargin="",i=0;i<this.children.length;i++)i<this.children.length-1?""===currMargin?(currMargin=this.children[i]._domElement.style["margin-right"],existingMargin=currMargin):currMargin!==this.children[i]._domElement.style["margin-right"]&&(existingMargin=""):""!==this.children[i]._domElement.style["margin-right"]&&(existingMargin="");return existingMargin},DivRow.prototype.testClickBetweenRows=function(ev){if(ev.target._ceElement&&!("DivCol"!==ev.target._ceElement.constructor.name&&"DivRow"!==ev.target._ceElement.constructor.name||"DivCol"===ev.target._ceElement.constructor.name&&ev.target._ceElement.parent()!==this||"DivRow"===ev.target._ceElement.constructor.name&&ev.target._ceElement!==this||"Region"!==this.parent().constructor.name&&"DivCol"!==this.parent().constructor.name)){var clickedOnTop=!1,clickedOnBottom=!1;if(ev.offsetY<10)clickedOnTop=!0;else{if(!(ev.offsetY>ev.target.offsetHeight-10))return;clickedOnBottom=!0}var otherElement,p,index=this.parent().children.indexOf(this),doAddEmpty=!0;clickedOnTop?(index&&(otherElement=this.parent().children[index-1],"Text"===otherElement.type()&&(doAddEmpty=!1)),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index),p.focus())):clickedOnBottom&&(index<this.parent().children.length-1&&(otherElement=this.parent().children[index+1],"Text"===otherElement.type()&&(doAddEmpty=!1)),doAddEmpty&&(p=new ContentEdit.Text("p",{},""),this.parent().attach(p,index+1),p.focus()))}},DivRow}(ContentEdit.ElementCollection),ContentEdit.TagNames.get().register(ContentEdit.DivRow,"row"),ContentEdit.DivCol=function(_super){function DivCol(tagName,attributes){DivCol.__super__.constructor.call(this,tagName,attributes)}function selectAfterFocus(domElement,index){var selection=new ContentSelect.Range(index,index);selection.select(domElement)}return __extends(DivCol,_super),DivCol.prototype.cssTypeName=function(){return"col"},DivCol.prototype.type=function(){return"DivRow"},DivCol.prototype.typeName=function(){return"Column"},DivCol.prototype._onMouseUp=function(ev){DivCol.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseOut=function(ev){DivCol.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},DivCol.prototype._onMouseDown=function(ev){if(DivCol.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target)return ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)},DivCol.prototype._onMouseMove=function(ev){DivCol.__super__._onMouseMove.call(this,ev),DivCol.__super__._onMouseOver.call(this,ev),clearTimeout(this._dragTimeout);var root=ContentEdit.Root.get(),dragging=root.dragging();dragging&&ev.target===this._domElement?(this._onMouseOut(ev),this.parent()._onOver(ev),this.parent()._removeCSSClass("ce-element--over")):ev.target!==this._domElement&&this._removeCSSClass("ce-element--over")},DivCol.prototype._onKeyDown=function(ev){DivCol.__super__._onMouseDown.call(this,ev);var index;if(190===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey)return index=this.parent().children.indexOf(this),this.blurIfFocused(),this.parent().addNewColumn(index+1).focus(),void ev.preventDefault();if(188===ev.keyCode&&(ev.metaKey||ev.ctrlKey)&&ev.shiftKey){index=this.parent().children.indexOf(this),this.blurIfFocused();var parent=this.parent();return parent.detach(this),index>0&&parent&&parent.children.length&&index--,parent&&parent.children.length&&parent.children[index].focus(),void ev.preventDefault()}if(ev.target._ceElement){if(ev.target._ceElement.constructor.name.toLowerCase().indexOf("list")!==-1)return;if(ev.target._ceElement.constructor.name.toLowerCase().indexOf("table")!==-1)return}9===ev.keyCode&&(!ev.shiftKey&&this.nextSibling()?(this.nextSibling().focus(),ev.stopPropagation()):ev.shiftKey&&this.previousSibling()&&(this.previousSibling().focus(),ev.stopPropagation()))},DivCol.droppers={},DivCol.prototype.attach=function(component,index){DivCol.__super__.attach.call(this,component,index),setTimeout(function(){this.cleanEmptyParagraphs()}.bind(this),10)},DivCol.prototype.cleanEmptyParagraphs=function(){if(this.isMounted()){for(var numEmpties=0,numNonEmpties=0,i=this.children.length-1;i>=0;i--)"undefined"!=typeof this.children[i].content&&this.children[i].content.isWhitespace()?numEmpties++:numNonEmpties++;if(numEmpties>1)for(i=0;i<this.children.length;i++)"undefined"!=typeof this.children[i].content&&this.children[i].content.isWhitespace()&&!this.children[i].isFocused()&&(numEmpties>1&&0===numNonEmpties?(this.detach(this.children[i]),numEmpties--):this.detach(this.children[i]),i--);if(numEmpties&&numNonEmpties)for(i=0;i<this.children.length;i++)"undefined"!=typeof this.children[i].content&&this.children[i].content.isWhitespace()&&!this.children[i].isFocused()&&(this.detach(this.children[i]),i--)}},DivCol.prototype.mount=function(){DivCol.__super__.mount.call(this),this.addCSSClass("pbs-col"),this.cleanEmptyParagraphs()},DivCol.prototype.merge=function(element){for(var len=element.children.length,i=0;i<len;i++)this.attach(element.children[0]);for(element.parent().detach(element),len=this.children.length,i=len-1;i>=0;i--)this.children[i].content&&this.children[i].content.isWhitespace()&&this.detach(this.children[i]);return this.taint()},DivCol.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_i<_len;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return 0===list.children.length&&list.attach(new ContentEdit.Text("p"),0),list},DivCol.prototype.focus=function(){for(var root=ContentEdit.Root.get(),i=0;i<this.children.length;i++)if(this.children[i].constructor&&"DivRow"!==this.children[i].constructor.name){if(this.children[i].isFocused())return;root.focused()&&root.focused().blur(),this.children[i].focus&&this.children[i].focus();var index=0;this.children[i].content&&(index=this.children[i].content.length());var domElement=this.children[i]._domElement;return void setTimeout(selectAfterFocus,1,domElement,index)}if(this.children.length){var allCompounds=!0;for(i=0;i<this.children.length;i++)"undefined"!=typeof this.children[i].isCompundElement&&this.children[i].isCompundElement||(allCompounds=!1);if(allCompounds)return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.domElement().focus(),root.trigger("focus",this)}for(i=this.children.length-1;i>=0;i--)if(this.children[i].constructor&&"DivRow"===this.children[i].constructor.name){if(this.children[i].children[0].isFocused())return;return root.focused()&&root.focused().blur(),void this.children[i].children[0].focus()}0===this.children.length&&this.attach(new ContentEdit.Text("p"),0),this.children[0].isFocused()||(root.focused()&&root.focused().blur(),this.children[0].focus())},DivCol.prototype.clone=function(){var existingGap=this.parent().hasColumnGap();this.blurIfFocused();var clone=document.createElement("div");clone.innerHTML=this.html();var newCol=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this);return this.parent().attach(newCol,index+1),newCol.focus(),existingGap&&this.style("margin-right")!==existingGap&&this.style("margin-right",existingGap),newCol},DivCol.prototype.blurIfFocused=function(){var root=ContentEdit.Root.get();if(root.focused())for(var currElem=root.focused();currElem;){if(currElem===this)return void root.focused().blur();currElem=currElem.parent()}},DivCol}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.DivCol,"column"),ContentEdit.Root.get().bind("drop",function(element,droppedElement){if(null!==droppedElement&&null!==droppedElement.parent()){var col,i;if("DivCol"===droppedElement.parent().constructor.name||"Div"===droppedElement.parent().constructor.name)for(col=droppedElement.parent(),i=0;i<col.children.length;i++)null!==col.children[i].content&&"undefined"!=typeof col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i]);else if("DivRow"===droppedElement.parent().constructor.name)for(col=droppedElement,i=0;i<col.children.length;i++)null!==col.children[i].content&&"undefined"!=typeof col.children[i].content&&col.children.length>1&&col.children[i].content.isWhitespace()&&col.children[i]!==element&&col.detach(col.children[i])}}),ContentEdit.Root.get().bind("drop",function(element,droppedElement){null!==droppedElement&&null!==droppedElement.parent()&&"DivRow"===element.constructor.name&&("Div"!==element.parent().constructor.name&&"DivCol"!==element.parent().constructor.name||element.attr("data-width")&&(element.style("margin-right",""),element.style("margin-left",""),"full-width-retain-content"===element.attr("data-width")&&(element.style("padding-right",""),element.style("padding-left","")),element.removeAttr("data-width")))}),function(){var proxied=ContentEdit.Text.prototype._keyUp;ContentEdit.Text.prototype._keyUp=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&0===this.parent().children.indexOf(this)&&0===selection.get()[0]){var row=this.parent().parent(),index=row.parent().children.indexOf(row);if(index>0&&row.parent().children[index-1].content)return void row.parent().children[index-1].focus();var p=new ContentEdit.Text("p",{},"");return row.parent().attach(p,index),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyDown;ContentEdit.Text.prototype._keyDown=function(ev){var selection=ContentSelect.Range.query(this._domElement);
if(("DivCol"===this.parent().constructor.name||"Div"===this.parent().constructor.name)&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this._atEnd(selection)){var row=this.parent().parent(),index=row.parent().children.indexOf(row);if(index<row.parent().children.length-1&&row.parent().children[index+1].content)return void row.parent().children[index+1].focus();var p=new ContentEdit.Text("p",{},"");return row.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype.blur;ContentEdit.Text.prototype.blur=function(ev){if(this.content.isWhitespace()&&this.parent()&&("Div"===this.parent().constructor.name||"DivCol"===this.parent().constructor.name)){for(var otherWhitespaces=0,otherNonWhitespaces=0,i=0;i<this.parent().children.length;i++){var sibling=this.parent().children[i];sibling.content&&sibling.content.isWhitespace()?otherWhitespaces++:otherNonWhitespaces++}if(1===otherWhitespaces&&0===otherNonWhitespaces){var error;if(this.isMounted()&&this._syncContent(),this.isMounted()){try{this._domElement.blur()}catch(_error){error=_error}this._domElement.removeAttribute("contenteditable")}return ContentEdit.Text.__super__.blur.call(this)}}return proxied.call(this,ev)}}(),wp.hooks.addFilter("pbs.save",function(html){return html=html.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(max-width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+pbs-row[^>]+style\=[^>]*[^-])(width:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<[^>]+pbs-row[^>]+style=[^>]*[^-])(left:\s?[-0-9.\w]+;?\s?)([^>]+>)/g,"$1$3"),html=html.replace(/(<div[^>]+>)\s+/gm,"$1"),html=html.replace(/\s+(<\/div>)/gm,"$1"),html=html.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width-retain-content["'][^>]+>/g,function(match){return match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $4;"),match=match.replace(/(padding:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/(padding:\s?)([\d\w.]+)[;"']/,"padding-top: $2; padding-bottom: $2;"),match=match.replace(/\s?padding-left:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/\s?padding-right:\s?[\d\w.]+;?\s?/g,""),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")}),html=html.replace(/<[^>]+pbs-row[^>]+data-width\=["']full-width["'][^>]+>/g,function(match){return match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $4;"),match=match.replace(/(margin:\s?)([\d\w.]+)\s([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/(margin:\s?)([\d\w.]+)[;"']/,"margin-top: $2; margin-bottom: $2;"),match=match.replace(/\s?margin-left:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/\s?margin-right:\s?[\d\w.-]+;?\s?/g,""),match=match.replace(/([^-])left:\s?[-\d\w.]+;?\s?/g,"$1")})}),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.paste;_EditorApp.prototype.paste=function(element,clipboardData){var content,encodeHTML,i,insertAt,insertIn,insertNode,item,lastItem,line,lineLength,lines,type,_i,_len;if(content=clipboardData.getData("text/plain"),lines=content.split("\n"),lines=lines.filter(function(line){return""!==line.trim()}),!lines)return proxied.call(this,element,clipboardData);if(encodeHTML=HTMLString.String.encode,type=element.type(),"PreText"===type||"ListItemText"===type||"DivRow"!==element.parent().type())return proxied.call(this,element,clipboardData);if(lines.length>1||!element.content){for(insertNode=element,insertIn=insertNode.parent(),insertAt=insertIn.children.indexOf(insertNode)+1,i=_i=0,_len=lines.length;_i<_len;i=++_i)line=lines[i],line=encodeHTML(line),item=new ContentEdit.Text("p",{},line),lastItem=item,insertIn.attach(item,insertAt+i);return lineLength=lastItem.content.length(),lastItem.focus(),lastItem.selection(new ContentSelect.Range(lineLength,lineLength))}return proxied.call(this,element,clipboardData)}}(),ContentEdit.Icon=function(_super){function Icon(tagName,attributes,content){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="icon"),attributes.role||(attributes.role="presentation"),Icon.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Icon,_super),Icon.prototype.cssTypeName=function(){return"icon"},Icon.prototype.typeName=function(){return"Icon"},Icon.fromDOMElement=function(domElement){return new this(domElement.tagName,this.getDOMElementAttributes(domElement),domElement.innerHTML)},Icon.droppers=PBSEditor.allDroppers,Icon.prototype.mount=function(){var ret=Icon.__super__.mount.call(this),svg=this._domElement.querySelector("svg");return svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),svg.innerHTML=svg.innerHTML.trim()+" ",this._content=this._domElement.innerHTML,ret},Icon.prototype.change=function(svg){var a=this._domElement.querySelector("a");a?a.innerHTML=svg.outerHTML:this._domElement.innerHTML=svg.outerHTML,this._content=this._domElement.innerHTML,this.taint()},Icon.prototype.clone=function(){var newElem,index,clone=document.createElement("div");return clone.innerHTML=this.html(),newElem=ContentEdit.Div.fromDOMElement(clone.childNodes[0]),index=this.parent().children.indexOf(this),this.parent().attach(newElem,index+1),newElem},Icon.prototype._onMouseOver=function(ev){return Icon.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Icon.droppers=PBSEditor.allDroppers,Icon.prototype._onDoubleClick=function(){PBSEditor.iconFrame.open({title:pbsParams.labels.icon_frame_change_title,button:pbsParams.labels.icon_frame_change_button,successCallback:function(frameView){this.change(frameView.selected.firstChild)}.bind(this)})},Icon.prototype.getLink=function(){var a=this._domElement.querySelector("a");return a?a.getAttribute("href"):""},Icon.prototype.setLink=function(url){var a,svg;return url?(a=this._domElement.querySelector("a"),void(a?(a.setAttribute("href",url),this._domElement.innerHTML=a.outerHTML,this._content=this._domElement.innerHTML,this.taint()):(a=document.createElement("A"),a.setAttribute("href",url),svg=this._domElement.querySelector("svg"),a.appendChild(svg),this._domElement.appendChild(a),this._content=this._domElement.innerHTML,this.taint()))):void this.removeLink()},Icon.prototype.removeLink=function(){var svg;this._domElement.querySelector("a")&&(svg=this._domElement.querySelector("svg"),this._domElement.innerHTML=svg.outerHTML,this._content=this._domElement.innerHTML,this.taint())},Icon.prototype.removeFills=function(){var fills=this._domElement.querySelectorAll("svg [fill]");Array.prototype.forEach.call(fills,function(fill){fill.removeAttribute("fill")}),this._content=this._domElement.innerHTML,this.taint()},Icon}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Icon,"icon"),ContentEdit.Html=function(_super){function Html(tagName,attributes,content){this.model=new Backbone.Model({}),Html.__super__.constructor.call(this,tagName,attributes),this._content=content}return __extends(Html,_super),Html.prototype.openEditor=function(){PBSEditor.htmlFrame.open({title:pbsParams.labels.html,button:pbsParams.labels.html_frame_button,successCallback:function(frameView){var html=frameView.getHtml();this._domElement.innerHTML=html,this._content=html,html||(this.nextContent()?this.nextContent().focus():this.previousContent()&&this.previousContent().focus(),this.parent().detach(this))}.bind(this),openCallback:function(frameView){frameView.setHtml(this._content)}.bind(this)})},Html.prototype._onDoubleClick=function(){this.openEditor()},Html.prototype.cssTypeName=function(){return"html"},Html.prototype.typeName=function(){return"Html"},Html.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Html.prototype.blur=function(){var root;return root=ContentEdit.Root.get(),this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Html.prototype._onMouseOver=function(ev){return Html.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Html}(ContentEdit.StaticEditable),ContentEdit.TagNames.get().register(ContentEdit.Html,"html"),wp.hooks.addFilter("pbs.toolbar.shortcode.label",function(scBase){return"pbs_sidebar"===scBase?pbsParams.labels.sidebar:scBase}),ContentEdit.Map=function(_super){function Map(tagName,attributes){attributes["data-ce-tag"]||(attributes["data-ce-tag"]="map"),this.model=new Backbone.Model({}),Map.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Map,_super),Map.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--over"),this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Map.prototype._onMouseOver=function(ev){return Map.__super__._onMouseOver.call(this,ev),this._addCSSClass("ce-element--over")},Map.prototype._onMouseUp=function(ev){Map.__super__._onMouseUp.call(this,ev),this.updateMapData(),this._removeCSSClass("pbs-map-editing"),this._dragging=!1,this._clicked=!1,clearInterval(this._forceCentered)},Map.prototype.updateMapData=function(){var latlng,center,zoom;!this._dragging&&this._domElement&&(latlng=this._domElement.map.getCenter(),center=latlng.lat().toFixed(6)+", "+latlng.lng().toFixed(6),this.attr("data-center")!==center&&(this.attr("data-center",center),this.attr("data-lat",latlng.lat().toFixed(6)),this.attr("data-lng",latlng.lng().toFixed(6)),this.model.set("data-center",center),this._domElement.map.marker&&this._domElement.map.marker.setPosition(this._domElement.map.getCenter()))),zoom=this._domElement.map.getZoom(),parseInt(this.attr("data-zoom"),10)!==zoom&&(this.attr("data-zoom",zoom),this.model.trigger("change",this.model))},Map.prototype._onMouseDown=function(ev){return this._clicked=!0,this.focus(),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(_this){return function(){return _this._dragging=!0,_this.drag(ev.pageX,ev.pageY)}}(this),2*ContentEdit.DRAG_HOLD_DURATION)},Map.prototype._onMouseMove=function(ev){this._dragging||clearTimeout(this._dragTimeout),!this._dragging&&this._clicked&&this._addCSSClass("pbs-map-editing"),Map.__super__._onMouseMove.call(this,ev)},Map.droppers=PBSEditor.allDroppers,Map.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Map.prototype.cssTypeName=function(){return"map"},Map.prototype.typeName=function(){return"Map"},Map.prototype.mount=function(){var ret=Map.__super__.mount.call(this);return window.initPBSMaps(this._domElement,function(){google.maps.event.addListener(this._domElement.map,"zoom_changed",_.throttle(function(){this.updateMapData()}.bind(this),2)),google.maps.event.addListener(this._domElement.map,"drag",_.throttle(function(){this.updateMapData()}.bind(this),2))}.bind(this)),ret},Map.prototype.unmount=function(){return"undefined"!=typeof google&&google.maps.event.clearInstanceListeners(this._domElement.map),Map.__super__.unmount.call(this)},Map.create=function(){var o=document.createElement("DIV");return o.setAttribute("data-ce-tag","map"),o.setAttribute("data-ce-moveable",""),ContentEdit.Map.fromDOMElement(o)},Map}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Map,"map"),window.addEventListener("DOMContentLoaded",function(){var mapRefreshInterval,editor=ContentTools.EditorApp.get();window.initPBSMaps&&editor.bind("stop",window.initPBSMaps),window.pbsMapsReCenter&&(editor.bind("start",function(){mapRefreshInterval=setInterval(function(){document.querySelector(".ce-element--dragging")||document.querySelector(".pbs-map-editing")||window.pbsMapsReCenter()},1e3)}),editor.bind("stop",function(){clearInterval(mapRefreshInterval)}))}),ContentEdit.Tabs=function(_super){function Tabs(tagName,attributes){Tabs.__super__.constructor.call(this,tagName,attributes),this.isCompundElement=!0}return __extends(Tabs,_super),Tabs.prototype.cssTypeName=function(){return"tabs"},Tabs.prototype.type=function(){return"Tabs"},Tabs.prototype.typeName=function(){return"Tabs"},Tabs.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_i<_len;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},Tabs.prototype.detachTabAndContent=function(tab){var inputID=tab._domElement.getAttribute("for"),inputElem=this._domElement.querySelector('[id="'+inputID+'"]')._ceElement,tabID=inputElem.attr("data-tab"),tabRow=this._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement;return inputElem.parent().detach(inputElem),tab.parent().detach(tab),tabRow.parent().detach(tabRow),this.reIndexTabs(),tabRow},Tabs.prototype.attachTabAndContent=function(tab,index,row){for(var tabsID=this._domElement.getAttribute("class").match(/pbs-tabs-(\w+)/)[0],tabIndex=this.numTabs()+1,hash=window.PBSEditor.generateHash();document.querySelector('[id="pbs-tab-'+hash+'"]');)hash=window.PBSEditor.generateHash();var radio=document.createElement("input");radio.classList.add("pbs-tab-state"),radio.setAttribute("type","radio"),radio.setAttribute("name",tabsID),radio.setAttribute("id","pbs-tab-"+hash),radio.setAttribute("data-tab",tabIndex),radio.setAttribute("data-ce-tag","static"),this.attach(ContentEdit.Static.fromDOMElement(radio),0),tab.attr("for","pbs-tab-"+hash),row.attr("data-panel",tabIndex),this._domElement.querySelector(".pbs-tab-tabs")._ceElement.attach(tab,index),this._domElement.querySelector(".pbs-tab-panels")._ceElement.attach(row)},Tabs.prototype.reIndexTabs=function(){for(var numTabs=this._domElement.querySelectorAll(".pbs-tab-state").length,i=1;i<=numTabs;i++){var radio=this._domElement.querySelector('[data-tab="'+i+'"]');radio||(radio=this._domElement.querySelector('[data-tab="'+(i+1)+'"]'),radio&&(radio._ceElement.attr("data-tab",i),this._domElement.querySelector('[data-panel="'+(i+1)+'"]')._ceElement.attr("data-panel",i)))}},Tabs.prototype.getOpenTab=function(){var radio=this._domElement.querySelector(".pbs-tab-state:checked")._ceElement,panel=this._domElement.querySelector('[data-panel="'+radio.attr("data-tab")+'"]');return panel||(panel=this._domElement.querySelector("[data-panel]")),panel._ceElement},Tabs.prototype.numTabs=function(){return this._domElement.querySelectorAll(".pbs-tab-state").length},Tabs.prototype.addTab=function(){var firstTab=this._domElement.querySelector(".pbs-tab-state")._ceElement,radioID="pbs-tab-"+window.PBSEditor.generateHash(),tabNum=this.numTabs()+1,radio=new ContentEdit.TabRadio("input",{"data-ce-tag":"tabradio","class":"pbs-tab-state","data-tab":tabNum,id:radioID,name:firstTab.attr("name"),type:"radio"});this.attach(radio,0);var tab=new ContentEdit.Tab("label",{"data-ce-tag":"tab","for":radioID},"<span>New Tab</span>"),tabContainer=this._domElement.querySelector(".pbs-tab-tabs")._ceElement;tabContainer.attach(tab,tabContainer.children.length),tabContainer.children.length&&tab.attr("style",tabContainer.children[0].attr("style"));var panelContainer=this._domElement.querySelector(".pbs-tab-panels")._ceElement,row=new ContentEdit.DivRow("div",{"data-panel":tabNum});panelContainer.attach(row);var col=new ContentEdit.DivCol("div");row.attach(col);var p=new ContentEdit.Text("p",{},"");col.attach(p),tab.openTab(),p.focus()},Tabs.prototype.removeTab=function(tab){if("undefined"==typeof tab){var radio=this._domElement.querySelector(".pbs-tab-state:checked")._ceElement;tab=this._domElement.querySelector('label[for="'+radio.attr("id")+'"]')._ceElement}var otherTab=tab.nextSibling();if(otherTab||(otherTab=tab.previousSibling()),this.detachTabAndContent(tab),otherTab)otherTab.openTab();else{this.blur();var focusTo=this.nextSibling();focusTo||(focusTo=this.previousSibling()),focusTo&&focusTo.focus(),this.parent().detach(this)}},Tabs.droppers=PBSEditor.allDroppers,Tabs}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.Tabs,"tabs"),ContentEdit.Tab=function(_super){function Tab(tagName,attributes,content){Tab.__super__.constructor.call(this,tagName,attributes,content)}return __extends(Tab,_super),Tab.prototype.cssTypeName=function(){return"tab"},Tab.prototype.type=function(){return"Tab"},Tab.prototype.typeName=function(){return"Tab"},Tab.prototype.parentTab=function(){return this.parent().parent()},Tab.prototype.setActiveTab=function(){var activeTab=this.parentTab()._domElement.querySelector(".pbs-tab-tabs .pbs-tab-active");activeTab&&activeTab._ceElement.removeCSSClass("pbs-tab-active"),this.addCSSClass("pbs-tab-active")},Tab.prototype._onMouseDown=function(ev){return setTimeout(function(){this.setActiveTab()}.bind(this),1),Tab.__super__._onMouseDown.call(this,ev)},Tab.prototype.openTab=function(){this.parentTab()._domElement.querySelector('[id="'+this.attr("for")+'"]').checked=!0,this.setActiveTab()},Tab._dropTab=function(element,target,placement){var insertIndex=target.parent().children.indexOf(target);if("left"!==placement[1]&&(insertIndex+=1),element.parent()!==target.parent()){var originalTabElement=element.parentTab(),otherTab=element.previousSibling();otherTab||(otherTab=element.nextSibling());var tabRow=element.parentTab().detachTabAndContent(element);return target.parentTab().attachTabAndContent(element,insertIndex,tabRow),element.openTab(),void(otherTab?otherTab.openTab():originalTabElement.parent().detach(originalTabElement))}return element.parent().detach(element),target.parent().attach(element,insertIndex)},Tab.prototype._onMouseOver=function(ev){var root=ContentEdit.Root.get();return root.dragging()&&this.openTab(),Tab.__super__._onMouseOver.call(this,ev)},Tab.droppers={Tab:Tab._dropTab},Tab.placements=["left","right"],Tab.prototype.focus=function(){return this.openTab(),Tab.__super__.focus.call(this)},Tab.prototype._keyReturn=function(ev){ev.preventDefault();var next=this.nextSibling();next&&next.focus()},Tab.prototype.isLastTab=function(){return this.parent().children.indexOf(this)===this.parent().children.length-1},Tab.prototype.getMatchingPanel=function(){var inputID=this.attr("for"),inputElem=this.parentTab()._domElement.querySelector('[id="'+inputID+'"]')._ceElement,tabID=inputElem.attr("data-tab");return this.parentTab()._domElement.querySelector('[data-panel="'+tabID+'"]')._ceElement},Tab.prototype.html=function(){var ret=Tab.__super__.html.call(this);if(0===this.parent().children.indexOf(this)){if(!ret.match(/pbs-tab-active/)){var r=new RegExp("(<"+this._tagName+"[^>]+class=['\"])");ret.match(r)?ret=ret.replace(r,"$1pbs-tab-active "):(r=new RegExp("(<"+this._tagName+")"),ret=ret.replace(r,'$1 class="pbs-tab-active"'))}}else ret=ret.replace(/\s*pbs-tab-active\s*/g,""),ret=ret.replace(/\s*class=[\'\"][\'\"]/g,"");return ret},Tab.prototype._keyLeft=function(ev){if(0===this.parent().children.indexOf(this)){var selection=ContentSelect.Range.query(this._domElement);0===selection.get()[0]&&selection.isCollapsed()&&this._keyUp(ev)}return Tab.__super__._keyLeft.call(this,ev)},Tab.prototype._keyUp=function(ev){if(0===this.parent().children.indexOf(this)){var selection=ContentSelect.Range.query(this._domElement);if(0===selection.get()[0]&&selection.isCollapsed()){var tabs=this.parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index>0&&tabs.parent().children[index-1].content){var elem=tabs.parent().children[index-1];return elem.focus(),selection=new ContentSelect.Range(elem.content.length(),elem.content.length()),selection.select(elem.domElement())}var p=new ContentEdit.Text("p",{},"");tabs.parent().attach(p,index),p.focus()}}return Tab.__super__._keyUp.call(this,ev)},Tab.prototype._keyDown=function(ev){if(this.parent().children.indexOf(this)===this.parent().children.length-1){var selection=ContentSelect.Range.query(this._domElement);if(!this._atEnd(selection)||!selection.isCollapsed())return;if(this._atEnd(selection)){ev.preventDefault();var row=this.getMatchingPanel();return void row.children[0].children[0].focus()}}return Tab.__super__._keyDown.call(this,ev)},Tab.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if(this._atEnd(selection)&&selection.isCollapsed()){if(this.isLastTab()){ev.preventDefault();var row=this.getMatchingPanel();return void row.children[0].children[0].focus()}return Tab.__super__._keyRight.call(this,ev)}},Tab}(ContentEdit.Text),ContentEdit.TagNames.get().register(ContentEdit.Tab,"tab"),ContentEdit.TabContainer=function(_super){function TabContainer(tagName,attributes){TabContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabContainer,_super),TabContainer.prototype.cssTypeName=function(){return"tabcontainer"},TabContainer.prototype.type=function(){return"TabContainer"},TabContainer.prototype.typeName=function(){return"TabContainer"},TabContainer._dropOutside=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().parent().children.indexOf(target.parent()),"below"===placement[0]&&(insertIndex+=1),target.parent().parent().attach(element,insertIndex)},TabContainer.prototype._onOver=function(ev){var ret=TabContainer.__super__._onOver.call(this,ev);if(ret){var root=ContentEdit.Root.get();return this._removeCSSClass("ce-element--drop"),this.parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent()}return ret},TabContainer.droppers={"*":TabContainer._dropOutside},TabContainer.prototype._onMouseUp=function(ev){TabContainer.__super__._onMouseUp.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseOut=function(ev){TabContainer.__super__._onMouseOut.call(this,ev),clearTimeout(this._dragTimeout)},TabContainer.prototype._onMouseDown=function(ev){if(TabContainer.__super__._onMouseDown.call(this,ev),clearTimeout(this._dragTimeout),this.domElement()===ev.target)return ev.preventDefault(),this.draggableParent||(this.draggableParent=this.parent()),this._dragTimeout=setTimeout(function(_this){return function(){return _this.draggableParent.drag(ev.pageX,ev.pageY)}}(this),ContentEdit.DRAG_HOLD_DURATION)},TabContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_i<_len;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},TabContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabContainer,"tabcontainer"),ContentEdit.TabPanelContainer=function(_super){function TabPanelContainer(tagName,attributes){TabPanelContainer.__super__.constructor.call(this,tagName,attributes)}return __extends(TabPanelContainer,_super),TabPanelContainer.prototype.cssTypeName=function(){return"tabpanelcontainer"},TabPanelContainer.prototype.type=function(){return"TabPanelContainer"},TabPanelContainer.prototype.typeName=function(){return"TabPanelContainer"},TabPanelContainer.fromDOMElement=function(domElement){var c,childNode,childNodes,list,_i,_len;list=new this(domElement.tagName,this.getDOMElementAttributes(domElement)),childNodes=function(){var _i,_len,_ref,_results;for(_ref=domElement.childNodes,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)c=_ref[_i],_results.push(c);return _results}();var tagNames=ContentEdit.TagNames.get();for(_i=0,_len=childNodes.length;_i<_len;_i++)if(childNode=childNodes[_i],1===childNode.nodeType){var cls;cls=childNode.getAttribute("data-ce-tag")?tagNames.match(childNode.getAttribute("data-ce-tag")):tagNames.match(childNode.tagName);var element=cls.fromDOMElement(childNode);element&&list.attach(element)}return list},TabPanelContainer}(ContentEdit.Div),ContentEdit.TagNames.get().register(ContentEdit.TabPanelContainer,"tabpanelcontainer"),ContentEdit.TabRadio=function(_super){function TabRadio(tagName,attributes){TabRadio.__super__.constructor.call(this,tagName,attributes)}return __extends(TabRadio,_super),TabRadio.prototype.cssTypeName=function(){return"tabradio"},TabRadio.prototype.type=function(){return"TabRadio"},TabRadio.prototype.typeName=function(){return"TabRadio"},TabRadio.prototype.mount=function(){var ret=TabRadio.__super__.mount.call(this);return this._domElement.setAttribute("disabled","disabled"),ret},TabRadio.prototype.unmount=function(){return this._domElement.removeAttribute("disabled"),TabRadio.__super__.unmount.call(this)},TabRadio}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.TabRadio,"tabradio"),wp.hooks.addFilter("pbs.overlay.margin_top.can_apply",function(apply,element){if(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList){var parent=element._domElement.parentNode;if(parent.classList&&parent.classList.contains("pbs-tab-tabs"))return!1}return apply}),wp.hooks.addFilter("pbs.overlay.margin_bottom.can_apply",function(apply,element){if(element&&element._domElement&&element._domElement.parentNode&&element._domElement.parentNode.classList){var parent=element._domElement.parentNode;if(parent.classList&&parent.classList.contains("pbs-tab-tabs"))return!1}return apply}),function(){var proxied=ContentEdit.Text.prototype._keyUp;ContentEdit.Text.prototype._keyUp=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&0===this.parent().children.indexOf(this)&&0===selection.get()[0]&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){ev.preventDefault();var tabs=this.parent().parent().parent().parent()._domElement.querySelector(".pbs-tab-tabs")._ceElement,tab=tabs.children[tabs.children.length-1];return tab.focus(),selection=new ContentSelect.Range(tab.content.length(),tab.content.length()),selection.select(tab.domElement())}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyLeft;ContentEdit.Text.prototype._keyLeft=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&0===this.parent().children.indexOf(this)&&0===this.parent().parent().children.indexOf(this.parent())&&0===selection.get()[0]&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){ev.preventDefault();var tabs=this.parent().parent().parent().parent()._domElement.querySelector(".pbs-tab-tabs")._ceElement,tab=tabs.children[tabs.children.length-1];return tab.focus(),selection=new ContentSelect.Range(tab.content.length(),tab.content.length()),selection.select(tab.domElement())}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyDown;ContentEdit.Text.prototype._keyDown=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this._atEnd(selection)&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){var tabs=this.parent().parent().parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index<tabs.parent().children.length-1&&tabs.parent().children[index+1].content)return ev.preventDefault(),tabs.parent().children[index+1].focus(),selection=new ContentSelect.Range(0,0),selection.select(tabs.parent().children[index+1]._domElement);var p=new ContentEdit.Text("p",{},"");return tabs.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Text.prototype._keyRight;ContentEdit.Text.prototype._keyRight=function(ev){var selection=ContentSelect.Range.query(this._domElement);if("DivCol"===this.parent().constructor.name&&this.parent().children.indexOf(this)===this.parent().children.length-1&&this.parent().parent().children.indexOf(this.parent())===this.parent().parent().children.length-1&&this._atEnd(selection)&&"TabPanelContainer"===this.parent().parent().parent().constructor.name){var tabs=this.parent().parent().parent().parent(),index=tabs.parent().children.indexOf(tabs);if(index<tabs.parent().children.length-1&&tabs.parent().children[index+1].content)return ev.preventDefault(),void tabs.parent().children[index+1].focus();var p=new ContentEdit.Text("p",{},"");return tabs.parent().attach(p,index+1),void p.focus()}return proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.Node.prototype.previous;ContentEdit.Node.prototype.previous=function(){var node=proxied.call(this);if(node&&node._domElement&&window.pbsSelectorMatches(node._domElement,".pbs-tab-panels *")&&0===node._domElement.offsetWidth&&0===node._domElement.offsetHeight){for(var tabs=node.parent().parent();tabs&&"Tabs"!==tabs.constructor.name;)tabs=tabs.parent();if(tabs){node=tabs.getOpenTab();for(var allVisibles=node._domElement.querySelectorAll("*"),i=allVisibles.length-1;i>=0;i--)if(allVisibles[i]._ceElement)return allVisibles[i]._ceElement}}return node}}(),function(){var proxied=ContentEdit.DivCol.prototype._onMouseDown;ContentEdit.DivCol.prototype._onMouseDown=function(ev){return this.parent().parent()._domElement.classList.contains("pbs-tab-panels")&&(this.draggableParent=this.parent().parent().parent()),proxied.call(this,ev)}}(),function(){var proxied=ContentEdit.DivRow.prototype._onOver;ContentEdit.DivRow.prototype._onOver=function(ev){var ret=proxied.call(this,ev);if(ret&&"TabPanelContainer"===this.parent().constructor.name){var root=ContentEdit.Root.get();return this._removeCSSClass("ce-element--drop"),this.parent().parent()._addCSSClass("ce-element--drop"),root._dropTarget=this.parent().parent()}return ret}}();var root=ContentEdit.Root.get();root._overrideImageOnStopResizing=root._onStopResizing,root._onStopResizing=function(ev){if("Image"===this._resizing.constructor.name){var match=this._resizing._attributes["class"].match(/size-\w+/);match&&this._resizing.removeCSSClass(match[0]),this._resizing.style("height","auto")}return this._overrideImageOnStopResizing(ev)}.bind(root),ContentEdit.Image.prototype._onDblclick=function(){
this.openMediaManager()},ContentEdit.Image.prototype.openMediaManager=function(){var frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(this._domElement)});frame.state("image-details").on("update",function(imageData){_pbsUpdateNonCaptionedImageCTElement(this,imageData)}.bind(this)),frame.state("replace-image").on("replace",function(imageData){_pbsUpdateNonCaptionedImageCTElement(this,imageData)}.bind(this)),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach()})},ContentEdit.Image.prototype._removeDOMEventListeners=function(){this._domElement.removeEventListener("dblclick",this._onDblClickBound),window.removeEventListener("keydown",this._onKeyDownBound)},ContentEdit.Image.prototype.mount=function(){var i;if(this._attributes){var responsiveAttributes=["srcset","sizes","data-lazy-loaded","data-lazy-src","data-pin-nopin","src-orig","scale"];for(i=0;i<responsiveAttributes.length;i++)this._attributes[responsiveAttributes[i]]&&delete this._attributes[responsiveAttributes[i]]}if(this._attributes&&this._attributes["class"]){var classes=this._attributes["class"].split(" ");classes.indexOf("alignnone")!==-1&&(classes[classes.indexOf("alignnone")]="aligncenter",this._attributes["class"]=classes.join(" "))}this._domElement=document.createElement("img");for(i in this._attributes)this._attributes.hasOwnProperty(i)&&this._attributes[i]&&this._domElement.setAttribute(i,this._attributes[i]);if(this._onDblClickBound=this._onDblclick.bind(this),this._domElement.addEventListener("dblclick",this._onDblClickBound),this._onKeyDownBound=this._onKeyDown.bind(this),window.addEventListener("keydown",this._onKeyDownBound),this._attributes.height&&this._attributes.width){var parentWidth=window.pbsGetBoundingClientRect(this.parent()._domElement).width,imageWidth=parseInt(this._attributes.width,10),imageHeight=parseInt(this._attributes.height,10);if(imageWidth>parentWidth){var ratio=imageHeight/imageWidth;imageWidth=parentWidth,imageHeight=imageWidth*ratio}this._domElement.style.height=imageHeight+"px",this._domElement.style.width=imageWidth+"px",this._domElement.classList.add("pbs-image-loading");var load=function(){this._domElement&&(this._domElement.style.height="",this._domElement.style.width="",this._domElement.classList.remove("pbs-image-loading"),this._domElement.removeEventListener("load",load))}.bind(this);this._domElement.addEventListener("load",load)}var ret=ContentEdit.Image.__super__.mount.call(this);return wp.hooks.doAction("pbs.image.mounted"),ret},ContentEdit.Image.prototype._onKeyDown=function(ev){16!==ev.keyCode&&91!==ev.keyCode&&93!==ev.keyCode&&(ev.ctrlKey||ev.metaKey||["input","select","textarea","button"].indexOf(ev.target.tagName.toLowerCase())===-1&&this.isFocused()&&(ev.preventDefault(),ContentTools.Tools.Paragraph.apply(this,null,function(){})))},ContentEdit.Image._dropBoth=function(element,target,placement){var insertIndex;return element.parent().detach(element),insertIndex=target.parent().children.indexOf(target),"below"===placement[0]&&"center"===placement[1]&&(insertIndex+=1),element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),["left","right","center"].indexOf(placement[1])!==-1&&element.addCSSClass("align"+placement[1]),target.parent().attach(element,insertIndex)},ContentEdit.Image.droppers={Image:ContentEdit.Image._dropBoth,PreText:ContentEdit.Image._dropBoth,Static:ContentEdit.Image._dropBoth,Text:ContentEdit.Image._dropBoth},wp.hooks.addFilter("pbs.shortcode.allow_raw_edit",function(allow,scBase,element){if("caption"===scBase){var target=element._domElement.querySelector("img"),frame=wp.media.editor.open("edit",{frame:"image",state:"image-details",metadata:_pbsImageGetMetaData(target)});return frame.state("image-details").on("update",function(imageData){_pbsUpdateNonCaptionedImage(target,imageData)}),frame.state("replace-image").on("replace",function(imageData){_pbsUpdateNonCaptionedImage(target,imageData)}),frame.on("close",function(){wp.media.editor.remove("edit"),frame.detach()}),!1}return allow});var _pbsToolbarImageHasTextContent=function(node){return node&&!(!node.textContent&&!node.innerText)},_pbsToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&(" "+node.className+" ").indexOf(" "+className+" ")!==-1)return node;node=node.parentNode}return!1},_pbsUpdateNonCaptionedImage=function(imageNode,imageData){var classes,node,captionNode,id,attrs,linkAttrs,width,height,align;classes=imageData.extraClasses.split(" "),classes||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,"class":classes.join(" ")||null};for(var key in attrs)attrs.hasOwnProperty(key)&&imageNode.setAttribute(key,attrs[key]);if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,"class":imageData.linkClassName||null},imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(imageNode.parentNode))if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&imageNode.parentNode.setAttribute(key,linkAttrs[key]);else{var oldA=imageNode.parentNode;oldA.parentNode.insertBefore(imageNode,oldA),oldA.parentNode.removeChild(oldA)}else if(imageData.linkUrl){var linkNode=_pbsToolbarImageGetParent(imageNode,"a");linkNode&&imageNode.parentNode.insertBefore(linkNode,imageNode.nextSibling),linkNode=document.createElement("a");for(var i in linkAttrs)linkAttrs.hasOwnProperty(i)&&null!==linkAttrs[i]&&linkNode.setAttribute(i,linkAttrs[i]);imageNode.parentNode.insertBefore(linkNode,imageNode),linkNode.appendChild(imageNode)}captionNode=_pbsToolbarImageGetParent(imageNode,".mceTemp"),node=imageNode.parentNode&&"A"===imageNode.parentNode.nodeName&&!_pbsToolbarImageHasTextContent(imageNode.parentNode)?imageNode.parentNode:imageNode;for(var textElement=null,currElement=node;currElement;){if(currElement._ceElement){textElement=currElement._ceElement;break}currElement=currElement.parentNode}var parent,index,newElem;if(imageData.caption){id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none");var scData={tag:"caption",type:"closed",content:node.outerHTML+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData).string();parent=textElement.parent(),index=parent.children.indexOf(textElement),shortcode=wp.shortcode.next("caption",shortcode,0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),parent.attach(newElem,index),parent.detach(textElement),newElem.ajaxUpdate(!0),newElem.focus(),textElement=newElem}else parent=textElement.parent(),index=parent.children.indexOf(textElement),newElem=ContentEdit.Image.fromDOMElement(node),parent.attach(newElem,index),parent.detach(textElement),newElem.focus()},_pbsToolbarImageGetParent=function(node,className){for(;node&&node.parentNode;){if(node.className&&(" "+node.className+" ").indexOf(" "+className+" ")!==-1)return node;node=node.parentNode}return!1},_pbsUpdateNonCaptionedImageCTElement=function(imageNode,imageData){var classes,id,attrs,linkAttrs,width,height,align;classes=imageData.extraClasses.split(" "),classes||(classes=[]),imageData.caption||classes.push("align"+imageData.align),imageData.attachment_id&&(classes.push("wp-image-"+imageData.attachment_id),imageData.size&&"custom"!==imageData.size&&classes.push("size-"+imageData.size)),width=imageData.width,height=imageData.height,"custom"===imageData.size&&(width=imageData.customWidth,height=imageData.customHeight),attrs={src:imageData.url,width:width||null,height:height||null,alt:imageData.alt,title:imageData.title||null,"class":classes.join(" ")||null},imageNode._aspectRatio=height/width,imageNode.size([width,height]);var cls=imageNode.attr("class").match(/wp-image-\d+/);cls&&imageNode.removeCSSClass(cls[0]),cls=imageNode.attr("class").match(/size-\w+/),cls&&imageNode.removeCSSClass(cls[0]),imageNode.removeCSSClass("alignleft"),imageNode.removeCSSClass("alignright"),imageNode.removeCSSClass("aligncenter"),imageNode.removeCSSClass("alignnone");for(var i=0;i<classes.length;i++)classes[i]&&imageNode.addCSSClass(classes[i]);for(var key in attrs)attrs.hasOwnProperty(key)&&"class"!==key&&(null!==attrs[key]?imageNode.attr(key,attrs[key]):imageNode.removeAttr(key));if(linkAttrs={href:imageData.linkUrl,rel:imageData.linkRel||null,target:imageData.linkTargetBlank?"_blank":null,"class":imageData.linkClassName||null},imageNode.a)if(imageData.linkUrl)for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&(null!==linkAttrs[key]?imageNode.a[key]=linkAttrs[key]:delete imageNode.a[key]);else imageNode.a=null;else if(imageData.linkUrl){imageNode.a={};for(key in linkAttrs)linkAttrs.hasOwnProperty(key)&&null!==linkAttrs[key]&&(imageNode.a[key]=linkAttrs[key])}if(imageData.caption){id=imageData.attachment_id?"attachment_"+imageData.attachment_id:null,align="align"+(imageData.align||"none");var scData={tag:"caption",type:"closed",content:imageNode.html()+" "+imageData.caption,attrs:{id:id,align:align,width:width}},shortcode=new wp.shortcode(scData),newElem=ContentEdit.Shortcode.createShortcode(wp.shortcode.next("caption",shortcode.string(),0)),index=imageNode.parent().children.indexOf(imageNode);return imageNode.parent().attach(newElem,index),imageNode.parent().detach(imageNode),void newElem.ajaxUpdate(!0)}},_pbsImageGetMetaData=function(img){var i,attachmentID=img.getAttribute("class").match(/wp-image-(\d+)/),align=img.getAttribute("class").match(/align(\w+)/),size=img.getAttribute("class").match(/size-(\w+)/),tmpClasses=img.getAttribute("class").split(" "),extraClasses=[],classRegex=/wp-image-\d+|align\w+|size-\w+|ce-element[-\w]*/;if(img._ceElement&&img._ceElement.a&&img._ceElement.a["class"]){var aClasses=img._ceElement.a["class"].split(" ");for(i=0;i<aClasses.length;i++)aClasses[i].match(classRegex)||extraClasses.push(aClasses[i])}for(i=0;i<tmpClasses.length;i++)tmpClasses[i].match(classRegex)||extraClasses.push(tmpClasses[i]);var metadata={attachment_id:!!attachmentID&&attachmentID[1],size:size?size[1]:"custom",caption:"",align:align?align[1]:"none",extraClasses:extraClasses.join(" "),link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:""};metadata.url=img.getAttribute("src"),metadata.alt=img.getAttribute("alt"),metadata.title=img.getAttribute("title");var width=img.getAttribute("width"),height=img.getAttribute("height");metadata.customWidth=metadata.width=width,metadata.customHeight=metadata.height=height;for(var captionClassName=[],captionBlock=img.parentNode;null!==captionBlock&&"undefined"!=typeof captionBlock.classList&&!captionBlock.classList.contains("wp-caption");)captionBlock=captionBlock.parentNode;if(captionBlock&&captionBlock.classList){var classes=captionBlock.classList;for(i=0;i<classes.length;i++){var c=classes.item(i);/^align/.test(c)?metadata.align=c.replace("align",""):c&&"wp-caption"!==c&&captionClassName.push(c)}metadata.captionClassName=captionClassName.join(" ");var caption=captionBlock.querySelector(".wp-caption-text");caption&&(metadata.caption=caption.innerHTML.replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))}if(img.parentNode&&"A"===img.parentNode.nodeName){var link=img.parentNode;metadata.linkUrl=link.getAttribute("href"),metadata.linkTargetBlank="_blank"===link.getAttribute("target"),metadata.linkRel=link.getAttribute("rel"),metadata.linkClassName=link.className}return img._ceElement&&img._ceElement.a&&(metadata.linkUrl=img._ceElement.a.href,metadata.linkTargetBlank="_blank"===img._ceElement.a.target,metadata.linkRel=img._ceElement.a.rel,metadata.linkClassName=img._ceElement.a["class"]),metadata};window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){for(var editableArea=document.querySelector('[data-name="main-content"]'),selector="a:not([data-ce-tag]) > img.alignright, a:not([data-ce-tag]) > img.alignleft, a:not([data-ce-tag]) > img.aligncenter, a:not([data-ce-tag]) > img.alignnone, p > img.alignright, p > img.alignleft, p > img.aligncenter, p > img.alignnone";editableArea.querySelector(selector);){var el=editableArea.querySelector(selector),mainImageNode=el;if("A"===el.parentNode.tagName&&(mainImageNode=el.parentNode,mainImageNode.setAttribute("data-ce-tag","img")),"P"===mainImageNode.parentNode.tagName){var clonedPNode,p=mainImageNode.parentNode,startingIndex=p.innerHTML.indexOf(mainImageNode.outerHTML),endingIndex=startingIndex+mainImageNode.outerHTML.length,tip=p.innerHTML.substr(0,startingIndex).trim(),tail=p.innerHTML.substr(endingIndex).trim(),newContent="";""!==tip&&(clonedPNode=p.cloneNode(),clonedPNode.innerHTML=tip,newContent+=clonedPNode.outerHTML),newContent+=mainImageNode.outerHTML,""!==tail&&(clonedPNode=p.cloneNode(),clonedPNode.innerHTML=tail,newContent+=clonedPNode.outerHTML),p.outerHTML=newContent}}for(;editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br');)editableArea.querySelector('img ~ br, [data-ce-tag="img"] ~ br').remove()}}),wp.hooks.addFilter("pbs.save",function(html){return html=html.replace(/\sdata-ce-tag=["']img["']/g,""),html=html.replace(/(<a[^>]*)\sclass((\s|>)[^>]*>)/g,"$1$2"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<p[^\w>]*>)/g,"$4$1"),html=html.replace(/(<[^pa][^>]*>\s*)(<img[^>]*>)/g,"$1<p>$2</p>"),html=html.replace(/(<[^p][^>]*>\s*)(<a[^>]+>\s*<img[^>]*>\s*<\/a>)/g,"$1<p>$2</p>"),html=html.replace(/((<a[^>]+>\s*)?<img[^>]*>(\s*<\/a>)?)\s*(<br[^>]*>)*/g,"$1")}),wp.hooks.addFilter("pbs.toolbar.shortcode.label",function(scBase){return"pbs_widget"===scBase?pbsParams.labels.widget:scBase}),wp.hooks.addFilter("pbs.inspector.do_add_section_options",function(doContinue,optionName,model,divGroup,element,toolboxUI){return"widgetSettings"===optionName&&model&&model.attributes&&model.attributes.widget&&(doContinue=!!document.querySelector("#tmpl-pbs-widget-"+model.attributes.widget),doContinue||toolboxUI.addGenericShortcodeOptions(divGroup,element)),doContinue}),ContentEdit.Spacer=function(_super){function Spacer(tagName,attributes){attributes||(attributes={}),attributes["data-ce-tag"]||(attributes["data-ce-tag"]="spacer"),this.model=new Backbone.Model({}),Spacer.__super__.constructor.call(this,tagName,attributes),this._content=""}return __extends(Spacer,_super),Spacer.prototype.blur=function(){var root=ContentEdit.Root.get();if(this.isFocused())return this._removeCSSClass("ce-element--focused"),root._focused=null,root.trigger("blur",this)},Spacer.droppers=PBSEditor.allDroppers,Spacer.prototype.focus=function(supressDOMFocus){var root;if(root=ContentEdit.Root.get(),!this.isFocused())return root.focused()&&root.focused().blur(),this._addCSSClass("ce-element--focused"),root._focused=this,this.isMounted()&&!supressDOMFocus&&this.domElement().focus(),root.trigger("focus",this)},Spacer.prototype.cssTypeName=function(){return"spacer"},Spacer.prototype.typeName=function(){return"Spacer"},Spacer}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.Spacer,"spacer"),HTMLString.String.prototype.removeStyle=function(){var c,from,i,to,_i,styleName=null;if(from=arguments[0],to=arguments[1],arguments.length>=3&&(styleName=arguments[2]),!styleName)return this;to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from);var newString=this.copy();for(i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i)if(c=newString.characters[i],c._tags.length)for(var z=c._tags.length-1;z>=0;z--)if("a"!==c.tags()[z].name()){var currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));if(currentStyles[styleName]){delete currentStyles[styleName];var newStyles=window.cssToStyleString(currentStyles);newString.characters[i]._tags[0].attr("style",newStyles),"span"===newString.characters[i]._tags[0].name()&&""===newString.characters[i]._tags[0].attr("style").trim()&&newString.characters[i].removeTags()}}return newString.optimize(),newString},HTMLString.String.prototype.removeStyles=function(){var c,from,i,newString,to,_i,newStyles,tagName;for(from=arguments[0],to=arguments[1],tagName=arguments[2],newStyles=arguments[3],to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from),newString=this.copy(),i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i)if(c=newString.characters[i],c._tags.length)for(var z=c._tags.length-1;z>=0;z--)"a"!==c.tags()[z].name()&&newString.characters[i].removeTags(c.tags()[z]);return newString.optimize(),newString},HTMLString.String.prototype.hasStyle=function(){var c,from,i,to,_i,styleName=null;for(from=arguments[0],to=arguments[1],arguments.length>=3&&(styleName=arguments[2]),to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from),i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i)if(c=this.characters[i],c&&c._tags.length)if(styleName){var currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));if("undefined"!=typeof currentStyles[styleName])return currentStyles[styleName]}else{if(["b","strong","i","em"].indexOf(c.tags()[0].name())!==-1)return!0;if(c.tags()[0].attr("style"))return!0}return!1},HTMLString.String.prototype.style=function(){var c,from,i,newString,tags,to,_i,newStyles,tagName;from=arguments[0],to=arguments[1],tagName=arguments[2],newStyles=arguments[3],tags=new HTMLString.Tag("span"),to<0&&(to=this.length()+to+1),from<0&&(from=this.length()+from);var dummy=document.createElement(tagName);for(dummy.style.display="none",document.body.appendChild(dummy),newString=this.copy(),i=_i=from;from<=to?_i<to:_i>to;i=from<=to?++_i:--_i){c=newString.characters[i],c._tags.length||c.addTags(tags);for(var isBr=!1,z=0;z<c._tags.length;z++)if("br"===c._tags[z].name()){isBr=!0;break}if(!isBr){var currentStyles=window.cssToStyleObject(c.tags()[0].attr("style"));for(var styleName in newStyles){if(newStyles.hasOwnProperty(styleName)&&newStyles[styleName]){"string"==typeof newStyles[styleName]?newStyles[styleName]=["",newStyles[styleName]]:""!==newStyles[styleName][0]&&newStyles[styleName].unshift("");for(var applyStyle,k=(newStyles[styleName][newStyles[styleName].length-1],0);k<newStyles[styleName].length;k++)applyStyle=newStyles[styleName][k];currentStyles[styleName]=applyStyle}else delete currentStyles[styleName];""===currentStyles[styleName]&&delete currentStyles[styleName]}newString.characters[i]._tags[0].attr("style",window.cssToStyleString(currentStyles)),"span"===newString.characters[i]._tags[0].name()&&""===newString.characters[i]._tags[0].attr("style").trim()&&newString.characters[i].removeTags()}}return document.body.removeChild(dummy),newString.optimize(),newString},HTMLString.String.prototype.getStyle=function(styleName,element){var dashedStyleName=styleName;styleName=styleName.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()});var nodeToCheck=element._domElement,nodeHTML=this.html(),foundNode=!1;if(0===nodeHTML.indexOf("<"))for(var i=0;i<element._domElement.children.length;i++)if(element._domElement.children[i].outerHTML===nodeHTML){nodeToCheck=element._domElement.children[i],foundNode=!0;break}if(!foundNode&&0===nodeHTML.indexOf("<")){var style=nodeToCheck.firstChild.style[dashedStyleName];if(""!==style)return style;var styleRegex=new RegExp("(<\\w+[^>]+style=[^>]*[^-]"+dashedStyleName+':\\s*)([^;"]+)'),match=nodeHTML.match(styleRegex);if(match)return match[2]}return nodeToCheck.style[styleName]?nodeToCheck.style[styleName]:window.pbsGetComputedStyle(nodeToCheck)[styleName]},HTMLString.Character.prototype.addTags=function(){var tag,tags,_i,_len,_results;for(tags=1<=arguments.length?__slice.call(arguments,0):[],_results=[],_i=0,_len=tags.length;_i<_len;_i++)tag=tags[_i],Array.isArray(tag)||(tag.selfClosing()?this.isTag()||this._tags.unshift(tag.copy()):_results.push(this._tags.push(tag.copy())));return _results},window.addEventListener("DOMContentLoaded",function(){wp.media.frames.pbsSelectImage=wp.media({title:pbsParams.labels.select_image,multiple:!1,library:{type:"image"},button:{text:pbsParams.labels.use_selected_image}}),PBSEditor.openMediaManager=function(callback,selectedImageID){wp.media.frames.pbsSelectImage.callback=function(){wp.media.frames.pbsSelectImage.off("close",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage.off("select",wp.media.frames.pbsSelectImage.callback);var selection=wp.media.frames.pbsSelectImage.state().get("selection");if(selection){var ret=null;selection.each(function(attachment){ret=attachment}),ret&&callback(ret)}},wp.media.frames.pbsSelectImage.on("close",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage.on("select",wp.media.frames.pbsSelectImage.callback),wp.media.frames.pbsSelectImage._onOpen=function(){wp.media.frames.pbsSelectImage.off("open",wp.media.frames.pbsSelectImage._onOpen);var selection=wp.media.frames.pbsSelectImage.state().get("selection");if(selection){for(;selection.length;)selection.remove(selection.first());if(selectedImageID){var attachment=wp.media.attachment(selectedImageID);attachment&&selection.add(attachment)}}},wp.media.frames.pbsSelectImage.on("open",wp.media.frames.pbsSelectImage._onOpen),wp.media.frames.pbsSelectImage.open()}}),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){var appendWidgetTemplates=function(ajaxResponse){localStorage.setItem("pbs_get_widget_templates_hash",pbsParams.widget_list_hash),localStorage.setItem("pbs_get_widget_templates",ajaxResponse);var dummy=document.createElement("DIV");for(dummy.innerHTML=ajaxResponse;dummy.firstChild;)document.body.appendChild(dummy.firstChild)},storedWidgetHash=localStorage.getItem("pbs_get_widget_templates_hash"),storedWidgets=localStorage.getItem("pbs_get_widget_templates");if(storedWidgetHash===pbsParams.widget_list_hash&&storedWidgets)return void appendWidgetTemplates(storedWidgets);var payload=new FormData;payload.append("action","pbs_get_widget_templates"),payload.append("nonce",pbsParams.nonce);var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.status>=200&&xhr.status<400&&appendWidgetTemplates(xhr.responseText)},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)}}),ContentTools.ToolboxBarUI=function(_super){function ToolboxBarUI(tools){ToolboxBarUI.__super__.constructor.call(this),this._tools=tools,this._toolUIs={}}return __extends(ToolboxBarUI,_super),ToolboxBarUI.prototype.isDragging=function(){return!1},ToolboxBarUI.prototype.hide=function(){return this._removeDOMEventListeners(),ToolboxBarUI.__super__.hide.call(this)},ToolboxBarUI.prototype.tools=function(tools){return void 0===tools?this._tools:(this._tools=tools,this.unmount(),this.mount())},ToolboxBarUI.prototype.mount=function(){var domToolGroup,i,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref;for(this._domElement=this.constructor.createDiv(["pbs-toolbox-bar","ct-widget","ct-toolbox"]),document.body.appendChild(this._domElement),_ref=this._tools,i=_i=0,_len=_ref.length;_i<_len;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_j<_len1;_j++)toolName=toolGroup[_j],"|"!==toolName?pbsParams.is_lite&&window.PBSEditor.premiumTools&&window.PBSEditor.premiumTools[toolName]?(tool=ContentTools.ToolShelf.fetch("premium-formatting"),tool.icon=toolName,tool.label=window.PBSEditor.premiumTools[toolName],this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName]._domElement.classList.add("pbs-premium-flag")):(tool=ContentTools.ToolShelf.fetch(toolName),this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].disabled(!0),this._toolUIs[toolName].bind("apply",function(_this){return function(){return _this.updateTools()}}(this))):(tool=this.constructor.createDiv(["pbs-tool-sep"]),domToolGroup.appendChild(tool));return this._addDOMEventListeners()},ToolboxBarUI.prototype.updateTools=function(){ToolboxBarUI.__super__.updateTools.call(this)},ToolboxBarUI.prototype._addDOMEventListeners=function(){return this._updateTools=function(_this){return function(){var app,element,name,selection,toolUI,update,_ref,_results;app=ContentTools.EditorApp.get(),update=!1,element=ContentEdit.Root.get().focused(),selection=null,element===_this._lastUpdateElement?element&&element.selection&&(selection=element.selection(),_this._lastUpdateSelection&&selection.eq(_this._lastUpdateSelection)&&(update=!0)):update=!0,app.history&&(_this._lastUpdateHistoryLength!==app.history.length()&&(update=!0),_this._lastUpdateHistoryLength=app.history.length()),_this._lastUpdateElement=element,_this._lastUpdateSelection=selection,_ref=_this._toolUIs,_results=[];for(name in _ref)toolUI=_ref[name],_results.push(toolUI.update(element,selection));return _results}}(this),this._updateToolsTimeout=setInterval(this._updateTools,100),this._handleKeyDown=function(){return function(ev){var element,os,redo,undo,version;switch(46===ev.keyCode&&(element=ContentEdit.Root.get().focused(),element&&!element.content&&ContentTools.Tools.Remove.apply(element,null,function(){})),version=navigator.appVersion,os="linux",version.indexOf("Mac")!==-1?os="mac":version.indexOf("Win")!==-1&&(os="windows"),redo=!1,undo=!1,os){case"linux":90===ev.keyCode&&ev.ctrlKey&&(redo=ev.shiftKey,undo=!redo);break;case"mac":90===ev.keyCode&&ev.metaKey&&(redo=ev.shiftKey,undo=!redo);break;case"windows":89===ev.keyCode&&ev.ctrlKey&&(redo=!0),90===ev.keyCode&&ev.ctrlKey&&(undo=!0)}if(undo&&ContentTools.Tools.Undo.canApply(null,null)&&ContentTools.Tools.Undo.apply(null,null,function(){}),redo&&ContentTools.Tools.Redo.canApply(null,null))return ContentTools.Tools.Redo.apply(null,null,function(){})}}(this),window.addEventListener("keydown",this._handleKeyDown)},ToolboxBarUI.prototype._removeDOMEventListeners=function(){return window.removeEventListener("keydown",this._handleKeyDown),clearInterval(this._updateToolsTimeout)},ToolboxBarUI.prototype._onStartDragging=function(){},ToolboxBarUI.prototype._onStopDragging=function(){},ToolboxBarUI.prototype._onDrag=function(){},ToolboxBarUI}(ContentTools.ToolboxUI),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.init;_EditorApp.prototype.init=function(queryOrDOMElements,namingProp){proxied.call(this,queryOrDOMElements,namingProp),this._toolboxBar=new ContentTools.ToolboxBarUI(window.PBSEditor.formattingTools),this.attach(this._toolboxBar)};var unmountProxy=_EditorApp.prototype.unmount;_EditorApp.prototype.unmount=function(){unmountProxy.call(this),this.isMounted()&&(this._toolboxBar=null)};var startProxy=_EditorApp.prototype.start;_EditorApp.prototype.start=function(){startProxy.call(this),this._toolboxBar.show()};var stopProxy=_EditorApp.prototype.stop;_EditorApp.prototype.stop=function(){stopProxy.call(this),this._toolboxBar.hide()}}(),ContentTools.Tools.Bold.label=pbsParams.labels.bold,ContentTools.Tools.Italic.label=pbsParams.labels.italic,ContentTools.Tools.Link.label=pbsParams.labels.link,ContentTools.Tools.AlignLeft.label=pbsParams.labels.align_left,ContentTools.Tools.AlignCenter.label=pbsParams.labels.align_center,ContentTools.Tools.AlignRight.label=pbsParams.labels.align_right,ContentTools.Tools.OrderedList.label=pbsParams.labels.numbered_list,ContentTools.Tools.UnorderedList.label=pbsParams.labels.bullet_list,ContentTools.Tools.Indent.label=pbsParams.labels.indent,ContentTools.Tools.Unindent.label=pbsParams.labels.unindent,ContentTools.Tools.Undo.label=pbsParams.labels.undo,ContentTools.Tools.Redo.label=pbsParams.labels.redo,ContentTools.ToolboxFixedUI=function(_super){function ToolboxFixedUI(tools){ToolboxFixedUI.__super__.constructor.call(this),this._tools=tools,this._toolUIs={}}return __extends(ToolboxFixedUI,_super),ToolboxFixedUI.prototype.isDragging=function(){return!1},ToolboxFixedUI.prototype.toggle=function(){this._domElement&&this._domElement.classList.contains("pbs-toolbox-elements-shown")?this.hide():this.show()},ToolboxFixedUI.prototype.show=function(){this.isMounted()||this.mount(),this._domElement.scrollTop=0,this.addCSSClass("ct-widget--active")},ToolboxFixedUI.prototype.hide=function(){return this._domElement&&this.removeCSSClass("ct-widget--active"),this._removeDOMEventListeners(),ToolboxFixedUI.__super__.hide.call(this)},ToolboxFixedUI.prototype.tools=function(tools){return void 0===tools?this._tools:(this._tools=tools,this.unmount(),this.mount())},ToolboxFixedUI.prototype.mount=function(){var domToolGroup,i,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref;this._domElement=this.constructor.createDiv(["pbs-interactive-elements-group","pbs-toolbox-elements","ct-widget","ct-toolbox"]),document.body.appendChild(this._domElement);var note=this.constructor.createDiv(["pbs-toolbox-elements-note"]);for(note.innerHTML=pbsParams.labels.drag_an_element,this._domElement.appendChild(note),_ref=this._tools,i=_i=0,_len=_ref.length;_i<_len;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_j<_len1;_j++)if(toolName=toolGroup[_j],pbsParams.is_lite&&window.PBSEditor.premiumElements&&window.PBSEditor.premiumElements[toolName])tool=ContentTools.ToolShelf.fetch("premium-formatting"),tool.icon=toolName,tool.buttonName=window.PBSEditor.premiumElements[toolName],tool.label="",this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName]._domElement.setAttribute("title","Premium Element"),this._toolUIs[toolName]._domElement.classList.add("pbs-premium-flag");else{try{tool=ContentTools.ToolShelf.fetch(toolName)}catch(err){var label=this.constructor.createDiv(["ct-tool","pbs-element-label"]);label.innerHTML=toolName,domToolGroup.appendChild(label);continue}this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].disabled(!0),this._toolUIs[toolName].bind("apply",function(_this){return function(){return _this.updateTools()}}(this))}return this._addDOMEventListeners()},ToolboxFixedUI.prototype.updateTools=function(){ToolboxFixedUI.__super__.updateTools.call(this)},ToolboxFixedUI.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mouseleave",function(ev){ev.relatedTarget&&window.pbsSelectorMatches(ev.relatedTarget,".ct-tool--insert-element, .ct-tool--insert-element *")||this.hide()}.bind(this)),this._updateTools=function(_this){return function(){var app,element,name,selection,toolUI,update,_ref,_results;app=ContentTools.EditorApp.get(),update=!1,element=ContentEdit.Root.get().focused(),selection=null,element===_this._lastUpdateElement?element&&element.selection&&(selection=element.selection(),_this._lastUpdateSelection&&selection.eq(_this._lastUpdateSelection)&&(update=!0)):update=!0,app.history&&(_this._lastUpdateHistoryLength!==app.history.length()&&(update=!0),_this._lastUpdateHistoryLength=app.history.length()),_this._lastUpdateElement=element,_this._lastUpdateSelection=selection,_ref=_this._toolUIs,_results=[];for(name in _ref)toolUI=_ref[name],_results.push(toolUI.update(element,selection));return _results}}(this),this._updateToolsTimeout=setInterval(this._updateTools,100),this._handleKeyDown=function(){return function(ev){var element,os,redo,undo,version;switch(46===ev.keyCode&&(element=ContentEdit.Root.get().focused(),element&&!element.content&&ContentTools.Tools.Remove.apply(element,null,function(){})),version=navigator.appVersion,os="linux",version.indexOf("Mac")!==-1?os="mac":version.indexOf("Win")!==-1&&(os="windows"),redo=!1,undo=!1,os){
case"linux":90===ev.keyCode&&ev.ctrlKey&&(redo=ev.shiftKey,undo=!redo);break;case"mac":90===ev.keyCode&&ev.metaKey&&(redo=ev.shiftKey,undo=!redo);break;case"windows":89===ev.keyCode&&ev.ctrlKey&&(redo=!0),90===ev.keyCode&&ev.ctrlKey&&(undo=!0)}if(undo&&ContentTools.Tools.Undo.canApply(null,null)&&ContentTools.Tools.Undo.apply(null,null,function(){}),redo&&ContentTools.Tools.Redo.canApply(null,null))return ContentTools.Tools.Redo.apply(null,null,function(){})}}(this),window.addEventListener("keydown",this._handleKeyDown)},ToolboxFixedUI.prototype._removeDOMEventListeners=function(){return window.removeEventListener("keydown",this._handleKeyDown),clearInterval(this._updateToolsTimeout)},ToolboxFixedUI.prototype._onStartDragging=function(){},ToolboxFixedUI.prototype._onStopDragging=function(){},ToolboxFixedUI.prototype._onDrag=function(){},ToolboxFixedUI}(ContentTools.ToolboxUI),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.init;_EditorApp.prototype.init=function(queryOrDOMElements,namingProp){proxied.call(this,queryOrDOMElements,namingProp),this._toolboxElements=new ContentTools.ToolboxFixedUI(window.PBSEditor.insertElements),this.attach(this._toolboxElements)};var unmountProxy=_EditorApp.prototype.unmount;_EditorApp.prototype.unmount=function(){unmountProxy.call(this),this.isMounted()&&(this._toolboxElements=null)};var startProxy=_EditorApp.prototype.start;_EditorApp.prototype.start=function(){startProxy.call(this),this._toolboxElements.isMounted()||this._toolboxElements.mount()};var stopProxy=_EditorApp.prototype.stop;_EditorApp.prototype.stop=function(){stopProxy.call(this),this._toolboxElements.hide()}}(),function(){var editor=ContentTools.EditorApp.get(),hideAddElementsPanelListener=function(){ContentTools.EditorApp.get()._toolboxElements.hide()};editor.bind("start",function(){document.querySelector(".pbs-main-wrapper").addEventListener("mousedown",hideAddElementsPanelListener),document.querySelector(".pbs-main-wrapper").addEventListener("mouseup",hideAddElementsPanelListener),document.querySelector(".pbs-main-wrapper").addEventListener("keydown",hideAddElementsPanelListener)}),editor.bind("stop",function(){document.querySelector(".pbs-main-wrapper").removeEventListener("mousedown",hideAddElementsPanelListener),document.querySelector(".pbs-main-wrapper").removeEventListener("mouseup",hideAddElementsPanelListener),document.querySelector(".pbs-main-wrapper").removeEventListener("keydown",hideAddElementsPanelListener)})}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseLeave;ContentTools.ToolUI.prototype._onMouseLeave=function(ev){if(this._mouseDown&&this._domElement.classList.contains("pbs-tool-large")){if(pbsParams.is_lite&&window.PBSEditor.premiumElements&&(window.PBSEditor.premiumElements[this.tool.tagName]||window.PBSEditor.premiumElements[this.tool.icon.toLowerCase()]))return ev.stopPropagation(),ev.preventDefault(),proxied.call(this,ev);var element=new ContentEdit.NewElementDragHelper(this.tool);ContentTools.EditorApp.get().regions()["main-content"].attach(element),element.drag(ev.screenX,ev.screenY+window.pbsScrollY()),ev.stopPropagation(),ev.preventDefault()}return proxied.call(this,ev)}}(),ContentEdit.NewElementDragHelper=function(_super){function NewElementDragHelper(tool,attributes){NewElementDragHelper.__super__.constructor.call(this,"div",attributes),this._content="",this.tool=tool}return __extends(NewElementDragHelper,_super),NewElementDragHelper.droppers=PBSEditor.allDroppers,NewElementDragHelper.prototype.typeName=function(){return this.tool.label},NewElementDragHelper.prototype.drop=function(element,placement){if(!element)return ContentEdit.Root.get().cancelDragging(),void this.parent().detach(this);var index=element.parent().children.indexOf(element);index+="above"===placement[0]?0:1,this.tool.createNew(element.parent(),index),this.parent().detach(this)},NewElementDragHelper}(ContentEdit.Static),ContentEdit.TagNames.get().register(ContentEdit.NewElementDragHelper,"NewElementDragHelper"),ContentTools.ToolboxPropertiesUI=function(_super){function ToolboxPropertiesUI(tools){this._onClose=__bind(this._onClose,this),ToolboxPropertiesUI.__super__.constructor.call(this,tools)}return __extends(ToolboxPropertiesUI,_super),ToolboxPropertiesUI.prototype.isDragging=function(){return ToolboxPropertiesUI.__super__.isDragging.call(this)},ToolboxPropertiesUI.prototype.show=function(){return this.isMounted()||this.mount(),this.addCSSClass("ct-widget--active")},ToolboxPropertiesUI.prototype.hide=function(){this.removeCSSClass("ct-widget--active")},ToolboxPropertiesUI.prototype.tools=function(tools){return ToolboxPropertiesUI.__super__.tools.call(this,tools)},ToolboxPropertiesUI.prototype.mount=function(){var coord,domToolGroup,i,position,restore,tool,toolGroup,toolName,_i,_j,_len,_len1,_ref;this._domElement=this.constructor.createDiv(["pbs-toolbox-properties","ct-widget","ct-toolbox"]),this.parent().domElement().appendChild(this._domElement),this._domGrip=this.constructor.createDiv(["pbs-toolbox-titlebar"]),this._domElement.appendChild(this._domGrip),this._domTabs=this.constructor.createDiv(["pbs-toolbox-tabs"]),this._domElement.appendChild(this._domTabs),this._domSections=this.constructor.createDiv(["pbs-toolbox-sections"]),this._domElement.appendChild(this._domSections),this._domResize=this.constructor.createDiv(["pbs-toolbox-resizer"]),this._domElement.appendChild(this._domResize);var title=this.constructor.createDiv(["pbs-toolbox-title"]);for(title.innerHTML=pbsParams.labels.properties_inspector,this._domGrip.appendChild(title),this._closeButton=this.constructor.createDiv(["pbs-titlebox-close"]),this._domGrip.appendChild(this._closeButton),_ref=this._tools,i=_i=0,_len=_ref.length;_i<_len;i=++_i)for(toolGroup=_ref[i],domToolGroup=this.constructor.createDiv(["ct-tool-group"]),this._domElement.appendChild(domToolGroup),_j=0,_len1=toolGroup.length;_j<_len1;_j++)toolName=toolGroup[_j],tool=ContentTools.ToolShelf.fetch(toolName),this._toolUIs[toolName]=new ContentTools.ToolUI(tool),this._toolUIs[toolName].mount(domToolGroup),this._toolUIs[toolName].bind("apply",function(_this){return function(){return _this.updateTools()}}(this));return null===window.localStorage.getItem("pbs-toolbox-elements-position")&&window.localStorage.setItem("pbs-toolbox-elements-position",window.innerWidth-250-30+",87,"+(window.innerHeight-77-20)),restore=window.localStorage.getItem("pbs-toolbox-elements-position"),restore&&/^\d+,\d+,\d+$/.test(restore)&&(position=function(){var _k,_len2,_ref1,_results;for(_ref1=restore.split(","),_results=[],_k=0,_len2=_ref1.length;_k<_len2;_k++)coord=_ref1[_k],_results.push(parseInt(coord,10));return _results}(),this._domElement.style.left=position[0]+"px",this._domElement.style.top=position[1]+"px",this._domElement.style.height=position[2]+"px"),this._addDOMEventListeners()},ToolboxPropertiesUI.prototype.updateTools=function(){return ToolboxPropertiesUI.__super__.updateTools.call(this)},ToolboxPropertiesUI.prototype.unmount=function(){return ToolboxPropertiesUI.__super__.unmount.call(this)},ToolboxPropertiesUI.prototype._addDOMEventListeners=function(){this._closeButton.addEventListener("mousedown",this._onClose),this._onResizeBound=this._onResize.bind(this),this._onResizeMoveBound=this._onResizeMove.bind(this),this._onResizeStopBound=this._onResizeStop.bind(this),this._domResize.addEventListener("mousedown",this._onResizeBound),ToolboxPropertiesUI.__super__._addDOMEventListeners.call(this)},ToolboxPropertiesUI.prototype._onResize=function(ev){ev.preventDefault(),ev.stopPropagation(),document.body.addEventListener("mousemove",this._onResizeMoveBound),document.body.addEventListener("mouseup",this._onResizeStopBound),this._resizeStart=ev.screenY,this._resizeOrigHeight=this._domElement.getBoundingClientRect().height},ToolboxPropertiesUI.prototype._onResizeMove=function(ev){ev.preventDefault(),ev.stopPropagation(),this._domElement.style.transition="none",this._domElement.style.height=this._resizeOrigHeight+(ev.screenY-this._resizeStart)+"px"},ToolboxPropertiesUI.prototype._onResizeStop=function(ev){ev.preventDefault(),ev.stopPropagation(),document.body.removeEventListener("mousemove",this._onResizeMoveBound),document.body.removeEventListener("mouseup",this._onResizeStopBound),this._domElement.style.transition="";var rect=this._domElement.getBoundingClientRect();window.localStorage.setItem("pbs-toolbox-elements-position",parseInt(rect.left,10)+","+parseInt(rect.top,10)+","+parseInt(rect.height,10)),this._contain()},ToolboxPropertiesUI.prototype._contain=function(){var rect;if(this.isMounted()&&!(window.innerWidth<=800)){var top=0;document.querySelector("#wpadminbar")&&(top+=parseInt(document.querySelector("#wpadminbar").clientHeight,10)),document.querySelector(".pbs-toolbox-bar")&&(top+=parseInt(document.querySelector(".pbs-toolbox-bar").clientHeight,10)),rect=this._domElement.getBoundingClientRect(),rect.left+rect.width>window.innerWidth&&(window.innerWidth-rect.width<0?this._domElement.style.left="0px":this._domElement.style.left=window.innerWidth-rect.width+"px"),rect.top+rect.height>window.innerHeight&&(window.innerHeight-rect.height<77?this._domElement.style.top="77px":this._domElement.style.top=window.innerHeight-rect.height+"px"),rect.left<0&&(this._domElement.style.left="0px"),rect.top<77&&(this._domElement.style.top="77px")}},ToolboxPropertiesUI.prototype._removeDOMEventListeners=function(){this.isMounted()&&this._closeButton.removeEventListener("mousedown",this._onClose),ToolboxPropertiesUI.__super__._removeDOMEventListeners.call(this)},ToolboxPropertiesUI.prototype._onClose=function(){if(this.isMounted())return this.hide()},ToolboxPropertiesUI.prototype._onDrag=function(ev){return ToolboxPropertiesUI.__super__._onDrag.call(this,ev)},ToolboxPropertiesUI.prototype._onStartDragging=function(ev){return ToolboxPropertiesUI.__super__._onStartDragging.call(this,ev)},ToolboxPropertiesUI.prototype._onStopDragging=function(ev){var rect=this._domElement.getBoundingClientRect();return window.localStorage.setItem("pbs-toolbox-elements-position",parseInt(rect.left,10)+","+parseInt(rect.top,10)+","+parseInt(rect.height,10)),ToolboxPropertiesUI.__super__._onStopDragging.call(this,ev)},ToolboxPropertiesUI.prototype.inspect=function(element){this._inspectElement(element),this.show(),this._contain(),setTimeout(function(){this._domElement.classList.contains("ct-widget--active")&&this._contain()}.bind(this),1e3)},ToolboxPropertiesUI.prototype._addTab=function(label,element){var tab=document.createElement("DIV");tab.classList.add("pbs-toolbox-tab"),tab.innerHTML=label,tab.setAttribute("data-name",element.constructor.name),this._domTabs.appendChild(tab),tab._targetElement=element,1===this._domTabs.children.length&&tab.classList.add("pbs-toolbox-tab-shown"),tab.addEventListener("click",function(){var visibleTab=this.parentNode.querySelector(".pbs-toolbox-tab-shown");visibleTab&&visibleTab.classList.remove("pbs-toolbox-tab-shown"),this.classList.add("pbs-toolbox-tab-shown");var visibleSection=this.parentNode.parentNode.querySelector(".pbs-toolbox-section-shown");visibleSection&&visibleSection.classList.remove("pbs-toolbox-section-shown"),this.parentNode.parentNode.querySelector('.pbs-toolbox-section[data-name="'+this.getAttribute("data-name")+'"]').classList.add("pbs-toolbox-section-shown")}.bind(tab))},ToolboxPropertiesUI.prototype._removeTab=function(name){var removeMe=this._domTabs.querySelector('[data-name="'+name+'"]');removeMe&&this._domTabs.removeChild(removeMe)},ToolboxPropertiesUI.prototype.addSection=function(label,element,optionIndex){this._addTab(label,element);var section=document.createElement("DIV");section.classList.add("pbs-toolbox-section"),section.setAttribute("data-name",element.constructor.name),this._domSections.appendChild(section),1===this._domSections.children.length&&section.classList.add("pbs-toolbox-section-shown"),"Shortcode"===element.constructor.name&&"undefined"==typeof PBSInspectorOptions.Shortcode[element.sc_base]&&"undefined"!=typeof pbsParams.shortcode_mappings&&"undefined"!=typeof pbsParams.shortcode_mappings[element.sc_base]&&this.createShortcodeMappingOptions&&this.createShortcodeMappingOptions(element.sc_base);var numWithGroups,numNoGroup,k,note,elemType=element.constructor.name;if("Shortcode"===elemType){var shortcodeBase=element.sc_base,shortcodeProperties=PBSInspectorOptions.Shortcode[shortcodeBase];if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.hidden&&shortcodeProperties.hidden)return;var heading;if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.options){for(numWithGroups=0,numNoGroup=0,k=0;k<shortcodeProperties.options.length;k++)shortcodeProperties.options[k].group?numWithGroups++:numNoGroup++;if(numWithGroups&&numNoGroup)for(k=0;k<shortcodeProperties.options.length;k++)shortcodeProperties.options[k].group||(shortcodeProperties.options[k].group=pbsParams.labels.general);for(k=0;k<shortcodeProperties.options.length;k++)this.addSectionOptions(section,shortcodeProperties.options[k],element);shortcodeProperties.options.length||(note=document.createElement("DIV"),note.innerHTML=pbsParams.labels.no_attributes_available,note.classList.add("pbs-shortcode-no-options"),section.appendChild(note))}else heading=document.createElement("DIV"),heading.innerHTML=pbsParams.labels.note_options_are_detected,section.appendChild(heading),this.addGenericShortcodeOptions(section,element);var shortcodeNote=document.createElement("DIV");shortcodeNote.classList.add("pbs-inspector-shortcode-note"),shortcodeNote.innerHTML=pbsParams.labels.note_shortcode_not_appearing,section.appendChild(shortcodeNote)}else if("undefined"!=typeof PBSInspectorOptions[optionIndex]){var currElemModel;for(element.model?(currElemModel=element.model,currElemModel.set("element",element)):currElemModel=new Backbone.Model({element:element}),numWithGroups=0,numNoGroup=0,k=0;k<PBSInspectorOptions[optionIndex].options.length;k++)PBSInspectorOptions[optionIndex].options[k].group?numWithGroups++:numNoGroup++;if(numWithGroups&&numNoGroup)for(k=0;k<PBSInspectorOptions[optionIndex].options.length;k++)PBSInspectorOptions[optionIndex].options[k].group||(PBSInspectorOptions[optionIndex].options[k].group=pbsParams.labels.general);for(k=0;k<PBSInspectorOptions[optionIndex].options.length;k++)this.addSectionOptions(section,PBSInspectorOptions[optionIndex].options[k],element,currElemModel);PBSInspectorOptions[optionIndex].onMouseEnter&&section.addEventListener("mouseenter",function(e){PBSInspectorOptions[optionIndex].onMouseEnter(this,e)}.bind(element)),PBSInspectorOptions[optionIndex].onMouseLeave&&section.addEventListener("mouseleave",function(e){PBSInspectorOptions[optionIndex].onMouseLeave(this,e)}.bind(element)),"undefined"!=typeof PBSInspectorOptions[optionIndex].footer&&Math.random()>.5&&(note=document.createElement("DIV"),note.innerHTML=PBSInspectorOptions[optionIndex].footer,note.classList.add("pbs-group-footer"),section.appendChild(note))}},ToolboxPropertiesUI.prototype.removeSection=function(name){this._removeTab(name);var removeMe=this._domSections.querySelector('[data-name="'+name+'"]');removeMe&&this._domSections.removeChild(removeMe)},ToolboxPropertiesUI.prototype.removeAllSections=function(){for(this.clearSections();this._domTabs.firstChild;)this._domTabs.removeChild(this._domTabs.firstChild);for(;this._domSections.firstChild;)this._domSections.removeChild(this._domSections.firstChild)},ToolboxPropertiesUI.prototype._inspectElement=function(element){for(this.removeAllSections();element.nodeType&&!element._ceElement&&"BODY"!==element.tagName;)this.addOptions(element),element=element.parentNode;element._ceElement&&(element=element._ceElement);for(var inspectedElementNames=[];element&&element.type;)inspectedElementNames.indexOf(element.constructor.name)===-1&&(this.addOptions(element),inspectedElementNames.push(element.constructor.name),"DivRow"===element.constructor.name&&inspectedElementNames.push("DivCol")),element=element.parent();if(pbsParams.is_lite){var groups=this._domElement.querySelectorAll("[data-collapse-group]");Array.prototype.forEach.call(groups,function(group){var numOptions=group.querySelectorAll(".pbs-tool-option:not(.pbs-collapsable-title)").length,numPremiumOptions=group.querySelectorAll(".pbs-tool-option.pbs-premium-flag").length,title=group.firstChild;numOptions>0&&numOptions===numPremiumOptions&&(title.classList.add("pbs-premium-flag"),title.parentNode.classList.add("pbs-premium-flag-container"))})}},ToolboxPropertiesUI.prototype.addOptions=function(element){var optionIndex=element.constructor.name,label=optionIndex;if(!window.PBSInspectorOptions[element.constructor.name]&&element.nodeType){var matched=!1;for(var index in window.PBSInspectorOptions)if(window.PBSInspectorOptions.hasOwnProperty(index)&&window.pbsSelectorMatches(element,index)){optionIndex=index,matched=!0;break}if(!matched)return}window.PBSInspectorOptions[optionIndex]&&(label=window.PBSInspectorOptions[optionIndex].label,"Shortcode"===element.constructor.name&&(label=element.constructor.name,"pbs_widget"===element.sc_base?label="Widget":"pbs_sidebar"===element.sc_base&&(label="Sidebar")),this.addSection(label,element,optionIndex))},ToolboxPropertiesUI.prototype.addOption=function(){},ToolboxPropertiesUI}(ContentTools.ToolboxUI),function(){var _EditorApp=ContentTools.EditorApp.getCls(),proxied=_EditorApp.prototype.init;_EditorApp.prototype.init=function(queryOrDOMElements,namingProp){proxied.call(this,queryOrDOMElements,namingProp),this._toolboxProperties=new ContentTools.ToolboxPropertiesUI([]),this.attach(this._toolboxProperties)};var unmountProxy=_EditorApp.prototype.unmount;_EditorApp.prototype.unmount=function(){unmountProxy.call(this),this.isMounted()&&(this._toolboxProperties=null)};var startProxy=_EditorApp.prototype.start;_EditorApp.prototype.start=function(){startProxy.call(this),this._toolboxProperties.isMounted()||this._toolboxProperties.mount()};var stopProxy=_EditorApp.prototype.stop;_EditorApp.prototype.stop=function(){stopProxy.call(this),this._toolboxProperties.hide()}}();var ready=function(){var editor=ContentTools.EditorApp.get();editor&&(editor.bind("start",function(){document.querySelector("#wp-admin-bar-pbs_page_templates").addEventListener("click",openPageTemplates),isBlankPage()&&document.querySelector("#wp-admin-bar-pbs_page_templates").dispatchEvent(new CustomEvent("click"))}),editor.bind("end",function(){document.querySelector("#wp-admin-bar-pbs_page_templates").removeEventListener("click",openPageTemplates)}))};!function(){"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),window.addEventListener("DOMContentLoaded",function(){if(document.querySelector('[data-name="main-content"]')){var editor=ContentTools.EditorApp.get(),stopBodyScroll=function(ev){var $=jQuery,$this=$(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=$this.height(),delta="DOMMouseScroll"===ev.type?ev.originalEvent.detail*-40:ev.originalEvent.wheelDelta,up=delta>0,prevent=function(){return ev.stopPropagation(),ev.preventDefault(),ev.returnValue=!1,!1};return!up&&-delta>scrollHeight-height-scrollTop?($this.scrollTop(scrollHeight),prevent()):up&&delta>scrollTop?($this.scrollTop(0),prevent()):void 0};editor.bind("start",function(){jQuery("body").on("DOMMouseScroll mousewheel",".pbs-toolbox-elements, .pbs-toolbox-sections",stopBodyScroll)}),editor.bind("stop",function(){jQuery("body").off("DOMMouseScroll mousewheel",".pbs-toolbox-elements, .pbs-toolbox-sections",stopBodyScroll)})}}),window.addEventListener("DOMContentLoaded",function(){document.addEventListener("mousedown",function(ev){window.PBSEditor.isEditing()&&window.pbsSelectorMatches(ev.target,'[data-name="main-content"] *, .pbs-quick-action-overlay, .pbs-quick-action-overlay *')&&ContentTools.EditorApp.get()._toolboxProperties.hide()}),document.addEventListener("keyup",function(ev){window.PBSEditor.isEditing()&&window.pbsSelectorMatches(ev.target,'[data-name="main-content"] *')&&[40,37,39,38,9,8,46,13].indexOf(ev.keyCode)!==-1&&ContentTools.EditorApp.get()._toolboxProperties.hide()}),ContentEdit.Root.get().bind("focus",function(){ContentTools.EditorApp.get()._toolboxProperties.hide()}),ContentEdit.Root.get().bind("blur",function(){}),ContentEdit.Root.get().bind("drag",function(){ContentTools.EditorApp.get()._toolboxProperties.hide()}),ContentEdit.Root.get().bind("drop",function(){ContentTools.EditorApp.get()._toolboxProperties.hide()})}),window.PBSEditor.createGroupTip=function(text){var tip=document.createElement("span");tip.classList.add("pbs-group-tip"),tip.innerHTML="?";var tipText=document.createElement("span");return tipText.classList.add("pbs-group-tip-details"),tipText.innerHTML=text,tip.appendChild(tipText),tip};var _pbsCreatedViews=[];ContentTools.ToolboxPropertiesUI.prototype.addSectionOptions=function(divGroup,option,element,model){"undefined"==typeof model&&(model=element.model);var matchesAnOptionType=null;"undefined"!=typeof option.type&&(matchesAnOptionType=Object.keys(PBSOption).some(function(name){return name.toLowerCase()===option.type.toLowerCase().replace(/_/g,"")})),matchesAnOptionType||(option.type="Text");var type=option.type.toLowerCase().replace(/_/g,"");for(optionName in PBSOption)if(PBSOption.hasOwnProperty(optionName)&&type===optionName.toLowerCase()){var id=optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();element.constructor.name&&(id=element.constructor.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-"+option.id);var optionWrapper=document.createElement("DIV");if(optionWrapper.classList.add("ct-tool"),"button"!==type&&optionWrapper.classList.add("pbs-tool-option"),option["class"]&&optionWrapper.setAttribute("class",optionWrapper.getAttribute("class")+" "+option["class"]),optionName&&optionWrapper.classList.add("pbs-"+optionName.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),option.id&&optionWrapper.setAttribute("id",id),option.group){var subGroupName=option.group.toLowerCase().trim().replace(/\"/g,""),subGroup=divGroup.querySelector('[data-subgroup="'+subGroupName+'"]');divGroup.classList.add("pbs-has-group"),subGroup||(subGroup=document.createElement("DIV"),subGroup.setAttribute("data-subgroup",subGroupName),divGroup.appendChild(subGroup),"default"!==option.group&&(subGroup.innerHTML='<div class="pbs-option-subtitle pbs-tool-option">'+option.group+"</div>",subGroup.firstChild.classList.add("pbs-collapsable-title"),subGroup.setAttribute("data-collapse-group",element.constructor.name.toLowerCase()),divGroup.querySelectorAll("[data-subgroup]").length>1&&window.pbsCollapseSection(subGroup))),subGroup.appendChild(optionWrapper),option["group-tip"]&&(subGroup.querySelector(".pbs-group-tip-details")?subGroup.querySelector(".pbs-group-tip-details").innerHTML=option["group-tip"]:subGroup.querySelector(".pbs-option-subtitle").appendChild(window.PBSEditor.createGroupTip(option["group-tip"])))}else{var firstSubGroup=divGroup.querySelector("[data-subgroup]");firstSubGroup?divGroup.insertBefore(optionWrapper,firstSubGroup):divGroup.appendChild(optionWrapper)}if(!wp.hooks.applyFilters("pbs.inspector.do_add_section_options",!0,optionName,model,divGroup,element,this))return;var o=new PBSOption[optionName]({optionSettings:option,model:model,el:optionWrapper});return pbsParams.is_lite&&o.dummy&&o.el.classList.add("pbs-premium-flag"),_pbsCreatedViews.push(o.render()),o.optionSettings&&"function"==typeof o.optionSettings.visible&&(o.optionSettings.visible(o.model.get("element"))?o.$el.show():o.$el.hide()),divGroup.view=o,void this.applyOptionDependencies(o)}},window.addEventListener("DOMContentLoaded",function(){wp.hooks.addAction("pbs.option.changed",function(){for(var i=0;i<_pbsCreatedViews.length;i++){var option=_pbsCreatedViews[i];option.optionSettings&&"function"==typeof option.optionSettings.visible&&(option.optionSettings.visible(option.model.get("element"))?option.$el.show():option.$el.hide())}})}),ContentTools.ToolboxPropertiesUI.prototype.applyOptionDependencies=function(view){if(view.optionSettings.depends){var depends=view.optionSettings.depends;"number"!=typeof depends.length&&(depends=[depends]),view.listenTo(view.model,"change",function(){for(var allConditions=[],i=0;i<depends.length;i++)if(depends[i].id&&depends[i].value){var id=depends[i].id,value=depends[i].value,currentValue=this.model.get(id),makeVisible=!1;if("string"==typeof value&&("__not_empty"===value.toLowerCase().trim()||"__empty"===value.toLowerCase().trim()||value.match(/^(>=?|<=?|==|!=)(.*)/)||(value=[value])),value===!1||"string"==typeof value&&"false"===value.toLowerCase().trim())"undefined"==typeof currentValue?makeVisible=!0:"string"==typeof currentValue&&"false"===currentValue.toLowerCase().trim()?makeVisible=!0:"string"==typeof currentValue&&""===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"!=typeof currentValue||currentValue?currentValue||(makeVisible=!0):makeVisible=!0;else if(value===!0||"string"==typeof value&&"true"===value.toLowerCase().trim())"string"==typeof currentValue&&"true"===currentValue.toLowerCase().trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue?makeVisible=!0:currentValue&&(makeVisible=!0);else if("object"==typeof value&&"number"==typeof value.length){var k,brokenByUnmatch=!1,onceMatched=!1,allNegatives=!0;for(k=0;k<value.length;k++)if(!value[k].match(/^!(.*)/)){allNegatives=!1;break}for(k=0;k<value.length;k++)if(value[k].match(/^!(.*)/)){var text=value[k].match(/^!(.*)/);if(text=text[1],text===currentValue){brokenByUnmatch=!0;break}}else if(value[k]===currentValue){onceMatched=!0;break}allNegatives&&!brokenByUnmatch?makeVisible=!0:!brokenByUnmatch&&onceMatched&&(makeVisible=!0)}else if("__not_empty"===value.toLowerCase().trim())"string"==typeof currentValue&&""!==currentValue.trim()?makeVisible=!0:"boolean"==typeof currentValue&&currentValue&&(makeVisible=!0);else if("__empty"===value.toLowerCase().trim())"undefined"==typeof currentValue?makeVisible=!0:""===currentValue.trim()&&(makeVisible=!0);else if(value.match(/^(>=?|<=?|==|!=)(.*)/)){var matches=value.match(/^(>=?|<=?|==|!=)(.*)/),operator=matches[1],num=matches[2];num=num.match(/\./)?parseFloat(num):parseInt(num,10),currentValue="undefined"==typeof currentValue?0:currentValue.match(/\./)?parseFloat(currentValue):parseInt(currentValue,10),makeVisible="<"===operator?currentValue<num:"<="===operator?currentValue<=num:">"===operator?currentValue>num:">="===operator?currentValue>=num:"!="===operator?currentValue!==num:currentValue===num}allConditions.push(makeVisible)}var allTrue=!0;for(i=0;i<allConditions.length;i++)allConditions[i]||(allTrue=!1);allTrue?this.$el.fadeIn():this.$el.fadeOut()}),view.model.trigger("change",view.model)}},ContentTools.ToolboxPropertiesUI.prototype.addGenericShortcodeOptions=function(divGroup,element){var view,keys,i,attributeName,hasOptions=!1;for(divGroup.classList.add("pbs-shortcode-generic"),keys=element.model.keys(),i=0;i<keys.length;i++)attributeName=keys[i],"content"!==attributeName&&(view=new PBSOption.GenericOption({attribute:attributeName,model:element.model}),_pbsCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0);if(element.model.get("content")&&(view=new PBSOption.GenericOption({attribute:"content",model:element.model}),_pbsCreatedViews.push(view.render()),divGroup.appendChild(view.el),hasOptions=!0),!hasOptions){var note=document.createElement("DIV");note.innerHTML=pbsParams.labels.shortcodes_not_attributes_detected,note.classList.add("pbs-shortcode-no-options"),divGroup.appendChild(note)}},ContentTools.ToolboxPropertiesUI.prototype._addSection=function(domElement){var currElem,i,k,group,heading,label,doneTypes=[];if(this._previouslySelectedElement!==domElement){if(this._newGroups=[],this._currentGroupIndex=0,"undefined"==typeof this._oldGroups){this._oldGroups=[];var editor=ContentTools.EditorApp.get();editor.bind("start",function(){this._oldGroups=[]}.bind(this))}if(this._previouslySelectedElement=domElement,"undefined"==typeof this._domInspectorGroups&&(this._domInspectorGroups=[]),domElement){for(var currDomElement=null;domElement;){if(domElement.tagName&&"DIV"!==domElement.tagName&&window.pbsSelectorMatches(domElement,'[data-name="main-content"] *')){currDomElement=domElement;break}domElement=domElement.parentNode}var matchedPattern="";if(label="",currDomElement)for(var pattern in PBSInspectorOptions)if(PBSInspectorOptions.hasOwnProperty(pattern))try{window.pbsSelectorMatches(domElement,pattern)&&(matchedPattern=pattern)}catch(err){}if(matchedPattern)for(PBSInspectorOptions[matchedPattern].label&&(label=PBSInspectorOptions[matchedPattern].label),label||(label=matchedPattern),group=this.constructor.createDiv(["ct-tool-group","pbs-inspector-group","pbs-dom-group"]),group.groupType=matchedPattern,heading=document.createElement("DIV"),heading.classList.add("pbs-group-title"),heading.classList.add("pbs-collapsable-title"),heading.classList.add("pbs-dom-title"),heading.innerHTML=pbsParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),currElemModel=new Backbone.Model({element:currDomElement}),i=0;i<PBSInspectorOptions[matchedPattern].options.length;i++)this.addSectionOptions(group,PBSInspectorOptions[matchedPattern].options[i],currDomElement,currElemModel)}var root=ContentEdit.Root.get(),element=root.focused();if(element){currElem=element;for(var hierarchy=[],finishedClasses=[];currElem&&"Region"!==currElem.constructor.name;)finishedClasses.indexOf(currElem.constructor.name)===-1&&(hierarchy.push(currElem),finishedClasses.push(currElem.constructor.name)),currElem=currElem.parent();var elem,note;for(i=0;i<hierarchy.length;i++)if("DivRow"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}for(i=0;i<hierarchy.length;i++)if("DivCol"===hierarchy[i].constructor.name){elem=hierarchy[i],hierarchy.splice(i,1),hierarchy.push(elem);break}var currElemModel,finishedElemTypes=[];for(i=0;i<hierarchy.length;i++){currElem=hierarchy[i];var groupClasses,shortcodeProperties,elemType=currElem.constructor.name;if(elemType=wp.hooks.applyFilters("pbs.inspector.elemtype",elemType,currElem),finishedElemTypes.indexOf(elemType)===-1){if(finishedElemTypes.push(elemType),"Shortcode"===elemType)label=currElem._domElement.getAttribute("data-base"),label=label.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()}),"undefined"==typeof PBSInspectorOptions.Shortcode[currElem.sc_base]&&"undefined"!=typeof pbsParams.shortcode_mappings&&"undefined"!=typeof pbsParams.shortcode_mappings[currElem.sc_base]&&this.createShortcodeMappingOptions&&this.createShortcodeMappingOptions(currElem.sc_base),"undefined"!=typeof PBSInspectorOptions.Shortcode[currElem.sc_base]&&"undefined"!=typeof PBSInspectorOptions.Shortcode[currElem.sc_base].label&&(label=PBSInspectorOptions.Shortcode[currElem.sc_base].label);else{if("undefined"==typeof PBSInspectorOptions[elemType]||doneTypes.indexOf(elemType)!==-1)continue;label=currElem.typeName(),PBSInspectorOptions[elemType].label&&(label=PBSInspectorOptions[elemType].label)}if(groupClasses=["ct-tool-group","pbs-inspector-group","pbs-"+currElem.cssTypeName()+"-group"],"Shortcode"===elemType&&groupClasses.push("pbs-shortcode-"+currElem.sc_base+"-group"),group=this.constructor.createDiv(groupClasses),group.groupType=elemType,heading=document.createElement("DIV"),heading.classList.add("pbs-group-title"),heading.classList.add("pbs-collapsable-title"),heading.classList.add("pbs-"+currElem.cssTypeName()+"-title"),heading.innerHTML=pbsParams.labels.inspector_title.replace("%s",label),group.insertBefore(heading,group.firstChild),wp.hooks.doAction("inspector.group_title.create",group),this.placeGroup(group),"Shortcode"===elemType){var shortcodeBase=currElem.sc_base;if(shortcodeProperties=PBSInspectorOptions.Shortcode[shortcodeBase],
"undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.hidden&&shortcodeProperties.hidden)continue;if("undefined"!=typeof shortcodeProperties&&"undefined"!=typeof shortcodeProperties.options){for(k=0;k<shortcodeProperties.options.length;k++)this.addSectionOptions(group,shortcodeProperties.options[k],currElem);if(shortcodeProperties.desc&&(heading.innerHTML+="<span>"+shortcodeProperties.desc+"</span>"),!shortcodeProperties.options.length){var note=document.createElement("DIV");note.innerHTML=pbsParams.labels.no_attributes_available,note.classList.add("pbs-shortcode-no-options"),group.appendChild(note)}}else this.addGenericShortcodeOptions(group,currElem),heading.innerHTML+="<span>"+pbsParams.labels.note_options_are_detected+"</span>";var shortcodeNote=document.createElement("DIV");shortcodeNote.classList.add("pbs-inspector-shortcode-note"),shortcodeNote.innerHTML=pbsParams.labels.note_shortcode_not_appearing,group.appendChild(shortcodeNote)}else{if("undefined"==typeof PBSInspectorOptions[elemType]||doneTypes.indexOf(elemType)!==-1)continue;for(currElem.model?(currElemModel=currElem.model,currElemModel.set("element",currElem)):currElemModel=new Backbone.Model({element:currElem}),k=0;k<PBSInspectorOptions[elemType].options.length;k++)this.addSectionOptions(group,PBSInspectorOptions[elemType].options[k],currElem,currElemModel);"undefined"!=typeof PBSInspectorOptions[elemType].footer&&Math.random()>.5&&(note=document.createElement("DIV"),note.innerHTML=PBSInspectorOptions[elemType].footer,note.classList.add("pbs-group-footer"),group.appendChild(note)),wp.hooks.doAction("pbs.inspector.add_section",group,label)}}}for(this.clearOldGroups();this._newGroups.length;)this._oldGroups.push(this._newGroups.pop())}}},ContentTools.ToolboxPropertiesUI.prototype.clearOldGroups=function(){for(var i=0;i<this._oldGroups.length;i++){var oldGroup=this._oldGroups[i];"undefined"!=typeof oldGroup.view,oldGroup.style.height=window.getComputedStyle(oldGroup).height,oldGroup.style.webkitTransition="height .3s ease-in-out",oldGroup.style.mozTransition="height .3s ease-in-out",oldGroup.style.msTransition="height .3s ease-in-out",oldGroup.style.transition="height .3s ease-in-out",oldGroup.style.overflow="hidden",oldGroup.offsetHeight,oldGroup.style.height=0,oldGroup.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.removeEventListener("transitionend",transitionEnd,!1),"undefined"!=typeof this.view&&this.view.remove(),this.parentNode.removeChild(this))}.bind(oldGroup),!1),setTimeout(function(){"undefined"!=typeof this.view&&this.view.remove(),this.parentNode&&this.parentNode.removeChild(this)}.bind(oldGroup),350)}this._oldGroups=[]},ContentTools.ToolboxPropertiesUI.prototype.clearSections=function(){for(;_pbsCreatedViews.length>0;){var o=_pbsCreatedViews.pop();o&&o.remove()}if(this._domInspectorGroups)for(;this._domInspectorGroups.length;){var elemToRemove=this._domInspectorGroups.shift();elemToRemove.parentNode.removeChild(elemToRemove)}this._previouslySelectedElement=null},ContentTools.ToolboxPropertiesUI.prototype.placeGroup=function(group){this._newGroups.push(group);for(var i=0;i<this._oldGroups.length;i++){var oldGroup=this._oldGroups[i];if(oldGroup.groupType===group.groupType){var startHeight=getComputedStyle(oldGroup).height;return group.style.overflow="hidden",group.style.height=startHeight,"undefined"!=typeof oldGroup.view&&oldGroup.view.remove(),this._domElement.replaceChild(group,oldGroup),this._currentGroupIndex=i+1,this._oldGroups.splice(i,1),void setTimeout(function(){this.style.height="auto";var endHeight=getComputedStyle(this).height;this.classList.contains("pbs-collapse")&&(endHeight=getComputedStyle(this.querySelector(".pbs-group-title")).height),this.style.height=startHeight,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight;var didTransition=!1;this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"),didTransition=!0,this.removeEventListener("transitionend",transitionEnd,!1))},!1),setTimeout(function(){!didTransition&&this&&(this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"))}.bind(this),350)}.bind(group),1)}}group.style.height=0,group.style.overflow="hidden",this._domElement.insertBefore(group,this._domElement.querySelectorAll(".ct-tool-group")[this._currentGroupIndex+1]),this._currentGroupIndex++,setTimeout(function(){this.style.height="auto";var endHeight=getComputedStyle(this).height;this.classList.contains("pbs-collapse")&&(endHeight=getComputedStyle(this.querySelector(".pbs-group-title")).height),this.style.height=0,this.offsetHeight,this.style.webkitTransition="height .3s ease-in-out",this.style.mozTransition="height .3s ease-in-out",this.style.msTransition="height .3s ease-in-out",this.style.transition="height .3s ease-in-out",this.style.overflow="hidden",this.style.height=endHeight,this.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(this.style.webkitTransition="",this.style.mozTransition="",this.style.msTransition="",this.style.transition="",this.classList.contains("pbs-collapse")||(this.style.height="auto",this.style.overflow="visible"),this.removeEventListener("transitionend",transitionEnd,!1))},!1)}.bind(group),1)},window.pbsElementsWithInspector=[],window.pbsAddInspector=function(elemName,args){if("object"==typeof args){var i,container=PBSInspectorOptions;if("object"!=typeof elemName){if("undefined"!=typeof args.is_shortcode&&args.is_shortcode?container=PBSInspectorOptions.Shortcode:window.pbsElementsWithInspector.indexOf(elemName)===-1&&window.pbsElementsWithInspector.push(elemName),"undefined"==typeof container[elemName])return void(container[elemName]=args);for(var argName in args)if(args.hasOwnProperty(argName))if("options"!==argName)container[elemName][argName]=args[argName];else{var options=args[argName];for(i=0;i<options.length;i++)container[elemName].options.push(options[i])}}else for(i=0;i<elemName.length;i++)window.pbsAddInspector(elemName[i],args)}},window.pbsRemoveInspector=function(elemName){var i,container=PBSInspectorOptions;if("object"!=typeof elemName)"undefined"!=typeof PBSInspectorOptions.Shortcode[elemName]&&(container=PBSInspectorOptions.Shortcode),"undefined"!=typeof container[elemName]&&delete container[elemName];else for(i=0;i<elemName.length;i++)window.pbsRemoveInspector(elemName[i])};var PBSInspectorOptions={Shortcode:{}};if(pbsParams.additional_shortcodes)for(var elemName in pbsParams.additional_shortcodes)pbsParams.additional_shortcodes.hasOwnProperty(elemName)&&(PBSInspectorOptions.Shortcode[elemName]=pbsParams.additional_shortcodes[elemName]);window.pbsCollapseSection=function(section){var classes;if(section.classList.contains("pbs-collapse")){if(section.getAttribute("data-collapse-group")){var openSections=document.querySelectorAll('[data-collapse-group="'+section.getAttribute("data-collapse-group")+'"]:not(.pbs-collapse)');Array.prototype.forEach.call(openSections,function(el){window.pbsCollapseSection(el)})}var prevHeight=section.style.height;section.style.height="auto";var endHeight=getComputedStyle(section).height;section.style.height=prevHeight,section.offsetHeight,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.style.height=endHeight,section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&(section.style.webkitTransition="",section.style.mozTransition="",section.style.msTransition="",section.style.transition="",section.style.height="auto",section.style.overflow="visible",section.removeEventListener("transitionend",transitionEnd,!1))},!1),section.classList.remove("pbs-collapse"),classes=section.getAttribute("class"),classes=classes.replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,"")}else section.style.height=window.getComputedStyle(section).height,section.style.webkitTransition="height .3s ease-in-out",section.style.mozTransition="height .3s ease-in-out",section.style.msTransition="height .3s ease-in-out",section.style.transition="height .3s ease-in-out",section.style.overflow="hidden",section.offsetHeight,section.style.height="38px",section.addEventListener("transitionend",function transitionEnd(event){"height"===event.propertyName&&section.removeEventListener("transitionend",transitionEnd,!1)},!1),section.classList.add("pbs-collapse"),classes=section.getAttribute("class"),classes=classes.replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,"")},window.pbsOpenAllSections=function(){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){el.classList.contains("pbs-collapse")&&window.pbsCollapseSection(el)})},window.pbsOnlyOpenSection=function(sectionClass){var sections=document.querySelectorAll(".ct-tool-group");Array.prototype.forEach.call(sections,function(el){sectionClass&&el.classList.contains(sectionClass)?el.classList.contains("pbs-collapse")&&window.pbsCollapseSection(el):el.classList.contains("pbs-collapse")||window.pbsCollapseSection(el)})},window.addEventListener("DOMContentLoaded",function(){document.querySelector('[data-name="main-content"]')&&document.addEventListener("click",function(ev){var section=ev.target;if(ev.target.classList.contains("pbs-collapsable-title"))section=ev.target.parentNode;else{if(!ev.target.parentNode)return;if(!ev.target.parentNode.classList)return;if(!ev.target.parentNode.classList.contains("pbs-collapsable-title"))return;section=ev.target.parentNode.parentNode}window.pbsCollapseSection(section)})}),wp.hooks.addAction("inspector.group_title.create",function(section){var classes=section.getAttribute("class");classes=classes.replace(/\s*(ct-tool-group|pbs-collapse|pbs-inspector-group)\s*/g,""),storedCollapsed.indexOf(classes)!==-1&&(section.classList.add("pbs-collapse"),setTimeout(function(){section.style.height=window.getComputedStyle(section.firstChild).height},1))}),function(){var proxied=ContentTools.Tools.Remove.apply;ContentTools.Tools.Remove.apply=function(element,selection,callback){document.activeElement&&["INPUT","TEXTAREA"].indexOf(document.activeElement.tagName)!==-1||proxied.call(element,selection,callback)}}();var PBSOption={},PBSBaseView=Backbone.View.extend({initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.optionSettings.visible&&(this._visibleBound=this._visible.bind(this),wp.hooks.addAction("pbs.option.changed",this._visibleBound),this._visible()),Backbone.View.prototype.initialize.call(this,options)},_visible:function(){this.optionSettings.visible(this.model.get("element"))?this.$el.show():this.$el.hide()},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="text"]').val()!==data.value&&this.$el.find('input[type="text"]').val(data.value):this.$el.html(this.template(data)),this},remove:function(){this.optionSettings.visible&&wp.hooks.removeAction("pbs.option.changed",this._visibleBound),Backbone.View.prototype.remove.apply(this)}});PBSOption.widgetSettings=Backbone.View.extend({className:"pbs-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged",'click input[type="radio"]':"attributeChanged",'click input[type="checkbox"]':"attributeChanged","change select":"attributeChanged","keyup select":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),"undefined"==typeof this.model.attributes.widget&&(this.model.attributes.widget="WP_Widget_Text"),this.template=wp.template("pbs-widget-"+this.model.attributes.widget)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);this.$el.html(this.template(data));var widgetInfo=pbsParams.widget_list[this.model.attributes.widget];for(var attributeName in this.model.attributes)if(this.model.attributes.hasOwnProperty(attributeName)){var option=this.el.querySelector("#widget-"+widgetInfo.id_base+"--"+attributeName);option&&("TEXTAREA"===option.tagName?option.value=this.model.attributes[attributeName].replace(/<br>/g,"\n"):"INPUT"===option.tagName&&"checkbox"===option.getAttribute("type")?this.model.attributes[attributeName]&&(option.checked=!0):option.value=this.model.attributes[attributeName])}var fields=this.el.querySelectorAll("[id^=widget-"+widgetInfo.id_base+"--");return Array.prototype.forEach.call(fields,function(el){this.attributeChanged({target:el})}.bind(this)),this},attributeChanged:function(e){var widgetInfo=pbsParams.widget_list[this.model.attributes.widget],attribute=e.target.getAttribute("id").replace("widget-"+widgetInfo.id_base+"--","");"INPUT"===e.target.tagName&&"checkbox"===e.target.getAttribute("type")?this.model.set(attribute,e.target.checked?e.target.value:""):this.model.set(attribute,e.target.value)}}),PBSOption.Button=PBSBaseView.extend({events:{click:"click",mouseenter:"mouseenter",mouseleave:"mouseleave",mousedown:"mousedown",mouseup:"mouseup"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),this.attribute=_.clone(options.attribute),this._canApplyUpdater()},render:function(){return this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name),this.optionSettings.render&&this.optionSettings.render(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this},click:function(){this.el.classList.contains("ct-tool--disabled")||(this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater(),this._canApplyUpdater(),this._selectedElement&&this._selectedElement.restoreState&&this._selectedElement.restoreState())},updateTooltip:function(value){if(value||(value=""),window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown){if(this.optionSettings["tooltip-reset"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-reset"].replace("{0}",value))}else if(window.PBSEditor.isCtrlDown){if(this.optionSettings["tooltip-down"])return void this.el.setAttribute("data-tooltip",this.optionSettings["tooltip-down"].replace("{0}",value))}else if(this.optionSettings.tooltip)return void this.el.setAttribute("data-tooltip",this.optionSettings.tooltip.replace("{0}",value));this.optionSettings.tooltip?this.el.setAttribute("data-tooltip",this.optionSettings.tooltip):this.optionSettings.name&&this.el.setAttribute("data-tooltip",this.optionSettings.name)},_tooltipUpdater:function(){this.optionSettings.tooltipValue&&this.model.get("element")?this.updateTooltip(this.optionSettings.tooltipValue(this.model.get("element"),this)):this.updateTooltip()},updateIsApplied:function(value){this.el.classList.remove("ct-tool--applied"),value&&this.el.classList.add("ct-tool--applied")},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&this.model.get("element")&&this.model.get("element")._domElement&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},_isAppliedUpdater:function(){this.optionSettings.isApplied&&this.model.get("element")&&this.model.get("element")._domElement&&this.updateIsApplied(this.optionSettings.isApplied(this.model.get("element"),this))},mouseenter:function(){this.optionSettings.mouseenter&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseenter(this.model.get("element"),this),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.add("ce-element--over"),this._tooltipUpdaterInterval=setInterval(this._tooltipUpdater.bind(this),100)},mouseleave:function(){this.optionSettings.mouseleave&&this.model.get("element")&&this.model.get("element")._domElement&&this.optionSettings.mouseleave(this.model.get("element"),this),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval)),this.model.get("element")&&this.model.get("element")._domElement&&this.model.get("element")._domElement.classList.remove("ce-element--over"),clearInterval(this._tooltipUpdaterInterval)},mousedown:function(){var root=ContentEdit.Root.get(),selectedElement=root.focused();selectedElement&&selectedElement.storeState&&selectedElement.storeState(),selectedElement&&(this._selectedElement=selectedElement),this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.optionSettings.hold(this.model.get("element"),this),this._tooltipUpdater(),this._isAppliedUpdater()}.bind(this),30)}.bind(this),500))},mouseup:function(){this.optionSettings.hold&&(clearTimeout(this._holdTimeout),clearInterval(this._holdInterval))}}),PBSOption.GenericOption=Backbone.View.extend({template:wp.template("pbs-shortcode-generic-option"),className:"pbs-tool-option",events:{"change input":"attributeChanged","keyup input":"attributeChanged","change textarea":"attributeChanged","keyup textarea":"attributeChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.attribute=_.clone(options.attribute),"content"===this.attribute&&(this.template=wp.template("pbs-shortcode-generic-content"))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.model.get(this.attribute),data.attr=this.attribute,this.$el.html(this.template(data)),this},attributeChanged:function(e){this.model.set(this.attribute,e.target.value)}}),PBSOption.Border=Backbone.View.extend({template:wp.template("pbs-option-border"),events:{"change select":"styleChanged","change .width":"widthChanged","keyup .width":"widthChanged","change .radius":"radiusChanged","keyup .radius":"radiusChanged","click .pbs-color-preview":"togglePicker","change .pbs-color-popup input":"colorChanged","keyup .pbs-color-popup input":"colorChanged"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound)},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);data.id=this.randomID;for(var styles=window.getComputedStyle(this.model.get("element")._domElement),stylesToAdd=["border-color","border-style","border-width","border-radius"],i=0;i<stylesToAdd.length;i++)this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});this.$el.html(this.template(data));var _this=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){_this.colorChanged()},clear:function(){},hide:!1,palettes:["#282425","#3d3a3b","#555152","#6b6969","#838181","#9b999a","#b4b1b2","#cccbcb","#e5e4e4","#ffffff","#fd3d3f","#f70363","#eb389a","#a812a9","#7330b0","#4b4bae","#1490ec","#00a4ed","#00bacf","#009586","#e1d6b8","#5b7b88","#7c554a","#fe5234","#fe9631","#fec03b","#fbec57","#c2dd52","#75c457","#12b059"]}),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),Backbone.View.prototype.remove.call(this)},colorChanged:function(){var inputColor=this.el.querySelector(".pbs-color-popup input").value,color=jQuery(this.el.querySelector("#"+this.randomID)).iris("color");"transparent"!==inputColor&&""!==inputColor||(color=inputColor),this.model.get("element").style("border-color",color),"transparent"===color&&(color=""),this.el.querySelector(".pbs-color-preview").style.background=color},styleChanged:function(e){this.model.get("element").style("border-style",e.target.value);var newBorder="0px";"none"!==e.target.value&&(newBorder="1px");var allBordersZero=!0;parseInt(this.model.get("border-top-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-right-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-bottom-width"),10)&&(allBordersZero=!1),parseInt(this.model.get("border-left-width"),10)&&(allBordersZero=!1),(allBordersZero&&"none"!==e.target.value||"none"===e.target.value)&&(this.model.set("border-top-width",newBorder),this.model.set("border-right-width",newBorder),this.model.set("border-bottom-width",newBorder),this.model.set("border-left-width",newBorder),this.model.get("element").style("border-width",newBorder),this.model.trigger("change",this.model))},widthChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-width",value)},radiusChanged:function(e){var value=e.target.value;isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style("border-radius",value)},togglePicker:function(){"block"===this.el.querySelector(".pbs-color-popup").style.display?this.el.querySelector(".pbs-color-popup").style.display="":this.el.querySelector(".pbs-color-popup").style.display="block"},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""}}),PBSOption.Color=PBSBaseView.extend({template:wp.template("pbs-option-color"),events:{mouseenter:"mouseenter",mouseleave:"mouseleave","change input":"selectChanged","keyup input":"selectChanged","click .pbs-color-preview":"togglePicker","mousedown .iris-square-handle":"mousedownPicker","mouseup .iris-square-handle":"mouseupPicker","click .iris-square-handle":"irisHandleClick"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),this.randomID=this.optionSettings.id+"-"+_.random(0,1e4),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element"))),this._hidePickerBound=this.hidePicker.bind(this),document.querySelector(".ct-toolbox").addEventListener("mouseleave",this._hidePickerBound),this._canApplyUpdater()},_canApplyUpdater:function(){this.el.classList.remove("ct-tool--disabled"),this.optionSettings.canApply&&(this.optionSettings.canApply(this.model.get("element"),this)||this.el.classList.add("ct-tool--disabled"))},updateColor:function(color){this.el.querySelector(".pbs-color-preview").style.background!==color&&(this.el.querySelector(".pbs-color-preview").style.background=color,this.el.querySelector("input").value=color,jQuery("#"+this.randomID).iris("color",color))},irisHandleClick:function(ev){ev.preventDefault()},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);data.id=this.randomID,this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html(this.template(data));var _this=this;return jQuery("#"+this.randomID).iris({defaultColor:!0,change:function(){return _this._justInit?void _this.selectChanged():void(_this._justInit=!0)},clear:function(){},hide:!1,palettes:["#282425","#3d3a3b","#555152","#6b6969","#838181","#9b999a","#b4b1b2","#cccbcb","#e5e4e4","#ffffff","#fd3d3f","#f70363","#eb389a","#a812a9","#7330b0","#4b4bae","#1490ec","#00a4ed","#00bacf","#009586","#e1d6b8","#5b7b88","#7c554a","#fe5234","#fe9631","#fec03b","#fbec57","#c2dd52","#75c457","#12b059"]}),this._canApplyUpdater(),this},remove:function(){jQuery("#"+this.randomID).iris("destroy"),document.querySelector(".ct-toolbox").removeEventListener("mouseleave",this._hidePickerBound),PBSBaseView.prototype.remove.call(this)},selectChanged:function(forceColor){var input=this.el.querySelector("input"),color=jQuery(input).iris("color");forceColor&&(color=input.value),""!==input.value&&"transparent"!==input.value||(color=input.value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),color,this),this.optionSettings.id&&this.model.set(this.optionSettings.id,color),"transparent"===color&&(color=""),this.el.querySelector(".pbs-color-preview").style.background=color,wp.hooks.doAction("pbs.option.changed")},togglePicker:function(){if(window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown){var input=this.el.querySelector("input");return input.value="",this.selectChanged(),void jQuery("#"+this.randomID).iris("color","transparent")}var popup=this.el.querySelector(".pbs-color-popup"),otherPopups=document.querySelectorAll(".pbs-color-popup");Array.prototype.forEach.call(otherPopups,function(el){el!==popup&&(el.style.display="")}),"block"===popup.style.display?popup.style.display="":(wp.hooks.doAction("pbs.tool.popup.open"),popup.style.display="block"),wp.hooks.addAction("pbs.tool.popup.open",function(){popup.style.display=""}.bind(this))},hidePicker:function(){this.el.querySelector(".pbs-color-popup").style.display=""},mouseenter:function(){this.optionSettings.mouseenter&&this.optionSettings.mouseenter(this.model.get("element"),this)},mouseleave:function(){this.optionSettings.mouseleave&&this.optionSettings.mouseleave(this.model.get("element"),this)},mousedownPicker:function(){ContentTools.EditorApp.get().history.stopWatching()},mouseupPicker:function(){ContentTools.EditorApp.get().history.watch()}}),PBSOption.ColorButton=PBSOption.Color.extend({}),PBSOption.Select=PBSBaseView.extend({template:wp.template("pbs-option-select"),events:{"change select":"selectChanged"},initialize:function(options){if(PBSBaseView.prototype.initialize.call(this,options),this.listenTo(this.model,"change",this.render),this.optionSettings.value)this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")));else{var value=this.model.element.model.attributes[this.optionSettings.id]||"";this.model.set(this.optionSettings.id,value)}},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element"),this):data.value=this.model.element.model.attributes[this.optionSettings.id]||"",this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value),wp.hooks.doAction("pbs.option.changed")}}),PBSOption.Checkbox=PBSBaseView.extend({template:wp.template("pbs-option-checkbox"),events:{"change input":"selectChanged"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),"undefined"==typeof this.optionSettings.checked&&(this.optionSettings.checked=!0),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="checkbox"]')[0].checked=data.value===this.optionSettings.checked:this.$el.html(this.template(data)),this},selectChanged:function(e){var value=!1;this.optionSettings.unchecked&&(value=this.optionSettings.unchecked),e.target.checked&&(value=!0,this.optionSettings.checked&&(value=this.optionSettings.checked)),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),value,this),this.model.set(this.optionSettings.id,value),wp.hooks.doAction("pbs.option.changed")},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),PBSOption.Text=PBSBaseView.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged","click input":"click"},initialize:function(options){PBSBaseView.prototype.initialize.call(this,options),this.listenTo(this.model,"change",this.render),this.optionSettings.value&&this.model.set(this.optionSettings.id,this.optionSettings.value(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value="",this.optionSettings.value?data.value=this.optionSettings.value(this.model.get("element")):this.optionSettings.id&&(data.value=this.model.get(this.optionSettings.id)),this.$el.html()?this.$el.find('input[type="text"]').val()!==data.value&&this.$el.find('input[type="text"]').val(data.value):this.$el.html(this.template(data)),this},selectChanged:function(e){this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),e.target.value,this),this.model.set(this.optionSettings.id,e.target.value),wp.hooks.doAction("pbs.option.changed")},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value)}}),PBSOption.Textarea=PBSOption.Text.extend({template:wp.template("pbs-option-textarea"),events:{"change textarea":"selectChanged","keyup textarea":"selectChanged","click textarea":"click"}}),PBSOption.Number=PBSOption.Text.extend({template:wp.template("pbs-option-number"),render:function(){var value,input;if(this.$el.html()){if(this.optionSettings.value){value=this.optionSettings.value(this.model.get("element"));var slider=this.$el.find(".pbs-option-number-slider");input=this.$el.find("input"),slider.slider("value").toString()!==value.toString()&&slider.slider("value",value),input.val(value)}return this}return this.optionSettings.value&&(input=this.$el.find("input"),value=this.optionSettings.value(this.model.get("element")),input.val(value)),PBSOption.Number.__super__.render.call(this),input=this.$el.find("input"),this.$el.find(".pbs-option-number-slider").slider({max:parseFloat(input.attr("max")),min:parseFloat(input.attr("min")),step:parseFloat(input.attr("step")),value:input.val(),animate:"fast",change:function(event,ui){clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(ui){var input=this.$el.find("input");ui.value!==input.val()&&input.val(ui.value).trigger("change")}.bind(this,ui),60)}.bind(this),slide:function(event,ui){clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(ui){var input=this.$el.find("input");ui.value!==input.val()&&input.val(ui.value).trigger("change")}.bind(this,ui),60)}.bind(this)}).disableSelection(),this},selectChanged:function(e){PBSOption.Number.__super__.selectChanged.call(this,e);var slider=this.$el.find(".pbs-option-number-slider"),input=this.$el.find("input"),inputVal=input.val();"keyup"===e.type&&""!==inputVal&&slider.slider("value").toString()!==input.val().toString()&&slider.slider("value",input.val()),""===inputVal&&input.val(""),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),inputVal,this),wp.hooks.doAction("pbs.option.changed")}}),PBSOption.File=PBSOption.Text.extend({template:wp.template("pbs-option-file"),multiple:!1,events:{"change input":"selectChanged","click button":"openImagePicker"},openImagePicker:function(){var frame=wp.media({title:pbsParams.labels.s_attribute.replace("%s",this.optionSettings.name),
multiple:this.multiple,button:{text:pbsParams.labels.select_file}});return frame.on("open",function(){}.bind(this)),frame.on("select",function(){var selection=frame.state().get("selection"),value="";selection.each(function(attachment){"undefined"!=typeof attachment.attributes.url&&(value=attachment.attributes.url)}.bind(this)),this.$el.find('input[type="text"]').val(value),this.model.set(this.optionSettings.id,value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),value,this),wp.hooks.doAction("pbs.option.changed"),frame.off("select")}.bind(this)),frame.open(),!1}}),PBSOption.Image=PBSOption.Text.extend({template:wp.template("pbs-option-image"),multiple:!1,events:{"change input":"selectChanged","click .pbs-image-preview":"openImagePicker","click .pbs-image-preview-remove":"removeImage"},render:function(){var ajaxToGetImageURL=!1;this.$el.html()||(ajaxToGetImageURL=!0);var ret=PBSOption.Image.__super__.render.call(this);if(ajaxToGetImageURL){var imageIDsToAjaxLoad="";this.$el.find('.pbs-image-preview:not([data-id=""])').each(function(){var imageID=this.getAttribute("data-id");return imageID.match(/^[\d,]+$/)?void(PBSOption.Image._imageURLs.hasOwnProperty(imageID)?this.style.backgroundImage="url("+PBSOption.Image._imageURLs[imageID]+")":(imageIDsToAjaxLoad+=imageIDsToAjaxLoad?",":"",imageIDsToAjaxLoad+=imageID)):void(this.style.backgroundImage=imageID.match(/url\(/)?imageID:"url("+imageID+")")}),imageIDsToAjaxLoad&&PBSOption.Image.doAjaxToGetImageURLs(imageIDsToAjaxLoad)}return ret},openImagePicker:function(){var frame=wp.media({title:pbsParams.labels.s_attribute.replace("%s",this.optionSettings.name),multiple:this.multiple,library:{type:"image"},button:{text:pbsParams.labels.select_image}});return frame.on("open",function(){var imageIDs=this.model.get(this.optionSettings.id)||"";imageIDs=imageIDs.split(",");for(var selection=frame.state().get("selection"),i=0;i<imageIDs.length;i++){var attachment=wp.media.attachment(imageIDs[i]);selection.add(attachment?[attachment]:[])}}.bind(this)),frame.on("select",function(){var selection=frame.state().get("selection"),value="";this.$el.find(".pbs-image-preview").remove();var attachmentURLs=[],attachmentIDs=[],useURLs=!1;"undefined"!=typeof this.optionSettings.urls&&this.optionSettings.urls&&(useURLs=!0),selection.each(function(attachment){if("undefined"!=typeof attachment.attributes.sizes){var image=attachment.attributes.sizes.full;"undefined"!=typeof attachment.attributes.sizes.medium&&(image=attachment.attributes.sizes.medium),jQuery("<div></div>").addClass("pbs-image-preview").css("backgroundImage","url("+image.url+")").attr("data-id",attachment.id).attr("data-url",attachment.attributes.sizes.full.url).append(jQuery("<div></div>").addClass("pbs-image-preview-remove")).appendTo(this.$el),attachmentURLs.push(attachment.attributes.sizes.full.url),attachmentIDs.push(attachment.id),value+=value?",":"",value+=useURLs?attachment.attributes.sizes.full.url:attachment.id,PBSOption.Image._imageURLs[attachment.id]=image.url}}.bind(this)),this.model.set(this.optionSettings.id,value),this.optionSettings.change&&this.optionSettings.change(this.model.get("element"),useURLs?attachmentURLs:attachmentIDs,useURLs?attachmentIDs:attachmentURLs,this),wp.hooks.doAction("pbs.option.changed"),frame.off("select")}.bind(this)),frame.open(),!1},removeImage:function(e){var value="",removeMe=e.target.parentNode.getAttribute("data-id"),useURLs=!1;"undefined"!=typeof this.optionSettings.urls&&this.optionSettings.urls&&(useURLs=!0);var attachmentIDs=[],attachmentURLs=[];return this.multiple&&this.$el.find(".pbs-image-preview").each(function(){this.getAttribute("data-id")!==removeMe&&(value+=value?",":"",value+=this.getAttribute("data-id"),attachmentIDs.push(this.getAttribute("data-id")),attachmentURLs.push(this.getAttribute("data-url")?this.getAttribute("data-url"):this.getAttribute("data-id")))}),e.target.parentNode.parentNode.removeChild(e.target.parentNode),(!this.multiple||this.multiple&&!this.$el.find(".pbs-image-preview").length)&&jQuery("<div></div>").addClass("pbs-image-preview").attr("data-id","").appendTo(this.$el),this.model.set(this.optionSettings.id,value),this.optionSettings.remove&&this.optionSettings.remove(this.model.get("element"),useURLs?attachmentURLs:attachmentIDs,this),wp.hooks.doAction("pbs.option.changed"),!1}}),PBSOption.Image._imageURLs={},PBSOption.Image.doAjaxToGetImageURLs=function(imageIDs){"undefined"==typeof PBSOption.Image._imageIDsToAjax&&(PBSOption.Image._imageIDsToAjax=""),imageIDs.match(/^[\d,]+$/)&&(PBSOption.Image._imageIDsToAjax+=PBSOption.Image._imageIDsToAjax?",":"",PBSOption.Image._imageIDsToAjax+=imageIDs,clearTimeout(PBSOption.Image._doAjaxToGetImageURLsTimeout),PBSOption.Image._doAjaxToGetImageURLsTimeout=setTimeout(function(){PBSOption.Image._doAjaxToGetImageURLs()},50))},PBSOption.Image._doAjaxToGetImageURLs=function(){var imageIDs=PBSOption.Image._imageIDsToAjax||"";imageIDs=imageIDs.split(",");for(var i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").addClass("pbs-loading");var payload=new FormData;payload.append("action","pbs_get_attachment_urls"),payload.append("image_ids",PBSOption.Image._imageIDsToAjax),payload.append("nonce",pbsParams.nonce);var request=new XMLHttpRequest;request.open("POST",pbsParams.ajax_url),request.onload=function(){var i,response;if(request.status>=200&&request.status<400)try{for(response=JSON.parse(request.responseText),i=0;i<imageIDs.length;i++)"undefined"!=typeof response[imageIDs[i]]?(jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").css("backgroundImage","url("+response[imageIDs[i]]+")"),PBSOption.Image._imageURLs[imageIDs[i]]=response[imageIDs[i]]):jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").addClass("pbs-ajax-error")}catch(e){for(i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").addClass("pbs-ajax-error")}for(i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").removeClass("pbs-loading");PBSOption.Image._imageIDsToAjax=""},request.onerror=function(){for(var i=0;i<imageIDs.length;i++)jQuery(".pbs-tool-option .pbs-image-preview[data-id="+imageIDs[i]+"]").removeClass("pbs-loading");PBSOption.Image._imageIDsToAjax=""},request.send(payload)},PBSOption.Images=PBSOption.Image.extend({multiple:"toggle"}),PBSOption.MarginsAndPaddings=Backbone.View.extend({template:wp.template("pbs-option-margins-and-paddings"),events:{"keyup input":"inputChanged","change input":"inputChanged","blur input":"fixBlankValue","keydown input":"incrementDecrementValue"},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.listenTo(this.model,"change",this.render)},render:function(){for(var element=this.model.get("element")._domElement,styles=window.getComputedStyle(element),stylesToAdd=["margin-top","margin-right","margin-bottom","margin-left","border-top-width","border-right-width","border-bottom-width","border-left-width","padding-top","padding-right","padding-bottom","padding-left"],i=0;i<stylesToAdd.length;i++)element.style[stylesToAdd[i]]?this.model.set(stylesToAdd[i],element.style[stylesToAdd[i]],{silent:!0}):this.model.set(stylesToAdd[i],styles[stylesToAdd[i]],{silent:!0});"full-width-retain-content"===element.getAttribute("data-width")||"full-width"===element.getAttribute("data-width")?("full-width-retain-content"===this.model.get("width")?this.model.set("disableHorizontalPaddings",!0):this.model.unset("disableHorizontalPaddings"),"full-width-retain-content"===this.model.get("width")||"full-width"===this.model.get("width")?this.model.set("disableHorizontalMargins",!0):this.model.unset("disableHorizontalMargins")):(this.model.unset("disableHorizontalPaddings"),this.model.unset("disableHorizontalMargins"));var data=_.extend({},this.model.attributes,this.optionSettings);return this.$el.html(this.template(data)),this},inputChanged:function(e){var value=e.target.value,styleName=e.target.getAttribute("data-style");isNaN(value)||""===value.trim()||(value+="px"),this.model.get("element").style(styleName,value),this.model.set(styleName,value,{silent:!0})},incrementDecrementValue:function(e){var regex=/^(\-?\d+)([^\d]*)$/,match=regex.exec(e.target.value);!match||38!==e.which&&40!==e.which||(38===e.which?(match[1]++,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]++,match[1]++,match[1]++,match[1]++)):(match[1]--,(e.ctrlKey||e.metaKey||e.shiftKey)&&(match[1]--,match[1]--,match[1]--,match[1]--)),e.target.value=match[1]+match[2],e.target.dispatchEvent(new CustomEvent("change")))},fixBlankValue:function(e){var style=e.target.getAttribute("data-style"),styleCamel=style.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()}),cssValue=this.model.get("element")._domElement.style[styleCamel];if(!cssValue){var values=window.getComputedStyle(this.model.get("element")._domElement);cssValue=values[style]}e.target.value=cssValue,this.model.set(style,cssValue,{silent:!0})}}),PBSOption.CustomClass=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getClasses:function(){var element=this.model.get("element");if("undefined"==typeof element.attr("class"))return"";var classes=element.attr("class");if(this.optionSettings.ignoredClasses){var currentClasses=classes.trim().split(" ");classes="",this.staticClasses=[];for(var staticClassRegex=new RegExp(this.optionSettings.ignoredClasses,"i"),i=0;i<currentClasses.length;i++)staticClassRegex.test(currentClasses[i])?this.staticClasses.push(currentClasses[i]):(classes+=0===classes.length?"":" ",classes+=currentClasses[i])}return classes},change:function(element,value){var i;if(value=value.toLowerCase(),"undefined"!=typeof element.attr("class")){var currentClasses=element.attr("class").split(" ");for(i=0;i<currentClasses.length;i++)element.removeCSSClass(currentClasses[i])}if(""!==value.trim()){var newClasses=value.trim().split(" ");for(i=0;i<newClasses.length;i++)element.addCSSClass(newClasses[i])}if(this.staticClasses.length)for(i=0;i<this.staticClasses.length;i++)element.addCSSClass(this.staticClasses[i]);element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getClasses(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getClasses(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),PBSOption.CustomID=Backbone.View.extend({template:wp.template("pbs-option-text"),events:{"change input":"selectChanged","keyup input":"selectChanged"},getID:function(){var element=this.model.get("element");return"undefined"==typeof element.attr("id")?"":element.attr("id")},change:function(element,value){element.attr("id",value),element.taint()},initialize:function(options){this.optionSettings=_.clone(options.optionSettings),this.staticClasses=[],this.optionSettings.initialize&&this.optionSettings.initialize(this.model.get("element"),this),this.listenTo(this.model,"change",this.render),this.model.set(this.optionSettings.id,this.getID(this.model.get("element")))},render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);return data.value=this.getID(this.model.get("element")),this.$el.html(this.template(data)),this},selectChanged:function(e){this.change(this.model.get("element"),e.target.value),this.model.set(this.optionSettings.id,e.target.value)}}),PBSOption.Button2=PBSBaseView.extend({template:wp.template("pbs-option-button2"),events:{'click input[type="button"]':"click"},render:function(){if(!this.$el.html()){var data=_.extend({},this.model.attributes,this.optionSettings);this.$el.html(this.template(data))}return this.optionSettings.disabled&&(this.optionSettings.disabled(this.model.get("element"),this)?this.$el.find('[type="button"]').removeAttr("disabled"):this.$el.find('[type="button"]').attr("disabled","disabled")),this},click:function(e){this.optionSettings.click&&this.optionSettings.click(this.model.get("element"),e.target.value,this)}}),PBSOption.Dummy=PBSBaseView.extend({dummy:!0,template:wp.template("pbs-dummy-option-text"),render:function(){var data=_.extend({},this.model.attributes,this.optionSettings);this.$el.html()||this.$el.html(this.template(data))}}),PBSOption.TextDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-text")}),PBSOption.NumberDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-number")}),PBSOption.ColorDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-color")}),PBSOption.SelectDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-select")}),PBSOption.CheckboxDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-checkbox")}),PBSOption.Button2Dummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-button2")}),PBSOption.ImageDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-image")}),PBSOption.TextareaDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-textarea")}),PBSOption.FileDummy=PBSOption.Dummy.extend({template:wp.template("pbs-dummy-option-file")});var options=[];options.push({name:pbsParams.labels.border_radius,type:"number",step:"1",min:"0",max:"1000",initialize:function(element){this.max=parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px")}},{name:pbsParams.labels.shadows,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.shadows},{name:pbsParams.labels.shadow_strength,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.shadows}),window.pbsAddInspector("Image",{label:pbsParams.labels.image,options:options});var options=[];options.push({name:pbsParams.labels.icon_frame_change_title,button:pbsParams.labels.pick_an_icon,type:"button2",group:pbsParams.labels.general,click:function(element){PBSEditor.iconFrame.open({title:pbsParams.labels.choose_icon,button:pbsParams.labels.choose_icon,successCallback:function(frameView){element.change(frameView.selected.firstChild)}})}},{name:pbsParams.labels.link,type:pbsParams.is_lite?"textDummy":"text",placeholder:"http://",desc:pbsParams.labels.desc_icon_url,group:pbsParams.labels.general},{name:pbsParams.labels.icon_color,type:"color",group:pbsParams.labels.general,value:function(element){return element._domElement.style.fill},change:function(element,value){element.style("fill",value),element.removeFills()}}),options.push({name:pbsParams.labels.background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.general},{name:pbsParams.labels.padding,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general},{name:pbsParams.labels.border_radius,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general},{name:pbsParams.labels.tooltip_text,type:pbsParams.is_lite?"textDummy":"text",desc:pbsParams.labels.desc_icon_tooltip,group:pbsParams.labels.tooltip},{name:pbsParams.labels.tooltip_location,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.tooltip},{name:pbsParams.labels.background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tooltip},{name:pbsParams.labels.text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tooltip},{name:pbsParams.labels.toggle_shadow,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.tooltip},{name:pbsParams.labels.width,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tooltip},{name:pbsParams.labels.padding,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tooltip},{name:pbsParams.labels.border_radius,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tooltip}),window.pbsAddInspector("Icon",{label:pbsParams.labels.icon,onMouseEnter:function(element){element._addCSSClass("ce-element--over")},onMouseLeave:function(element){element._removeCSSClass("ce-element--over")},options:options}),window.pbsAddInspector("pbs_widget",{is_shortcode:!0,label:pbsParams.labels.widget,desc:pbsParams.labels.widget_inspector_desc,options:[{type:"widgetSettings"}]}),window.pbsAddInspector("pbs_sidebar",{is_shortcode:!0,label:pbsParams.labels.sidebar,desc:pbsParams.labels.sidebar_inspector_desc,options:[{type:"select",name:pbsParams.labels.select_a_sidebar,id:"id",options:pbsParams.sidebar_list,desc:pbsParams.sidebar_label_id}]});var options=[];options.push({name:pbsParams.labels.row_width,desc:pbsParams.labels.desc_row_width,type:"select",group:pbsParams.labels.general,options:{"":pbsParams.labels.normal_width,"full-width-retain-content":pbsParams.labels.full_width_retained_content_width,"full-width":pbsParams.labels.full_width},getRootRow:function(element){for(var rootRow=element,currElem=element._domElement;currElem&&currElem._ceElement;)currElem.classList.contains("pbs-row")&&(rootRow=currElem._ceElement),currElem=currElem.parentNode;return rootRow},value:function(element){return element._domElement.getAttribute("data-width")||""},render:function(element,view){var rootRow=view.optionSettings.getRootRow(element),val=rootRow._domElement.getAttribute("data-width");val||(val=""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),"full-width"===val?view.el.classList.add("full"):"full-width-retain-content"===val&&view.el.classList.add("full-retain"),view.model.set(view.optionSettings.id,val)},change:function(element,value,view){var rootRow=view.optionSettings.getRootRow(element);rootRow.style("margin-left",""),rootRow.style("margin-right",""),rootRow.style("padding-left",""),rootRow.style("padding-right",""),view.el.classList.remove("full"),view.el.classList.remove("full-retain"),"full-width"===value?view.el.classList.add("full"):"full-width-retain-content"===value&&view.el.classList.add("full-retain"),rootRow.attr("data-width",value),window._pbsFixRowWidth(rootRow._domElement),rootRow.taint(),view.model.set(view.optionSettings.id,value)}},{name:pbsParams.labels.full_height,type:"checkbox",group:pbsParams.labels.general,value:function(element){return"100vh"===element._domElement.style["min-height"]},change:function(element,value){element.style("min-height",value?"100vh":"")}},{name:pbsParams.labels.background_color,type:"color",group:pbsParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.render)},value:function(element){return element._domElement.style.backgroundColor||""},change:function(element,value){var bgImage=element._domElement.style["background-image"],url=bgImage.match(/url\([^\)]+\)/i)||"";element.style("background-color",value),bgImage.indexOf("gradient")!==-1&&element.style("background-image","linear-gradient("+value+", "+value+"), "+url)}},{name:pbsParams.labels.background_image,type:"image",group:pbsParams.labels.background,value:function(element){if(element._domElement.style.backgroundImage){var matches=element._domElement.style.backgroundImage.match(/url\([^,$]+/);return matches?matches[0]:element._domElement.style.backgroundImage}return""},change:function(element,attachmentIDs,attachmentURLs){for(var backgrounds="",i=0;i<attachmentURLs.length;i++)backgrounds+=backgrounds?",":"",backgrounds+="url("+attachmentURLs[i]+")";var background=element.style("background-image");background.match(/url\(/)?(background=background.replace(/url\([^\)]+\)/,backgrounds),element.style("background-image",background)):element.style("background-image",backgrounds)},remove:function(element,attachmentIDs,view){element.style("background-image",""),view.model.set("background-image","")}}),options.push({name:pbsParams.labels.toggle_background_image_tint,desc:pbsParams.labels.desc_background_tint,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.background},{name:pbsParams.labels.background_size,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_background_size,group:pbsParams.labels.background},{options:{"":pbsParams.labels.normal_background_image,fixed:pbsParams.labels.fixed_background_image,parallax:pbsParams.labels.parallax_image,kenburns:"Ken Burns Slider",video:pbsParams.labels.video_background_youtube_vimeo,"video-html5":pbsParams.labels.video_background_uploaded},name:pbsParams.labels.background_image_type,desc:pbsParams.labels.desc_background_image_type,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.background},{name:pbsParams.labels.parallax,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_parallax,group:pbsParams.labels.background},{placeholder:"http://",name:pbsParams.labels.video_background,type:pbsParams.is_lite?"textDummy":"text",desc:pbsParams.labels.desc_video_background,group:pbsParams.labels.background},{name:pbsParams.labels.webm_video,type:pbsParams.is_lite?"fileDummy":"file",desc:pbsParams.labels.desc_webm_video,group:pbsParams.labels.background},{name:pbsParams.labels.mp4_video,type:pbsParams.is_lite?"fileDummy":"file",desc:pbsParams.labels.desc_mp4_video,group:pbsParams.labels.background},{name:pbsParams.labels.kenburns_images,type:pbsParams.is_lite?"imageDummy":"images",desc:pbsParams.labels.desc_kenburns_images,group:pbsParams.labels.background,urls:!0},{name:pbsParams.labels.text_color,desc:pbsParams.labels.note_overridden_by_elements,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.general},{name:pbsParams.labels.column_gap,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general}),options.push({name:pbsParams.labels.border_style,type:"select",group:pbsParams.labels.borders,options:{"":pbsParams.labels.none,solid:pbsParams.labels.solid,dashed:pbsParams.labels.dashed,dotted:pbsParams.labels.dotted},value:function(element){return element._domElement.style["border-style"]},change:function(element,value,view){element.style("border-style",value),value?(""!==element._domElement.style["border-width"]&&"transparent"!==element._domElement.style["border-width"]||(element.style("border-width","1px"),view.model.set("border-width","1")),""!==element._domElement.style["border-color"]&&"0px"!==element._domElement.style["border-color"]||(element.style("border-color","#000000"),view.model.set("border-color","#000000"))):(element.style("border-width",""),element.style("border-color",""),view.model.set("border-width",""),view.model.set("border-color",""))}},{name:pbsParams.labels.border_color,type:"color",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.render)},value:function(element){return element._domElement.style.borderColor||""},change:function(element,value){element.style("border-color",value)}},{name:pbsParams.labels.border_thickness,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"20",initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},value:function(element){var size=parseInt(element._domElement.style["border-width"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-width",value+"px")}},{name:pbsParams.labels.border_radius,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"1000",initialize:function(element){this.max=parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px")}}),options.push({name:pbsParams.labels.shadows,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.shadows},{name:pbsParams.labels.shadow_strength,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.shadows},{name:pbsParams.labels.overflow_hidden,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_overflow_hidden}),window.pbsAddInspector("DivRow",{label:pbsParams.labels.row,options:options}),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){for(var row=null;element&&"Region"!==element.constructor.name;)"DivRow"===element.constructor.name&&(row=element),element=element.parent();row&&"none"===row.style("border-style")&&("0px"!==row.style("border-width")&&row.style("border-width",""),""!==row.style("border-color")&&row.style("border-color",""))})});var options=[];options.push({name:pbsParams.labels.background_color,type:"color",group:pbsParams.labels.background,initialize:function(element,view){view.listenTo(view.model,"change:background-color",view.render)},value:function(element){return element._domElement.style.backgroundColor||""},change:function(element,value){var bgImage=element._domElement.style["background-image"],url=bgImage.match(/url\([^\)]+\)/i)||"";element.style("background-color",value),bgImage.indexOf("gradient")!==-1&&element.style("background-image","linear-gradient("+value+", "+value+"), "+url)}},{name:pbsParams.labels.background_image,type:"image",group:pbsParams.labels.background,value:function(element){if(element._domElement.style.backgroundImage){var matches=element._domElement.style.backgroundImage.match(/url\([^,$]+/);return matches?matches[0]:element._domElement.style.backgroundImage}return""},change:function(element,attachmentIDs,attachmentURLs){for(var backgrounds="",i=0;i<attachmentURLs.length;i++)backgrounds+=backgrounds?",":"",backgrounds+="url("+attachmentURLs[i]+")";var background=element.style("background-image");background.match(/url\(/)?(background=background.replace(/url\([^\)]+\)/,backgrounds),element.style("background-image",background)):element.style("background-image",backgrounds)},remove:function(element,attachmentIDs,view){element.style("background-image",""),view.model.set("background-image","")}}),options.push({name:pbsParams.labels.toggle_background_image_tint,desc:pbsParams.labels.desc_background_tint,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.background},{name:pbsParams.labels.background_size,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_background_size,group:pbsParams.labels.background},{name:pbsParams.labels.content_orientation,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_content_orientation,group:pbsParams.labels.alignment},{name:pbsParams.labels.vertical_column_alignment,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_vertical_column_alignment,group:pbsParams.labels.alignment},{name:pbsParams.labels.vertical_content_alignment,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_vertical_content_alignment,group:pbsParams.labels.alignment},{name:pbsParams.labels.horizontal_content_alignment,type:pbsParams.is_lite?"selectDummy":"select",desc:pbsParams.labels.desc_horizontal_content_alignment,group:pbsParams.labels.alignment},{name:pbsParams.labels.border_style,type:"select",group:pbsParams.labels.borders,options:{"":pbsParams.labels.none,solid:pbsParams.labels.solid,dashed:pbsParams.labels.dashed,dotted:pbsParams.labels.dotted},value:function(element){return element._domElement.style["border-style"]},change:function(element,value,view){element.style("border-style",value),value?(""!==element._domElement.style["border-width"]&&"transparent"!==element._domElement.style["border-width"]||(element.style("border-width","1px"),view.model.set("border-width","1")),""!==element._domElement.style["border-color"]&&"0px"!==element._domElement.style["border-color"]||(element.style("border-color","#000000"),view.model.set("border-color","#000000"))):(element.style("border-width",""),element.style("border-color",""),view.model.set("border-width",""),view.model.set("border-color",""))}},{name:pbsParams.labels.border_color,type:"color",group:pbsParams.labels.borders,initialize:function(element,view){view.listenTo(view.model,"change:border-color",view.render)},value:function(element){return element._domElement.style.borderColor||""},change:function(element,value){element.style("border-color",value)}},{name:pbsParams.labels.border_thickness,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"20",initialize:function(element,view){view.listenTo(view.model,"change:border-width",view.render)},value:function(element){var size=parseInt(element._domElement.style["border-width"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-width",value+"px")}},{name:pbsParams.labels.border_radius,type:"number",group:pbsParams.labels.borders,step:"1",min:"0",max:"1000",initialize:function(element){this.max=parseInt(parseInt(element._domElement.getBoundingClientRect().height,10)/2+1,10)},value:function(element){var size=parseInt(element._domElement.style["border-radius"],10);return isNaN(size)?0:size},change:function(element,value){element.style("border-radius",value+"px")}}),options.push({name:pbsParams.labels.shadows,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.shadows},{name:pbsParams.labels.shadow_strength,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.shadows},{name:pbsParams.labels.overflow_hidden,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_overflow_hidden}),window.pbsAddInspector("DivCol",{label:pbsParams.labels.column,options:options}),window.addEventListener("DOMContentLoaded",function(){ContentEdit.Root.get().bind("blur",function(element){for(var col=null;element&&"Region"!==element.constructor.name;)"DivCol"===element.constructor.name&&(col=element),element=element.parent();col&&"none"===col.style("border-style")&&("0px"!==col.style("border-width")&&col.style("border-width",""),""!==col.style("border-color")&&col.style("border-color",""))})}),window.pbsAddInspector("List",{label:pbsParams.labels.list,options:[{name:pbsParams.labels.font_size,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general},{name:pbsParams.labels.line_height,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.general},{name:pbsParams.labels.bullet_icon,button:pbsParams.labels.pick_an_icon,type:pbsParams.is_lite?"button2Dummy":"button2",group:pbsParams.labels.bullet},{name:pbsParams.labels.reset_bullet_icon,button:pbsParams.labels.remove_icon,type:pbsParams.is_lite?"button2Dummy":"button2",group:pbsParams.labels.bullet},{name:pbsParams.labels.border_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.bullet},{name:pbsParams.labels.icon_size,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.bullet}]}),ContentTools.ToolboxUI.prototype.createShortcodeMappingOptions=function(shortcodeTag){var map=pbsParams.shortcode_mappings[shortcodeTag],name=map.name;name||(name=shortcodeTag),name=name.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()});var i,opts,value,label,attributes=[],typesDone=[];for(var attribute in map.attributes){var options=map.attributes[attribute];if(options.desc=options.description||"",options.id=options.attribute,options.type_orig=options.type,options.first_of_type=typesDone.indexOf(options.type)===-1,typesDone.push(options.type),"iframe"===options.type&&(options.attribute=""),"undefined"!=typeof options.name&&options.name||(options.name=options.attribute,options.name=options.name.replace(/[-_]/g," ").replace(/\b[a-z]/g,function(letter){return letter.toUpperCase();
})),pbsParams.is_lite)if("color"===options.type)options.type="text";else if("dropdown_post"===options.type)options.type="text";else if("dropdown_post_type"===options.type)options.type="text";else if("boolean"===options.type)options.type="text";else if("number"===options.type)options.type="text";else if("dropdown"===options.type)options.type="text";else if("select"===options.type)options.type="text";else if("iframe"===options.type)continue;if("boolean"===options.type)options.type="checkbox",options.checked=options.extra_boolean_checked||"true",options.unchecked=options.extra_boolean_unchecked||"false";else if("number"===options.type)options.min=options.extra_num_min||0,options.max=options.extra_num_max||1e3,options.step=options.extra_num_step||1;else if("multicheck"===options.type)for(options.options={},opts=options.extra_dropdown.split(/\n/)||{},i=0;i<opts.length;i++)value=opts[i].substr(0,opts[i].indexOf(",")),label=opts[i].substr(opts[i].indexOf(",")+1),options.options[value]=label;else if("multicheck_post_type"===options.type)options.type="multicheck",options.options=pbsParams.post_types;else if("dropdown"===options.type)for(options.type="select",options.options={"":" "+pbsParams.labels.select_one+" "},opts=options.extra_dropdown.split(/\n/)||{},i=0;i<opts.length;i++)value=opts[i].substr(0,opts[i].indexOf(",")),label=opts[i].substr(opts[i].indexOf(",")+1),options.options[value]=label;else if("dropdown_post_type"===options.type){options.type="select",options.options={"":" "+pbsParams.labels.select_a_post_type+" "};for(i in pbsParams.post_types)options.options[i]=pbsParams.post_types[i]}else if("dropdown_post"===options.type)options.type="select_post",options.post_type=options.extra||"post";else if("dropdown_db"===options.type)options.type="select_db",options.db_table=options.extra_db_table||"posts",options.db_field_id=options.extra_db_value||"ID",options.db_field_label=options.extra_db_label||"post_title",options.db_where_column=options.extra_db_where_field,options.db_where_value=options.extra_db_where_value;else if("iframe"===options.type){if(options.url=options.extra_url,!options.url)continue;options.button=options.extra_button||pbsParams.labels.open}else"content"===options.type&&(options.type="textarea");attributes.push(options)}window.pbsAddInspector(shortcodeTag,{is_shortcode:!0,label:name,desc:map.description||"",options:attributes})};var options=[];options.push({name:pbsParams.labels.latitude_longitude_and_address,type:"text",desc:pbsParams.labels.latitude_longitude_desc,initialize:function(element,view){view.listenTo(view.model,"change:data-center",view.render)},value:function(element){return element.attr("data-center")},change:_.debounce(function(element,value,view){if(element.attr("data-center")!==value){element.attr("data-center",value),view.$el.find("input").removeClass("pbs-option-error");var center=value.trim()||"37.09024, -95.712891";element._domElement.map.marker&&(element._domElement.map.marker.setMap(null),delete element._domElement.map.marker);var latLonMatch=center.match(/^([-+]?\d{1,2}([.]\d+)?)\s*,?\s*([-+]?\d{1,3}([.]\d+)?)$/);if(latLonMatch)element.attr("data-lat",latLonMatch[1]),element.attr("data-lng",latLonMatch[3]),center={lat:parseFloat(latLonMatch[1]),lng:parseFloat(latLonMatch[3])},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}));else{var geocoder=new google.maps.Geocoder;geocoder.geocode({address:center},function(results,status){status===google.maps.GeocoderStatus.OK?(element.attr("data-lat",results[0].geometry.location.lat()),element.attr("data-lng",results[0].geometry.location.lng()),center={lat:results[0].geometry.location.lat(),lng:results[0].geometry.location.lng()},element._domElement.map.setCenter(center),element.attr("data-marker-image")?element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map,icon:element.attr("data-marker-image")}):element.attr("data-marker")&&(element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map}))):view.$el.find("input").addClass("pbs-option-error")})}}},300)},{name:pbsParams.labels.map_controls,type:"checkbox",value:function(element){return!element._domElement.getAttribute("data-disable-ui")},change:function(element,value){element.attr("data-disable-ui",value?"1":""),element._domElement.map.setOptions({disableDefaultUI:!value})}},{name:pbsParams.labels.map_marker,type:"checkbox",value:function(element){return!!element._domElement.getAttribute("data-marker")},change:function(element,value){element._domElement.map.marker&&(element._domElement.map.marker.setMap(null),delete element._domElement.map.marker),value?(element.attr("data-marker","1"),element._domElement.map.marker=new google.maps.Marker({position:element._domElement.map.getCenter(),map:element._domElement.map})):(element.attr("data-marker",""),element.attr("data-marker-image",""))}}),options.push({name:pbsParams.labels.custom_map_marker,type:pbsParams.is_lite?"imageDummy":"image"},{name:pbsParams.labels.tint_map,type:pbsParams.is_lite?"colorDummy":"color"},{name:pbsParams.labels.custom_map_styles,type:pbsParams.is_lite?"textareaDummy":"textarea",desc:pbsParams.labels.custom_map_styles_desc}),window.pbsAddInspector("Map",{label:pbsParams.labels.map,options:options});var options=[];options.push({name:pbsParams.labels.vertical_tabs,type:pbsParams.is_lite?"checkboxDummy":"checkbox"},{name:pbsParams.labels.tab_alignment,type:pbsParams.is_lite?"selectDummy":"select"},{name:pbsParams.labels.tab_style,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.border_thickness,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.border_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.border_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.active_tab_background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.active_tab_text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.inactive_tab_text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.tab_content_background_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles},{name:pbsParams.labels.tab_content_text_color,type:pbsParams.is_lite?"colorDummy":"color",group:pbsParams.labels.tab_styles}),window.pbsAddInspector("Tabs",{label:pbsParams.labels.tabs,options:options});var options=[];options.push({name:pbsParams.labels.count_up_numbers,desc:pbsParams.labels.desc_count_up_number,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.count_up},{name:pbsParams.labels.count_up_time,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_count_up_time,group:pbsParams.labels.count_up},{name:pbsParams.labels.count_up_delay,type:pbsParams.is_lite?"numberDummy":"number",desc:pbsParams.labels.desc_count_up_delay,group:pbsParams.labels.count_up}),window.pbsAddInspector("Text",{label:pbsParams.labels.text,options:options});var options=[];options.push({name:pbsParams.labels.animation,type:pbsParams.is_lite?"selectDummy":"select",group:pbsParams.labels.animation,desc:pbsParams.labels.desc_animation},{name:pbsParams.labels.animation_speed,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.animation,desc:pbsParams.labels.in_milliseconds},{name:pbsParams.labels.animation_start_delay,type:pbsParams.is_lite?"numberDummy":"number",group:pbsParams.labels.animation,desc:pbsParams.labels.desc_animation_start_delay},{name:pbsParams.labels.elastic_animation,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.animation,desc:pbsParams.labels.desc_elastic_animation},{name:pbsParams.labels.play_animation_once,type:pbsParams.is_lite?"checkboxDummy":"checkbox",group:pbsParams.labels.animation,desc:pbsParams.labels.desc_play_animation_once},{name:pbsParams.labels.custom_class,type:pbsParams.is_lite?"textDummy":"text",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_custom_class},{name:pbsParams.labels.custom_id,type:pbsParams.is_lite?"textDummy":"text",group:pbsParams.labels.advanced,desc:pbsParams.labels.desc_custom_id});for(var i=0;i<window.pbsElementsWithInspector.length;i++)ContentEdit[window.pbsElementsWithInspector[i]]&&window.pbsAddInspector(window.pbsElementsWithInspector[i],{options:options});ContentTools.Tools.ElementButton=function(_super){function ElementButton(){return ElementButton.__super__.constructor.apply(this,arguments)}return __extends(ElementButton,_super),ElementButton.canApply=function(){return!0},ElementButton.isApplied=function(){return!1},ElementButton}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.disabled;ContentTools.ToolUI.prototype.disabled=function(disabledState){if(!this._domElement.classList.contains("pbs-tool-large"))return proxied.call(this,disabledState)};var proxied2=ContentTools.ToolUI.prototype._onMouseUp;ContentTools.ToolUI.prototype._onMouseUp=function(ev){return this._domElement.classList.contains("pbs-tool-large")?(this._mouseDown=!1,this.removeCSSClass("ct-tool--down")):proxied2.call(this,ev)}}(),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);if(this.tool.buttonName){this._domElement.classList.add("pbs-tool-large");var label=document.createElement("div");label.classList.add("pbs-tool-title"),label.textContent=this.tool.buttonName,this._domElement.appendChild(label)}return ret}}(),ContentTools.Tools.Heading._canApply=ContentTools.Tools.Heading.canApply,ContentTools.Tools.Heading.canApply=function(element,selection){var origReturn=ContentTools.Tools.Heading._canApply(element,selection);return"ListItemText"!==element.constructor.name&&(void 0!==element.content&&element.parent().tagName?origReturn||"div"===element.parent().tagName():origReturn)},ContentTools.Tools.Paragraph.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.UnorderedList.canApply=function(element,selection){var ret=ContentTools.Tools.Bold.canApply(element,selection);return!(!element.parent()||!element.parent().tagName||"li"!==element.parent().tagName())||ret},ContentTools.Tools.OrderedList.canApply=ContentTools.Tools.UnorderedList.canApply,ContentTools.Tools.UnorderedList.isApplied=function(element,selection){return!!(element.parent()&&element.parent().parent()&&element.parent().parent().tagName&&element.parent().parent().tagName()===this.listTag)},ContentTools.Tools.OrderedList.isApplied=ContentTools.Tools.UnorderedList.isApplied,function(){var proxied=ContentTools.Tools.UnorderedList.apply;ContentTools.Tools.UnorderedList.apply=function(element,selection,callback){if(!this.isApplied(element)){if("ListItem"===element.parent().type()||element.content){var ret=proxied.call(this,element,selection,callback);return element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element),ret}var listItemText=new ContentEdit.ListItemText(""),listItem=new ContentEdit.ListItem;listItem.attach(listItemText);var list=new ContentEdit.List(this.listTag,{});return list.attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),callback(!0)}element.parent().unindent()}}(),function(){var proxied=ContentTools.Tools.OrderedList.apply;ContentTools.Tools.OrderedList.apply=function(element,selection,callback){if(!this.isApplied(element)){if("ListItem"===element.parent().type()||element.content){var ret=proxied.call(this,element,selection,callback);return element.parent()&&"ListItem"===element.parent().type()&&ContentEdit.Root.get().trigger("focus",element),ret}var listItemText=new ContentEdit.ListItemText(""),listItem=new ContentEdit.ListItem;listItem.attach(listItemText);var list=new ContentEdit.List(this.listTag,{});return list.attach(listItem),element.parent().attach(list,element.parent().children.indexOf(element)+1),listItemText.focus(),callback(!0)}element.parent().unindent()}}(),ContentTools.Tools.Preformatted.canApply=function(element,selection){return ContentTools.Tools.Heading1.canApply(element,selection)},function(){var proxied=ContentTools.Tools.Preformatted.apply;ContentTools.Tools.Preformatted.apply=function(element,selection,callback){if(!this.isApplied(element)){if(!element.content){var heading=new ContentEdit.Text(this.tagName);return element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0)}return proxied.call(this,element,selection,callback)}}}(),ContentTools.Tools.Preformatted.isApplied=function(element){return element.tagName()===this.tagName},ContentTools.Tools.Bold.canApply=function(element,selection){return!!element.content&&selection},ContentTools.Tools.Bold.isApplied=function(element,selection){var _ref,from=0,to=0;if(void 0===element.content||!element.content.length())return!1;selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to),fontWeight=styledString.getStyle("font-weight",element);if(styledString.hasTags("strong",!0)||styledString.hasTags("b",!0))return!0;var fontWeightNum=parseInt(fontWeight,10);return isNaN(fontWeightNum)?"bold"===fontWeight:fontWeightNum>400},ContentTools.Tools.Bold.apply=function(element,selection,callback){this.tagName="span";var _ref,from=0,to=0;element.storeState(),selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to);if(styledString.hasTags("strong",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("strong"));else if(styledString.hasTags("b",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("b"));else{var fontWeight=styledString.getStyle("font-weight",element);if(fontWeight=fontWeight&&"normal"!==fontWeight?isNaN(parseInt(fontWeight,10))?"normal":parseInt(fontWeight,10)<=400?"bold":"normal":"bold","normal"===fontWeight){var defaultFontWeight=element.defaultStyle("font-weight");isNaN(parseInt(defaultFontWeight,10))||parseInt(defaultFontWeight,10)<400&&(fontWeight=defaultFontWeight)}var newStyle={"font-weight":fontWeight};element.content=element.content.style(from,to,element._tagName,newStyle)}return element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Italic.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},ContentTools.Tools.Italic.isApplied=function(element,selection){var _ref,from=0,to=0;if(void 0===element.content||!element.content.length())return!1;selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to),fontStyle=styledString.getStyle("font-style",element);return!(!styledString.hasTags("em",!0)&&!styledString.hasTags("i",!0))||"italic"===fontStyle},ContentTools.Tools.Italic.apply=function(element,selection,callback){this.tagName="span";var _ref,from=0,to=0;element.storeState(),selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length());var styledString=element.content.substring(from,to);if(styledString.hasTags("em",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("em"));else if(styledString.hasTags("i",!0))element.content=element.content.unformat(from,to,new HTMLString.Tag("i"));else{var fontStyle=styledString.getStyle("font-style",element);fontStyle=fontStyle&&"normal"!==fontStyle?"normal":"italic";var newStyle={"font-style":fontStyle};element.content=element.content.style(from,to,element._tagName,newStyle)}return element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ContentTools.Tools.Link.isApplied=function(element,selection){if("Image"===element.constructor.name)return element.a;if(selection){var from,to,_ref;return!(void 0===element.content||!element.content.length())&&(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0))}},function(){var proxied=ContentTools.Tools.Paragraph.apply;ContentTools.Tools.Paragraph.apply=function(element,selection,callback){var app,forceAdd,paragraph,region;if(app=ContentTools.EditorApp.get(),forceAdd=app.ctrlDown(),ContentTools.Tools.Heading.canApply(element)&&!forceAdd);else if("DivCol"===element.parent().constructor.name||"Div"===element.parent().constructor.name)return region=element.parent(),paragraph=new ContentEdit.Text("p"),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0);return proxied.call(this,element,selection,callback)}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseDown;ContentTools.ToolUI.prototype._onMouseDown=function(ev){var ret=proxied.call(this,ev);if(!this.tool.doHold)return ret;clearTimeout(this._holdTimeout),clearInterval(this._holdInterval);var interval=30;this.tool.holdInterval&&(interval=this.tool.holdInterval);var element,selection;if(this._mouseDown){if(element=ContentEdit.Root.get().focused(),!element||!element.isMounted())return;selection=null,element.selection&&(selection=element.selection()),this._holdTimeout=setTimeout(function(){this._holdInterval=setInterval(function(){this.tool.doHold(element,selection)}.bind(this),interval)}.bind(this),500)}return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._onMouseUp;ContentTools.ToolUI.prototype._onMouseUp=function(ev){return clearTimeout(this._holdTimeout),clearInterval(this._holdInterval),proxied.call(this,ev)}}(),ContentTools.Tool.refreshTooltip=function(value){var buttonElement=window.PBSEditor.getToolUI(this.icon)._domElement;value||(value="");var tooltip;tooltip=window.PBSEditor.isCtrlDown&&window.PBSEditor.isShiftDown?this.labelReset.replace("{0}",value):window.PBSEditor.isCtrlDown?this.labelDown.replace("{0}",value):this.label.replace("{0}",value),buttonElement.getAttribute("data-tooltip")!==tooltip&&buttonElement.setAttribute("data-tooltip",tooltip)},function(){ContentTools.Tools.Table.apply;ContentTools.Tools.Table.apply=function(element,selection,callback){},ContentTools.Tools.Table.premium=!0,ContentTools.Tools.Table.buttonName=pbsParams.labels.table,ContentTools.Tools.Table.label=pbsParams.labels.table}(),ContentTools.Tools.AddElementButton=function(_super){function AddElementButton(){return AddElementButton.__super__.constructor.apply(this,arguments)}return __extends(AddElementButton,_super),AddElementButton.isAddElementButton=!0,AddElementButton.listTool="",AddElementButton.icon="add-element-button",AddElementButton.canApply=function(){return!0},AddElementButton.isApplied=function(){if(this.listTool){var tool=window.PBSEditor.getToolUI(this.listTool);if(tool)return"block"===tool._domElement.style.display}return!1},AddElementButton.apply=function(element,selection,callback){return callback(!0)},AddElementButton}(ContentTools.Tool),ContentTools.Tools.AddElementList=function(_super){function AddElementList(){return AddElementList.__super__.constructor.apply(this,arguments)}return __extends(AddElementList,_super),AddElementList.type="design-elements-list",AddElementList.icon="design-elements-list",AddElementList.label="",AddElementList.populateList=function(domToolContainer){},AddElementList.addClickedItem=function(domItemClicked,elemFocused){},AddElementList.canApply=function(){return!0},AddElementList.isApplied=function(){return!1},AddElementList.toggleList=function(){this._ceElement._domElement.style.display?this.hideList():this.showList()},AddElementList.init=function(){var toolDomElement=this._ceElement._domElement;if(!toolDomElement.children.length){toolDomElement.classList.add("pbs-add-element-list"),this.populateList(toolDomElement);for(var i=0;i<toolDomElement.children.length;i++){var el=toolDomElement.children[i];el.classList.add("pbs-add-element-list-item"),el.setAttribute("data-search-terms",el.textContent.trim().toLowerCase()),el.addEventListener("click",this._onClick.bind(this))}var elem=document.createElement("INPUT");elem.setAttribute("type","search"),elem.setAttribute("placeholder","Type to search..."),toolDomElement.insertBefore(elem,toolDomElement.firstChild),elem.addEventListener("keyup",this._doSearch.bind(this)),elem=document.createElement("SPAN"),elem.classList.add("pbs-add-element-list-none-found"),elem.innerHTML="Nothing found",toolDomElement.insertBefore(elem,toolDomElement.firstChild)}},AddElementList._onClick=function(e){var root=ContentEdit.Root.get();if(root.focused()){for(var currTarget=e.target;!currTarget.classList.contains("pbs-add-element-list-item")&&currTarget.parentNode;)currTarget=currTarget.parentNode;this.addClickedItem(currTarget,root.focused())}},AddElementList.showList=function(){this._ceElement._domElement.style.display="block";var search=this._ceElement._domElement.querySelector('[type="search"]');search.focus(),search.select()},AddElementList.hideList=function(){this._ceElement._domElement.style.display=""},AddElementList._doSearch=function(ev){var elements,searchString=ev.target.value.trim().toLowerCase(),noneFoundLabel=this._ceElement._domElement.querySelector(".pbs-add-element-list-none-found");return noneFoundLabel.style.display="none",""===searchString?(elements=ev.target.parentNode.querySelectorAll("[data-search-terms]"),void Array.prototype.forEach.call(elements,function(el){el.style.display=""})):(elements=ev.target.parentNode.querySelectorAll("[data-search-terms]"),Array.prototype.forEach.call(elements,function(el){el.style.display="none"}),elements=ev.target.parentNode.querySelectorAll('[data-search-terms*="'+searchString+'"]'),Array.prototype.forEach.call(elements,function(el){el.style.display=""}),void(elements.length||(noneFoundLabel.style.display="block")))},AddElementList}(ContentTools.Tool),function(){var proxied=ContentTools.ToolboxUI.prototype.mount;ContentTools.ToolboxUI.prototype.mount=function(){var ret=proxied.call(this);for(var i in this._toolUIs)this._toolUIs.hasOwnProperty(i)&&this._toolUIs[i].tool.init&&this._toolUIs[i].tool.init();return ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){if(this.tool.__super__&&"AddElementButton"===this.tool.__super__.constructor.name)this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){if(e.target.classList.contains("ct-tool")){var tool=window.PBSEditor.getToolUI(this.tool.listTool);"undefined"!=typeof tool&&tool.tool.toggleList()}}.bind(this));else{if(!this.tool.__super__||"AddElementList"!==this.tool.__super__.constructor.name)return proxied.call(this);this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()})}}}(),ContentTools.Tools.Shortcode=function(_super){function Shortcode(){return Shortcode.__super__.constructor.apply(this,arguments)}return __extends(Shortcode,_super),ContentTools.ToolShelf.stow(Shortcode,"shortcode"),Shortcode.label=pbsParams.labels.shortcode,Shortcode.icon="shortcode",Shortcode.tagName="shortcode",Shortcode.buttonName=pbsParams.labels.shortcode,Shortcode.apply=function(element,selection,callback){var parent=null,index=0,root=ContentEdit.Root.get();if(root.focused())parent=root.focused().parent(),index=parent.children.indexOf(root.focused())+1;else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(parent=mainRegion.children[0].parent())}return this.createNew(parent,index),callback(!0)},Shortcode.createNew=function(parent,index){PBSEditor.shortcodeFrame.open({title:pbsParams.labels.insert_shortcode,button:pbsParams.labels.insert_shortcode,successCallback:function(view){var elem,base=view.selected.getAttribute("data-shortcode-tag"),shortcodeRaw=this.createInsertedShortcode(base),shortcode=wp.shortcode.next(base,shortcodeRaw,0),isMapped=pbsParams.shortcode_mappings[base];elem=isMapped?ContentEdit.Shortcode.createShortcode(shortcode):new ContentEdit.Text("p",{},shortcode.shortcode.string()),parent.attach(elem,index),isMapped?elem.ajaxUpdate(!0):(elem.origShortcode="",elem.origInnerHTML="",elem.isShortcodeEditing=!0),elem.focus()}.bind(this)})},Shortcode.createInsertedShortcode=function(base){var scData={tag:base,type:"closed",content:"",attrs:{}};if("undefined"==typeof PBSInspectorOptions.Shortcode[base]&&"undefined"!=typeof pbsParams.shortcode_mappings&&"undefined"!=typeof pbsParams.shortcode_mappings[base]){var editor=ContentTools.EditorApp.get();editor._toolbox.createShortcodeMappingOptions&&editor._toolbox.createShortcodeMappingOptions(base)}if(PBSInspectorOptions.Shortcode[base]&&PBSInspectorOptions.Shortcode[base].options)for(var i=0;i<PBSInspectorOptions.Shortcode[base].options.length;i++){var option=PBSInspectorOptions.Shortcode[base].options[i];option.id&&("content"===option.id?scData.content=option["default"]||"":scData.attrs[option.id]=option["default"]||"")}return new wp.shortcode(scData).string()},Shortcode}(ContentTools.Tools.ElementButton),ContentTools.Tools.Heading1=function(_super){function Heading1(){return Heading1.__super__.constructor.apply(this,arguments)}return __extends(Heading1,_super),ContentTools.ToolShelf.stow(Heading1,"h1"),Heading1.label=pbsParams.labels.heading_label.replace("%d","1"),Heading1.icon="h1",Heading1.tagName="h1",Heading1.canApply=function(element,selection){return"ListItemText"!==element.constructor.name&&("TableCellText"!==element.constructor.name&&ContentTools.Tools.Paragraph.canApply(element,selection))},Heading1.apply=function(element,selection,callback){if(!this.isApplied(element)){if(!element.content){var heading=new ContentEdit.Text(this.tagName);return element.parent().attach(heading,element.parent().children.indexOf(element)+1),heading.focus(),callback(!0)}return Heading1.__super__.constructor.apply.call(this,element,selection,callback)}},Heading1.isApplied=function(element){return element.tagName()===this.tagName},Heading1}(ContentTools.Tools.Heading),ContentTools.Tools.Heading2=function(_super){function Heading2(){return Heading2.__super__.constructor.apply(this,arguments)}return __extends(Heading2,_super),ContentTools.ToolShelf.stow(Heading2,"h2"),Heading2.label=pbsParams.labels.heading_label.replace("%d","2"),Heading2.icon="h2",Heading2.tagName="h2",Heading2}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading3=function(_super){function Heading3(){return Heading3.__super__.constructor.apply(this,arguments)}return __extends(Heading3,_super),ContentTools.ToolShelf.stow(Heading3,"h3"),Heading3.label=pbsParams.labels.heading_label.replace("%d","3"),Heading3.icon="h3",Heading3.tagName="h3",Heading3}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading4=function(_super){function Heading4(){return Heading4.__super__.constructor.apply(this,arguments)}return __extends(Heading4,_super),ContentTools.ToolShelf.stow(Heading4,"h4"),Heading4.label=pbsParams.labels.heading_label.replace("%d","4"),Heading4.icon="h4",Heading4.tagName="h4",Heading4}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading5=function(_super){function Heading5(){return Heading5.__super__.constructor.apply(this,arguments)}return __extends(Heading5,_super),ContentTools.ToolShelf.stow(Heading5,"h5"),Heading5.label=pbsParams.labels.heading_label.replace("%d","5"),Heading5.icon="h5",Heading5.tagName="h5",Heading5}(ContentTools.Tools.Heading1),ContentTools.Tools.Heading6=function(_super){function Heading6(){return Heading6.__super__.constructor.apply(this,arguments)}return __extends(Heading6,_super),ContentTools.ToolShelf.stow(Heading6,"h6"),Heading6.label=pbsParams.labels.heading_label.replace("%d","6"),Heading6.icon="h6",Heading6.tagName="h6",Heading6}(ContentTools.Tools.Heading1),ContentTools.Tools.Blockquote=function(_super){function Blockquote(){return Blockquote.__super__.constructor.apply(this,arguments)}return __extends(Blockquote,_super),ContentTools.ToolShelf.stow(Blockquote,"blockquote"),Blockquote.label=pbsParams.labels.blockquote,Blockquote.icon="blockquote",Blockquote.tagName="blockquote",Blockquote}(ContentTools.Tools.Heading1),ContentTools.Tools.ClearFormatting=function(_super){function ClearFormatting(){return ClearFormatting.__super__.constructor.apply(this,arguments)}return __extends(ClearFormatting,_super),ContentTools.ToolShelf.stow(ClearFormatting,"clear-formatting"),ClearFormatting.label=pbsParams.labels.clear_formatting,ClearFormatting.icon="clear-formatting",ClearFormatting.tagName="span",ClearFormatting.canApply=function(element,selection){var _ref,from=0,to=0;return!!ContentTools.Tools.Bold.canApply(element,selection)&&(!(void 0===element.content||!element.content.length())&&(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),!!element.content.hasStyle(from,to)||(!!ContentTools.Tools.Align.isApplied(element,selection)||!("undefined"==typeof ContentTools.Tools.LineHeight||!ContentTools.Tools.LineHeight.isApplied(element)))))},ClearFormatting.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),element.content=element.content.removeStyles(from,to),"undefined"!=typeof ContentTools.Tools.LineHeight&&ContentTools.Tools.LineHeight.apply(element,selection,function(){},"reset"),ContentTools.Tools.Align._apply("reset"),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},ClearFormatting}(ContentTools.Tool),ContentTools.Tools.Code=function(_super){function Code(){return Code.__super__.constructor.apply(this,arguments)}return __extends(Code,_super),ContentTools.ToolShelf.stow(Code,"code"),Code.label=pbsParams.labels.code,Code.icon="code",Code.tagName="code",Code.canApply=function(element,selection){var _ref,from,to;return!!selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1],from!==to)},Code.apply=function(element,selection,callback){var from,to,_ref;return element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],this.isApplied(element,selection)?element.content=element.content.unformat(from,to,new HTMLString.Tag(this.tagName)):element.content=element.content.format(from,to,new HTMLString.Tag(this.tagName)),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Code.isApplied=function(element,selection){var from,to,_ref;return!!selection&&(!(void 0===element.content||!element.content.length())&&(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1),element.content.slice(from,to).hasTags(this.tagName,!0)))},Code}(ContentTools.Tools.Bold),ContentTools.Tools.Color=function(_super){function Color(){return Color.__super__.constructor.apply(this,arguments)}return __extends(Color,_super),ContentTools.ToolShelf.stow(Color,"color"),Color.label=pbsParams.labels.color,Color.icon="color",Color.tagName="span",Color.canApply=function(element,selection){var from,to,_ref,selectedContent,matches,s,apply=selection&&!selection.isCollapsed(),color="";if("Hr"===element.constructor.name)for(color=getComputedStyle(element._domElement).background,color=color.match(/linear-gradient\(\s*\w+,\s*\w+,\s*(rgba?\([^\)]+\)|#?\w+)/i)[1];color.match(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i);)color=color.replace(/(rgba\(\s*\d+,\s*\d+,\s*\d+,\s*\d+.\d{2})\d+/i,"$1");else{
if(!element.content)return!1;apply=selection&&!selection.isCollapsed(),apply?(_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(to+=1)):(from=0,to=element.content.length()),selectedContent=element.content.slice(from,to).html(),matches=selectedContent.match(/^<span[^>]style[^>]+['"\s;]color:\s?([#().,\w]+)/),matches&&(color=matches[1]),color||("undefined"==typeof this._defaultBodyTextColor&&(s=getComputedStyle(document.body),this._defaultBodyTextColor=s.color),color=this._defaultBodyTextColor)}return this._ceElement._domElement.style.backgroundColor!==color&&(this._ceElement._domElement.style.backgroundColor=color),color?window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label+": "+color):window.PBSEditor.getToolUI(this.icon)._domElement.setAttribute("data-tooltip",this.label),color},Color.isApplied=function(){return!1},Color.applyColor=function(color,element,selection){var _ref,from,to;if(element.isMounted()){if("Hr"===element.constructor.name)return void element.style("background-image","linear-gradient(0deg, transparent, "+color+", transparent)");selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),element.content=element.content.style(from,to,element._tagName,{color:color}),element.updateInnerHTML(),element.taint(),element.restoreState()}},Color.apply=function(element,selection,callback){var currColor;return this.rememberedSelection&&(selection=this.rememberedSelection),currColor=jQuery(this._ceElement._domElement.querySelector("input")).iris("color"),""===this._ceElement._domElement.querySelector("input").value&&(currColor=""),this.applyColor(currColor,element,selection),wp.hooks.doAction("pbs.tool.color.applied",element),callback(!0)},Color._colorPickerMount=function(){var _this=this,d=document.createElement("DIV"),o=document.createElement("INPUT");o.addEventListener("mousedown",function(){var _ref,from,to,element=ContentEdit.Root.get().focused(),selection=null;element.selection&&(selection=element.selection()),_ref=selection.get(),from=_ref[0],to=_ref[1],0===from&&0===to||(_this.rememberedSelection=selection)}),o.addEventListener("keyup",function(e){""===e.target.value&&(_this.selectedColor=e.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(),jQuery(_this._ceElement._domElement.querySelector("input")).iris("color",_this.selectedColor),e.target.focus())}),o.classList.add("color-picker"),o.setAttribute("data-alpha","true"),d.appendChild(o),this._ceElement._domElement.appendChild(d),jQuery(o).iris({defaultColor:this._ceElement._domElement.style.backgroundColor,change:function(event){_this._ceElement._justShowedPicker||(_this.selectedColor=event.target.value,_this._ceElement._mouseDown=!0,_this._ceElement._onMouseUp(event)),_this._ceElement._justShowedPicker=void 0},clear:function(){},hide:!1,palettes:["#282425","#3d3a3b","#555152","#6b6969","#838181","#9b999a","#b4b1b2","#cccbcb","#e5e4e4","#ffffff","#fd3d3f","#f70363","#eb389a","#a812a9","#7330b0","#4b4bae","#1490ec","#00a4ed","#00bacf","#009586","#e1d6b8","#5b7b88","#7c554a","#fe5234","#fe9631","#fec03b","#fbec57","#c2dd52","#75c457","#12b059"]}),document.querySelector(".ct-toolbox").addEventListener("mouseleave",function(){_this.hidePicker()}),document.body.addEventListener("mousedown",function(e){window.pbsSelectorMatches(e.target,".ct-tool--color, .ct-tool--color *")||_this.hidePicker()}),wp.hooks.addAction("pbs.tool.popup.open",function(){this.hidePicker()}.bind(this))},Color.hidePicker=function(){this._ceElement._domElement.classList.remove("pbs-tool-show"),this.rememberedSelection=null},Color}(ContentTools.Tool),ContentEdit.Root.get().bind("blur",function(){var tool=window.PBSEditor.getToolUI("color");"undefined"!=typeof tool&&tool.tool.hidePicker()}),ContentTools.ToolUI.prototype._colorPickerMountOverride=ContentTools.ToolUI.prototype.mount,ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=this._colorPickerMountOverride(domParent,before);return this.tool._ceElement=this,"undefined"!=typeof this.tool._colorPickerMount&&this.tool._colorPickerMount(),ret},ContentTools.ToolUI.prototype._toolColorAddDOMEventListeners=ContentTools.ToolUI.prototype._addDOMEventListeners,ContentTools.ToolUI.prototype._addDOMEventListeners=function(){var _this;return"Color"!==this.tool.name?this._toolColorAddDOMEventListeners():(_this=this,this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),this._domElement.addEventListener("click",function(e){var elements,element;e.target.classList.contains("ct-tool")&&!e.target.classList.contains("ct-tool--disabled")&&(_this._domElement.querySelector("input").value=_this._domElement.style.backgroundColor,_this._justShowedPicker=!0,jQuery(_this._domElement.querySelector("input")).iris("color",_this._domElement.style.backgroundColor),_this._domElement.classList.contains("pbs-tool-show")||wp.hooks.doAction("pbs.tool.popup.open"),_this._domElement.classList.toggle("pbs-tool-show"),element=ContentEdit.Root.get().focused(),element.selection&&(_this.tool.rememberedSelection=element.selection()),_this._domElement.querySelector("input").focus(),_this._domElement.querySelector("input").select(),elements=_this._domElement.querySelectorAll(".iris-palette"),Array.prototype.forEach.call(elements,function(el){"undefined"==typeof el._pbsInitDone&&(el._pbsInitDone=!0,el.addEventListener("mousedown",function(e){e.preventDefault()}))}))}),void 0)},ContentTools.Tools.TwoColumn=function(_super){function OneColumn(){return OneColumn.__super__.constructor.apply(this,arguments)}return __extends(OneColumn,_super),ContentTools.ToolShelf.stow(OneColumn,"onecolumn"),OneColumn.label=pbsParams.labels.one_column,OneColumn.icon="onecolumn",OneColumn.tagName="onecolumn",OneColumn.buttonName=pbsParams.labels.one_column,OneColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},OneColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("justify-content","center"),row.style("min-height","200px"),row.showOutline(),wp.hooks.doAction("pbs.tool.row.applied",row)},OneColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.TwoColumn=function(_super){function TwoColumn(){return TwoColumn.__super__.constructor.apply(this,arguments)}return __extends(TwoColumn,_super),ContentTools.ToolShelf.stow(TwoColumn,"twocolumn"),TwoColumn.label=pbsParams.labels.two_column,TwoColumn.icon="twocolumn",TwoColumn.tagName="twocolumn",TwoColumn.buttonName=pbsParams.labels.two_column,TwoColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},TwoColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","50%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","50%"),row.style("min-height","200px"),row.showOutline()},TwoColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.ThreeColumn=function(_super){function ThreeColumn(){return ThreeColumn.__super__.constructor.apply(this,arguments)}return __extends(ThreeColumn,_super),ContentTools.ToolShelf.stow(ThreeColumn,"threecolumn"),ThreeColumn.label=pbsParams.labels.three_column,ThreeColumn.icon="threecolumn",ThreeColumn.tagName="threecolumn",ThreeColumn.buttonName=pbsParams.labels.three_column,ThreeColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},ThreeColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","33.33%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","33.33%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","33.33%"),row.style("min-height","200px"),row.showOutline()},ThreeColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.FourColumn=function(_super){function FourColumn(){return FourColumn.__super__.constructor.apply(this,arguments)}return __extends(FourColumn,_super),ContentTools.ToolShelf.stow(FourColumn,"fourcolumn"),FourColumn.label=pbsParams.labels.four_column,FourColumn.icon="fourcolumn",FourColumn.tagName="fourcolumn",FourColumn.buttonName=pbsParams.labels.four_column,FourColumn.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return element.blur(),this.createNew(element.parent(),index),callback(!0)},FourColumn.createNew=function(parent,index){var row=new ContentEdit.DivRow("div"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},"");parent.attach(row,index),row.attach(col),col.attach(p),p.focus(),col.style("flex-basis","25%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),col=new ContentEdit.DivCol("div"),p=new ContentEdit.Text("p",{},""),row.attach(col),col.attach(p),col.style("flex-basis","25%"),row.style("min-height","200px"),row.showOutline()},FourColumn}(ContentTools.Tools.ElementButton),ContentTools.Tools.InsertElement=function(_super){function InsertElement(){return InsertElement.__super__.constructor.apply(this,arguments)}return __extends(InsertElement,_super),ContentTools.ToolShelf.stow(InsertElement,"insertElement"),InsertElement.label="",InsertElement.icon="insert-element",InsertElement.className="",InsertElement.apply=function(element,selection,callback){var editor=ContentTools.EditorApp.get();return editor._toolboxElements.toggle(),callback(!0)},InsertElement.canApply=function(){return!0},InsertElement}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this._domElement.classList.contains("ct-tool--insert-element")&&(this._domElement.innerHTML="<span>"+pbsParams.labels.add_element+"</span>",this._toolboxElementsHoverShow=function(){ContentTools.EditorApp.get()._toolboxElements.show()},this._domElement.addEventListener("mouseenter",this._toolboxElementsHoverShow),this._toolboxElementsSideMouseEnterHandler=function(ev){window.PBSEditor.isEditing()&&(ContentTools.EditorApp.get()._toolboxElements._domElement.classList.contains("ct-widget--active")||ev.screenX<=10&&ev.screenY>70&&ContentTools.EditorApp.get()._toolboxElements.show())},document.body.addEventListener("mousemove",this._toolboxElementsSideMouseEnterHandler),this._toolboxElementsLeaveHide=function(ev){window.pbsSelectorMatches(ev.relatedTarget,".pbs-toolbox-elements, .pbs-toolbox-elements *")||ContentTools.EditorApp.get()._toolboxElements.hide()},this._domElement.addEventListener("mouseleave",this._toolboxElementsLeaveHide)),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype.unmount;ContentTools.ToolUI.prototype.unmount=function(t,e){return this._domElement.classList.contains("ct-tool--insert-element")&&(this._domElement.removeEventListener("mouseenter",this._toolboxElementsHoverShow),document.body.removeEventListener("mousemove",this._toolboxElementsSideMouseEnterHandler)),proxied.call(this,t,e)}}();var defaultAlign;!function(){var ready=function(){defaultAlign=getComputedStyle(document.querySelector("html")).textAlign};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),ContentTools.Tools.Align=function(_super){function Align(){return Align.__super__.constructor.apply(this,arguments)}return __extends(Align,_super),ContentTools.ToolShelf.stow(Align,"align"),Align.label=pbsParams.labels.alignment,Align.labelDown=pbsParams.labels.alignment,Align.labelReset=pbsParams.labels.reset_alignment,Align.labelLeft=pbsParams.labels.align_left,Align.labelCenter=pbsParams.labels.align_center,Align.labelRight=pbsParams.labels.align_right,Align.labelJustify=pbsParams.labels.justify,Align.icon="align",Align.tagName="span",Align.canApply=function(element,selection){return"Icon"===element.constructor.name||ContentTools.Tools.Bold.canApply(element,selection)},Align.isApplied=function(element){var align;return"Icon"===element.constructor.name?element.hasCSSClass("alignleft")||element.hasCSSClass("alignright")||element.hasCSSClass("aligncenter"):(align=element.style("textAlign"),!!(window.pbsIsRTL()||"start"!==align&&"left"!==align||"start"!==defaultAlign&&"left"!==defaultAlign)&&(!window.pbsIsRTL()||"start"!==align&&"right"!==align||"start"!==defaultAlign&&"right"!==defaultAlign))},Align.apply=function(element,selection,callback){return callback(!0)},Align._apply=function(alignment,button){var element=ContentEdit.Root.get().focused();button&&(button.classList.contains(".ct-tool--disabled")||button.classList.contains("ct-tool--applied"))||("Icon"===element.constructor.name?(element.removeCSSClass("alignleft"),element.removeCSSClass("alignright"),element.removeCSSClass("aligncenter"),element.removeCSSClass("alignnone"),"reset"!==alignment&&element.addCSSClass("align"+alignment)):"reset"!==alignment?element.style("textAlign",alignment):element.style("textAlign",""),button&&(button.parentNode.querySelector(".ct-tool--applied").classList.remove("ct-tool--applied"),button.classList.add("ct-tool--applied")))},Align._alignButtonsMount=function(){var _this=this,d=document.createElement("DIV"),alignLeft=document.createElement("DIV"),alignCenter=document.createElement("DIV"),alignRight=document.createElement("DIV"),alignJustify=document.createElement("DIV");alignLeft.classList.add("ct-tool"),alignCenter.classList.add("ct-tool"),alignRight.classList.add("ct-tool"),alignJustify.classList.add("ct-tool"),alignLeft.classList.add("ct-tool--align-left"),alignCenter.classList.add("ct-tool--align-center"),alignRight.classList.add("ct-tool--align-right"),alignJustify.classList.add("ct-tool--align-justify"),alignLeft.setAttribute("data-tooltip",this.labelLeft),alignCenter.setAttribute("data-tooltip",this.labelCenter),alignRight.setAttribute("data-tooltip",this.labelRight),alignJustify.setAttribute("data-tooltip",this.labelJustify),d.appendChild(alignLeft),d.appendChild(alignCenter),d.appendChild(alignRight),d.appendChild(alignJustify),this.alignLeft=alignLeft,this.alignCenter=alignCenter,this.alignRight=alignRight,this.alignJustify=alignJustify,this._ceElement._domElement.appendChild(d),alignLeft.addEventListener("click",function(e){this._apply("left",e.target)}.bind(this)),alignCenter.addEventListener("click",function(e){this._apply("center",e.target)}.bind(this)),alignRight.addEventListener("click",function(e){this._apply("right",e.target)}.bind(this)),alignJustify.addEventListener("click",function(e){this._apply("justify",e.target)}.bind(this)),document.body.addEventListener("mousedown",function(e){window.pbsSelectorMatches(e.target,".ct-tool--align, .ct-tool--align *")||_this.hidePicker()}),wp.hooks.addAction("pbs.tool.popup.open",function(){this.hidePicker()}.bind(this))},Align.hidePicker=function(){this._ceElement._domElement.classList.remove("pbs-tool-show")},Align}(ContentTools.Tool),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this.tool._ceElement=this,"undefined"!=typeof this.tool._alignButtonsMount&&this.tool._alignButtonsMount(),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){var _this=this;return"Align"!==this.tool.name?proxied.call(this):(this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),void this._domElement.addEventListener("click",function(e){var element,_ref;e.target.classList.contains("ct-tool")&&!e.target.classList.contains("ct-tool--disabled")&&(_this._domElement.classList.contains("pbs-tool-show")||wp.hooks.doAction("pbs.tool.popup.open"),element=ContentEdit.Root.get().focused(),"ListItemText"!==(_ref=element.type())&&"TableCellText"!==_ref||(element=element.parent()),_this.tool.alignLeft.classList.remove("ct-tool--applied"),_this.tool.alignCenter.classList.remove("ct-tool--applied"),_this.tool.alignRight.classList.remove("ct-tool--applied"),_this.tool.alignJustify.classList.remove("ct-tool--applied"),"Icon"===element.constructor.name?(element.hasCSSClass("alignleft")?_this.tool.alignLeft.classList.add("ct-tool--applied"):element.hasCSSClass("alignright")?_this.tool.alignRight.classList.add("ct-tool--applied"):_this.tool.alignCenter.classList.add("ct-tool--applied"),_this.tool.alignJustify.classList.add("ct-tool--disabled")):("left"===element.style("textAlign")||"start"===element.style("textAlign")?_this.tool.alignLeft.classList.add("ct-tool--applied"):"right"===element.style("textAlign")||"end"===element.style("textAlign")?_this.tool.alignRight.classList.add("ct-tool--applied"):"center"===element.style("textAlign")?_this.tool.alignCenter.classList.add("ct-tool--applied"):"justify"===element.style("textAlign")&&_this.tool.alignJustify.classList.add("ct-tool--applied"),_this.tool.alignJustify.classList.remove("ct-tool--disabled")),_this._domElement.classList.toggle("pbs-tool-show"))}))}}(),ContentTools.Tools.Spacer=function(_super){function Spacer(){return Spacer.__super__.constructor.apply(this,arguments)}return __extends(Spacer,_super),ContentTools.ToolShelf.stow(Spacer,"spacer"),Spacer.label=pbsParams.labels.spacer,Spacer.icon="spacer",Spacer.tagName="div",Spacer.buttonName=pbsParams.labels.spacer,Spacer.canApply=function(){return!0},Spacer.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Spacer.createNew=function(parent,index){var spacer=new ContentEdit.Spacer("div");parent.attach(spacer,index)},Spacer}(ContentTools.Tool),ContentTools.Tools.Sidebar=function(_super){function Sidebar(){return Sidebar.__super__.constructor.apply(this,arguments)}return __extends(Sidebar,_super),ContentTools.ToolShelf.stow(Sidebar,"sidebar"),Sidebar.label=pbsParams.labels.sidebar_or_widget_area,Sidebar.icon="sidebar",Sidebar.tagName="sidebar",Sidebar.buttonName=pbsParams.labels.sidebar,Sidebar.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Sidebar.createNew=function(parent,index){var defaultSidebar="";for(var sidebarID in pbsParams.sidebar_list)if(sidebarID&&pbsParams.sidebar_list.hasOwnProperty(sidebarID)){defaultSidebar=sidebarID;break}var shortcode=wp.shortcode.next("pbs_sidebar",'[pbs_sidebar id="'+defaultSidebar+'"][/pbs_sidebar]',0),newElem=ContentEdit.Shortcode.createShortcode(shortcode);parent.attach(newElem,index),newElem.ajaxUpdate(!0),newElem.focus()},Sidebar}(ContentTools.Tools.ElementButton),ContentTools.Tools.Hr=function(_super){function Hr(){return Hr.__super__.constructor.apply(this,arguments)}return __extends(Hr,_super),ContentTools.ToolShelf.stow(Hr,"hr"),Hr.label=pbsParams.labels.horizontal_rule,Hr.icon="hr",Hr.tagName="hr",Hr.buttonName=pbsParams.labels.horizontal_rule,Hr.canApply=function(){return!0},Hr.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Hr.createNew=function(parent,index){var hr=new ContentEdit.Hr("hr");parent.attach(hr,index)},Hr}(ContentTools.Tool),ContentTools.Tools.Icon=function(_super){function Icon(){return Icon.__super__.constructor.apply(this,arguments)}return __extends(Icon,_super),ContentTools.ToolShelf.stow(Icon,"icon"),Icon.label=pbsParams.labels.icon,Icon.icon="icon",Icon.tagName="icon",Icon.buttonName=pbsParams.labels.icon,Icon.apply=function(element,selection,callback){return PBSEditor.iconFrame.open({title:pbsParams.labels.insert_icon,button:pbsParams.labels.use_icon,successCallback:function(view){var newElem=new ContentEdit.Icon("div",{},view.selected.innerHTML),index=element.parent().children.indexOf(element);element.parent().attach(newElem,index+1)}}),callback(!0)},Icon.createNew=function(parent,index){return PBSEditor.iconFrame.open({title:pbsParams.labels.insert_icon,button:pbsParams.labels.use_icon,successCallback:function(view){var newElem=new ContentEdit.Icon("div",{},view.selected.innerHTML);parent.attach(newElem,index)}}),null},Icon}(ContentTools.Tools.ElementButton),ContentTools.Tools.Link._pbsToolLinkOverrideCanApply=ContentTools.Tools.Link.canApply,ContentTools.Tools.Link.canApply=function(element,selection){var ret=this._pbsToolLinkOverrideCanApply(element,selection);if(!ret&&element.content&&selection){var _ref=selection.get(),from=_ref[0],to=_ref[1];if(from===to)return!0}return ret},ContentTools.Tools.Link.getSelectedLink=function(element,from,to){if(from<element.content.characters.length&&from>=0&&element.content.characters[from].hasTags("a"))for(;from>0;)if(from--,!element.content.characters[from].hasTags("a")){from++;break}if(to<element.content.characters.length&&to>=0&&element.content.characters[to].hasTags("a"))for(;to<element.content.characters.length&&element.content.characters[to].hasTags("a");)to++;return{from:from,to:to}},ContentTools.Tools.Link.apply=function(element,selection,callback){var url="",target="",text="",existingClass="",existingStyles="";if("Image"===element.constructor.name)element.a&&(url=element.a.href,target=element.a.target||"");else{var _ref=selection.get(),from=_ref[0],to=_ref[1],selected=this.getSelectedLink(element,from,to);from=selected.from,to=selected.to,selection=new ContentSelect.Range(from,to);var tag=this.getTag(element,selection);tag&&(tag.attr("href")&&(url=tag.attr("href")),tag.attr("target")&&(target=tag.attr("target")),tag.attr("class")&&(existingClass=tag.attr("class")),tag.attr("style")&&(existingStyles=tag.attr("style"))),text=element.content.unformat(from,to,"a"),text=text.slice(from,to)}return element.storeState&&element.storeState(),wpLink.open("dummy-wplink-textarea"),"Image"!==element.constructor.name&&text.html().trim()===text.text().trim()?(document.querySelector("#wp-link-wrap").classList.add("has-text-field"),text=text.text()):(document.querySelector("#wp-link-wrap").classList.remove("has-text-field"),text=""),document.querySelector("#wp-link-url, #link-options #url-field").value=url,document.querySelector("#wp-link-text, #link-options #link-title-field").value=text,document.querySelector("#wp-link-target, #link-options #link-target-checkbox").checked=""!==target,window._pbsCurrentLink={element:element,selection:selection,existingClass:existingClass,existingStyles:existingStyles,type:this.name},callback(!0)},window.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(ev){if("wp-link-submit"===ev.target.getAttribute("id")){var element=window._pbsCurrentLink.element,selection=window._pbsCurrentLink.selection,existingClass=window._pbsCurrentLink.existingClass,existingStyles=window._pbsCurrentLink.existingStyles,linkType=window._pbsCurrentLink.type,url=document.querySelector("#wp-link-url, #link-options #url-field").value,text=document.querySelector("#wp-link-text, #link-options #link-title-field").value,target=document.querySelector("#wp-link-target, #link-options #link-target-checkbox").checked;if("Image"===element.constructor.name)element.a||(element.a={}),element.a.href=url,element.a.target=target?"_blank":"";else{var _ref=selection.get(),from=_ref[0],to=_ref[1];if(element.content=element.content.unformat(from,to,"a"),url){var args={href:url};if(target&&(args.target="_blank"),existingClass&&(args["class"]=existingClass),existingStyles&&(args.style=existingStyles),args=wp.hooks.applyFilters("pbs.tool."+linkType.toLowerCase()+".args",args),document.querySelector("#wp-link-wrap").classList.contains("has-text-field")&&""===text.trim()&&(text=url),text){var content=new HTMLString.String(text,"PreText"===element.constructor.name);content=content.format(0,content.characters.length,new HTMLString.Tag("a",args));var tip=element.content.substring(0,selection.get()[0]),tail=element.content.substring(selection.get()[1]);element.content=tip.concat(content),element.content=element.content.concat(tail,!1),from===to&&(to+=content.length())}else element.content=element.content.format(from,to,new HTMLString.Tag("a",args))}else element.content=element.content.unformat(from,to,"a")}delete window._pbsCurrentLink,wp.hooks.doAction("pbs.tool."+linkType.toLowerCase()+".applied",element,from,to),"Image"!==element.constructor.name&&(element.updateInnerHTML(),element.taint(),element.restoreState&&element.restoreState()),wpLink.close()}})}),ContentTools.Tools.Link.getTag=function(element,selection){var c,from,selectedContent,tag,to,_i,_j,_len,_len1,_ref,_ref1,_ref2;if("Image"===element.constructor.name){if(element.a)return element.a}else for(_ref=selection.get(),from=_ref[0],to=_ref[1],selectedContent=element.content.slice(from,to),_ref1=selectedContent.characters,_i=0,_len=_ref1.length;_i<_len;_i++)if(c=_ref1[_i],c.hasTags("a"))for(_ref2=c.tags(),_j=0,_len1=_ref2.length;_j<_len1;_j++)if(tag=_ref2[_j],"a"===tag.name())return tag;return null},ContentTools.Tools.Widget=function(_super){function Widget(){return Widget.__super__.constructor.apply(this,arguments)}return __extends(Widget,_super),ContentTools.ToolShelf.stow(Widget,"widget"),Widget.label=pbsParams.labels.widget,Widget.icon="widget",Widget.tagName="widget",Widget.buttonName=pbsParams.labels.widget,Widget.apply=function(element,selection,callback){var root=ContentEdit.Root.get(),elemFocused=null;if(root.focused())elemFocused=root.focused();else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(elemFocused=mainRegion.children[0])}var index=elemFocused.parent().children.indexOf(elemFocused)+1;return this.createNew(elemFocused.parent(),index),callback(!0)},Widget.createNew=function(parent,index){PBSEditor.widgetFrame.open({title:pbsParams.labels.insert_widget,button:pbsParams.labels.insert_widget,successCallback:function(view){var base="pbs_widget",widgetSlug=view.selected.getAttribute("data-widget-slug"),shortcodeRaw='[pbs_widget widget="'+widgetSlug+'" ]',shortcode=wp.shortcode.next(base,shortcodeRaw,0),elem=ContentEdit.Shortcode.createShortcode(shortcode);parent.attach(elem,index),elem.focus(),setTimeout(function(){elem.ajaxUpdate(!0)},20)}})},Widget}(ContentTools.Tools.ElementButton),ContentTools.Tools.Text=function(_super){function Text(){return Text.__super__.constructor.apply(this,arguments)}return __extends(Text,_super),ContentTools.ToolShelf.stow(Text,"text"),Text.label=pbsParams.labels.text,Text.icon="text",Text.tagName="p",Text.shortcut="",Text.buttonName=pbsParams.labels.text,Text.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Text.createNew=function(parent,index){var newElem=new ContentEdit.Text("p",{},"");parent.attach(newElem,index),newElem.focus()},Text}(ContentTools.Tools.ElementButton),ContentTools.Tools.Html=function(_super){function Html(){return Html.__super__.constructor.apply(this,arguments)}return __extends(Html,_super),ContentTools.ToolShelf.stow(Html,"html"),Html.label=pbsParams.labels.html,Html.icon="html",Html.tagName="html",Html.buttonName=pbsParams.labels.html,Html.apply=function(element,selection,callback){var root=ContentEdit.Root.get(),elemFocused=null;if(root.focused())elemFocused=root.focused();else{var mainRegion=ContentTools.EditorApp.get().regions()["main-content"];mainRegion.children&&(elemFocused=mainRegion.children[0])}var dummy=document.createElement("DIV");dummy.setAttribute("data-ce-tag","html");var elem=ContentEdit.Html.fromDOMElement(dummy),index=elemFocused.parent().children.indexOf(elemFocused);return elemFocused.parent().attach(elem,index+1),elem.focus(),elem.openEditor(),callback(!0)},Html.createNew=function(parent,index){var dummy=document.createElement("DIV");dummy.setAttribute("data-ce-tag","html");var elem=ContentEdit.Html.fromDOMElement(dummy);parent.attach(elem,index),elem.focus(),elem.openEditor()},Html}(ContentTools.Tools.ElementButton),ContentTools.Tools.Map=function(_super){function Map(){return Map.__super__.constructor.apply(this,arguments)}return __extends(Map,_super),ContentTools.ToolShelf.stow(Map,"map"),Map.label=pbsParams.labels.map,Map.icon="map",Map.tagName="div",Map.shortcut="",Map.buttonName=pbsParams.labels.google_map,Map.apply=function(element,selection,callback){var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Map.createNew=function(parent,index){var newElem=ContentEdit.Map.create();parent.attach(newElem,index),newElem.focus()},Map}(ContentTools.Tools.ElementButton),ContentTools.Tools.Tabs=function(_super){function Tabs(){return Tabs.__super__.constructor.apply(this,arguments)}return __extends(Tabs,_super),ContentTools.ToolShelf.stow(Tabs,"tabs"),Tabs.label=pbsParams.labels.tabs,Tabs.icon="tabs",Tabs.tagName="tabs",Tabs.buttonName=pbsParams.labels.tabs,Tabs.apply=function(element,selection,callback){if(window.pbsSelectorMatches(element._domElement,'[data-ce-tag="tabs"] *'))for(;element&&"Tabs"!==element.constructor.name;)element=element.parent();var index=element.parent().children.indexOf(element)+1;return this.createNew(element.parent(),index),callback(!0)},Tabs.createNew=function(parent,index){for(var hashes=[];hashes.length<4;){var hash=window.PBSEditor.generateHash();document.querySelector(".pbs-tabs-"+hash)||document.querySelector('[id="pbs-tabs-'+hash+'"]')||hashes.indexOf(hash)===-1&&hashes.push(hash)}var elem=document.createElement("div");elem.classList.add("pbs-tabs-"+hashes[0]),elem.setAttribute("data-ce-tag","tabs"),elem.innerHTML='<input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[1]+'" data-tab="1" data-ce-tag="tabradio" checked /><input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[2]+'" data-tab="2" data-ce-tag="tabradio" /><input class="pbs-tab-state" type="radio" name="pbs-tabs-'+hashes[0]+'" id="pbs-tab-'+hashes[3]+'" data-tab="3" data-ce-tag="tabradio" /><div class="pbs-tab-tabs" data-ce-tag="tabcontainer"><label for="pbs-tab-'+hashes[1]+'" data-ce-tag="tab" class="pbs-tab-active"><span style="font-weight: bold;">Tab 1</span></label><label for="pbs-tab-'+hashes[2]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 2</span></label><label for="pbs-tab-'+hashes[3]+'" data-ce-tag="tab"><span style="font-weight: bold;">Tab 3</span></label></div><div class="pbs-tab-panels" data-ce-tag="tabpanelcontainer"><div class="pbs-row" data-panel="1"><div class="pbs-col"><p>Tab 1 content</p></div></div><div class="pbs-row" data-panel="2"><div class="pbs-col"><p>Tab 2 content</p></div></div><div class="pbs-row" data-panel="3"><div class="pbs-col"><p>Tab 3 content</p></div></div></div>';var newElem=ContentEdit.Tabs.fromDOMElement(elem);parent.attach(newElem,index),newElem.focus()},Tabs}(ContentTools.Tools.ElementButton);var toolMediaFrame,imageInserted,boundInsertHandler;wp.media.view.settings.post&&(wp.media.view.settings.post.id=pbsParams.post_id),
ContentTools.Tools.pbsMedia=function(_super){function pbsMedia(){return pbsMedia.__super__.constructor.apply(this,arguments)}return __extends(pbsMedia,_super),ContentTools.ToolShelf.stow(pbsMedia,"pbs-media"),pbsMedia.label=pbsParams.labels.media,pbsMedia.icon="image",pbsMedia.buttonName=pbsParams.labels.media,pbsMedia.apply=function(element,selection){var root,elem;this._isOpen()||(root=ContentEdit.Root.get(),elem=root.focused(),ContentSelect.Range.query(elem._domElement),selection=ContentSelect.Range.query(elem._domElement),window._tempSelection=selection,this.createNew(element.parent(),elem.parent().children.indexOf(elem)+1))},pbsMedia.createNew=function(parent,index){this._attachToParent=parent,this._attachIndex=index,window._pbsAddMediaOrigInsert=wp.media.editor.insert,wp.media.editor.insert=this.pbsAddMediaOverrideInsert.bind(this),toolMediaFrame=wp.media.editor.open(),boundInsertHandler||(boundInsertHandler=pbsMedia.insertHandler.bind(this)),toolMediaFrame.on("insert",boundInsertHandler)},pbsMedia.insertHandler=function(g){var size=g.single().attributes.sizes[toolMediaFrame.$el.find('[name="size"]').val()],img=document.createElement("IMG");img.setAttribute("height",size.height),img.setAttribute("width",size.width),img.classList.add("aligncenter"),img.classList.add("ce-element"),img.classList.add("ce-element--type-image"),img.classList.add("wp-image-"+pbsParams.dummy_image_id),img.setAttribute("data-ce-size","w "+size.width+" x h 1"),img.setAttribute("alt",""),imageInserted=ContentEdit.Image.fromDOMElement(img),this._attachToParent.attach(imageInserted,this._attachIndex),toolMediaFrame.off("insert",boundInsertHandler)},pbsMedia._isOpen=function(){var el;return!!wp.media.editor.get()&&(el=wp.media.editor.get().el,!(0===el.offsetWidth&&0===el.offsetHeight))},pbsMedia.pbsAddMediaOverrideInsert=function(html){var base,shortcode,dummy,newElem,addedImage=!1;html.match(/^\[/)?(base=html.match(/^\[(\w+)/),base=base[1],shortcode=wp.shortcode.next(base,html,0),newElem=ContentEdit.Shortcode.createShortcode(shortcode),imageInserted&&(this._attachToParent.detach(imageInserted),imageInserted=null),this._attachToParent.attach(newElem,this._attachIndex),newElem.ajaxUpdate(!0)):(dummy=document.createElement("p"),dummy.innerHTML=html,newElem=ContentEdit.Image.fromDOMElement(dummy.firstChild),imageInserted&&(this._attachToParent.detach(imageInserted),imageInserted=null),newElem&&(this._attachToParent.attach(newElem,this._attachIndex),addedImage=!0)),wp.media.editor.insert=window._pbsAddMediaOrigInsert,delete window._pbsAddMediaOrigInsert},pbsMedia}(ContentTools.Tools.ElementButton),function(){var dragEnterHandler=function(){var root,elem,mediaModals=document.querySelectorAll('[tabindex="0"] .media-modal'),allModalsHidden=!0;Array.prototype.forEach.call(mediaModals,function(el){0!==el.offsetHeight&&(allModalsHidden=!1)}),allModalsHidden&&(root=ContentEdit.Root.get(),elem=root.focused(),elem&&window.PBSEditor.getToolUI("pbs-media").apply(elem,null))};window.addEventListener("DOMContentLoaded",function(){var editor=ContentTools.EditorApp.get();editor.bind("start",function(){document.addEventListener("dragenter",dragEnterHandler)}),editor.bind("stop",function(){document.removeEventListener("dragenter",dragEnterHandler)})})}(),function(){ContentTools.Tools.Table.canApply=function(){return!0}}(),function(){ContentTools.Tools.Table.createNew=function(parent,index){var app,dialog,modal,table;return app=ContentTools.EditorApp.get(),modal=new ContentTools.ModalUI,table=null,dialog=new ContentTools.TableDialog(table),dialog.bind("cancel",function(_this){return function(){dialog.unbind("cancel"),modal.hide(),dialog.hide()}}(this)),dialog.bind("save",function(_this){return function(tableCfg){dialog.unbind("save"),table=_this._createTable(tableCfg),parent.attach(table,index),table.firstSection().children[0].children[0].children[0].focus(),modal.hide(),dialog.hide()}}(this)),app.attach(modal),app.attach(dialog),modal.show(),dialog.show()}}(),ContentTools.Tools.Underline=function(_super){function Underline(){return Underline.__super__.constructor.apply(this,arguments)}return __extends(Underline,_super),ContentTools.ToolShelf.stow(Underline,"underline"),Underline.label=pbsParams.labels.underline,Underline.icon="underline",Underline.tagName="span",Underline.shortcut="ctrl+u",Underline.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Underline.isApplied=function(element,selection){var _ref,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"underline"===element.content.substring(from,to).getStyle("text-decoration",element))},Underline.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var style=element.content.substring(from,to).getStyle("text-decoration",element);style=style&&"none"!==style&&"line-through"!==style?"none":"underline";var newStyle={"text-decoration":style};return element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Underline}(ContentTools.Tool),ContentTools.Tools.paragraphPicker=function(_super){function paragraphPicker(){return paragraphPicker.__super__.constructor.apply(this,arguments)}return __extends(paragraphPicker,_super),ContentTools.ToolShelf.stow(paragraphPicker,"paragraphPicker"),paragraphPicker.label=pbsParams.labels.text_style,paragraphPicker.icon="paragraph-picker",paragraphPicker.tagName="p",paragraphPicker.types={p:{className:"Paragraph",label:pbsParams.labels.paragraph},h1:{className:"Heading1",label:pbsParams.labels.heading_1},h2:{className:"Heading2",label:pbsParams.labels.heading_2},h3:{className:"Heading3",label:pbsParams.labels.heading_3},h4:{className:"Heading4",label:pbsParams.labels.heading_4},h5:{className:"Heading5",label:pbsParams.labels.heading_5},h6:{className:"Heading6",label:pbsParams.labels.heading_6},blockquote:{className:"Blockquote",label:'"'+pbsParams.labels.blockquote+'"'},pre:{className:"Preformatted",label:pbsParams.labels.preformatted}},paragraphPicker.canApply=function(element){var tag;if(this.types.hasOwnProperty(element.tagName())){for(tag in this.types)this.types.hasOwnProperty(tag)&&element.tagName()!==tag&&this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-"+tag)&&this._ceElement._domElement.classList.remove("pbs-paragraph-picker-type-"+tag);this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-"+element.tagName())||(this._ceElement._domElement.classList.add("pbs-paragraph-picker-type-"+element.tagName()),this._ceElement._domElement.firstChild.textContent=this.types[element.tagName()].label)}return"LABEL"!==element._domElement.tagName&&void 0!==element},paragraphPicker.isApplied=function(){return!this._ceElement._domElement.classList.contains("pbs-paragraph-picker-type-p")},paragraphPicker.apply=function(element,selection,callback){return this.applyTag(element,this._selectedType,selection,callback)},paragraphPicker.applyTag=function(element,tag,selection,callback){var app,forceAdd,paragraph,region,prevColor;app=ContentTools.EditorApp.get(),forceAdd=app.ctrlDown(),element.storeState&&element.storeState(),prevColor=ContentTools.Tools.Color.canApply(element,selection),ContentTools.Tools.ClearFormatting.apply(element,selection,function(){}),ContentTools.Tools.Heading.canApply(element)&&!forceAdd?ContentTools.Tools[paragraphPicker.types[tag].className].apply(element,selection,callback):("Region"!==element.parent().type()&&(element=element.closest(function(node){return"Region"===node.parent().type()})),region=element.parent(),paragraph=new ContentEdit.Text(tag),region.attach(paragraph,region.children.indexOf(element)+1),paragraph.focus(),callback(!0)),prevColor!==element.defaultStyle("color")&&ContentTools.Tools.Color.applyColor(prevColor,element,selection),element.restoreState&&element.restoreState()},paragraphPicker._paragraphPickerMount=function(){var tag,label,_this=this,d=document.createElement("DIV");for(tag in this.types)this.types.hasOwnProperty(tag)&&(label=document.createElement(tag),label.innerHTML=this.types[tag].label,label.setAttribute("data-tag",tag),label.setAttribute("data-class",this.types[tag].className),d.appendChild(label),label.addEventListener("mousedown",function(ev){ev.preventDefault(),this._selectedType=ev.target.getAttribute("data-tag"),this._selectedClass=ev.target.getAttribute("data-class"),this._ceElement._mouseDown=!0,this._ceElement._onMouseUp(),this.hidePicker()}.bind(this)));this._ceElement._domElement.innerHTML=pbsParams.labels.paragraph,this._ceElement._domElement.appendChild(d),document.body.addEventListener("mousedown",function(e){window.pbsSelectorMatches(e.target,".ct-tool--paragraph-picker, .ct-tool--paragraph-picker *")||_this.hidePicker()}),wp.hooks.addAction("pbs.tool.popup.open",function(){this.hidePicker()}.bind(this))},paragraphPicker.hidePicker=function(){this._ceElement._domElement.querySelector("div").style.display="",this.rememberedSelection=null},paragraphPicker}(ContentTools.Tool),ContentEdit.Root.get().bind("blur",function(){var tool=window.PBSEditor.getToolUI("paragraph");"undefined"!=typeof tool&&tool.tool.hidePicker()}),function(){var proxied=ContentTools.ToolUI.prototype.mount;ContentTools.ToolUI.prototype.mount=function(domParent,before){var ret=proxied.call(this,domParent,before);return this.tool._ceElement=this,"undefined"!=typeof this.tool._paragraphPickerMount&&this.tool._paragraphPickerMount(),ret}}(),function(){var proxied=ContentTools.ToolUI.prototype._addDOMEventListeners;ContentTools.ToolUI.prototype._addDOMEventListeners=function(){var _this=this;return"paragraphPicker"!==this.tool.name?proxied.call(this):(this._domElement.addEventListener("mousedown",function(e){e.target.classList.contains("ct-tool")&&e.preventDefault()}),void this._domElement.addEventListener("click",function(e){e.target.classList.contains("ct-tool")&&(""===_this._domElement.querySelector("div").style.display&&wp.hooks.doAction("pbs.tool.popup.open"),_this._domElement.querySelector("div").style.display=_this._domElement.querySelector("div").style.display?"":"block")}))}}(),ContentTools.Tools.Strikethrough=function(_super){function Strikethrough(){return Strikethrough.__super__.constructor.apply(this,arguments)}return __extends(Strikethrough,_super),ContentTools.ToolShelf.stow(Strikethrough,"strikethrough"),Strikethrough.label=pbsParams.labels.strikethrough,Strikethrough.icon="strikethrough",Strikethrough.tagName="span",Strikethrough.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},Strikethrough.isApplied=function(element,selection){var _ref,from=0,to=0;return!(void 0===element.content||!element.content.length())&&(selection&&(_ref=selection.get(),from=_ref[0],to=_ref[1]),from===to&&(from=0,to=element.content.length()),"line-through"===element.content.substring(from,to).getStyle("text-decoration",element))},Strikethrough.apply=function(element,selection,callback){var from,to,_ref;element.storeState(),_ref=selection.get(),from=_ref[0],to=_ref[1],from===to&&(from=0,to=element.content.length());var style=element.content.substring(from,to).getStyle("text-decoration",element);style=style&&"none"!==style&&"underline"!==style?"none":"line-through";var newStyle={"text-decoration":style};return element.content=element.content.style(from,to,element._tagName,newStyle),element.updateInnerHTML(),element.taint(),element.restoreState(),callback(!0)},Strikethrough}(ContentTools.Tool),PBSEditor.shortcuts={"ctrl+r":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("right")},"ctrl+u":function(element,selection,callback){ContentTools.Tools.Underline.canApply(element,selection)&&ContentTools.Tools.Underline.apply(element,selection,callback)},"ctrl+e":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("center")},"ctrl+l":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("left")},"ctrl+j":function(element,selection){ContentTools.Tools.Align.canApply(element,selection)&&ContentTools.Tools.Align._apply("justify")},"ctrl+i":function(element,selection,callback){ContentTools.Tools.Italic.canApply(element,selection)&&ContentTools.Tools.Italic.apply(element,selection,callback)},"ctrl+b":function(element,selection,callback){ContentTools.Tools.Bold.canApply(element,selection)&&ContentTools.Tools.Bold.apply(element,selection,callback)},"ctrl+k":function(element,selection,callback){ContentTools.Tools.Link.canApply(element,selection)&&ContentTools.Tools.Link.apply(element,selection,callback)},"ctrl+shift+k":function(element,selection,callback){ContentTools.Tools.Button.canApply(element,selection)&&ContentTools.Tools.Button.apply(element,selection,callback)},"ctrl+p":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"p",selection,callback)},"ctrl+1":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h1",selection,callback)},"ctrl+2":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h2",selection,callback)},"ctrl+3":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h3",selection,callback)},"ctrl+4":function(element,selection,callback){ContentTools.Tools.paragraphPicker.applyTag(element,"h4",selection,callback)},"ctrl+.":function(element,selection,callback){ContentTools.Tools.UnorderedList.canApply(element,selection)&&ContentTools.Tools.UnorderedList.apply(element,selection,callback)},"ctrl+/":function(element,selection,callback){ContentTools.Tools.OrderedList.canApply(element,selection)&&ContentTools.Tools.OrderedList.apply(element,selection,callback)},"ctrl+=":function(element,selection,callback){ContentTools.Tools.FontSizeUp.canApply(element,selection)&&ContentTools.Tools.FontSizeUp.apply(element,selection,callback,"up")},"ctrl+-":function(element,selection,callback){ContentTools.Tools.FontSizeDown.canApply(element,selection)&&ContentTools.Tools.FontSizeDown.apply(element,selection,callback,"down")},"ctrl+o":function(element,selection,callback){ContentTools.Tools.Code.canApply(element,selection)&&ContentTools.Tools.Code.apply(element,selection,callback)},"ctrl+z":function(){ContentTools.Tools.Undo.apply(null,null,function(){})},"ctrl+m":function(element,selection,callback){ContentTools.Tools.pbsMedia.apply(element,selection,callback)}};var redoKey=navigator.appVersion.indexOf("Mac")!==-1?"ctrl+shift+z":"ctrl+y";PBSEditor.shortcuts[redoKey]=function(){ContentTools.Tools.Redo.apply(null,null,function(){})},ContentTools.Tools.paragraphPicker.label+=" (ctrl+p/1/2/3)",ContentTools.Tools.Bold.label+=" (ctrl+b)",ContentTools.Tools.Italic.label+=" (ctrl+i)",ContentTools.Tools.Underline.label+=" (ctrl+u)",ContentTools.Tools.Link.label+=" (ctrl+k)",ContentTools.Tools.Align.labelLeft+=" (ctrl+l)",ContentTools.Tools.Align.labelCenter+=" (ctrl+e)",ContentTools.Tools.Align.labelRight+=" (ctrl+r)",ContentTools.Tools.Align.labelJustify+=" (ctrl+j)",ContentTools.Tools.Code.label+=" (ctrl+o)",ContentTools.Tools.UnorderedList.label+=" (ctrl+.)",ContentTools.Tools.OrderedList.label+=" (ctrl+/)",ContentTools.Tools.Undo.label+=" (ctrl+z)",ContentTools.Tools.Redo.label+=" ("+redoKey+")",PBSEditor._shortcuts={};for(var code in PBSEditor.shortcuts)if(PBSEditor.shortcuts.hasOwnProperty(code)){var matches=code.match(/(^.*\+)([^+]*)$/);if(!matches.length)continue;var key=matches[1],sc=matches[2];"space"===sc?sc=32:"up"===sc?sc=38:"right"===sc?sc=39:"down"===sc?sc=40:"left"===sc?sc=37:"tab"===sc?sc=9:"enter"===sc?sc=13:"."===sc?sc=190:"/"===sc?sc=191:"="===sc?sc=187:"-"===sc?sc=189:"delete"===sc&&(sc=8),"number"==typeof sc?key+=sc:(sc=sc.match(/[a-z]/)?sc.toUpperCase():sc,key+=sc.charCodeAt(0)),PBSEditor._shortcuts[key]=PBSEditor.shortcuts[code]}PBSEditor.shortcuts=PBSEditor._shortcuts,PBSEditor._shortcuts=null,function(){var getShortcutKey=function(ev){var key="";if((ev.metaKey||ev.ctrlKey)&&(key+="ctrl"),ev.shiftKey&&(key+=key?"+":"",key+="shift"),key)return key+="+"+ev.keyCode},shortcutListener=function(ev){var key=getShortcutKey(ev),element=ContentEdit.Root.get().focused();if(wp.hooks.applyFilters("pbs.shortcuts",!1,key,element))return void ev.preventDefault();if(element&&PBSEditor.shortcuts[key]){var selection=null;return element.selection&&(selection=element.selection()),ev.preventDefault(),PBSEditor.shortcuts[key](element,selection,function(){}),ev.preventDefault(),void ev.stopPropagation()}},addDomEventListenersProxy=ContentTools.ToolboxBarUI.prototype._addDOMEventListeners;ContentTools.ToolboxBarUI.prototype._addDOMEventListeners=function(){return document.addEventListener("keydown",shortcutListener),addDomEventListenersProxy.call(this)};var removeDomEventListenersProxy=ContentTools.ToolboxBarUI.prototype._removeDOMEventListeners;ContentTools.ToolboxBarUI.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keydown",shortcutListener),removeDomEventListenersProxy.call(this)}}(),window.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(ev){if(!(window.innerWidth<=800))if(window.PBSEditor.isEditing())if(!ev.metaKey&&!ev.ctrlKey||83!==ev.keyCode&&27!==ev.keyCode)(ev.metaKey||ev.ctrlKey)&&ev.shiftKey&&82===ev.keyCode&&(ev.preventDefault(),location.reload());else{ev.preventDefault();var element=ContentEdit.Root.get().focused();element&&element.blur(),83===ev.keyCode?document.querySelector("#wp-admin-bar-gambit_builder_save").dispatchEvent(new CustomEvent("click")):document.querySelector("#wp-admin-bar-gambit_builder_cancel").dispatchEvent(new CustomEvent("click"))}else(ev.metaKey||ev.ctrlKey)&&69===ev.keyCode&&(document.querySelector("#wp-admin-bar-gambit_builder_edit").dispatchEvent(new CustomEvent("click")),ev.preventDefault())})}),ContentTools.Tools.PremiumFormatting=function(_super){function PremiumFormatting(){return PremiumFormatting.__super__.constructor.apply(this,arguments)}return __extends(PremiumFormatting,_super),ContentTools.ToolShelf.stow(PremiumFormatting,"premium-formatting"),PremiumFormatting.label="",PremiumFormatting.labelReset="",PremiumFormatting.icon="",PremiumFormatting.canApply=function(element,selection){return ContentTools.Tools.Bold.canApply(element,selection)},PremiumFormatting.isApplied=function(){return!1},PremiumFormatting.apply=function(element,selection,callback){return callback(!0)},PremiumFormatting}(ContentTools.Tool),document.addEventListener("DOMContentLoaded",function(){var goPremiumButton=document.querySelector("#wp-admin-bar-pbs_go_premium");goPremiumButton&&goPremiumButton.addEventListener("click",function(){function carouselHide(num){indicators[num].setAttribute("data-state",""),slides[num].setAttribute("data-state",""),slides[num].style.opacity=0}function carouselShow(num){indicators[num].checked=!0,indicators[num].setAttribute("data-state","active"),slides[num].setAttribute("data-state","active"),slides[num].style.opacity=1}function setSlide(slide){return function(){for(var i=0;i<indicators.length;i++)indicators[i].setAttribute("data-state",""),slides[i].setAttribute("data-state",""),carouselHide(i);indicators[slide].setAttribute("data-state","active"),slides[slide].setAttribute("data-state","active"),carouselShow(slide),clearInterval(switcher)}}function switchSlide(){for(var nextSlide=0,i=0;i<indicators.length;i++)"active"===indicators[i].getAttribute("data-state")&&i!==indicators.length-1&&(nextSlide=i+1),carouselHide(i);carouselShow(nextSlide)}var div=document.createElement("DIV");div.innerHTML=wp.template("pbs-learn-premium")(),div.setAttribute("id","pbs-learn-premium-wrapper"),document.body.appendChild(div),setTimeout(function(){div.classList.add("pbs-shown")},50),document.querySelector("#pbs-learn-premium-wrapper .pbs-tour-close").addEventListener("click",function(){document.body.removeChild(div)});var carousel=document.querySelector(".pbs-learn-carousel"),speed=7e3;if(carousel)for(var slides=carousel.querySelectorAll(".pbs-learn-slide"),indicators=carousel.querySelectorAll(".pbs-learn-indicators label"),switcher=setInterval(function(){switchSlide()},speed),i=0;i<indicators.length;i++)indicators[i].querySelector("input").addEventListener("click",setSlide(i))})}),document.addEventListener("DOMContentLoaded",function(){if(pbsParams.is_lite){var shownPremiumNotice=!1;document.addEventListener("click",function(ev){if(ev.target&&"pbs-learn-premium-wrapper"===ev.target.getAttribute("id"))return void document.querySelector("#pbs-learn-premium-wrapper .pbs-tour-close").dispatchEvent(new CustomEvent("click"));if(window.pbsSelectorMatches(ev.target,".pbs-premium-flag:not(.pbs-collapsable-title), .pbs-premium-flag:not(.pbs-collapsable-title) *")){shownPremiumNotice=!0;var div=document.createElement("DIV");div.innerHTML=wp.template("pbs-learn-premium-elements")(),div.setAttribute("id","pbs-learn-premium-wrapper"),document.body.appendChild(div),setTimeout(function(){div.classList.add("pbs-shown")},50),document.querySelector("#pbs-learn-premium-wrapper .pbs-tour-close").addEventListener("click",function(){document.body.removeChild(div)})}})}}),window.pbsPlayTour=function(){if(localStorage){if(localStorage.getItem("pbs_did_intro_v4"))return;localStorage.setItem("pbs_did_intro_v4",1)}var tourModalWrapper=document.createElement("DIV");tourModalWrapper.classList.add("pbs-tour-modal-wrapper");var tourModal=document.createElement("DIV");tourModal.classList.add("pbs-tour-modal"),tourModalWrapper.appendChild(tourModal);var closeButton=document.createElement("DIV");closeButton.classList.add("pbs-tour-close"),tourModal.appendChild(closeButton),closeButton.addEventListener("click",function(){tourModalWrapper.classList.remove("pbs-tour-shown"),setTimeout(function(){document.body.removeChild(tourModalWrapper)},400)});var iframe=document.createElement("IFRAME");iframe.setAttribute("src","https://www.youtube.com/embed/dSU2l1Vhp50?rel=0&autoplay=1&showinfo=0&autohide=1&controls=0"),iframe.setAttribute("width","800"),iframe.setAttribute("height","450"),iframe.setAttribute("frameborder","0"),iframe.setAttribute("allowfullscreen","1"),tourModal.appendChild(iframe),document.body.appendChild(tourModalWrapper),setTimeout(function(){tourModalWrapper.classList.add("pbs-tour-shown")},100);var editor=ContentTools.EditorApp.get();editor.unbind("start",window.pbsPlayTour);var payload=new FormData;payload.append("action","pbs_did_tour"),payload.append("nonce",pbsParams.nonce);var xhr=new XMLHttpRequest;xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)},function(){var ready=function(){if(pbsParams.do_intro){var editor=ContentTools.EditorApp.get();editor.bind("start",window.pbsPlayTour)}};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),function(){var ready=function(){jQuery(document).on("heartbeat-send",function(e,data){window.PBSEditor.isEditing()&&(data.tracking_interval=wp.heartbeat.interval())})};"loading"!==document.readyState?ready():document.addEventListener("DOMContentLoaded",ready)}(),window.addEventListener("DOMContentLoaded",function(){pbsParams.tracking_opted_in&&wp.hooks.addAction("pbs.save.payload.post",function(payload){var xhrTracking=new XMLHttpRequest;xhrTracking.open("POST",pbsParams.ajax_url),payload.append("action","pbs_save_content_tracking"),xhrTracking.send(payload)})}),function(){var proxied=jQuery.fn.is;jQuery.fn.is=function(selector){var ret=proxied.call(this,selector);if(ret){var elem=this[0];if('<div tabindex="0"></div>'===elem.outerHTML)return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)}return ret}}(),window.addEventListener("DOMContentLoaded",function(){function checkHeartbeat(){var payload=new FormData;payload.append("action","pbs_heartbeat_check"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce),payload.append("media_manager_editor_nonce",wp.media.view.settings.nonce.sendToEditor);var xhr=new XMLHttpRequest;xhr.onload=function(){if(xhr.status>=200&&xhr.status<400){var response=JSON.parse(xhr.responseText);if(response){if(response.post_lock){var data={avatar:response.post_lock_avatar,avatar2x:response.post_lock_avatar2x,author_name:response.post_lock_author_name},div=document.createElement("DIV");div.innerHTML=wp.template("pbs-heartbeat-locked")(data),div.setAttribute("id","pbs-post-locked-dialog"),document.body.appendChild(div),modalIsOpen=!0,document.querySelector(".pbs-post-locked-back").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,doRemovePostLock=!1,document.querySelector("#wp-admin-bar-gambit_builder_cancel").dispatchEvent(new CustomEvent("click")),div.parentNode.removeChild(div)}),document.querySelector(".pbs-post-locked-takeover").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,overridePostLock(),div.parentNode.removeChild(div)})}response.nonce&&(pbsParams.nonce=response.nonce),response.media_manager_editor_nonce&&(wp.media.view.settings.nonce.sendToEditor=response.media_manager_editor_nonce)}}}.bind(this),xhr.onerror=function(){},xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)}function removePostLock(){var payload=new FormData;payload.append("action","pbs_remove_post_lock"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce);var xhr=new XMLHttpRequest;xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)}function overridePostLock(){var payload=new FormData;payload.append("action","pbs_override_post_lock"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce);var xhr=new XMLHttpRequest;xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)}function doAutosave(){var payload=new FormData;payload.append("action","pbs_autosave"),payload.append("post_id",pbsParams.post_id),payload.append("nonce",pbsParams.nonce);var content=ContentTools.EditorApp.get().regions()["main-content"].html();content=wp.hooks.applyFilters("pbs.save",content),payload.append("content",content);var xhr=new XMLHttpRequest;xhr.open("POST",pbsParams.ajax_url),xhr.send(payload)}if(wp.heartbeat){wp.heartbeat.interval(120);var lastAutosave=+new Date,loginListenerInterval=null,loginListener=function(){var authCheckWrapper=document.querySelector("#wp-auth-check-wrap");authCheckWrapper?authCheckWrapper.classList.contains("hidden")&&(clearInterval(loginListenerInterval),modalIsOpen=!1,wp.heartbeat.connectNow()):(clearInterval(loginListenerInterval),modalIsOpen=!1)},startLoginListener=function(){clearInterval(loginListenerInterval),loginListenerInterval=setInterval(loginListener,500)},modalIsOpen=!1;jQuery(document).on("heartbeat-send",function(e,data){if(window.PBSEditor.isEditing()&&(data["wp-refresh-post-nonces"]={post_id:pbsParams.post_id},data.pbs_nonce=pbsParams.nonce,data.media_manager_editor_nonce=wp.media.view.settings.nonce.sendToEditor,data.post_id=pbsParams.post_id,!modalIsOpen)){var autosaveDiff=(+new Date-lastAutosave)/1e3,autosaveInterval=15;pbsParams.autosave_interval&&(autosaveInterval=60*parseInt(pbsParams.autosave_interval,10)),autosaveDiff>autosaveInterval&&(lastAutosave=+new Date,data.content=ContentTools.EditorApp.get().regions()["main-content"].html(),data.content=wp.hooks.applyFilters("pbs.save",data.content))}}),jQuery(document).on("heartbeat-tick",function(e,data){if(window.PBSEditor.isEditing()){if(data["wp-auth-check"]===!1)return modalIsOpen=!0,void startLoginListener();if(data["wp-refresh-post-nonces"]){var nonces=data["wp-refresh-post-nonces"];nonces.heartbeatNonce&&(window.heartbeatSettings.nonce=nonces.heartbeatNonce),nonces.pbs_nonce_new&&(pbsParams.nonce=nonces.pbs_nonce_new),data.media_manager_editor_nonce_new&&(wp.media.view.settings.nonce.sendToEditor=data.media_manager_editor_nonce_new)}if(data.pbs_nonce_new&&(pbsParams.nonce=data.pbs_nonce_new),data.media_manager_editor_nonce_new&&(wp.media.view.settings.nonce.sendToEditor=data.media_manager_editor_nonce_new),!modalIsOpen&&data.has_post_lock&&!document.querySelector("#pbs-post-locked-dialog")){doAutosave();var templateData={avatar:data.post_lock_avatar,avatar2x:data.post_lock_avatar2x,author_name:data.post_lock_author_name},div=document.createElement("DIV");div.innerHTML=wp.template("pbs-heartbeat-takeover")(templateData),div.setAttribute("id","pbs-post-locked-dialog"),document.body.appendChild(div),modalIsOpen=!0,document.querySelector(".pbs-post-takeover-refresh").addEventListener("click",function(ev){ev.preventDefault(),modalIsOpen=!1,doRemovePostLock=!1,ContentTools.EditorApp.get().stop(),window.location.reload(),div.parentNode.removeChild(div)})}}});var doRemovePostLock=!0;ContentTools.EditorApp.get().bind("start",function(){wp.heartbeat.interval(15),checkHeartbeat(),doRemovePostLock=!0}),ContentTools.EditorApp.get().bind("stop",function(){wp.heartbeat.interval(120),doRemovePostLock&&removePostLock()})}}),window.PBSEditor||(window.PBSEditor={}),window.PBSEditor.hexToRgb=function(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},window.PBSEditor.rgbToHsl=function(r,g,b){r/=255,g/=255,b/=255;var h,s,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2;if(max===min)h=s=0;else{var d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h/=6}return{h:h,s:s,l:l}},function(){var proxy=ContentTools.IgnitionUI.prototype._addDOMEventListeners;ContentTools.IgnitionUI.prototype._addDOMEventListeners=function(){this._domEdit.addEventListener("click",function(ev){window.parent.pbsGoResponsive||ev.target.firstChild&&"#"!==ev.target.firstChild.getAttribute("href")&&(ev.stopImmediatePropagation(),ev.stopPropagation(),localStorage&&localStorage.setItem("pbs-open-"+pbsParams.post_id,"1"),window.location.href=ev.target.firstChild.getAttribute("href"))}),proxy.call(this)}}(),window.addEventListener("DOMContentLoaded",function(){document.querySelector("#wp-admin-bar-pbs_responsive_phone").addEventListener("click",function(ev){ev.preventDefault(),window.parent&&window.parent.pbsGoResponsive("phone")}),document.querySelector("#wp-admin-bar-pbs_responsive_tablet").addEventListener("click",function(ev){ev.preventDefault(),window.parent&&window.parent.pbsGoResponsive("tablet")}),document.querySelector("#wp-admin-bar-pbs_responsive_desktop").addEventListener("click",function(ev){ev.preventDefault(),window.parent&&window.parent.pbsGoResponsive("desktop")});var editor=ContentTools.EditorApp.get();editor.bind("stop",function(){window.parent&&window.parent.pbsGoResponsive("desktop")})}),window.parent.pbsGoResponsive&&(window.onunload=function(){window.top.postMessage("pbs_iframe_change","*")}),function(){var _Root=ContentEdit.Root.get(),proxiedStartDragging=_Root.startDragging;_Root.startDragging=function(element,x,y){if(!(window.innerWidth<=800))return proxiedStartDragging.call(this,element,x,y)}}(),function(){var proxy=ContentEdit.Image.prototype.openMediaManager;ContentEdit.Image.prototype.openMediaManager=function(){window.innerWidth<=800||proxy.call(this)}}(),window.pbsSwitchResponsiveStyles=function(screenSize,oldScreenSize){if(screenSize!==oldScreenSize){var styles={"margin-top":'.pbs-main-wrapper [style*="margin:"], .pbs-main-wrapper [style*="margin-top:"]',"margin-bottom":'.pbs-main-wrapper [style*="margin:"], .pbs-main-wrapper [style*="margin-bottom:"]'},sizes=["tablet","phone"];for(var style in styles)if(styles.hasOwnProperty(style)){for(var selector=styles[style],i=0;i<sizes.length;i++)selector+=", [data-pbs-"+sizes[i]+"-"+style+"]";
var elements=document.querySelectorAll(selector);Array.prototype.forEach.call(elements,function(el){var element=el._ceElement;element&&(element.style(style)&&element.attr("data-pbs-"+oldScreenSize+"-"+style,element.style(style)),element.attr("data-pbs-"+screenSize+"-"+style)?element.style(style,element.attr("data-pbs-"+screenSize+"-"+style)):"phone"===screenSize&&element.attr("data-pbs-tablet-"+style)?element.style(style,element.attr("data-pbs-tablet-"+style)):element.attr("data-pbs-desktop-"+style)?element.style(style,element.attr("data-pbs-desktop-"+style)):element.style(style,""),element.attr("data-pbs-phone-"+style)===element.attr("data-pbs-tablet-"+style)&&element.removeAttr("data-pbs-phone-"+style),element.attr("data-pbs-tablet-"+style)===element.attr("data-pbs-desktop-"+style)&&element.removeAttr("data-pbs-tablet-"+style))}),"desktop"===screenSize&&(elements=document.querySelectorAll("[data-pbs-"+screenSize+"-"+style+"]"),Array.prototype.forEach.call(elements,function(el){var element=el._ceElement;element&&element.removeAttr("data-pbs-"+screenSize+"-"+style)}))}}},window.PBSEditor.formattingTools=[[]],window.PBSEditor.formattingTools[0].push("insertElement","paragraphPicker","|","color","bold","italic","underline","strikethrough","link","align","|"),window.PBSEditor.formattingTools[0].push("uppercase","font-size-down","font-size-up","line-height"),window.PBSEditor.premiumTools={uppercase:pbsParams.labels.uppercase+" ("+pbsParams.labels.premium+")","font-size-down":pbsParams.labels.increase_font_size+" ("+pbsParams.labels.premium+")","font-size-up":pbsParams.labels.decrease_font_size+" ("+pbsParams.labels.premium+")","line-height":pbsParams.labels.increase_line_height+" ("+pbsParams.labels.premium+")"},window.PBSEditor.formattingTools[0].push("code","|","unordered-list","ordered-list","indent","unindent","|","clear-formatting","undo","redo"),window.PBSEditor.insertElements=[[]],pbsParams.is_lite?window.PBSEditor.insertElements[0].push("onecolumn","twocolumn","threecolumn","fourcolumn","text","pbs-media","icon","hr","spacer","shortcode","widget","sidebar","html","map","tabs","icon-label","button","carousel","table","toggle",pbsParams.labels.special_elements,"woocommerce","acf","nextgen","contact-form7","events-calendar","instagram-feed","predesigned","countup","countdown","page-heading","social-icons","call-to-action","contact-details","pricing-table","image-box","newsletter","testimonial","featurette","team-members","gallery"):window.PBSEditor.insertElements[0].push("onecolumn","twocolumn","threecolumn","fourcolumn","text","pbs-media","button","icon","hr","spacer","shortcode","widget","sidebar","html","map","icon-label","carousel","tabs","table","toggle",pbsParams.labels.special_elements,"woocommerce","acf","nextgen","contact-form7","events-calendar","instagram-feed","predesigned","countup","countdown","page-heading","social-icons","call-to-action","contact-details","pricing-table","image-box","newsletter","testimonial","featurette","team-members","gallery"),pbsParams.has_woocommerce||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("woocommerce"),1),pbsParams.has_nextgen_gallery||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("nextgen"),1),pbsParams.has_events_calendar||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("events-calendar"),1),pbsParams.has_acf||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("acf"),1),pbsParams.has_wpcf7||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("contact-form7"),1),pbsParams.has_instagram_feed||window.PBSEditor.insertElements[0].splice(window.PBSEditor.insertElements[0].indexOf("instagram-feed"),1),window.PBSEditor.premiumElements={button:pbsParams.labels.button,carousel:pbsParams.labels.carousel,newsletter:pbsParams.labels.newsletter,table:pbsParams.labels.table,predesigned:pbsParams.labels.pre_designed_sections,toggle:pbsParams.labels.toggle,countdown:pbsParams.labels.countdown,countup:pbsParams.labels.count_up,"icon-label":pbsParams.labels.icon_label,woocommerce:pbsParams.labels.woocommerce,acf:pbsParams.labels.advanced_custom_fields,nextgen:pbsParams.labels.nextgen,"contact-form7":pbsParams.labels.contact_form7,"events-calendar":pbsParams.labels.events_calendar,"instagram-feed":pbsParams.labels.instagram_feed,"page-heading":pbsParams.labels.page_heading,"call-to-action":pbsParams.labels.call_to_action,testimonial:pbsParams.labels.testimonial,"contact-details":pbsParams.labels.contact_details,"pricing-table":pbsParams.labels.pricing_table,"image-box":pbsParams.labels.image_box,"social-icons":pbsParams.labels.social_icons,featurette:pbsParams.labels.featurette,"team-members":pbsParams.labels.team_members,gallery:pbsParams.labels.gallery},ContentTools.DEFAULT_TOOLS=[[]],window.PBSEditor.toolHeadings=[],window.addEventListener("DOMContentLoaded",function(){new PBSEditor.OverlayColumn,new PBSEditor.OverlayRow,new PBSEditor.OverlayElement,new PBSEditor.ToolbarElement,new PBSEditor.ToolbarImage,new PBSEditor.ToolbarHtml,new PBSEditor.ToolbarIframe,new PBSEditor.ToolbarEmbed,new PBSEditor.ToolbarMap,new PBSEditor.ToolbarIcon,new PBSEditor.ToolbarShortcode,new PBSEditor.ToolbarRow,new PBSEditor.ToolbarColumn,new PBSEditor.ToolbarNewsletter,new PBSEditor.ToolbarList,new PBSEditor.ToolbarTabContainer,new PBSEditor.ToolbarTable,new PBSEditor.ToolbarTitle,new PBSEditor.ToolbarHr,new PBSEditor.ToolbarSpacer,!pbsParams.is_lite,new PBSEditor.TooltipLink,new PBSEditor.TooltipButton,new PBSEditor.TooltipInput,new PBSEditor.TooltipTab});